# Фракталы

## Введение

> section: introduction
> id: intro
> trailer: ohygDnKg5mg
> color: "#8032AD"
> level: Advanced
> next: chaos

В природе вы могли встречать сложные растения, например как эти:

::: column.r(width=320)

    img(src="images/fern.jpg" width=320 height=240)
    img.fractal-overlay(src="images/fern-overlay.png" width=320 height=240)

{.caption} Этот __папоротник__ состоит из множества маленьких листиков-веточек, которые соединяются в более крупные.

::: column.r(width=320)

    img(src="images/romanesco.jpg" width=320 height=240)
    img.fractal-overlay(src="images/romanesco-overlay.png" width=320 height=240)

{.caption} Этот __брокколи__ Романенко состоит из небольших [[конусов|кубиков|сфер]], закрученных по спирали вокруг большого.

:::

{.reveal(when="blank-0")} Изначально они выглядят как очень сложные формы, но если вы посмотрите ближе, то сможете заметить, что они построены по относительно простому шаблону: все [отдельно взятые части](target:fractal) растений выглядят точно так же, как и всё растение целиком. Одна и та же картина повторяется снова и снова, только в больших масштабах. [Продолжить](btn:next)

---

> id: fern

В математике мы называем это свойство __самоподобием__, а формы, которые имеют это свойство, называются [__фракталами__](gloss:fractal). Фракталы являются одними из самых красивых и самых странных объектов во всей математике.

Чтобы создать наши собственные фракталы, мы должны начать с простого шаблона, а затем повторять его снова и снова, в меньших масштабах.

::: column.grow

Одним из самых простых шаблонов может быть [{.pill.red} линейный сегмент](target:s1), добавим [{.pill.blue} еще два сегмента](target:s2) на одном конце. Если мы повторим этот шаблон, оба этих синих сегмента также будут иметь две ветви на конце.

Вы можете перемещать [синие точки](target:dot), чтобы изменить длину и угол ветвей. Затем увеличьте количество итераций, используя [ползунок](->#fern-slider) ниже.

{.reveal(when="slider-0")} В зависимости от положения веток вы можете создавать совершенно разные рисунки - например, [папоротник](action:set(130,228,197,184)), [дерево](action:set(160,186,200,186)) или [пятиугольники](action:set(113,235,232,238)). Что еще вы сможете построить? [Продолжить](btn:next)

::: column(width=360)

    x-geopad(width=360 height=360 projections="no")
      canvas(width=720 height=720)
      svg
        circle(x="point(180,340)" name="a" hidden)
        circle(x="point(180,250)" name="b" hidden)
        circle.move.blue.pulsate(name="c1" cx=150 cy=175 target="s2 dot")
        circle.move.blue.pulsate(name="c2" cx=225 cy=220 target="s2 dot")
        path.thick.red(x="segment(a,b)" target="s1")
        path.thick.blue.rounded(x="polyline(c1,b,c2)" target="s2")
    x-slider#fern-slider(steps=8 :bind="steps")

:::

---

> id: triangle

::: column.grow(parent="right")

Другой известный фрактал - это [__треугольник Серпинского__](gloss:sierpinski-triangle). В этом случае мы начинаем с большого равностороннего треугольника, затем делим его на четыре одинаковых треугольника и вырезаем центральный из них.

{.reveal(when="slider=0")} Обратите внимание, что окончательная форма состоит из [трех идентичных копий себя](target:x), и каждая из них состоит из еще меньших копий большого треугольника! Вы можете продолжать увеличивать масштаб в треугольнике навсегда, а картинка и формы всегда будут повторяться.

::: column(width=300)

    svg.sierpinski.var(width=300 height=265)
      path.red(:draw="triangle" :show="!steps")
      g.red.t1
        path(:draw="t1")
        path.white(:d="sierpinski(t1.points, steps-1)")
      g.red.t2
        path(:draw="t2")
        path.white(:d="sierpinski(t2.points, steps-1)")
      g.red.t3
        path(:draw="t3")
        path.white(:d="sierpinski(t3.points, steps-1)")
    x-slider(steps=8 :bind="steps")

:::

---

> id: real

Растения в начале этой главы выглядят точно так же, как фракталы, но мы понимаем, что невозможно создать бесконечные фракталы в реальной жизни. Если мы будем повторять один и тот же шаблон снова и снова, все в меньшем и меньшем масштабе, то мы в конечном итоге получим кусочки меньше клетки, молекулы или атома, которые мы больше не сможем разделить.

Однако, в математике мы можем размышлять о свойствах, которыми могли бы обладать реальные фракталы - в этом и есть прелесть математики… [Продолжить](btn:next)

---
> id: dimension

### Фрактальная размерность

::: column(width=240)

    img(src="images/line.png" width=240 height=20)

::: column.grow

Во-первых, давайте подумаем о размерности фракталов. Линия имеет размерность [[1]]. _{span.reveal(when="blank-0")} При увеличении в 2 раза его длина увеличивается в `2^1 = 2`. Очевидно!_

:::

---
> id: dimension-1

::: column(width=240)

    img(src="images/square.png" width=240 height=131)

::: column.grow

Квадрат имеет размерность [[2]]. _{span.reveal(when="blank-0")} При масштабировании в 2 раза его площадь увеличивается в `2^2 =` [[4]]._

:::

---
> id: dimension-2

::: column(width=240)

    img(src="images/cube.png" width=240 height=157)

::: column.grow

Куб имеет размерность [[3]]. _{span.reveal(when="blank-0")} При увеличении в 2 раза его объем увеличивается в `2^3 =` [[8]]._ _{span.reveal(when="blank-1")} Заметьте, что больший куб на картинке состоит из 8 маленьких!_

:::

---
> id: dimension-3

::: column(width=240)

    img(src="images/sierpinski.png" width=240 height=114 style="position:sticky;top:48px")

::: column.grow

Теперь давайте посмотрим на треугольник Серпинского. Если мы масштабируем его в 2 раза, вы можете видеть, что его «площадь» увеличивается в [[3]] раза.

{.reveal(when="blank-0")} Пусть _d_ - это размерность треугольника Серпинского. Повторив те же действия, что и выше, мы получаем `2^d = 3`. Другими словами, _d_ = [[`log_2(3)`|`log_3(2)`]] _{span.reveal(when="blank-1")} ≈ 1,558 ..._

:::

---
> id: dimension-4

Но подождите ... как что либо может иметь измерение, которое не является целым числом? Это кажется невозможным, но это только одно из странных свойств фракталов. Фактически, это то, что дает фракталам их имя: они имеют __дробное измерение__ (fraction - дробь).

Во время построения треугольника Серпиноского при каждой итерации мы удаляли часть площади треугольника. Если бы мы продолжили делать это бесконечно много раз, то удалили бы всю площадь: вот почему треугольник Серпинского - это нечто среднее между 2-мерной областью и 1-мерной линией.

::: .theorem

Хотя многие фракталы являются самоподобными, все равно лучшее определение фрактала состоит в том, что __фрактал__ это форма, которая имеет __нецелую размерность__.

:::

[Продолжить](btn:next)

---

> id: snowflake

### Снежинка Коха

В природе мы встречаем много форм, которые выглядят как фракталы. Мы уже видели некоторые растения в начале этой главы. Другими замечательными примерами являются снежинки и ледяные кристаллы:

::: column(width=120 parent="padded-thin")

    x-img(src="images/snow-1.jpg" width=120 height=120)

::: column(width=120)

    x-img(src="images/snow-2.jpg" width=120 height=120)

::: column(width=120)

    x-img(src="images/snow-3.jpg" width=120 height=120)

::: column(width=120)

    x-img(src="images/snow-4.jpg" width=120 height=120)

::: column(width=120)

    x-img(src="images/snow-5.jpg" width=120 height=120)

:::

---

> id: koch

Чтобы создать нашу собственную фрактальную снежинку, нам снова нужно придумать простую последовательность действий, которую мы можем повторять снова и снова.

::: column.grow

Как и в треугольнике Серпинского, давайте начнем с одного равностороннего треугольника. Однако вместо _вырезания_ внутренней части, мы будем _достраивать_ уменьшенные треугольники на каждой стороне. Длина стороны достроенного треугольника равна [[`1/3`|`1/4`|`1/2`]] от длины стороны треугольника на предыдущем шаге.

{.reveal(when="blank-0")} Получившаяся форма называется [__снежинка Коха__](gloss:koch-snowflake), названная в честь шведского математика [Хельге фон Кох](bio:koch). Еще раз обратите внимание, что [маленький участок](target:t2) края снежинки выглядят точно так же, как [большой участок](target:t1).

::: column(width=300)

    svg.var(width=300 height=300)
      path.blue(:draw="koch(steps)")
      rect.overlay(y=76 width=300 height=224 target="t1")
      polygon.overlay(points="300 0 90 0 107 76 0 76 0 300 300 300 300 0" target="t2")
    x-slider(steps=5 :bind="steps")

:::

---

> id: koch-dimension

::: column(width=380)

    img(src="images/koch.png" width=380 height=171)

::: column.grow

Когда мы масштабируем один край снежинки Коха в 3 раза, его длина увеличивается [[в четыре раза|в три раза|в два раза]].

{.reveal(when="blank-0")} Если снова мы захотим узнать, как меняется длина фрактала при масштабировании, то мы получим уравнение [[`3^d=4`|`2^d=4`|`2^d=3`|`4^d=3`]]. _{span.reveal(when="blank-1")} Это означает, что размерность снежинки Коха равна `§d = log_3(4) ≈ 1.262`._

:::

---

> id: koch-size

::: tab

#### Площадь _{span.check(when="blank-6")}_

Создание снежинок Коха похоже на [рекурсивную последовательность](gloss:sequence-recursive): мы знаем начальную форму (треугольник) и знаем, как переходить к другому следующей (добавляя больше треугольников на каждом ребре):

::: column(width=140)

    img#koch-0(src="images/koch-0.svg" width=140 height=160)

::: column(width=140)

    img#koch-1(src="images/koch-1.svg" width=140 height=160)

{.text-center} [[3]] новых треугольников

::: column(width=140)

    img(src="images/koch-2.svg" width=140 height=160)

{.text-center} [[12]] новых треугольников

::: column(width=140)

    img(src="images/koch-3.svg" width=140 height=160)

{.text-center} [[48]] новых треугольников

:::

{.reveal(when="blank-0 blank-1 blank-2")} После первой итерации количество добавленных на этом шаге треугольников стало в [[4]] раза больше. В то же время площадь этих новых треугольников уменьшается в [[9]] раз с каждым шагом.

{.reveal(when="blank-3 blank-4")} Предположим, что [первый треугольник](->#koch-0) имеет площадь 1. Тогда общая площадь [добавленных трех треугольников](->#koch-1) равна `3 × 1/9 = 1/3`. Все последующие площади добавленных треугольников образуют [[геометрическую прогрессию|арифметическую прогрессию|квадратичную зависимость]], _{span.reveal(when="blank-5")} с коэффициентом [[`4/9`|`9/4`|`4/3`]]._

{.reveal(when="blank-6")} Используя формулу для суммы бесконечной [геометрической прогрессии](gloss:geometric-series), мы можем рассчитать, что общая площадь снежинки Коха равна

{.text-center.reveal(when="blank-6")} `A = 1 + 1/3 × 1/blank(1-4/9, 1+9/4, 9-1/4) reveal(= 8/5 = 1.6,"blank-7")`.

::: tab

#### Периметр _{span.check(when="blank-9")}_

::: column.grow

Мы также можем попытаться рассчитать периметр снежинки Коха. Как мы уже видели ранее, длина периметра увеличивается на коэффициент [[`4/3`|`3/4`|`1/4`]] на каждом новом шаге.

{.reveal(when="blank-8")} Это означает, что мы снова имеем геометрическую прогрессию, но в этом случае она [[не сходится|сходится к нулю|не имеет первого члена]]. _{span.reveal(when="blank-9")} Это означает, что периметр снежинки Коха на самом деле __равен бесконечности__!_

::: column(width=220)

    img(src="images/koch-edge.svg" width=220 height=250)

:::

{.reveal(when="blank-9")} Если это кажется нелогичным, просто представьте, мы умножаем периметр на `§4/3` при каждой новой итерации и делаем это бесконечно много раз.

:::

---

> id: frozen

::: column.grow

Почти немыслимо, что существует фигура с _конечной_ площадью, но с бесконечным периметром - и это только одно из многих удивительных свойств фракталов.

Можете ли вы придумать свои собственные способы создания фракталов?

::: column(width=352)

    x-video(src="images/frozen.mp4" poster="images/frozen.jpg" width=352 height=198 audio credit="© Disney")

{.caption} «Моя душа кружится морозными фракталами вокруг…»

:::

[Продолжить](btn:next)

---

> id: menger-sponge

### Губка Менгера

Фракталы не обязательно должны быть «плоскими», как в примерах выше. Один из самых известных трехмерных фракталов это __губка Менгера__, названная в честь математика [Карла Менгера](bio:menger), который впервые описал ее в 1926 году.

::: column(width=320 parent="right")

    x-menger-sponge.var(size=320 :steps="steps")
    x-slider(steps=3 :bind="steps")

::: column.grow

Мы начинаем с твердого куба и многократно просверливаем все меньшие и меньшие отверстия в его сторонах. Ширина вырезанного куба при каждой новой итерации составляет [[`1/3`|`1/2`|`1/4`]] от ширины куба, вырезанного при предыдущей итерации.

{.reveal(when="blank-0")} Представим, что изначально куб состоял из `3×3×3=27` кубиков меньшего размера, потом мы удалили некоторые из них. Тогда Губка Менгера после первой итерации состоит из [[20]] маленьких кубиков, ширина которых в 3 раза меньше первоначальной.

{.reveal(when="blank-1")} Теперь мы можем попытаться вычислить размерность _d_ губки Менгера, как мы это делали для снежинки Коха выше. В этом случае мы получаем `3^d = 20` или `§d = log_3(20) ≈ 2.727`.

:::

{.reveal(when="blank-1")} Если вы представите, что будете вырезать все больше и больше отверстий, бесконечно много раз, фактического объема не останется. Вот почему куб «не совсем» трехмерен! [Продолжить](btn:next)

---

> id: coastlines

### Фрактальная береговая линия

Одна из ключевых характеристик всех фракталов, с которыми мы познакомились, состоит в том, что вы можете «увеличивать» их и всегда находить одинаковые паттерны. В 1920 г. британский математик [Льюис Фрай Ричардсон](bio:richardson) понял, что то же самое работает с границами стран и береговыми линиям.

Вы начинаете с очертаний границы страны и, увеличивая масштаб, добавляете речные впадины, заливы и устья рек, затем отдельные скалы, камни, гальку и т.д.

::: column(width=120 parent="padded-thin")

    x-img(src="images/coast-1.jpg" width=120 height=180)

::: column(width=120)

    x-img(src="images/coast-2.jpg" width=120 height=180)

::: column(width=120)

    x-img(src="images/coast-3.jpg" width=120 height=180)

::: column(width=120)

    x-img(src="images/coast-4.jpg" width=120 height=180)

::: column(width=120)

    x-img(src="images/coast-5.jpg" width=120 height=180)

:::

[Продолжить](btn:next)

---

> id: coastlines-1

::: column.grow

Это серьезная проблема при попытке рассчитать длину границы страны - нужно решить, насколько сильно увеличивать масштаб, и включать укромные уголки и трещины?

Например, мы могли бы измерить длину береговой линии Великобритании, взяв длинную линейку, пройтись по ее берегу, а затем сложить все расстояния.

Если мы возьмем линейку длиной ${rulers[index]}{index|0|0,8,1} км, то длина границы будет состоять из ${count} линеек, поэтому мы получаем длину береговой линии ${count} × ${rulers[index]} = ${count * rulers[index]} км.

{.reveal(when="var-0")} Мы можем просто продолжать уменьшает длину линейки, и каждый раз наш результат длины береговой линии будет становиться немного больше. Как и у снежинки Коха, кажется, что береговая линия Британии имеет бесконечную длину! Это часто называют __парадоксом береговой линии__. [Продолжить](btn:next)

::: column(width=280)

    .coastline: include svgs/britain.svg

:::

---

> id: coastline-grid

Несколько десятилетий спустя математик [Бенуа Мандельброт](bio:mandelbrot) наткнулся на работу Ричардсона в заброшенной библиотечной книге. Он осознал значение его работы, а также нашел связь с более поздними исследованиями фракталов и размерностей.

::: column(width=340)

    include svgs/cells.svg
    x-slider(steps=10 continuous :bind="i")

::: column.grow

Береговая линия Британии, безусловно, выглядит как фрактал, но она не _самоподобна_, как другие фракталы, которые мы видели ранее. Чтобы найти ее размерность, мы можем поместить контур границы на сетке и подсчитать количество ячеек, которые она пересекла.

{.r.reveal(when="slider-0")} Первоначально мы получим __{.pill.yellow} 88__ таких ячеек. Если мы увеличим береговую линию в 2 раза, то получим __{.pill.yellow} 197__ ячеек - количество увеличилось больше чем в два раза! [Продолжить](btn:next)

{.r.reveal(when="next-0")} Размер береговой линии увеличился в `§197/88`. Как и раньше, это означает, что размерность береговой линии

{.text-center.reveal(when="next-0")} `§d = log_2(197/88) ≈ 1.16`

:::

---

> id: coastline-dimension-1

Если мы повторим это с более мелкими сетками, мы обнаружим, что размерность береговой линии Британии фактически равна 1,21. Мандельброт понял, что эта фрактальная размерность также является мерой __шероховатости__ формы - новый показатель, который нашел приложение во многих других областях математики и физики.

---

> id: nature

### Больше фракталов в природе и технике

Хотя идеальные фракталы никогда не могут появиться в природе, есть много объектов, которые выглядят _почти_ как фракталы. Мы уже видели растения, снежинки и береговые линии, и вот еще несколько примеров:

::: column(width=200)

    x-img(src="images/nature/mountains.jpg" width=200 height=200 lightbox credit="NASA/GSFC")

{.caption} Горный массив в Центральной Азии

::: column(width=200)

    x-img(src="images/nature/rivers.jpg" width=200 height=200 lightbox credit="NASA")

{.caption} Дельта реки Ганг в Индии

::: column(width=200 parent="padded-thin")

    x-img(src="images/nature/lightning.jpg" width=200 height=200 lightbox)

{.caption} Молния

::: column(width=200)

    x-img(src="images/nature/retina.jpg" width=200 height=200 lightbox credit="Mikael Häggström, CC-BY-SA")

{.caption} Кровеносные сосуды сетчатки глаза

::: column(width=200)

    x-img(src="images/nature/canyons.jpg" width=200 height=200 lightbox credit="US Geological Survey")

{.caption} Гранд-Каньон в США

::: column(width=200)

    x-img(src="images/nature/clouds.jpg" width=200 height=200 lightbox)

{.caption} Облака

:::

Все эти объекты могли образоваться совершенно случайно, но, как и у фракталов, существует шаблон, по которому они формируются. Математика может помочь нам лучше понять формы, а фракталы находят применение в таких областях, как медицина, биология, геология и метеорология. [Продолжить](btn:next)

---
> id: technology

::: column(width=300)

    x-img(src="images/terrain.jpg" width=360 height=270 lightbox)

{.caption} Компьютерная графика созданная с помощью фракталов

::: column.grow

Мы также можем использовать фракталы для создания реалистичных «копий» природы, например, пейзажей и текстур, используемых в видеоиграх или компьютерных фильмах. Вода, горы и облака на этом изображении сделаны исключительно компьютером с помощью фракталов!

И мы можем даже использовать этот процесс, чтобы сжимать цифровые изображения, уменьшать их размер. Первые подобные алгоритмы были разработаны Майклом Барнсли и Аланом Слоаном в 1980-х годах, а новые до сих пор исследуются.

:::

---

## Треугольник Серпинского

> section: sierpinski
> id: sierpinski

::: column.grow

Одним из фракталов, которые мы увидели в предыдущей главе, был [__треугольник Серпинского__](gloss:sierpinski-triangle), названный в честь польского математика [Вацлава Серпинского](bio:sierpinski). Его можно создать, начав с одного большого равностороннего треугольника, а затем многократно вырезая меньшие треугольники из его центра.

{.r.reveal(when="slider-0")} Вацлав Серпинский был первым математиком, который задумался о свойствах этого треугольника, однако сама фигура появилась много веков назад в произведениях искусства, узорах и мозаиках.

::: column(width=300)

    svg.var.sierpinsk(width=300 height=265)
      path.red(:draw="triangle")
      path.white(:d="sierpinski(triangle.points, steps)")
    x-slider(steps=8 :bind="steps")

:::

---

> id: sierpinski-history

Вот несколько примеров облицовки полов из разных церквей в Риме:

::: column(width=140 parent="padded-thin")

    x-img(src="images/floor-1.jpg" width=140 height=140 credit="Wiki LIC, CC-BY-SA-4.0")

::: column(width=140)

    x-img(src="images/floor-2a.jpg" width=140 height=140 credit="San Clemente, Carlini und Conversano, 2010")

::: column(width=140)

    x-img(src="images/floor-2.jpg" width=140 height=140 credit="© cattedraledianagni.it")

::: column(width=140)

    x-img(src="images/floor-3.jpg" width=140 height=140 credit="© Lycée Baudelaire")

:::

Как оказалось, треугольник Серпинского появляется во многих других областях математики, и есть много различных способов его построить. В этой главе мы рассмотрим некоторые из них! [Продолжить](btn:next)

---

> id: pascal
> goals: select

### Треугольник Паскаля

Возможно, вы уже помните треугольник Серпинского из нашей главы о [__треугольнике Паскаля__](gloss:pascals-triangle). Это числовая пирамида, в которой каждое число является суммой двух чисел над ним. Нажмите на все четные числа в треугольнике ниже, чтобы выделить их - и посмотрите, заметите ли вы закономерность:

    - var fact = function(x) { return !x ? 1 : (x * fact(x-1)); };
    - var bin = function(a, b) { return Math.round(fact(a) / fact(b) / fact(a - b)); };
    figure: .overflow-wrap: .pascal-grid.small(style="width: 760px")
      - var i = 0;
      while i <= 18
        - var j = 0
        .r
          while j <= i
            - b = bin(i, j)
            .c= b
            - j += 1;
        - i += 1;

---

> id: pascal-1

Треугольник Паскаля можно достраивать бесконечно, и паттерн Серпинского будет продолжаться, создавая треугольники все больше и больше. Вы уже можете увидеть начало большого треугольника, который начинается на строке 16.

Если две соседние ячейки делятся на 2, то их сумма в ячейке под ними также должна делиться на 2 - поэтому четные числа выстраиваются в треугольники (или одиночные ячейки). Конечно, мы можем также попытаться раскрасить ячейки, кратные числам отличным от 2. Как вы думаете, что произойдет в этих случаях? [Продолжить](btn:next)

---

> id: pascal-large

    .pascal-canvas
      canvas.pascal(width=960 height=840)
      .label Делится на #[span.circled.var(style="background: ${gradient[n - 2]}") ${n}]:

Здесь вы можете увидеть миниатюрную версию первых 128 рядов треугольника Паскаля. Мы выделили все ячейки, которые делятся на ${n}{n|2|2,40,1} - что вы заметили?

{.reveal(when="var-0")} Для любого числа мы получаем картинку, похожую на треугольник Серпинского. Картинка будет более систематична, если мы выберем [[простое число|четное число|число Фибоначчи]]. _{span.reveal(when="blank-0")} Если число будет иметь много различных простых делителей, то картинка становится более рандомной._

    x-gesture(target="#pascal-large x-var" slide="100,0")

---

> id: chaos-game
> goals: point play

### Игры хаоса

::: column(width=360 parent="right")

    x-geopad.sticky#chaos-geo(width=360)
      canvas(width=720 height=720)
      svg
        circle.red(name="x0" x="tri[0]")
        circle.green(name="x1" x="tri[1]")
        circle.yellow(name="x2" x="tri[2]")
    x-gesture(target="#chaos-geo")

::: column.grow

Здесь вы можете увидеть три вершины равностороннего треугольника. Нажмите где-нибудь в серой области, чтобы создать четвертую точку.

{.r.reveal(when="point")} Давайте играть в простую игру: мы выбираем одну из вершин треугольника случайным образом, рисуем отрезок прямой между нашей точкой и вершиной треугольника, а затем находим [{.pill.red} среднюю точку](target:p1) этого отрезка. [Продолжить](btn:next)

{.r.reveal(when="next-0")} Теперь мы повторяем процесс: мы выбираем случайную вершину, рисуем отрезок от нашей последней точки, а затем находим [{.pill.green} среднюю точку](target:p2). Обратите внимание, что мы окрашиваем эти новые точки в зависимости от цвета вершины треугольника, которую мы выбрали. [Продолжить](btn:next)

{.reveal(when="next-1")} Пока что ничего удивительного не произошло, но посмотрите, что получится, когда мы повторим эти шаги много раз:

{.text-center.reveal.var(when="next-1")} _{button.btn.btn-red(@click="play()")} Добавить 1000 шагов_

:::

---

> id: fractal-builder
> goals: s1 s2 shape play

Этот процесс называется __Игры хаоса__. В начале может быть несколько случайных точек, но если вы будете повторяете одни и те же шаги много раз, распределение точек начинает выглядеть точно так же, как треугольник Серпинского!

Есть много других версий подобных построений - например, мы могли бы начать с квадрата или пятиугольника, мы могли бы добавить дополнительные правила, такие как невозможность выбрать одну и ту же вершину два раза подряд, или мы могли бы ставить следующую точку не на `§1/2` отрезка. В некоторых из этих случаев мы просто получим случайное распределение точек, но в других случаях мы получим еще больше фракталов:

    include components/chaos-game

{.reveal(when="s1 s2 play")} У вас получилось построить [ковер Серпинского](action:carpet()) или [пятиугольную снежинку](action:snowflake()) на основе [__Золотого сечения__](gloss:golden-ratio)?

---

> id: cellular
> goals: sierpinski

### Клеточный автомат

__Клеточный автомат__ - это сетка, состоящая из множества отдельных ячеек. Каждая ячейка может находиться в разных «состояниях» (например, быть окрашена в разные цвета), и состояние одной клеточки зависит от состояния окружающих ячеек.

В нашем примере каждая ячейка может быть либо черной, либо белой. Мы начинаем с верхней строки, которая содержит только одну черную ячейку. В каждой следующей строке цвет ячейки определяется тремя клеточками, расположенными над ней. Включите любые правила окрашивания из восьми возможных вариантов ниже, чтобы заполнить все поле. Сможете ли вы найти набор правил, который создаст узор, похожий на треугольник Серпинского?

    figure: x-automaton(size=28)

{.reveal(when="sierpinski")} Существует два варианта окрашивания нижней ячейки для каждого из восьми правил, что означает, что в общей сложности существует `2^8 =` [[256]] возможных правил. Некоторые из них, например как [Правило 126](action:setRule('01111110')), выглядят как треугольник Серпинского. Другие, такие как [Правило 30](action:setRule('01111000')), выглядят совершенно хаотично. Это правило было обнаружено [Стивеном Вольфрамом](bio:wolfram) в 1983 году, и его могут даже использовать для генерации случайных чисел!

---

> id: cellular-1

::: column.grow

Клеточные автоматы показывают, как очень сложные фигуры (такие, как фракталы) могут быть созданы по очень простым правилам. Многие процессы в природе также следуют простым правилам, но создают невероятно сложные системы.

В некоторых случаях это может привести к появлению узоров, которые выглядят так же, как клеточные автоматы, например, цвета на оболочке этой улитки.

::: column(width=320)

    x-img(src="images/shell.jpg" width=320 height=240 lightbox credit="Richard Ling, CC BY-SA 3.0")

{.caption} Conus textile, ядовитая морская улитка

:::

---

> id: tetrahedra

### Тетраэдр Серпинского

Существует много вариантов треугольника Серпинского и других фракталов со схожими свойствами и процессами создания. Некоторые выглядят двумерными, как ковер Серпинского, который вы видели выше. Другие выглядят трехмерными, как эти примеры:

::: column(width=320)

    x-sierpinski-tetrahedra(size=320 steps=5 style="display: block; margin-top: -20px")

{.caption} Тетраэдр Серпинского

::: column(width=320)

    x-sierpinski-pyramid(size=320 steps=5 style="display: block; margin-top: -20px")

{.caption} Пирамида Серпинского

:::

---

## Множество Мандельброта

> section: mandelbrot
> id: iteration
> goals: move-1 move-2

Все фракталы, которые мы видели в предыдущих главах, были созданы с использованием процесса __повторения__: вы начинаете с определенного шаблона, а затем повторяете его снова и снова.

::: column(width=112 parent="padded-thin")

    img(src="images/koch-0.svg" width=112 height=128)

::: column(width=112 parent="padded-thin")

    img(src="images/koch-1.svg" width=112 height=128)

::: column(width=112 parent="padded-thin")

    img(src="images/koch-2.svg" width=112 height=128)

::: column(width=112 parent="padded-thin")

    img(src="images/koch-3.svg" width=112 height=128)

:::

Это похоже на другое понятие в математике, которое вы видели раньше: с [рекурсивными последовательностями](gloss:sequence-recursive). Вы начинаете с определенного числа, а затем снова и снова применяете ту же рекурсивную формулу, чтобы получить следующее число.

Давайте возьмем рекурсивную формулу `§x_n = x_(n-1)^2` в качестве примера и нанесем ее члены на числовую прямую. Вы можете изменить значение `pill(x_0,"yellow","x0")`:

    figure: x-geopad.no-background(width=720 height=120 x-axis="-2.4,4.4,1" y-axis="-0.1,0.1" axes="yes,no" padding="40 20 0"): svg
      circle.yellow.move.pulsate(x="point(0,0)" name="x0" project="line(point(-3,0),point(3,0))" target="x0")
      path.blue.thick.reveal.light(x="segment(point(-1,0),point(1,0))" style="stroke-width: 20px" when="move-1 move-2" animation="draw" duration=1200)
      path.yellow(:d="drawArc(x0)")

---

> id: iteration-1

Обратите внимание, что получившаяся последовательность может вести себя очень по-разному, в зависимости от начального значения `x_0`:

::: column.frame.f-blue.text-center(width=212 parent="padded-thin")

Если `x_0 > 1`, последовательность [[расходится|сходится]]: _{span.reveal(when="blank-0")} она просто продолжает расти до бесконечности._

::: column.frame.f-blue.text-center(width=212)

Если `x_0` находится между –1 и 1, последовательность [[сходится|расходится]].

::: column.frame.f-blue.text-center(width=212)

Если `x_0 < -1`, последовательность [[расходится|сходится]].

:::

---

> id: iteration-2

Пока что мы не узнали ничего нового. Однако около ста лет назад математики начали исследовать, что происходит с этими последовательностями, если использовать в них [__комплексные числа__](gloss:complex-numbers), а не просто прямую действительных чисел. Их открытия были одними из самых удивительных и красивых результатов во всей математике.

---

> id: julia
> goals: wipe-a wipe-b wipe-c wipe-d

### Множества Жюлиа

Давайте использовать ту же последовательность, что и раньше, `§x_n = x_(n-1)^2`, но в комплексной плоскости. Вы можете переместить позицию `pill(x_0,"yellow","x0")`, чтобы увидеть, что происходит со следующими членами последовательности. Если последовательность будет сходиться, то мы будем закрашивать точку `x_0` на плоскости в _{span.pill.blue} синий цвет_:

    figure: x-geopad(slot="stage" width=720 height=480 x-axis="-2.2,2.2,1" y-axis="-1.5,1.5,1" axes grid padding=8 projections="no" style="margin-bottom: 24px" label-positioning="no" label-suffix=",i" axis-names="Real, Imaginary")
      canvas(width=1440 height=960)
      canvas(width=1440 height=960 style="opacity: 1")
      svg
        circle.move.yellow.pulsate(name="x0" x="point(0,0)" target="x0")
        circle.yellow.transparent(name="x1" x="iterate(x0)" target="x1")
        circle.yellow.transparent(name="x2" x="iterate(x1)" target="x2")
        circle.yellow.transparent(name="x3" x="iterate(x2)" target="x3")
        path.yellow(x="spiral(x0)")
      .geo-legend
        .formula.md `pill(x_n,"yellow") = pill(x_(n-1),"yellow")^2`
        .sequence
          .md `pill(x_0,"yellow", "x0") = var("complex(x0)")`
          .md `pill(x_1,"yellow", "x1") = var("complex(x1)")`
          .md `pill(x_2,"yellow", "x2") = var("complex(x2)")`
          .md `pill(x_3,"yellow", "x3") = var("complex(x3)")`
          div
            span.vdots …
            strong.var.m-blue(:show="converges" data-display="inline") Converges!
            strong.var(:show="!converges" data-display="inline") Diverges!

{.reveal(when="wipe-a wipe-b wipe-c wipe-d")} Как видите, последовательность сходится, пока `pill(x_0,"yellow","x0")` лежит [[внутри единичной окружности|снаружи единичного квадрата|на оси х]] _{span.reveal(when="blank-0")} (окружность с радиусом 1, центр в начале координат)._

---

> id: julia-1

Теперь давайте немного усложним. Вместо того чтобы просто возводить в квадрат предыдущее число, мы также каждый раз будем добавлять константу _{.pill.red} c_ (это может быть любое комплексное число). Другими словами, `§x_n = x_(n-1)^2 + c`. Как вы думаете, мы по прежнему получим круг сходимости? Как вы думаете, какую форму мы сможем увидеть? [Продолжить](btn:next)

---

> id: julia-2

На этой диаграмме вы можете менять позицию `pill(x_0,"yellow","x0")`, а также значение `pill(c,"red","c")`:

::: x-slideshow

    x-geopad(slot="stage" width=720 height=480 x-axis="-1.8,1.8,1" y-axis="-1.2,1.2,1" axes grid padding=8 projections="no" style="margin-bottom: 24px" label-suffix=",i" axis-names="Real, Imaginary")
      canvas(width=1440 height=960)
      svg
        circle.move.yellow(name="x0" x="point(0.5,0.5)" target="x0")
        circle.move.red(name="c" x="point(0,0)" target="c")
        circle.yellow.transparent(name="x1" x="iterate(x0,c)" target="x1")
        circle.yellow.transparent(name="x2" x="iterate(x1,c)" target="x2")
        circle.yellow.transparent(name="x3" x="iterate(x2,c)" target="x3")
        path.yellow(x="spiral(x0,c)")
      .geo-legend
        .formula.md `pill(x_n,"yellow") = pill(x_(n-1),"yellow")^2 + pill(var("complex(c)"),"red","c")`
        .sequence
          .md `pill(x_0,"yellow", "x0") = var("complex(x0)")`
          .md `pill(x_1,"yellow", "x1") = var("complex(x1)")`
          .md `pill(x_2,"yellow", "x2") = var("complex(x2)")`
          .md `pill(x_3,"yellow", "x3") = var("complex(x3)")`
          div
            span.vdots …
            strong.var.m-blue(:show="converges" data-display="inline") Bounded!
            strong.var(:show="!converges" data-display="inline") Diverges!

{div(slot="legend")} Мы уже знаем, что получится, если [`c = 0`](action:animate(0,0)) - получим картинку, как в примере выше. Сходимость последовательностей происходит до тех пор, пока `x_0` лежит внутри единичного круга.

{div(slot="legend")} Как только мы изменим значение _c_, произойдет нечто удивительное. Круг превращается в очень сложную, фрактальную форму.

{div(slot="legend")} Когда [`c = –0.54 + 0.5i`](action:animate(-0.54,0.5)), форма превращается в бесконечное количество крошечных элементов, закрученных по спирали.

::: div(slot="legend")

В некоторых случаях члены последовательности не сходятся к __единственной точке__ - вместо этого они образуют цикл из нескольких значений-точек, как треугольник. Эти циклы называются __орбитами__.

Точки синего цвета означают, что соответствующая этому значению `x_0` последовательность либо сходится, либо имеет орбиту (мы говорим, что она __ограничена__). Точки, которые мы оставили белыми, означают, что соответствующая последовательность __расходится__: она не ограничена и, в конечном итоге, стремится к бесконечности.

:::

{div(slot="legend")} Что еще вы сможете найти? Посмотрите на получившиеся шаблоны, для [`c = 0.4 + 0.21i`](action:animate(0.4,0.21)) или когда [`c = 0.38 – 0.25i`](action:animate(0.38,-0.25)). Существуют также некоторые значения _c_, где __любая__ последовательность расходится, поэтому вся плоскость остается белой.

:::

---

> id: julia-3

Все эти узоры, которые образуются на плоскости, называются [__Множества Жюулиа__](gloss:julia-set). Они были открыты независимо двумя французскими математиками, [Гастоном Жюлией](bio:julia) и [Пьером Фату](bio:fatou), около 1918 года.

В то время не было компьютеров, которые могли бы помочь построить визуальную модель, как на самом деле выглядят наборы Жюлиа. Математики, такие как Жюлиа и Фату, могли только математически рассуждать о них, но увидеть на практике можно было только грубые, нарисованные от руки наброски.

У нас сегодня такой проблемы нет - на изображениях ниже представлены разные наборы Жюлиа. Различные цвета указывают, __насколько быстро__ последовательность в этой точке расходится:

::: column(width=220)

    x-img(src="images/julia-1.jpg" width=220 height=165 lightbox)

{.caption} `c = −0.70176 – 0.3842"i"`

::: column(width=220)

    x-img(src="images/julia-2.jpg" width=220 height=165 lightbox)

{.caption} `c = −0.4 + 0.6"i"`

::: column(width=220)

    x-img(src="images/julia-3.jpg" width=220 height=165 lightbox)

{.caption} `c = 0.285 + 0.01"i"`

:::

[Продолжить](btn:next)

---

> id: mandel-paint
> goals: wipe-a wipe-b wipe-c

### Множество Мандельброта

При создании различных наборов Жюлиа вы могли заметить, что были некоторые значения _c_, для которых каждая последовательность расходится, и вся комплексная плоскость остается белой. Спустя несколько десятилетий после Жюлиа и Фату новое поколение математиков попыталось отобразить эти области на одном рисунке.

В предыдущем примере мы выбрали фиксированное значение для `pill(c,"red","c")`, а затем меняли положение `pill(x_0,"yellow","x0")`, чтобы раскрасить плоскость. Теперь давайте зафиксируем значение `pill(x_0 = 0,"yellow","x0")` и будем менять значение `pill(c,"red","c")`.

Попробуйте еще раз поменять положение точки и нарисуйте область, в которой последовательности остаются ограниченными. Какую форму вы получите?

    figure: x-geopad.no-background(width=720 height=480 x-axis="-2.1,1.1,1" y-axis="-1.1,1.1,1" axes grid padding=8 projections="no" label-suffix=",i" axis-names="Real, Imaginary")
      img(src="images/mandelbrot.png" data-bounds="1,0.5,-1,-1.5")
      canvas(width=1440 height=960 style="opacity: 1")
      svg
        circle.move.red.pulsate(name="c" cx=0 cy=0 target="c")
        circle.yellow.transparent(name="x0" x="point(0,0)" target="x0")
        circle.yellow.transparent(name="x1" x="iterate(x0,c)" target="x1")
        circle.yellow.transparent(name="x2" x="iterate(x1,c)" target="x2")
        circle.yellow.transparent(name="x3" x="iterate(x2,c)" target="x3")
        path.yellow(x="spiral(x0,c)")
      .geo-legend
        .formula.md `pill(x_n,"yellow") = pill(x_(n-1),"yellow")^2 + pill(var("complex(c)"),"red","c")`
        .sequence
          .md `pill(x_0,"yellow", "x0") = var("complex(x0)")`
          .md `pill(x_1,"yellow", "x1") = var("complex(x1)")`
          .md `pill(x_2,"yellow", "x2") = var("complex(x2)")`
          .md `pill(x_3,"yellow", "x3") = var("complex(x3)")`
          div
            span.vdots …
            strong.var.m-blue(:show="converges" data-display="inline") Bounded!
            strong.var(:show="!converges" data-display="inline") Diverges!

---

> id: mandel-history

Этот фрактал называется [__Множеством Мандельброта__](gloss:mandelbrot-set), и при повороте на 90 ° он выглядит почти как человек с головой, телом и двумя руками. Впервые оно было определено и нарисовано в 1978 году в исследовательской работе математиков Роберта Брукса и Питера Мательски:

    figure: x-img(src="images/mandelbrot.jpg" width=360 height=290 credit="© Princeton University Press")

Несколько лет спустя [Бенуа Мандельброт](bio:mandelbrot) использовал мощные компьютеры в IBM, чтобы создать гораздо более детальную визуализацию фрактала, который впоследствии был назван его именем. Первые изображения на бумаге выглядели не так, как он ожидал - пока он не осознал, что специалисты, работающие с принтерами, убирали «размытость» по краям, предполагая, что это было вызвано частицами пыли или ошибками принтера, а не определяющей характеристикой фракталов! [Продолжить](btn:next)

---

> id: mandel-zoom

Как и все фракталы, мы можем «приближать» набор Мандельброта вечно, находя новые паттерны при любом масштабе. На изображении ниже вы можете увеличить часть множества Мандельброта, которая называется __Морской конек__. Черные точки, которые находятся __внутри__ множества Мандельброта, показывают область, где последовательность ограничена. Цветные точки, которые __находятся за пределами__ множества Мандельброта, где последовательность расходится, а разные цвета указывают __как быстро__ она расходится:

    .mandel-frame
      - i = 1;
      while i <= 27
        img(src="images/mandel/mandel-" + i + ".jpg" width=760 height=500)
        - i += 1;
      .scale.var Scale: ${pow(scale)}
    x-slider(steps=27 continuous speed=0.1 :bind="scale")

---

> id: mandel-zoom-1

Этот слайд состоит из 27 отдельных изображений с уровнем увеличения более 14 квадриллионов или `2^54`. В общей сложности на современном ноутбуке на рендер этого видео ушло бы почти 45 минут. Множество Мандельброта может быть создано с помощью одного простого уравнения `§x_n = x_(n-1)^2 + c`, но оно бесконечно сложно и потрясающе красиво.

---

> id: mandel-orbits

::: column(width=360 parent="right")

    x-geopad.no-background(width=360 height="340" x-axis="-1.5,0.5,1" y-axis="-0.9,0.9,1" axes padding=8 labels="no")
      img(src="images/mandelbrot.png" data-bounds="1,0.5,-1,-1.5")
      svg
        circle.move.red.pulsate(name="c" x="point(-0.3,0.4)" target="c")
        path.blue.transparent.fill(x="cardioid" target="bulb0")
        path.blue.transparent.fill(x="circle(point(-0.125,0.745),0.094)" target="bulb1")
        path.blue.transparent.fill(x="circle(point(-0.5045,0.563),0.039)" target="bulb2")
        path.yellow.thin(x="spiral(point(0,0),c)")

::: column.grow

По мере перемещения значения [{.pill.red} c](target:c) по множеству Мандельброта вы можете заметить любопытное свойство:

* Все последовательности в [главной кардиоиде](target:bulb0) множества Мандельброта [[сходятся|расходятся|имеют орбиты]] _{span.reveal(when="blank-0")} в одну точку._
* {.reveal(when="blank-0")} Последовательности внутри [большого круга](target:bulb1) в верхней части [[имеют орбиты|сходятся|расходятся]] _{span.reveal(when="blank-1")}, состоящие из [[3]] точек._
* {.reveal(when="blank-2")} Последовательности в [этом меньшем круге](target:bulb2) имеют орбиты из [[5]] точек.

:::

{.reveal(when="blank-3")} В каждом круге последовательности имеют орбиты с разным количеством циклов, причем, чем меньше круг, тем больше циклов в орбитах. Размер этих орбит тесно связан с __логистической картой__, важной концепцией в [теории хаоса](/course/chaos).

---

> id: mandel-outro

::: column.grow

Бернойт Мандельброт посвятил большую часть своей жизни изучению фракталов, а также математике __шероховатости__ и __самоподобия__. Его работа нашла приминение в физике, метеорологии, неврологии, экономике, геологии, технике, информатике и многих других областях.

В 1985 году множество Мандельброта появился на обложке журнала _Scientific American_, и с тех пор оно стало одной из самых узнаваемых математических форм в мире. Вы можете найти его на футболках, в музыкальных клипах и в качестве заставок, на него ссылаются во многих популярных книгах и фильмах.

::: column(width=220)

    x-img(src="images/magazine.jpg" width=220 height=316 credit="© Scientific American")

:::

---

## Кривые заполнения пространства

> section: space-filling
> sectionStatus: dev

{.todo} Скоро!
