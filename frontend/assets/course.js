/* (c) Mathigon, generated by Mathigon Studio */
(()=>{var od=Object.defineProperty;var j1=Object.prototype.hasOwnProperty;var W1=Object.getOwnPropertyDescriptor,ad=Object.getOwnPropertySymbols,Z1=Object.prototype.propertyIsEnumerable;var hd=(e,t,i)=>t in e?od(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,We=(e,t)=>{for(var i in t||(t={}))j1.call(t,i)&&hd(e,i,t[i]);if(ad)for(var i of ad(t))Z1.call(t,i)&&hd(e,i,t[i]);return e};var R=(e,t,i,s)=>{for(var n=s>1?void 0:s?W1(t,i):t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(n=(s?o(t,i,n):o(n))||n);return s&&n&&od(t,i,n),n};var E=(e,t,i)=>new Promise((s,n)=>{var r=h=>{try{a(i.next(h))}catch(l){n(l)}},o=h=>{try{a(i.throw(h))}catch(l){n(l)}},a=h=>h.done?s(h.value):Promise.resolve(h.value).then(r,o);a((i=i.apply(e,t)).next())});function ld(e=10){return Math.random().toString(36).substr(2,e)}function tt(e,...t){return t.includes(e)}var K1=(e,t)=>e.concat(t);function Ka(e,t,i=K1){for(let s of Object.keys(t))s in e&&Array.isArray(e[s])&&Array.isArray(t[s])?e[s]=i(e[s],t[s]):s in e&&e[s]instanceof Object&&t[s]instanceof Object?Ka(e[s],t[s]):e[s]=t[s]}function ui(e,t=0){return t?+setTimeout(e,t):(e(),0)}function Bn(e){return new Promise(t=>setTimeout(t,e))}function Li(){let e=()=>{},t=()=>{},i=new Promise((s,n)=>{e=s,t=n});return i.catch(s=>s),{promise:i,resolve:e,reject:t}}var cd=class extends Error{constructor(e){super("[Cache Error]");this.data=e}};function ud(e){let t=new Map;return function(...i){let s=i.join("--");if(!t.has(s))try{t.set(s,e(...i))}catch(r){t.set(s,new cd(r))}let n=t.get(s);if(n instanceof cd)throw n.data;return n}}function Oi(e,t=0,i=!1){let s=!1,n=!1;return(...r)=>{s?n=!0:(i?n=!0:e(...r),s=!0,setTimeout(()=>{n&&e(...r),s=n=!1},t))}}function X1(e){return function(t,i){if(!t||Array.isArray(this)||e.includes(t))return i}}function Xa(e,t,i){if(!e)return t;try{return JSON.parse(e,i?X1(i):void 0)||t}catch(s){return t}}function di(e,t){return new Array(t).fill(e)}function Ya(e,t,i){let s=[];for(let n=0;n<t;++n)s.push(di(e,i));return s}function Ze(e,t){let i=[];for(let s=0;s<t;++s)i.push(e(s));return i}function dd(e,t,i){let s=[];for(let n=0;n<t;++n){let r=[];for(let o=0;o<i;++o)r.push(e(n,o));s.push(r)}return s}function Ks(e,t,i=1){let s=[];if(t===void 0&&e>=0)for(let n=0;n<e;n+=i)s.push(n);else if(t===void 0)for(let n=0;n>e;n-=i)s.push(n);else if(e<=t)for(let n=e;n<=t;n+=i)s.push(n);else for(let n=e;n>=t;n-=i)s.push(n);return s}function ct(e,t=0){return e[e.length-1-t]}function kt(e){return e.reduce((t,i)=>t+i,0)}function Qa(e,t,i=!1){return e.slice(0).sort((s,n)=>{let r=t(s),o=t(n);return r<o?i?1:-1:r>o?i?-1:1:0})}function es(e){let t=0;return()=>e[t++%e.length]}function Ke(e){return e.filter((t,i)=>e.indexOf(t)===i)}function Ii(e){return e.reduce((t,i)=>t.concat(Array.isArray(i)?Ii(i):i),[])}function pd(e){let t=0;return e.map(i=>t+=i)}function Ja(e,t){let i=[];for(let s=0;s<e.length;s+=t)i.push(e.slice(s,s+t));return i}function fd(...e){return e.reduce((t,i)=>t.concat(i),[])}function et(e,t=/\s+/){return e?e.trim().split(t):[]}function Fr(e){return e.toLowerCase().replace(/^-/,"").replace(/-(.)/g,(t,i)=>i.toUpperCase())}function Y1(e,t,i=!1){let s=Ya(0,e.length+1,t.length+1);for(let n=0;n<=e.length;n++)s[n][0]=n;for(let n=0;n<=t.length;n++)s[0][n]=n;for(let n=1;n<=e.length;n++)for(let r=1;r<=t.length;r++)s[n][r]=Math.min(s[n-1][r-1]+(e.charAt(n-1)===t.charAt(r-1)?0:1),s[n-1][r]+1,s[n][r-1]+1);return i?Math.min(...s[e.length]):s[e.length][t.length]}function md(e,t){let i=e.length/2,s=t.map(r=>({w:r,d:Y1(e,r)})).filter(({d:r})=>r<i),n=Qa(s,r=>r.d)[0];return n?n.w:void 0}var is=class{constructor(){this.events=new Map}on(e,t){for(let i of et(e))this.events.has(i)||this.events.set(i,[]),this.events.get(i).push(t)}one(e,t){let i=s=>{this.off(e,i),t(s)};this.on(e,i)}off(e,t){for(let i of et(e))this.events.has(i)&&this.events.set(i,this.events.get(i).filter(s=>s!==t))}trigger(e,t){for(let i of et(e))if(this.events.has(i))for(let s of this.events.get(i))s(t)}};var Ur=class{constructor(...e){this.values=e}map(e){let t=this.values;return new Ur(function*(){let i=0;for(let s of t)for(let n of s)yield e(n,i),i+=1}())}every(e){let t=0;for(let i of this.values)for(let s of i){if(!e(s,t))return!1;t+=1}return!0}some(e){let t=0;for(let i of this.values)for(let s of i){if(e(s,t))return!0;t+=1}return!1}slice(e,t){let i=this.values;return new Ur(function*(){let s=0;for(let n of i)for(let r of n)s<e||t!==void 0&&s>e+t||(yield r,s+=1)}())}filter(e){let t=this.values;return new Ur(function*(){let i=0;for(let s of t)for(let n of s)e(n,i)&&(yield n),i+=1}())}concat(e){this.values.push(e)}[Symbol.iterator](){let e=this.values;return function*(){for(let t of e)for(let i of t)yield i}()}static make(e,t){return new Ur(function*(){let i=0;for(;t===void 0||i<t;)yield e(i),i+=1}())}};var gd=Object.defineProperty,Q1=e=>gd(e,"__esModule",{value:!0}),th=(e,t)=>{Q1(e);for(var i in t)gd(e,i,{get:t[i],enumerable:!0})},vd=1e-6;function B(e,t,i=vd){return isNaN(e)||isNaN(t)?!1:Math.abs(e-t)<i}function Ut(e,t,i,s=vd){return t>i&&([t,i]=[i,t]),e>t+s&&e<i-s}var wd=/(\d+)(\d{3})/,J1=["","k","m","b","t","q"];function tv(e){let[t,i]=e.split(".");for(;wd.test(t);)t=t.replace(wd,"$1,$2");return t+(i?`.${i}`:"")}function ev(e,t=6){if(!t)return`${e}`;let i=`${Math.abs(Math.floor(e))}`.length,s=e<0?1:0;if(i<=t-s)return`${pi(e,t-i-s-1)}`;let n=Math.floor(Math.log10(Math.abs(e))/3);return pi(e/Math.pow(10,3*n),t-(i%3||3)-s-1)+J1[n]}function ss(e,t=0,i=!0){let s=ev(e,t).replace("-","\u2013");return i?tv(s):s}var iv=/^-?0,[0-9]+$/,sv=/^-?([0-9]+(,[0-9]{3})*)?\.?[0-9]*$/,nv=/^-?[0-9]+(\.[0-9]{3})*,?[0-9]*$/;function yd(e){return e=e.replace(/^–/,"-").trim(),!e||e.match(/[^0-9.,-]/)?NaN:iv.test(e)?parseFloat(e.replace(/,/,".")):sv.test(e)?parseFloat(e.replace(/,/g,"")):nv.test(e)?parseFloat(e.replace(/\./g,"").replace(/,/,".")):NaN}var eh=["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],xd=["","","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"],rv=[""," thousand"," million"," billion"," trillion"," quadrillion"," quintillion"," sextillion"];function ov(e){let[t,i,s]=e.split(""),n=t==="0"?"":` ${eh[+t]} hundred`;return i+s==="00"?n:+i<2?`${n} ${eh[+(i+s)]}`:s==="0"?`${n} ${xd[+i]}`:`${n} ${xd[+i]}-${eh[+s]}`}function ih(e){if(e===0)return"zero";let t=Math.round(Math.abs(e)).toString(),i=Math.ceil(t.length/3),s=t.padStart(3*i,"0"),n="";for(let r=0;r<i;r+=1){let o=s.substr(r*3,3);o!=="000"&&(n+=ov(o)+rv[i-1-r])}return n.trim()}function pi(e,t=0){let i=Math.pow(10,t);return Math.round(e*i)/i}function Xe(e,t=1){return Math.round(e/t)*t}function xt(e,t=-Infinity,i=Infinity){return Math.min(i,Math.max(t,e))}function sh(e,t,i=.5){return e+(t-e)*i}function ae(e){return e*e}function bd(e,t){return(e%t+t)%t}function Md(e,t=0){let i=e.slice(0),s=$d(i);return t?s.filter(n=>n.length===t):s}function $d(e){if(e.length===1)return[[],e];let t=e.pop(),i=$d(e),s=[];for(let n of i)s.push(n,[...n,t]);return s}var jr=(e,t)=>{let i=e<0?"\u2013":"";return Math.abs(e)===1&&t?i+t:i+Math.abs(e)+(t||"")},bt=class{constructor(e=0,t=0){this.re=e,this.im=t}get modulus(){return Math.sqrt(this.re*this.re+this.im*this.im)}get argument(){return Math.atan2(this.im,this.re)}get conjugate(){return new bt(this.re,-this.im)}root(e,t=0){let i=Math.pow(this.modulus,1/e),s=(this.argument+t*2*Math.PI)/e;return new bt(i*Math.cos(s),i*Math.sin(s))}toString(e=2){let t=pi(this.re,e),i=pi(this.im,e);return i===0?jr(t):t===0?jr(i,"i"):[jr(t),i<0?"\u2013":"+",jr(Math.abs(i),"i")].join(" ")}add(e){return bt.sum(this,e)}subtract(e){return bt.difference(this,e)}multiply(e){return bt.product(this,e)}divide(e){return bt.quotient(this,e)}static sum(e,t){return typeof e=="number"&&(e=new bt(e,0)),typeof t=="number"&&(t=new bt(t,0)),new bt(e.re+t.re,e.im+t.im)}static difference(e,t){return typeof e=="number"&&(e=new bt(e,0)),typeof t=="number"&&(t=new bt(t,0)),new bt(e.re-t.re,e.im-t.im)}static product(e,t){typeof e=="number"&&(e=new bt(e,0)),typeof t=="number"&&(t=new bt(t,0));let i=e.re*t.re-e.im*t.im,s=e.im*t.re+e.re*t.im;return new bt(i,s)}static quotient(e,t){if(typeof e=="number"&&(e=new bt(e,0)),typeof t=="number"&&(t=new bt(t,0)),Math.abs(t.re)<Number.EPSILON||Math.abs(t.im)<Number.EPSILON)return new bt(Infinity,Infinity);let i=t.re*t.re+t.im*t.im,s=(e.re*t.re+e.im*t.im)/i,n=(e.im*t.re-e.re*t.im)/i;return new bt(s,n)}static exp(e){typeof e=="number"&&(e=new bt(e,0));let t=Math.exp(e.re);return new bt(t*Math.cos(e.im),t*Math.sin(e.im))}};function ns(...e){let[t,...i]=e;if(i.length>1)return ns(t,ns(...i));let s=Math.abs(t),n=Math.abs(i[0]);for(;n;)[s,n]=[n,s%n];return s}function Hn(...e){let[t,...i]=e;return i.length>1?Hn(t,Hn(...i)):Math.abs(t*i[0])/ns(t,i[0])}function nh(e){if(e%1!=0||e<2)return!1;if(e%2==0)return e===2;if(e%3==0)return e===3;let t=Math.sqrt(e);for(let i=5;i<=t;i+=6)if(e%i==0||e%(i+2)==0)return!1;return!0}function rh(e){if(e===1)return[];if(nh(e))return[e];let t=Math.sqrt(e);for(let i=2;i<=t;++i)if(e%i==0)return rh(i).concat(rh(e/i));return[]}function Sd(e){return Ke(rh(e))}var av={};th(av,{determinant:()=>dv,fill:()=>Pd,identity:()=>Cd,inverse:()=>Ad,product:()=>Wr,reflection:()=>cv,rotation:()=>hv,scalarProduct:()=>uv,shear:()=>lv,sum:()=>Td,transpose:()=>Ed});function Pd(e,t,i){return Ya(e,t,i)}function Cd(e=2){let t=Pd(0,e,e);for(let i=0;i<e;++i)t[i][i]=1;return t}function hv(e){let t=Math.sin(e),i=Math.cos(e);return[[i,-t],[t,i]]}function lv(e){return[[1,e],[0,1]]}function cv(e){let t=Math.sin(2*e),i=Math.cos(2*e);return[[i,t],[t,-i]]}function Td(...e){let[t,...i]=e,s=i.length>1?Td(...i):i[0];if(t.length!==s.length||t[0].length!==s[0].length)throw new Error("Matrix sizes don\u2019t match");let n=[];for(let r=0;r<t.length;++r){let o=[];for(let a=0;a<t[r].length;++a)o.push(t[r][a]+s[r][a]);n.push(o)}return n}function uv(e,t){return e.map(i=>i.map(s=>s*t))}function Wr(...e){let[t,...i]=e,s=i.length>1?Wr(...i):i[0];if(t[0].length!==s.length)throw new Error("Matrix sizes don\u2019t match.");let n=[];for(let r=0;r<t.length;++r){let o=[];for(let a=0;a<s[0].length;++a){let h=0;for(let l=0;l<s.length;++l)h+=t[r][l]*s[l][a];o.push(h)}n.push(o)}return n}function Ed(e){let t=[];for(let i=0;i<e[0].length;++i){let s=[];for(let n=0;n<e.length;++n)s.push(e[n][i]);t.push(s)}return t}function dv(e){if(e.length!==e[0].length)throw new Error("Not a square matrix.");let t=e.length;if(t===1)return e[0][0];if(t===2)return e[0][0]*e[1][1]-e[0][1]*e[1][0];let i=0;for(let s=0;s<t;++s){let n=e[0][s],r=e[0][s];for(let o=1;o<t;++o)r*=e[o][s+o%t],n*=e[o][s-o%t];i+=r-n}return i}function Ad(e){let t=e.length;if(t!==e[0].length)throw new Error("Not a square matrix.");let i=Cd(t),s=dd((n,r)=>e[n][r],t,t);for(let n=0;n<t;++n){let r=s[n][n];if(!r){for(let o=n+1;o<t;++o)if(s[o][n]!==0){for(let a=0;a<t;++a)[s[o][a],s[n][a]]=[s[n][a],s[o][a]],[i[o][a],i[n][a]]=[i[n][a],i[o][a]];break}if(r=s[n][n],!r)throw new Error("Matrix not invertible.")}for(let o=0;o<t;++o)s[n][o]=s[n][o]/r,i[n][o]=i[n][o]/r;for(let o=0;o<t;++o){if(o===n)continue;let a=s[o][n];for(let h=0;h<t;++h)s[o][h]-=a*s[n][h],i[o][h]-=a*i[n][h]}}return i}var Jt={};th(Jt,{bernoulli:()=>kd,binomial:()=>vv,cauchy:()=>Mv,chiCDF:()=>Pv,exponential:()=>bv,find:()=>mv,geometric:()=>$v,integer:()=>fv,integrate:()=>Ld,normal:()=>xv,normalPDF:()=>Sv,poisson:()=>wv,shuffle:()=>pv,smart:()=>gv,uniform:()=>yv,weighted:()=>Vd});function pv(e){e=e.slice(0);for(let t=e.length-1;t>0;--t){let i=Math.floor(Math.random()*(t+1));[e[t],e[i]]=[e[i],e[t]]}return e}function fv(e,t){let i=t===void 0?0:e,s=t===void 0?e:t-e+1;return i+Math.floor(s*Math.random())}function Vd(e){let t=Math.random()*kt(e),i=0;return e.findIndex(s=>(i+=s)>=t)}function mv(e){return e[Math.floor(e.length*Math.random())]}var Zr=new Map;function gv(e,t){t||(t=ld()),Zr.has(t)||Zr.set(t,di(1,e));let i=Zr.get(t),s=Vd(i.map(n=>n*n));return i[s]-=1,i[s]<=0&&Zr.set(t,i.map(n=>n+1)),s}function kd(e=.5){return Math.random()<e?1:0}function vv(e=1,t=.5){let i=0;for(let s=0;s<e;++s)i+=kd(t);return i}function wv(e=1){if(e<=0)return 0;let t=Math.exp(-e),i=1,s=0;for(;i>t;++s)i*=Math.random();return s-1}function yv(e=0,t=1){return e+(t-e)*Math.random()}function xv(e=0,t=1){let i=Math.random(),s=Math.random();return Math.sqrt(-2*Math.log(i))*Math.cos(2*Math.PI*s)*Math.sqrt(t)+e}function bv(e=1){return e<=0?0:-Math.log(Math.random())/e}function $v(e=.5){if(!(e<=0||e>1))return Math.floor(Math.log(Math.random())/Math.log(1-e))}function Mv(){let e,t,i;do t=2*Math.random()-1,i=2*Math.random()-1,e=t*t+i*i;while(e>=1);return t/i}function Sv(e,t=1,i=0){return Math.exp(-((e-t)**2)/(2*i))/Math.sqrt(2*Math.PI*i)}var Od=7,Id=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,15056327351493116e-23];function Rd(e){if(e<.5)return Math.PI/(Math.sin(Math.PI*e)*Rd(1-e));e-=1;let t=Id[0];for(let s=1;s<Od+2;s++)t+=Id[s]/(e+s);let i=e+Od+.5;return Math.sqrt(2*Math.PI)*Math.pow(i,e+.5)*Math.exp(-i)*t}function Ld(e,t,i,s=1){let n=0;for(let r=t;r<i;r+=s)n+=e(r)*s||0;return n}function Pv(e,t){let i=Ld(s=>Math.pow(s,(t-2)/2)*Math.exp(-s/2),0,e);return 1-i/Math.pow(2,t/2)/Rd(t/2)}var oh={};th(oh,{bestPolynomial:()=>Vv,coefficient:()=>Nd,exponential:()=>Tv,linear:()=>Cv,logarithmic:()=>Ev,polynomial:()=>_d,power:()=>Av});function kv(e,t){let i=1,s=e[0];for(let n=1;n<e.length;++n)i*=t,s+=i*e[n];return s}function Cv(e,t=!1){let i=0,s=0,n=0,r=0,o=e.length;for(let l=0;l<o;l++)i+=e[l][0],s+=e[l][1],n+=e[l][0]*e[l][0],r+=e[l][0]*e[l][1];if(t){let l=r/n;return[0,l]}let a=(o*r-i*s)/(o*n-i*i);return[s/o-a*i/o,a]}function Tv(e){let t=[0,0,0,0,0,0];for(let r of e)t[0]+=r[0],t[1]+=r[1],t[2]+=r[0]*r[0]*r[1],t[3]+=r[1]*Math.log(r[1]),t[4]+=r[0]*r[1]*Math.log(r[1]),t[5]+=r[0]*r[1];let i=t[1]*t[2]-t[5]*t[5],s=Math.exp((t[2]*t[3]-t[5]*t[4])/i),n=(t[1]*t[4]-t[5]*t[3])/i;return[s,n]}function Ev(e){let t=[0,0,0,0],i=e.length;for(let r of e)t[0]+=Math.log(r[0]),t[1]+=r[1]*Math.log(r[0]),t[2]+=r[1],t[3]+=Math.pow(Math.log(r[0]),2);let s=(i*t[1]-t[2]*t[0])/(i*t[3]-t[0]*t[0]);return[(t[2]-s*t[0])/i,s]}function Av(e){let t=[0,0,0,0],i=e.length;for(let r of e)t[0]+=Math.log(r[0]),t[1]+=Math.log(r[1])*Math.log(r[0]),t[2]+=Math.log(r[1]),t[3]+=Math.pow(Math.log(r[0]),2);let s=(i*t[1]-t[2]*t[0])/(i*t[3]-t[0]*t[0]);return[Math.exp((t[2]-s*t[0])/i),s]}function _d(e,t=2){let i=e.map(h=>Ks(t+1).map(l=>Math.pow(h[0],l))),s=Ed(i),n=e.map(h=>[h[1]]),r=Wr(s,i),o=Ad(r);return Wr(o,s,n).map(h=>h[0])}function Nd(e,t){let s=e.reduce((o,a)=>o+a[1],0)/e.length,n=e.reduce((o,a)=>o+(a[1]-s)**2,0),r=e.reduce((o,a)=>o+(a[1]-t(a[0]))**2,0);return 1-r/n}function Vv(e,t=.85,i=8){if(!(e.length<=1))for(let s=1;s<i;++s){let n=_d(e,s),r=a=>kv(n,a);if(Nd(e,r)>=t)return{order:s,coefficients:n,fn:r}}}var ye=2*Math.PI;function Kr(e,t){let i=Math.atan2(e.y-(t?t.y:0),e.x-(t?t.x:0));return bd(i,ye)}var y=class{constructor(e=0,t=0){this.x=e,this.y=t,this.type="point"}get unitVector(){return B(this.length,0)?new y(1,0):this.scale(1/this.length)}get length(){return Math.sqrt(this.x**2+this.y**2)}get inverse(){return new y(-this.x,-this.y)}get flip(){return new y(this.y,this.x)}get perpendicular(){return new y(-this.y,this.x)}get array(){return[this.x,this.y]}distanceFromLine(e){return y.distance(this,e.project(this))}clamp(e,t=0){let i=xt(this.x,e.xMin+t,e.xMax-t),s=xt(this.y,e.yMin+t,e.yMax-t);return new y(i,s)}changeCoordinates(e,t){let i=t.xMin+(this.x-e.xMin)/e.dx*t.dx,s=t.yMin+(this.y-e.yMin)/e.dy*t.dy;return new y(i,s)}add(e){return y.sum(this,e)}subtract(e){return y.difference(this,e)}round(e=1){return new y(Xe(this.x,e),Xe(this.y,e))}floor(){return new y(Math.floor(this.x),Math.floor(this.y))}mod(e,t=e){return new y(this.x%e,this.y%t)}angle(e=Ye){return Kr(this,e)}snap(e,t=5){return B(this.x,e.x,t)?new y(e.x,this.y):B(this.y,e.y,t)?new y(this.x,e.y):this}static average(...e){let t=kt(e.map(s=>s.x))/e.length,i=kt(e.map(s=>s.y))/e.length;return new y(t,i)}static dot(e,t){return e.x*t.x+e.y*t.y}static sum(e,t){return new y(e.x+t.x,e.y+t.y)}static difference(e,t){return new y(e.x-t.x,e.y-t.y)}static distance(e,t){return Math.sqrt(ae(e.x-t.x)+ae(e.y-t.y))}static manhattan(e,t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}static interpolate(e,t,i=.5){return new y(sh(e.x,t.x,i),sh(e.y,t.y,i))}static interpolateList(e,t=.5){let i=e.length-1,s=Math.floor(xt(t,0,1)*i);return y.interpolate(e[s],e[s+1],i*t-s)}static fromPolar(e,t=1){return new y(t*Math.cos(e),t*Math.sin(e))}static random(e){let t=Jt.uniform(e.xMin,e.xMax),i=Jt.uniform(e.yMin,e.yMax);return new y(t,i)}static equals(e,t,i){return B(e.x,t.x,i)&&B(e.y,t.y,i)}static colinear(e,t,i,s){let n=e.x-t.x,r=e.y-t.y,o=t.x-i.x,a=t.y-i.y;return B(n*a,o*r,s)}transform(e){let t=e[0][0]*this.x+e[0][1]*this.y+e[0][2],i=e[1][0]*this.x+e[1][1]*this.y+e[1][2];return new y(t,i)}rotate(e,t=Ye){if(B(e,0))return this;let i=this.x-t.x,s=this.y-t.y,n=Math.cos(e),r=Math.sin(e),o=i*n-s*r+t.x,a=i*r+s*n+t.y;return new y(o,a)}reflect(e){let t=e.p2.x-e.p1.x,i=e.p2.y-e.p1.y,s=this.x-e.p1.x,n=this.y-e.p1.y,r=(t*n-i*s)/(t*t+i*i),o=this.x+2*r*i,a=this.y-2*r*t;return new y(o,a)}scale(e,t=e){return new y(this.x*e,this.y*t)}shift(e,t=e){return new y(this.x+e,this.y+t)}translate(e){return this.shift(e.x,e.y)}equals(e,t){return y.equals(this,e,t)}toString(){return`Point(x: ${this.x}, y: ${this.y})`}},Ye=new y(0,0),zn=class{constructor(e,t,i){this.c=e,this.start=t,this.angle=i,this.type="arc"}get radius(){return y.distance(this.c,this.start)}get end(){return this.start.rotate(this.angle,this.c)}get startAngle(){return Kr(this.start,this.c)}contract(e){return new this.constructor(this.c,this.at(e/2),this.angle*(1-e))}get minor(){return this.angle<=Math.PI?this:new this.constructor(this.c,this.end,ye-this.angle)}get major(){return this.angle>=Math.PI?this:new this.constructor(this.c,this.end,ye-this.angle)}get center(){return this.at(.5)}project(e){let t=this.startAngle,i=t+this.angle,s=Kr(e,this.c);return i>ye&&s<i-ye&&(s+=ye),s=xt(s,t,i),this.c.shift(this.radius,0).rotate(s,this.c)}at(e){return this.start.rotate(this.angle*e,this.c)}contains(e){return e.equals(this.project(e))}transform(e){return new this.constructor(this.c.transform(e),this.start.transform(e),this.angle)}rotate(e,t=Ye){return B(e,0)?this:new this.constructor(this.c.rotate(e,t),this.start.rotate(e,t),this.angle)}reflect(e){return new this.constructor(this.c.reflect(e),this.start.reflect(e),this.angle)}scale(e,t=e){return new this.constructor(this.c.scale(e,t),this.start.scale(e,t),this.angle)}shift(e,t=e){return new this.constructor(this.c.shift(e,t),this.start.shift(e,t),this.angle)}translate(e){return this.shift(e.x,e.y)}equals(){return!1}},Dd=class extends zn{constructor(){super(...arguments);this.type="sector"}contains(e){return y.distance(e,this.c)<=this.radius&&new ne(this.start,this.c,e).rad<=this.angle}},zt=class{constructor(e,t){this.p1=e,this.p2=t,this.type="line"}make(e,t){return new zt(e,t)}get length(){return y.distance(this.p1,this.p2)}get lengthSquared(){return(this.p1.x-this.p2.x)**2+(this.p1.y-this.p2.y)**2}get midpoint(){return y.average(this.p1,this.p2)}get slope(){return(this.p2.y-this.p1.y)/(this.p2.x-this.p1.x)}get intercept(){return this.p1.y+this.slope*this.p1.x}get angle(){return Kr(this.p2,this.p1)}get unitVector(){return this.p2.subtract(this.p1).unitVector}get perpendicularVector(){return new y(this.p2.y-this.p1.y,this.p1.x-this.p2.x).unitVector}parallel(e){let t=y.sum(e,y.difference(this.p2,this.p1));return new zt(e,t)}perpendicular(e){return new zt(e,y.sum(e,this.perpendicularVector))}get perpendicularBisector(){return this.perpendicular(this.midpoint)}distanceSquared(e){let t=this.project(e);return(e.x-t.x)**2+(e.y-t.y)**2}offset(e){let t=y.difference(this.p2,this.p1),i=y.difference(e,this.p1);return y.dot(t,i)/this.lengthSquared}project(e){return this.at(this.offset(e))}side(e,t){let i=y.difference(this.p2,this.p1),s=y.difference(e,this.p1),n=s.x*i.y-s.y*i.x;return B(n,0,t)?0:Math.sign(n)}contains(e,t){return this.side(e,t)===0}at(e){return y.interpolate(this.p1,this.p2,e)}transform(e){return new this.constructor(this.p1.transform(e),this.p2.transform(e))}rotate(e,t=Ye){return B(e,0)?this:new this.constructor(this.p1.rotate(e,t),this.p2.rotate(e,t))}reflect(e){return new this.constructor(this.p1.reflect(e),this.p2.reflect(e))}scale(e,t=e){return this.make(this.p1.scale(e,t),this.p2.scale(e,t))}shift(e,t=e){return this.make(this.p1.shift(e,t),this.p2.shift(e,t))}translate(e){return this.shift(e.x,e.y)}equals(e,t){return this.contains(e.p1,t)&&this.contains(e.p2,t)}toString(){return`Line(p1: ${this.p1}, p2: ${this.p2})`}},ah=class extends zt{constructor(){super(...arguments);this.type="ray"}make(e,t){return new ah(e,t)}equals(e,t){return e.type!=="ray"?!1:this.p1.equals(e.p1,t)&&this.contains(e.p2,t)}toString(){return`Ray(p1: ${this.p1}, p2: ${this.p2})`}},he=class extends zt{constructor(){super(...arguments);this.type="segment"}contains(e,t){return zt.prototype.contains.call(this,e,t)?this.p1.equals(e,t)||this.p2.equals(e,t)?!0:B(this.p1.x,this.p2.x,t)?Ut(e.y,this.p1.y,this.p2.y):Ut(e.x,this.p1.x,this.p2.x):!1}make(e,t){return new he(e,t)}project(e){let t=y.difference(this.p2,this.p1),i=y.difference(e,this.p1),s=xt(y.dot(t,i)/this.lengthSquared,0,1);return y.sum(this.p1,t.scale(s))}contract(e){return new he(this.at(e),this.at(1-e))}equals(e,t,i=!1){return e.type!=="segment"?!1:this.p1.equals(e.p1,t)&&this.p2.equals(e.p2,t)||!i&&this.p1.equals(e.p2,t)&&this.p2.equals(e.p1,t)}toString(){return`Segment(p1: ${this.p1}, p2: ${this.p2})`}},M5=180/Math.PI,S5=Math.PI/180;var ne=class{constructor(e,t,i){this.a=e,this.b=t,this.c=i,this.type="angle"}static fromDegrees(e){return ne.fromRadians(e*(Math.PI/180))}static fromRadians(e){let t=new y(1,0),i=t.rotate(e);return new ne(t,Ye,i)}get rad(){let e=Math.atan2(this.a.y-this.b.y,this.a.x-this.b.x),i=Math.atan2(this.c.y-this.b.y,this.c.x-this.b.x)-e;return i<0&&(i+=ye),i}get deg(){return this.rad*180/Math.PI}get isRight(){return B(this.rad,Math.PI/2,Math.PI/360)}get bisector(){if(this.b.equals(this.a)||this.b.equals(this.c))return;let e=Math.atan2(this.a.y-this.b.y,this.a.x-this.b.x),t=Math.atan2(this.c.y-this.b.y,this.c.x-this.b.x),i=(e+t)/2;e>t&&(i+=Math.PI);let s=Math.cos(i)+this.b.x,n=Math.sin(i)+this.b.y;return new zt(this.b,new y(s,n))}get sup(){return this.rad<Math.PI?this:new ne(this.c,this.b,this.a)}get arc(){return new zn(this.b,this.a,this.rad)}project(){return this.c}at(){return this.c}contains(){return!1}transform(e){return new ne(this.a.transform(e),this.b.transform(e),this.c.transform(e))}rotate(e,t){return B(e,0)?this:new ne(this.a.rotate(e,t),this.b.rotate(e,t),this.c.rotate(e,t))}reflect(e){return new ne(this.a.reflect(e),this.b.reflect(e),this.c.reflect(e))}scale(e,t=e){return new ne(this.a.scale(e,t),this.b.scale(e,t),this.c.scale(e,t))}shift(e,t=e){return new ne(this.a.shift(e,t),this.b.shift(e,t),this.c.shift(e,t))}translate(e){return new ne(this.a.translate(e),this.b.translate(e),this.c.translate(e))}equals(e){return!1}},rs=1e-6;function hh(e,t,i){let s=(i.x-t.x)*(e.y-t.y),n=(i.y-t.y)*(e.x-t.x);return s-n>=-rs}function Gd(e,t,i){let s=e.y-t.y,n=i.x-t.x,r=e.x-t.x,o=i.y-t.y,a=r*n+s*o;if(a<rs)return!1;let h=n*n+o*o;return a-h<=-rs}function qd(e,t){return B(e.x,t.x)?B(e.y,t.y)?0:e.y<t.y?-1:1:e.x<t.x?-1:1}function Bd(e){return e<=-rs?-2:e<rs?-1:e-1<=-rs?0:e-1<rs?1:2}function Lv(e,t,i,s){let n=t.x-e.x,r=t.y-e.y,o=s.x-i.x,a=s.y-i.y,h=n*a-r*o;if(B(h,0))return!1;let l=e.x-i.x,c=e.y-i.y,p=(o*c-a*l)/h,m=(n*c-r*l)/h,v=new y(e.x+p*n,e.y+p*r);return{alongA:Bd(p),alongB:Bd(m),pt:v}}var Xs=class{constructor(){this.root={root:!0,next:void 0}}exists(e){return e!==void 0&&e!==this.root}get head(){return this.root.next}insertBefore(e,t){let i=this.root,s=this.root.next;for(;s;){if(t(s)){e.prev=s.prev,e.next=s,s.prev.next=e,s.prev=e;return}i=s,s=s.next}i.next=e,e.prev=i,e.next=void 0}findTransition(e){let t=this.root,i=this.root.next;for(;i&&!e(i);)t=i,i=i.next;return{before:t===this.root?void 0:t,after:i,insert:s=>(s.prev=t,s.next=i,t.next=s,i&&(i.prev=s),s)}}static node(e){let t=e;return t.remove=()=>{t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t.prev=t.next=void 0},t}};function lh(e,t,i){let s={above:i.myFill.above,below:i.myFill.below};return{start:e,end:t,myFill:s}}function Ov(e,t,i,s,n,r){let o=qd(t,n);return o!==0?o:y.equals(i,r)?0:e!==s?e?1:-1:hh(i,s?n:r,s?r:n)?1:-1}function ch(e,t,i){e.insertBefore(t,s=>Ov(!!t.isStart,t.pt,i,!!s.isStart,s.pt,s.other.pt)<0)}function Iv(e,t,i){let s=Xs.node({isStart:!0,pt:t.start,seg:t,primary:i});return ch(e,s,t.end),s}function Rv(e,t,i,s){let n=Xs.node({pt:i.end,seg:i,primary:s,other:t});t.other=n,ch(e,n,t.pt)}function Xr(e,t,i){let s=Iv(e,t,i);return Rv(e,s,t,i),s}function _v(e,t,i){t.other.remove(),t.seg.end=i,t.other.pt=i,ch(e,t.other,t.pt)}function Re(e,t,i){let s=lh(i,t.seg.end,t.seg);return _v(e,t,i),Xr(e,s,!!t.primary)}function Nv(e,t){let i=e.seg.start,s=e.seg.end,n=t.seg.start,r=t.seg.end;return y.colinear(i,n,r)?y.colinear(s,n,r)||hh(s,n,r)?1:-1:hh(i,n,r)?1:-1}function uh(e,t,i){let s=t.seg,n=i.seg,r=s.start,o=s.end,a=n.start,h=n.end,l=Lv(r,o,a,h);if(l===!1){if(!y.colinear(r,o,a)||y.equals(r,h)||y.equals(o,a))return!1;let c=y.equals(r,a),p=y.equals(o,h);if(c&&p)return i;let m=!c&&Gd(r,a,h),v=!p&&Gd(o,a,h);if(c)return v?Re(e,i,o):Re(e,t,h),i;m&&(p||(v?Re(e,i,o):Re(e,t,h)),Re(e,i,r))}else l.alongA===0&&(l.alongB===-1?Re(e,t,a):l.alongB===0?Re(e,t,l.pt):l.alongB===1&&Re(e,t,h)),l.alongB===0&&(l.alongA===-1?Re(e,i,r):l.alongA===0?Re(e,i,l.pt):l.alongA===1&&Re(e,i,o));return!1}function Hd(e,t){var i,s;let n=new Xs,r=[];for(;e.head;){let o=e.head;if(o.isStart){let a=function(){if(l){let m=uh(e,o,l);if(m)return m}return c?uh(e,o,c):!1},h=n.findTransition(m=>Nv(o,m.ev)>0),l=(i=h.before)==null?void 0:i.ev,c=(s=h.after)==null?void 0:s.ev,p=a();if(p&&(t?(o.seg.myFill.below?o.seg.myFill.above!==o.seg.myFill.below:!0)&&(p.seg.myFill.above=!p.seg.myFill.above):p.seg.otherFill=o.seg.myFill,o.other.remove(),o.remove()),e.head!==o)continue;if(t){let m=o.seg.myFill.below?o.seg.myFill.above!==o.seg.myFill.below:!0;o.seg.myFill.below=c?c.seg.myFill.above:!1,o.seg.myFill.above=m?!o.seg.myFill.below:o.seg.myFill.below}else if(o.seg.otherFill===void 0){let m=c?o.primary===c.primary?c.seg.otherFill.above:c.seg.myFill.above:!1;o.seg.otherFill={above:m,below:m}}o.other.status=h.insert(Xs.node({ev:o}))}else{let a=o.status;if(a===void 0)throw new Error("[Euclid.js] Zero-length segment detected!");if(n.exists(a.prev)&&n.exists(a.next)&&uh(e,a.prev.ev,a.next.ev),a.remove(),!o.primary){let h=o.seg.myFill;o.seg.myFill=o.seg.otherFill,o.seg.otherFill=h}r.push(o.seg)}e.head.remove()}return r}function Dv(e){let t=[],i=[];return e.forEach(s=>{let n=s.start,r=s.end;if(y.equals(n,r))return;let o={index:0,matchesHead:!1,matchesPt1:!1},a={index:0,matchesHead:!1,matchesPt1:!1},h=o;function l(f,b,$){h.index=f,h.matchesHead=b,h.matchesPt1=$;let w=h===o;return h=w?a:void 0,!w}for(let f=0;f<t.length;f++){let b=t[f],$=b[0],w=ct(b);if(y.equals($,n)){if(l(f,!0,!0))break}else if(y.equals($,r)){if(l(f,!0,!1))break}else if(y.equals(w,n)){if(l(f,!1,!0))break}else if(y.equals(w,r)&&l(f,!1,!1))break}if(h===o){t.push([n,r]);return}if(h===a){let f=o.index,b=o.matchesPt1?r:n,$=o.matchesHead,w=t[f],x=$?w[0]:w[w.length-1],z=$?w[1]:w[w.length-2],Gt=$?w[w.length-1]:w[0],Ft=$?w[w.length-2]:w[1];if(y.colinear(z,x,b)&&($?w.shift():w.pop(),x=z),y.equals(Gt,b)){t.splice(f,1),y.colinear(Ft,Gt,x)&&($?w.pop():w.shift()),i.push(w);return}$?w.unshift(b):w.push(b);return}function c(f){t[f].reverse()}function p(f,b){let $=t[f],w=t[b],x=$[$.length-1],z=$[$.length-2],Gt=w[0],Ft=w[1];y.colinear(z,x,Gt)&&($.pop(),x=z),y.colinear(x,Gt,Ft)&&w.shift(),t[f]=$.concat(w),t.splice(b,1)}let m=o.index,v=a.index,M=t[m].length<t[v].length;o.matchesHead?a.matchesHead?M?(c(m),p(m,v)):(c(v),p(v,m)):p(v,m):a.matchesHead?p(m,v):M?(c(m),p(v,m)):(c(v),p(m,v))}),i}function Gv(e,t){let i=[];for(let s of e){let n=(s.myFill.above?8:0)+(s.myFill.below?4:0)+(s.otherFill&&s.otherFill.above?2:0)+(s.otherFill&&s.otherFill.below?1:0);t[n]!==0&&i.push({start:s.start,end:s.end,myFill:{above:t[n]===1,below:t[n]===2}})}return i}function zd(e){let t=new Xs;for(let i of e)for(let s=0;s<i.length;s++){let n=s?i[s-1]:ct(i),r=i[s],o=qd(n,r);if(o===0)continue;let a=o<0?n:r,h=o<0?r:n;Xr(t,{start:a,end:h,myFill:{}},!0)}return Hd(t,!0)}function dh(e,t,i){let s=new Xs;for(let r of zd(e))Xr(s,lh(r.start,r.end,r),!0);for(let r of zd(t))Xr(s,lh(r.start,r.end,r),!1);let n=Gv(Hd(s,!1),i);return Dv(n)}var qv=[0,2,1,0,2,2,0,0,1,0,1,0,0,0,0,0],Bv=[0,0,0,0,0,2,0,2,0,0,1,1,0,2,1,0],Hv=[0,0,0,0,2,0,2,0,1,1,0,0,0,1,2,0],zv=(e,t)=>dh(e,t,qv),Fv=(e,t)=>dh(e,t,Bv),Uv=(e,t)=>dh(e,t,Hv),le=class{constructor(e=Ye,t=1){this.c=e,this.r=t,this.type="circle"}get circumference(){return ye*this.r}get area(){return Math.PI*this.r**2}get arc(){let e=this.c.shift(this.r,0);return new zn(this.c,e,ye)}tangentAt(e){let t=this.at(e),i=this.c.rotate(Math.PI/2,t);return new zt(t,i)}collision(e){let t=this.c.x<e.p.x?e.p.x:this.c.x>e.p.x+e.w?e.p.x+e.w:this.c.x,i=this.c.y<e.p.y?e.p.y:this.c.y>e.p.y+e.h?e.p.y+e.h:this.c.y;return y.distance(this.c,new y(t,i))<=this.r}project(e){let t=e.subtract(this.c).unitVector.scale(this.r);return y.sum(this.c,t)}at(e){let t=ye*e;return this.c.shift(this.r*Math.cos(t),this.r*Math.sin(t))}contains(e){return y.distance(e,this.c)<=this.r}transform(e){let t=Math.abs(e[0][0])+Math.abs(e[1][1]);return new le(this.c.transform(e),this.r*t/2)}rotate(e,t=Ye){return B(e,0)?this:new le(this.c.rotate(e,t),this.r)}reflect(e){return new le(this.c.reflect(e),this.r)}scale(e,t=e){return new le(this.c.scale(e,t),this.r*(e+t)/2)}shift(e,t=e){return new le(this.c.shift(e,t),this.r)}translate(e){return this.shift(e.x,e.y)}equals(e,t){return B(this.r,e.r,t)&&this.c.equals(e.c,t)}toString(){return`Circle(c: ${this.c}, r: ${this.r})`}};function Yr(e){return["polygon","polyline","rectangle","triangle"].includes(e.type)}function Fd(e){return["polygon","triangle"].includes(e.type)}function Ud(e){return e.type==="polyline"}function jv(e){return e.type==="rectangle"}function _e(e){return["line","ray","segment"].includes(e.type)}function Wv(e){return e.type==="line"}function Zv(e){return e.type==="ray"}function jd(e){return e.type==="segment"}function Qe(e){return e.type==="circle"}function Fn(e){return e.type==="arc"}function ph(e){return e.type==="sector"}function fh(e){return e.type==="angle"}function Wd(e){return e.type==="point"}function Kv(e,t){return B(e.p1.x,e.p2.x)?Ut(t.y,e.p1.y,e.p2.y):Ut(t.x,e.p1.x,e.p2.x)}function Xv(e,t){return B(e.p1.x,e.p2.x)?(t.y-e.p1.y)/(e.p2.y-e.p1.y)>0:(t.x-e.p1.x)/(e.p2.x-e.p1.x)>0}function Yv(e,t){let i=e.p1.x-e.p2.x,s=e.p1.y-e.p2.y,n=t.p1.x-t.p2.x,r=t.p1.y-t.p2.y,o=i*r-s*n;if(B(o,0))return[];let a=e.p1.x*e.p2.y-e.p1.y*e.p2.x,h=t.p1.x*t.p2.y-t.p1.y*t.p2.x,l=a*n-i*h,c=a*r-s*h;return[new y(l/o,c/o)]}function Qv(e,t){let i=y.distance(e.c,t.c);if(i>e.r+t.r)return[];if(i<Math.abs(e.r-t.r))return[];if(B(i,0)&&B(e.r,t.r))return[];if(B(i,e.r+t.r))return[new zt(e.c,t.c).midpoint];let s=(ae(e.r)-ae(t.r)+ae(i))/(2*i),n=Math.sqrt(ae(e.r)-ae(s)),r=(t.c.x-e.c.x)*s/i+(t.c.y-e.c.y)*n/i+e.c.x,o=(t.c.y-e.c.y)*s/i-(t.c.x-e.c.x)*n/i+e.c.y,a=(t.c.x-e.c.x)*s/i-(t.c.y-e.c.y)*n/i+e.c.x,h=(t.c.y-e.c.y)*s/i+(t.c.x-e.c.x)*n/i+e.c.y;return[new y(r,o),new y(a,h)]}function Zd(e,t){let i=e.p2.x-e.p1.x,s=e.p2.y-e.p1.y,n=ae(i)+ae(s),r=t.c.x,o=t.c.y,a=(e.p1.x-r)*(e.p2.y-o)-(e.p2.x-r)*(e.p1.y-o),h=ae(t.r)*n-ae(a);if(h<0)return[];let l=a*s/n,c=-a*i/n;if(B(h,0))return[t.c.shift(l,c)];let p=i*(s<0?-1:1)*Math.sqrt(h)/n,m=Math.abs(s)*Math.sqrt(h)/n;return[t.c.shift(l+p,c+m),t.c.shift(l-p,c-m)]}function Jv(e,t){let i=[];_e(e)&&_e(t)?i=Yv(e,t):_e(e)&&Qe(t)?i=Zd(e,t):Qe(e)&&_e(t)?i=Zd(t,e):Qe(e)&&Qe(t)&&(i=Qv(e,t));for(let s of[e,t])s.type==="segment"&&(i=i.filter(n=>Kv(s,n))),s.type==="ray"&&(i=i.filter(n=>Xv(s,n)));return i}function jt(...e){if(e.length<2)return[];if(e.length>2)return Ii(Md(e,2).map(s=>jt(...s)));let[t,i]=e;if(Yr(i)&&([t,i]=[i,t]),Yr(t)){let s=_e(i)?t.points.filter(n=>i.contains(n)):[];for(let n of t.edges)s.push(...jt(n,i));return s}return Jv(t,i)}var xe=class{constructor(...e){this.type="polygon",this.points=e}get circumference(){if(this.points.length<=1)return 0;let e=y.distance(this.points[0],ct(this.points));for(let t=1;t<this.points.length;++t)e+=y.distance(this.points[t-1],this.points[t]);return e}get signedArea(){let e=this.points,t=e.length,i=e[t-1].x*e[0].y-e[0].x*e[t-1].y;for(let s=1;s<t;++s)i+=e[s-1].x*e[s].y-e[s].x*e[s-1].y;return i/2}get area(){return Math.abs(this.signedArea)}get centroid(){let e=this.points,t=e.length,i=0;for(let n=0;n<t;++n)i+=e[n].x;let s=0;for(let n=0;n<t;++n)s+=e[n].y;return new y(i/t,s/t)}get edges(){let e=this.points,t=e.length,i=[];for(let s=0;s<t;++s)i.push(new he(e[s],e[(s+1)%t]));return i}get radius(){let e=this.centroid,t=this.points.map(i=>y.distance(i,e));return Math.max(...t)}get oriented(){if(this.signedArea>=0)return this;let e=[...this.points].reverse();return new this.constructor(...e)}cut(e){let t=this.radius/e.length*10,i=e.at(-t),s=e.at(t),n=e.perpendicularVector.scale(e.length*t),r=[i,s,s.add(n),i.add(n)],o=Fv([this.points],[r]),a=Uv([this.points],[r]);return[...o,...a].map(h=>new xe(...h))}static collision(e,t){if(e.points.some(i=>t.contains(i))||t.points.some(i=>e.contains(i)))return!0;for(let i of e.edges)for(let s of t.edges)if(jt(i,s)[0])return!0;return!1}static union(...e){let[t,...i]=e;if(!i.length)return[t];let s=[t.points],n=i.length>1?xe.union(...i).map(r=>r.points):[e[1].points];return zv(s,n).map(r=>new xe(...r))}static regular(e,t=1){let i=ye/e,s=Math.PI/2-i/2,n=Ze(r=>y.fromPolar(s+i*r,t),e);return new xe(...n)}static interpolate(e,t,i=.5){let s=e.points.map((n,r)=>y.interpolate(n,t.points[r],i));return new xe(...s)}static convexHull(...e){if(e.length<=3)return new xe(...e);let t=e.sort((r,o)=>r.x!==o.x?r.x-o.x:r.y-o.y),i=t.slice(0).reverse(),s=[],n=[];for(let[r,o]of[[t,s],[i,n]]){for(let a of r){for(;o.length>=2;){let h=o[o.length-1],l=o[o.length-2];if((h.x-l.x)*(a.y-l.y)>=(a.x-l.x)*(h.y-l.y))o.pop();else break}o.push(a)}o.pop()}return new xe(...s.concat(n))}contains(e){let t=!1;for(let i of this.edges){if(i.p1.equals(e)||i.contains(e))return!1;if(i.p1.y>e.y==i.p2.y>e.y)continue;let s=(i.p2.x-i.p1.x)/(i.p2.y-i.p1.y);e.x<s*(e.y-i.p1.y)+i.p1.x&&(t=!t)}return t}at(e){return y.interpolateList([...this.points,this.points[0]],e)}project(e){let t,i=Infinity;for(let s of this.edges){let n=s.project(e),r=y.distance(e,n);r<i&&(t=n,i=r)}return t||this.points[0]}centerAt(e=Ye){return this.translate(e.subtract(this.centroid))}transform(e){return new this.constructor(...this.points.map(t=>t.transform(e)))}rotate(e,t=Ye){if(B(e,0))return this;let i=this.points.map(s=>s.rotate(e,t));return new this.constructor(...i)}reflect(e){let t=this.points.map(i=>i.reflect(e));return new this.constructor(...t)}scale(e,t=e){let i=this.points.map(s=>s.scale(e,t));return new this.constructor(...i)}shift(e,t=e){let i=this.points.map(s=>s.shift(e,t));return new this.constructor(...i)}translate(e){return this.shift(e.x,e.y)}equals(e,t,i){let s=this.points.length;if(s!==e.points.length)return!1;let n=i?this:this.oriented,r=i?e:e.oriented;for(let o=0;o<s;++o)if(n.points.every((a,h)=>a.equals(r.points[(h+o)%s],t)))return!0;return!1}},Kd=class extends xe{constructor(){super(...arguments);this.type="polyline"}get length(){let e=0;for(let t=1;t<this.points.length;++t)e+=y.distance(this.points[t-1],this.points[t]);return e}get edges(){let e=[];for(let t=0;t<this.points.length-1;++t)e.push(new he(this.points[t],this.points[t+1]));return e}},Xd=class extends xe{constructor(){super(...arguments);this.type="triangle"}get circumcircle(){let[e,t,i]=this.points,s=2*(e.x*(t.y-i.y)+t.x*(i.y-e.y)+i.x*(e.y-t.y)),n=(e.x**2+e.y**2)*(t.y-i.y)+(t.x**2+t.y**2)*(i.y-e.y)+(i.x**2+i.y**2)*(e.y-t.y),r=(e.x**2+e.y**2)*(i.x-t.x)+(t.x**2+t.y**2)*(e.x-i.x)+(i.x**2+i.y**2)*(t.x-e.x),o=new y(n/s,r/s),a=y.distance(o,this.points[0]);return new le(o,a)}get incircle(){let e=this.edges,t=e.map(c=>c.length),i=t[0]+t[1]+t[2],[s,n,r]=this.points,o=t[1]*s.x+t[2]*n.x+t[0]*r.x,a=t[1]*s.y+t[2]*n.y+t[0]*r.y,h=new y(o/i,a/i),l=h.distanceFromLine(e[0]);return new le(h,l)}get orthocenter(){let[e,t,i]=this.points,s=new zt(e,t).perpendicular(i),n=new zt(e,i).perpendicular(t);return jt(s,n)[0]}},ce=class{constructor(e,t=1,i=t){this.p=e,this.w=t,this.h=i,this.type="rectangle"}static aroundPoints(e){let t=Infinity,i=-Infinity,s=Infinity,n=-Infinity;for(let r of e)t=t<r.x?t:r.x,i=i>r.x?i:r.x,s=s<r.y?s:r.y,n=n>r.y?n:r.y;return new ce(new y(t,s),i-t,n-s)}get center(){return new y(this.p.x+this.w/2,this.p.y+this.h/2)}get centroid(){return this.center}get circumference(){return 2*Math.abs(this.w)+2*Math.abs(this.h)}get area(){return Math.abs(this.w*this.h)}get edges(){return this.polygon.edges}get points(){return this.polygon.points}get polygon(){let e=new y(this.p.x+this.w,this.p.y),t=new y(this.p.x+this.w,this.p.y+this.h),i=new y(this.p.x,this.p.y+this.h);return new xe(this.p,e,t,i)}collision(e){return this.p.x<e.p.x+e.w&&this.p.x+this.w>e.p.x&&this.p.y<e.p.y+e.h&&this.p.y+this.h>e.p.y}contains(e,t){return Ut(e.x,this.p.x,this.p.x+this.w,t)&&Ut(e.y,this.p.y,this.p.y+this.h,t)}project(e){let t;for(let i of this.edges){let s=i.project(e);(!t||y.distance(e,s)<y.distance(e,t))&&(t=s)}return t}at(e){return this.p}transform(e){return this.polygon.transform(e)}rotate(e,t=Ye){return B(e,0)?this:this.polygon.rotate(e,t)}reflect(e){return this.polygon.reflect(e)}scale(e,t=e){return new ce(this.p.scale(e,t),this.w*e,this.h*t)}shift(e,t=e){return new ce(this.p.shift(e,t),this.w,this.h)}translate(e){return this.shift(e.x,e.y)}equals(e){return!1}toString(){return`Rectangle(p: ${this.p}, w: ${this.w}, h: ${this.h})`}},be=class{constructor(e,t,i,s){this.xMin=e,this.xMax=t,this.yMin=i,this.yMax=s}contains(e){return this.containsX(e)&&this.containsY(e)}containsX(e){return Ut(e.x,this.xMin,this.xMax)}containsY(e){return Ut(e.y,this.yMin,this.yMax)}resize(e,t){return new be(this.xMin,this.xMax+e,this.yMin,this.yMax+t)}get dx(){return this.xMax-this.xMin}get dy(){return this.yMax-this.yMin}get xRange(){return[this.xMin,this.xMax]}get yRange(){return[this.yMin,this.yMax]}get rect(){return new ce(new y(this.xMin,this.yMin),this.dx,this.dy)}get center(){return new y(this.xMin+this.dx/2,this.yMin+this.dy/2)}get flip(){return new be(this.yMin,this.yMax,this.xMin,this.xMax)}};function Yd(e,t,i={}){if(i.fill&&(e.fillStyle=i.fill),i.opacity&&(e.globalAlpha=i.opacity),i.stroke&&(e.strokeStyle=i.stroke,e.lineWidth=i.strokeWidth||1,i.lineCap&&(e.lineCap=i.lineCap),i.lineJoin&&(e.lineJoin=i.lineJoin)),e.beginPath(),jd(t))e.moveTo(t.p1.x,t.p1.y),e.lineTo(t.p2.x,t.p2.y);else if(Qe(t))e.arc(t.c.x,t.c.y,t.r,0,ye);else if(Fd(t)){e.moveTo(t.points[0].x,t.points[0].y);for(let s of t.points.slice(1))e.lineTo(s.x,s.y);e.closePath()}else if(Ud(t)){e.moveTo(t.points[0].x,t.points[0].y);for(let s of t.points.slice(1))e.lineTo(s.x,s.y)}i.fill&&e.fill(),i.stroke&&e.stroke()}function mh(e,t,i){let n=t.x*(i.y-e.y)+e.x*(t.y-i.y)+i.x*(e.y-t.y)>0?1:0,r=y.distance(t,e);return[e.x,`${e.y}A${r}`,r,0,n,1,i.x,i.y].join(",")}function gh(e,t={}){return e.isRight&&!t.round?20:24+20*(1-xt(e.rad,0,Math.PI)/Math.PI)}function tw(e,t={}){let i=e.a,s=e.b,n=e.c,r=t.size||gh(e,t),o=y.difference(i,s).unitVector,a=y.difference(n,s).unitVector;i=y.sum(s,o.scale(r)),n=y.sum(s,a.scale(r));let h=t.fill?`M${s.x},${s.y}L`:"M";if(e.isRight&&!t.round){let l=y.sum(i,a.scale(r));h+=`${i.x},${i.y}L${l.x},${l.y}L${n.x},${n.y}`}else h+=mh(i,s,n);return t.fill&&(h+="Z"),h}function ue(...e){return`M${e.map(t=>`${t.x},${t.y}`).join("L")}`}function Qd(e,t){let i=e.perpendicularVector.scale(6),s=e.unitVector.scale(3),n=e.midpoint;switch(t){case"bar":return ue(n.add(i),n.add(i.inverse));case"bar2":return ue(n.add(s).add(i),n.add(s).add(i.inverse))+ue(n.add(s.inverse).add(i),n.add(s.inverse).add(i.inverse));case"arrow":return ue(n.add(s.inverse).add(i),n.add(s),n.add(s.inverse).add(i.inverse));case"arrow2":return ue(n.add(s.scale(-2)).add(i),n,n.add(s.scale(-2)).add(i.inverse))+ue(n.add(i),n.add(s.scale(2)),n.add(i.inverse));default:return""}}function Qr(e,t){if(!e||!t)return"";let i=t.perpendicular,s=e.add(t.scale(9)).add(i.scale(9)),n=e.add(t.scale(9)).add(i.scale(-9));return ue(s,e,n)}function ew(e,t){let i="";return tt(t,"start","both")&&(i+=Qr(e.p1,e.unitVector)),tt(t,"end","both")&&(i+=Qr(e.p2,e.unitVector.inverse)),i}function iw(e,t){let i="";if(tt(t,"start","both")){let s=new zt(e.c,e.start).perpendicularVector.inverse;i+=Qr(e.start,s)}if(tt(t,"end","both")){let s=new zt(e.c,e.end).perpendicularVector;i+=Qr(e.end,s)}return i}function vh(e,t={}){if(fh(e))return tw(e,t);if(jd(e)){if(e.p1.equals(e.p2))return"";let i=ue(e.p1,e.p2);return t.mark&&(i+=Qd(e,t.mark)),t.arrows&&(i+=ew(e,t.arrows)),i}if(Zv(e)){if(!t.box)return"";let i=jt(e,t.box)[0];return i?ue(e.p1,i):""}if(Wv(e)){if(!t.box)return"";let i=jt(e,t.box);if(i.length<2)return"";let s=ue(i[0],i[1]);return t.mark&&(s+=Qd(e,t.mark)),s}if(Qe(e))return`M ${e.c.x-e.r} ${e.c.y} a ${e.r},${e.r} 0 1 0 ${2*e.r} 0 a ${e.r} ${e.r} 0 1 0 ${-2*e.r} 0`;if(Fn(e)){let i=`M${mh(e.start,e.c,e.end)}`;return t.arrows&&(i+=iw(e,t.arrows)),i}return ph(e)?`M ${e.c.x} ${e.c.y} L ${mh(e.start,e.c,e.end)} Z`:Ud(e)?ue(...e.points):Fd(e)?`${ue(...e.points)}Z`:jv(e)?`${ue(...e.polygon.points)}Z`:""}var $e=(e,t,i)=>new Promise((s,n)=>{var r=h=>{try{a(i.next(h))}catch(l){n(l)}},o=h=>{try{a(i.throw(h))}catch(l){n(l)}},a=h=>h.done?s(h.value):Promise.resolve(h.value).then(r,o);a((i=i.apply(e,t)).next())});function sw(e){let t=[];for(let i of Object.keys(e)){let s=e[i];if(i=encodeURIComponent(i),s==null){t.push(i);continue}s=Array.isArray(s)?s.join(","):`${s}`,s=s.replace(/(\r)?\n/g,`\r
`),s=encodeURIComponent(s),s=s.replace(/%20/g,"+"),t.push(`${i}=${s}`)}return t.join("&")}function Jd(e){e=e.replace(/^[?,&]/,"");let t=decodeURIComponent(e).split("&"),i={};return t.forEach(s=>{let n=s.split("=");i[n[0]]=n[1]}),i}function fi(e,t){return $e(this,null,function*(){let i=t instanceof FormData,s={method:"POST",body:i?t:t?sw(t):void 0,headers:{"X-CSRF-Token":window.csrfToken||""}};i||(s.headers["Content-Type"]="application/x-www-form-urlencoded");let n=e.includes("?")?"&xhr=1":"?xhr=1",r=yield fetch(e+n,s);if(!r.ok)throw new Error(`Fetch error ${r.status}: ${e}`);return r.text()})}function tp(e,t=!1){return new Promise(i=>{let s=new Image;t||(s.crossOrigin="Anonymous"),s.onload=()=>i(s),s.src=e})}var Un=new Map;function ep(e,t){Un.has(e)?Ka(Un.get(e),t,(i,s)=>Ke(i.concat(s))):Un.set(e,t)}function ip(){if(!!window.navigator.onLine)for(let[e,t]of Un)Un.delete(e),fi(e,{data:JSON.stringify(t)}).catch(i=>{console.error("Failed to send POST request:",i),ep(e,t)})}var sp=Oi(ip,5e3);window.addEventListener("online",sp);window.onbeforeunload=ip;function np(e,t){ep(e,t),sp()}var rp;(function(e){e[e.Array=0]="Array",e[e.BinaryOp=1]="BinaryOp",e[e.Call=2]="Call",e[e.Conditional=3]="Conditional",e[e.Identifier=4]="Identifier",e[e.Literal=5]="Literal",e[e.Member=6]="Member",e[e.UnaryOp=7]="UnaryOp"})(rp||(rp={}));var op={"===":(e,t)=>e===t,"!==":(e,t)=>e!==t,"||":(e,t)=>e||t,"&&":(e,t)=>e&&t,"==":(e,t)=>e==t,"!=":(e,t)=>e!=t,"<=":(e,t)=>e<=t,">=":(e,t)=>e>=t,"**":(e,t)=>e**t,"<":(e,t)=>e<t,">":(e,t)=>e>t,"+":(e,t)=>e+t,"-":(e,t)=>e-t,"*":(e,t)=>e*t,"/":(e,t)=>e/t,"%":(e,t)=>e%t},ap={"-":e=>-e,"+":e=>+e,"!":e=>!e},hp={"||":1,"&&":2,"==":3,"!=":3,"===":3,"!==":3,"<":4,">":4,"<=":4,">=":4,"+":5,"-":5,"*":6,"/":6,"%":6,"**":7},lp={true:!0,false:!1,undefined:void 0},nw=/\s/,wh=/[0-9]/,yh=/[a-zA-Zα-ωΑ-Ω$_]/,rw=/[0-9a-zA-Zα-ωΑ-Ω$_]/;function ow(e){let t=e.length,i=0;function s(f){throw new Error(`${f} at character ${i} of "${e}"`)}function n(){for(;nw.test(e[i]);)i+=1}function r(){let f="";for(;wh.test(e[i]);)f+=e[i++];if(e[i]===".")for(f+=e[i++];wh.test(e[i]);)f+=e[i++];let b=e[i];if(b&&yh.test(b)){let $=f+e[i];s(`Variable names cannot start with a number (${$})`)}else b==="."&&s("Unexpected period");return{type:5,value:parseFloat(f)}}function o(){let f=e[i];i+=1;let b=!1,$="";for(;i<t;){let w=e[i++];if(w===f){b=!0;break}$+=w}return b||s(`Unclosed quote after "${$}"`),{type:5,value:$}}function a(){let f=e[i];for(yh.test(e[i])||s(`Unexpected ${f}`),i+=1;i<t&&rw.test(e[i]);)f+=e[i++];return f in lp?{type:5,value:lp[f]}:{type:4,name:f}}function h(f){let b=[],$=!1,w;for(;i<t;)if(e[i]===f){w&&b.push(w),$=!0,i+=1;break}else e[i]===","?(b.push(w||{type:5,value:void 0}),i+=1):w=v();return $||s(`Expected ${f}`),b}function l(){let f;if(e[i]==="("){if(i+=1,f=v(),n(),e[i]===")")return i+=1,f;s("Unclosed (")}else f=a();for(n();".[(".includes(e[i]);)e[i]==="."?(i++,n(),f={type:6,object:f,computed:!1,property:a()}):e[i]==="["?(i++,f={type:6,object:f,computed:!0,property:v()},n(),e[i]!=="]"&&s("Unclosed ["),i++):e[i]==="("&&(i++,f={type:2,args:h(")"),callee:f}),n();return f}function c(){n();for(let f of[3,2,1]){let b=e.substr(i,f);if(b in op)return i+=f,b}}function p(){n();let f=e[i];if(wh.test(f)||f===".")return r();if(f==="'"||f==='"')return o();if(f==="[")return i+=1,{type:0,elements:h("]")};if(f in ap)return i+=1,{type:7,operator:f,argument:p()};if(yh.test(f)||f==="(")return l();s("Expression parsing error")}function m(){let f=p(),b=c();if(!b)return f;let $=p();$||s(`Expected expression after ${b}`);let w,x=[f,b,$];for(;b=c();){let Gt=hp[b],Ft=b;for(;x.length>2&&Gt<=hp[x[x.length-2]];)$=x.pop(),b=x.pop(),f=x.pop(),w={type:1,operator:b,left:f,right:$},x.push(w);w=p(),w||s(`Expected expression after ${Ft}`),x.push(Ft,w)}let z=x.length-1;for(w=x[z];z>1;)w={type:1,operator:x[z-1],left:x[z-2],right:w},z-=2;return w}function v(){let f=m();if(n(),f&&e[i]==="?"){i+=1;let b=v();if(b||s("Expected expression"),n(),e[i]===":"){i++;let $=v();return $||s("Expected expression"),{type:3,test:f,consequent:b,alternate:$}}else s("Expected :")}else return f}let M=v();return i<e.length&&s(`Unexpected "${e[i]}"`),M}var Jr=[void 0,void 0];function Me(e,t,i){switch(e.type){case 0:let s=e.elements.map(M=>Me(M,t,i)[0]);return s.some(M=>M===void 0)?Jr:[s,void 0];case 1:let n=Me(e.left,t,i)[0],r=Me(e.right,t,i)[0];return"+-**/%".includes(e.operator)&&(n===void 0||r===void 0)?Jr:[op[e.operator](n,r),void 0];case 2:let[o,a]=Me(e.callee,t,i),h=e.args.map(M=>Me(M,t,i)[0]);return h.some(M=>M===void 0)||typeof o!="function"?Jr:[o.apply(a,h),void 0];case 3:let l=Me(e.consequent,t,i),c=Me(e.alternate,t,i);return Me(e.test,t,i)[0]?l:c;case 4:return[i[e.name]||t[e.name],void 0];case 5:return[e.value,void 0];case 6:let p=Me(e.object,t,i)[0],m=e.computed?Me(e.property,t,i)[0]:e.property.name;return p?[p[m],p]:[void 0,void 0];case 7:let v=Me(e.argument,t,i)[0];return v===void 0&&e.operator!=="!"?Jr:[ap[e.operator](v),void 0]}}function Lt(e){let t=ow(e);return t?(i={},s={})=>Me(t,i,s)[0]:(i={})=>{}}var aw=/\${([^}]+)}/g;function to(e){let t=e.split(aw),i=t.map((s,n)=>n%2?Lt(s.replace(/×/g,"*")):void 0);return s=>t.map((n,r)=>{if(!(r%2))return n;let o=i[r](s);return typeof o=="number"&&o<0?`\u2013${-o}`:o}).join("")}var jn="ontouchstart"in window,Ys="onpointerdown"in window;function Ne(e){if(e.touches){let t=e.targetTouches.length?e.targetTouches:e.changedTouches;return new y(t[0].clientX,t[0].clientY)}else return new y(e.clientX||0,e.clientY||0)}function hw(e){return e.touches||[]}function cp(e,t){return Ne(e).transform(t.inverseTransformMatrix)}function up(e,t){let i=Ne(e),s=t.bounds,n=(i.x-s.left)*t.canvasWidth/s.width,r=(i.y-s.top)*t.canvasHeight/s.height;return new y(n,r)}function lw(e){if(e instanceof PointerEvent&&e.pointerType==="mouse")return N(e.target);let t=Ne(e);return N(document.elementFromPoint(t.x,t.y)||void 0)}function cw(e){if(e._data.tapEvent)return;e._data.tapEvent=!0;let t;e.on("pointerdown",i=>t=Ne(i)),e.on("pointerup",i=>{if(!t)return;let s=Ne(i);y.distance(t,s)<6&&e.trigger("tap",i),t=void 0}),e.on("pointercancel",()=>t=void 0)}function uw(e){e._data.clickOutsideEvent||(e._data.clickOutsideEvent=!0,Y.on("pointerdown",t=>{var i,s;let n=t.target,r=(s=(i=e._el).getRootNode)==null?void 0:s.call(i),o=Ne(t);(r==null?void 0:r.host)&&(n=r.elementFromPoint(o.x,o.y)),!(!n||e._el===n||e._el.contains(n))&&e.trigger("clickOutside",t)}))}function os(e,t){let i=t.$box||e,s=Ne;i.type==="svg"?s=m=>cp(m,i.$ownerSVG):i.type==="canvas"&&(s=m=>up(m,i));let n=t.justInside?e:Y,r,o,a=!1,h=0;e.css("touch-action")==="auto"&&e.css("touch-action","none"),e.addClass("noselect");function l(m){m.handled||hw(m).length>1||(m.preventDefault(),a=!1,h=m.pointerId||0,n.on("pointermove",c),n.on("pointerstop",p),r=o=s(m),t.down&&t.down(r))}function c(m){if(!r||h&&m.pointerId!==h)return;m.preventDefault();let v=s(m);y.distance(v,o)<.5||(!a&&t.start&&t.start(r),t.move&&t.move(v,r,o),o=v,a=!0)}function p(m,v=!1){!r||h&&m.pointerId!==h||(m.preventDefault(),n.off("pointermove",c),n.off("pointerstop",p),t.up&&t.up(o,r),a&&t.end&&t.end(o,r),!a&&t.click&&!v&&t.click(r),r=void 0)}P.onKey("escape",()=>{if(!r)return;a&&t.move&&t.move(r,r,o),o=r;let m=document.createEvent("MouseEvent");m.pointerId=h,p(m,!0)}),e.on("pointerdown",l),t.justInside&&e.on("mouseleave",p),t.accessible&&(e.setAttr("tabindex","0"),document.addEventListener("keydown",m=>{if(![37,38,39,40].includes(m.keyCode)||e!==P.getActiveInput())return;let v=e.boxCenter,M=s({clientX:v.x,clientY:v.y}),f=m.keyCode===37?-25:m.keyCode===39?25:0,b=m.keyCode===38?-25:m.keyCode===40?25:0,$=M.shift(f,b);t.down&&t.down(M),t.start&&t.start(M),t.move&&t.move($,M,M),t.end&&t.end($,M)}))}function dp(e,t){let i=Ne;e.type==="svg"?i=n=>cp(n,e.$ownerSVG):e.type==="canvas"&&(i=n=>up(n,e));let s=!1;e.on("touchstart mouseenter",n=>{!s&&t.enter&&t.enter(),t.move&&t.move(i(n)),s=!0},{passive:!0}),e.on("pointermove",n=>{s&&t.move&&t.move(i(n))}),e.on("touchend mouseleave",()=>{s&&t.exit&&t.exit(),s=!1},{passive:!0})}function dw(e){if(e._data.scrollEvents)return;e._data.scrollEvents=!0;let t=!1,i;function s(){let h=e.scrollTop;if(h===i){t=!1;return}i=h,e.trigger("scroll",{top:i}),window.requestAnimationFrame(s)}function n(){t||window.requestAnimationFrame(s),t=!0}(e.type==="window"?window:e._el).addEventListener("scroll",n);function o(){window.addEventListener("touchmove",n),window.addEventListener("touchend",a)}function a(){window.removeEventListener("touchmove",n),window.removeEventListener("touchend",a)}e._el.addEventListener("touchstart",function(h){h.handled||o()})}function Qs(e,t){let i=t.$clickTarget||e,s=0,n=!1,r=!1,o=!1;function a(){n||(t.enter&&t.enter(),n=!0)}function h(){!n||(clearTimeout(s),t.exit&&t.exit(),n=!1)}e.on("mouseover",()=>{t.preventMouseover&&t.preventMouseover()||(clearTimeout(s),s=ui(()=>{a(),r=!0},t.delay))}),e.on("mouseout",()=>{!r||(clearTimeout(s),s=ui(h,t.exitDelay||t.delay))}),i.on("focus",()=>{n||t.preventMouseover&&t.preventMouseover()||(clearTimeout(s),a(),o=!0)});let l=()=>{!o||(t.canFocusWithin?setTimeout(()=>{let c=P.getActiveInput();c&&c.hasParent(e)?c.one("blur",l):h()}):h())};i.on("blur",l),i.on("click",()=>{n&&!r?h():n||(a(),r=!1)}),e.on("clickOutside",h)}var xh;function pw(e){for(let t of e){let i=t.isIntersecting?"enterViewport":"exitViewport";setTimeout(()=>N(t.target).trigger(i))}}function pp(e){if(!e._data.intersectionEvents){if(e._data.intersectionEvents=!0,!window.IntersectionObserver){let t=!1;Y.on("scroll",()=>{let i=e.isInViewport;t&&!i?(e.trigger("exitViewport"),t=!1):i&&!t&&(e.trigger("enterViewport"),t=!0)});return}xh||(xh=new IntersectionObserver(pw)),xh.observe(e._el)}}function fw(e,t=!1){if(t&&(e._data.resizeObserver&&e._data.resizeObserver.disconnect(),e._data.resizeObserver=void 0),!e._data.resizeObserver){if(window.ResizeObserver){let i=new window.ResizeObserver(()=>e.trigger("resize"));i.observe(e._el),e._data.resizeObserver=i}else if(window.MutationObserver){let i=new MutationObserver(()=>e.trigger("resize"));i.observe(e._el,{attributes:!0,childList:!0,characterData:!0,subtree:!0}),e._data.resizeObserver=i}}}function fp(e){if(e._data.pointerPositionEvents)return;e._data.pointerPositionEvents=!0;let t=e.parent,i;t.on("pointerend",()=>i=void 0),t.on("pointermove",s=>{let n=i,r=lw(s);i=r.equals(e)||r.hasParent(e),n!==void 0&&i&&!n&&e.trigger("pointerenter",s),!i&&n&&e.trigger("pointerleave",s)})}function bh(e,t){t._data[`_${e}`]||(t._data[`_${e}`]=!0,Ys?t.on(e.replace("mouse","pointer"),i=>{i.pointerType==="mouse"&&t.trigger(e,i)}):jn||t._el.addEventListener(e,i=>t.trigger(e,i)))}function mw(e){e.on("keydown",t=>{if(t.metaKey||t.ctrlKey||P.isAndroid&&t.keyCode===229)return;let i=t.key||String.fromCharCode(t.which),s=i.toLowerCase(),n=!!t.shiftKey;e.trigger("key",{code:t.keyCode,key:s,char:i,shift:n})}),P.isAndroid&&e.type==="input"&&e.on("input",t=>{let i=t.data[t.data.length-1],s=i.toLowerCase();e.trigger("key",{code:void 0,key:s,char:i}),e.value=""})}var eo={scrollwheel:"DOMMouseScroll mousewheel",pointerdown:Ys?"pointerdown":jn?"touchstart":"mousedown",pointermove:Ys?"pointermove":jn?"touchmove":"mousemove",pointerup:Ys?"pointerup":jn?"touchend":"mouseup",pointercancel:Ys?"pointercancel":"touchcancel",pointerstop:Ys?"pointerup pointercancel":jn?"touchend touchcancel":"mouseup"},io={scroll:dw,tap:cw,clickOutside:uw,key:mw,mousedown:bh.bind(void 0,"mousedown"),mousemove:bh.bind(void 0,"mousemove"),mouseup:bh.bind(void 0,"mouseup"),pointerenter:fp,pointerleave:fp,enterViewport:pp,exitViewport:pp,resize:fw};function gw(e,t,i,s){if(t in io)io[t](e,!1);else if(t in eo){let n=et(eo[t]);for(let r of n)e._el.addEventListener(r,i,s)}else e._el.addEventListener(t,i,s)}function vw(e,t,i){if(t in io)(!e._events[t]||!e._events[t].length)&&io[t](e,!0);else if(i&&t in eo){let s=et(eo[t]);for(let n of s)e._el.removeEventListener(n,i)}else i&&e._el.removeEventListener(t,i)}var so=0,$h=new Map;function mp(e,t){$h.set(e,t)}function ww(e){if(so++,e(),so--,so===0){for(let[t,i]of $h.entries())t(i);$h.clear()}}function as(e,t){let i=new Map,s=new Map,n=new Set,r,o=0;function a(w){r=w;let x=w($,!0);return r=void 0,x}function h(w){for(let x of i.values())x.has(w)&&x.delete(w);n.delete(w)}function l(w,x){return n.add(w),x?void 0:w($,!0)}function c(w,x){s.has(w)&&h(s.get(w));let z=()=>{e[w]=x($),r===z&&(r=void 0),p(w)};s.set(w,z),a(z)}function p(w){if(so>0){for(let x of i.get(w)||[])mp(x,e);for(let x of n)mp(x,e)}else{for(let x of i.get(w)||[])x(e);for(let x of n)x(e)}}function m(){for(let w of i.values())for(let x of w)x(e);for(let w of n)w(e)}function v(w){ww(()=>{for(let[x,z]of Object.entries(w))$[x]=z})}function M(){for(o+=1;`_x${o}`in e;)o+=1;return`_x${o}`}function f(){e={},i.clear(),s.clear(),o=0}function b(w){!t||t.watch(()=>$[w]=t[w])}let $=new Proxy(e,{get(w,x){return x==="watch"?a:x==="unwatch"?h:x==="watchAll"?l:x==="setComputed"?c:x==="forceUpdate"?m:x==="assign"?v:x==="getKey"?M:x==="clear"?f:x==="_internal"?[e,i]:(r&&(i.has(x)||i.set(x,new Set),i.get(x).add(r)),x in e||b(x),e[x])},set(w,x,z){return e[x]===z||(e[x]=z,s.has(x)&&(h(s.get(x)),s.delete(x)),p(x)),!0},deleteProperty(w,x){return delete e[x],i.delete(x),s.delete(x),!0}});return $}var yw={A:7,C:6,H:1,L:2,M:2,Q:4,S:4,T:2,V:1,Z:0},xw=/[astvzqmhlc]([^astvzqmhlc]*)/ig,bw=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig;function $w(e){let t=[],i;for(let s of e.match(xw)||[]){let n=s[0].toUpperCase();if(n==="Z"){t.push({type:"Z",points:[]});continue}let r=(s.slice(1).match(bw)||[]).map(a=>+a),o=n===s[0];for(let[a,h]of Ja(r,yw[n]).entries()){let l=[],c=n==="M"&&a>0?"L":n,p;n==="H"?(c="L",l=[new y(h[0],o&&(i==null?void 0:i.y)||0)]):n==="V"?(c="L",l=[new y(o&&(i==null?void 0:i.x)||0,h[0])]):n==="A"?(c="A",l=[new y(h[5],h[6])],p=h.slice(0,5)):"MLCSQT".includes(n)&&(l=Ja(h,2).map(m=>new y(m[0],m[1]))),!o&&i&&(l=l.map(m=>m.translate(i))),i=ct(l),t.push({type:c,points:l,options:p})}}return t}function Mw(e){return e?$w(e).map(i=>ct(i.points)).filter(i=>!!i):[]}var gp=class{constructor(e){this._el=e,this._data={},this._events={},this.type="default",e._view=this}get id(){return this._el.id}get data(){return this._el.dataset}get tagName(){return this._el.tagName.toUpperCase()}equals(e){return this._el===e._el}addClass(e){for(let t of et(e))this._el.classList.add(t)}removeClass(e){for(let t of et(e))this._el.classList.remove(t)}hasClass(e){return this._el.classList.contains(e)}toggleClass(e){return this._el.classList.toggle(e)}setClass(e,t){t?this.addClass(e):this.removeClass(e)}attr(e){return this._el.getAttribute(e)||""}hasAttr(e){return this._el.hasAttribute(e)}setAttr(e,t){t===void 0?this.removeAttr(e):this._el.setAttribute(e,t.toString())}removeAttr(e){this._el.removeAttribute(e)}get attributes(){return Array.from(this._el.attributes||[])}get html(){return this._el.innerHTML||""}set html(e){this._el.innerHTML=e}get text(){return this._el.textContent||""}set text(e){this._el.textContent=e}set textStr(e){this._el.textContent=`${e}`}blur(){this._el.blur()}focus(){this._el.focus()}getParentModel(){let e=this.parent;return e?e.model||e.getParentModel():void 0}bindModel(e,t=!0){var i;if(!this.model){if(this.model=e,this.hasAttr(":for"))return this.makeDynamicList(e);for(let{name:s,value:n}of this.attributes)this.makeDynamicAttribute(s,n,e);for(let s of this.childNodes)if(s instanceof Text){if((i=s.textContent)==null?void 0:i.includes("${")){let n=to(s.textContent);e.watch(()=>s.textContent=n(e)||"")}}else t&&s.bindModel(e)}}bindVariable(e,t){}makeDynamicAttribute(e,t,i){if(e.startsWith("@")){let s=e.slice(1),n=Lt(t);this.on(s,r=>n(i,{$event:r}))}else if(e===":show"){let s=Lt(t);i.watch(()=>this.toggle(!!s(i)))}else if(e===":if"){let s=Lt(t),n=N(document.createComment(""));this.insertBefore(n);let r=!0;i.watch(()=>{let o=!!s(i);o!==r&&(o&&n.insertBefore(this),o||this.detach(),r=o)})}else if(e===":html"){let s=Lt(t);i.watch(()=>this.html=s(i)||"")}else if(e===":draw"){let s=Lt(t);i.watch(()=>this.draw(s(i)))}else if(e===":class"){let s=Lt(t),n=`${this.attr("class")} `;i.watch(()=>this.setAttr("class",n+s(i)))}else if(e===":bind")this.bindVariable(i,t);else if(e.startsWith(":")){let s=Lt(t),n=e.slice(1);i.watch(()=>this.setAttr(n,s(i)))}else if(t.includes("${")){let s=to(t);i.watch(()=>this.setAttr(e,s(i)||""))}(e.startsWith("@")||e.startsWith(":"))&&this.removeAttr(e)}makeDynamicList(e){let[t,i]=this.attr(":for").split(" in ");this.removeAttr(":for");let s=Lt(i),n=N(document.createComment(""));this.insertBefore(n),this.detach();let r=[],o=0;e.watch(()=>{let a=s(e);Array.isArray(a)||(a=[]);for(let h=a.length;h<o;++h)r[h].detach();for(let h=o;h<r.length;++h)n.insertBefore(r[h]);for(let h=r.length;h<a.length;++h){let l=this.copy(!0);l.bindModel(as({[t]:void 0},e)),n.insertBefore(l),r.push(l)}o=a.length;for(let h=0;h<o;++h)r[h].model[t]=a[h]})}get bounds(){return this._el.getBoundingClientRect()}get boundsRect(){let e=this.bounds;return new ce(new y(e.x,e.y),e.width,e.height)}contains(e){return this.boundsRect.contains(e)}get isInViewport(){if(this.height===0)return!1;let e=this.bounds;return Ut(e.top,-e.height,P.height)}get topLeftPosition(){let e=this.bounds;return new y(e.left,e.top)}get boxCenter(){let e=this.bounds;return new y(e.left+e.width/2,e.top+e.height/2)}get scrollWidth(){return this._el.scrollWidth}get scrollHeight(){return this._el.scrollHeight}get scrollTop(){return this._el.scrollTop}set scrollTop(e){this._el.scrollTop=e,this.trigger("scroll",{top:e,left:this.scrollLeft})}get scrollLeft(){return this._el.scrollLeft}set scrollLeft(e){this._el.scrollLeft=e,this.trigger("scroll",{top:this.scrollTop,left:e})}scrollTo(e,t=1e3,i="cubic"){e<0&&(e=0);let s=this.scrollTop,n=e-s;this._data.scrollAnimation&&this._data.scrollAnimation.cancel(),this._data.scrollAnimation=re(r=>{let o=s+n*mi(i,r);this.scrollTop=o,this.trigger("scroll",{top:o})},t)}scrollBy(e,t=1e3,i="cubic"){!e||this.scrollTo(this.scrollTop+e,t,i)}css(e,t){if(t===void 0){if(typeof e=="string")return window.getComputedStyle(this._el).getPropertyValue(e);{let i=Object.keys(e);for(let s of i)this._el.style.setProperty(s,`${e[s]}`)}}else typeof e=="string"&&this._el.style.setProperty(e,`${t}`)}get transform(){return this.css("transform").replace("none","")}get transformMatrix(){let e=this.transform;if(!e)return[[1,0,0],[0,1,0]];let t=e.match(/matrix\(([0-9,.\s-]*)\)/);if(!t||!t[1])return[[1,0,0],[0,1,0]];let i=t[1].split(",");return[[+i[0],+i[2],+i[4]],[+i[1],+i[3],+i[5]]]}get scale(){let e=this.transformMatrix;return[e[0][0],e[1][1]]}setTransform(e,t=0,i=1){let s="";e&&(s+=`translate(${Xe(e.x,.1)}px,${Xe(e.y,.1)}px)`),t&&(s+=` rotate(${t}rad)`),i&&(s+=` scale(${i})`),this._el.style.transform=s}translate(e,t){this.setTransform(new y(e,t))}show(){this.hasAttr("hidden")&&this.removeAttr("hidden"),this.data.display==="visibility"?this._el.style.visibility="visible":this._el.style.display=this.data.display||"block"}hide(){this.data.display==="visibility"?this._el.style.visibility="hidden":this._el.style.display="none"}toggle(e){e?this.show():this.hide()}is(e){return this._el.matches?this._el.matches(e):Array.from(document.querySelectorAll(e)).includes(this._el)}index(){let e=0,t=this._el;for(;(t=t.previousSibling||void 0)!==void 0;)++e;return e}prepend(e){let t=this._el.childNodes;t.length?this._el.insertBefore(e._el,t[0]):this._el.appendChild(e._el)}append(e){this._el.appendChild(e instanceof Text?e:e._el)}insertBefore(e){this.parent._el.insertBefore(e._el,this._el)}insertAfter(e){let t=this._el.nextSibling;t?this.parent._el.insertBefore(e._el,t):this.parent._el.appendChild(e._el)}get next(){return N(this._el.nextSibling)}get prev(){return N(this._el.previousSibling)}$(e){return N(e,this)}$$(e){return Je(e,this)}get parent(){return N(this._el.parentElement||void 0)}parents(e){let t=[],i=this.parent;for(;i;)(!e||i.is(e))&&t.push(i),i=i.parent;return t}hasParent(...e){let t=e.map(s=>s._el),i=this._el.parentNode;for(;i;){if(tt(i,...t))return!0;i=i.parentNode}return!1}get children(){return Array.from(this._el.children||[],e=>N(e))}get childNodes(){return Array.from(this._el.childNodes,e=>{if(!(e instanceof Comment))return e instanceof Text?e:N(e)}).filter(e=>e)}restartAnimation(){let e=this.next,t=this.parent;this.detach(),e?e.insertBefore(this):t.append(this)}detach(){this._el&&this._el.parentNode&&this._el.parentNode.removeChild(this._el)}remove(){this.detach()}removeChildren(){for(;this._el.firstChild;)this._el.removeChild(this._el.firstChild)}on(e,t,i){for(let s of et(e))s in this._events?this._events[s].includes(t)||this._events[s].push(t):this._events[s]=[t],gw(this,s,t,i)}one(e,t,i){let s=n=>{this.off(e,s),t(n)};this.on(e,s,i)}off(e,t){for(let i of et(e))i in this._events&&(this._events[i]=t?this._events[i].filter(s=>s!==t):[]),vw(this,i,t)}trigger(e,t={}){for(let i of et(e)){if(!this._events[i])return;for(let s of this._events[i])s.call(this,t)}}onKeyDown(e,t){let i=et(e).map(s=>Js[s]||s);this._el.addEventListener("keydown",s=>{i.indexOf(s.keyCode)>=0&&t(s)})}onAttr(e,t){new MutationObserver(s=>{for(let n of s)n.type==="attributes"&&n.attributeName===e&&t(this.attr(e))}).observe(this._el,{attributes:!0}),t(this.attr(e),!0)}onPromise(e,t=!1){return t?Promise.resolve():new Promise(i=>this.one("solve",()=>i()))}animate(e,t=400,i=0,s="ease-in-out"){return te(this,e,t,i,s)}enter(e="fade",t=500,i=0){return Sw(this,e,t,i)}exit(e="fade",t=500,i=0,s=!1){return Pw(this,e,t,i,s)}effect(e){this.one("animationend",()=>this.removeClass(`effects-${e}`)),this.addClass(`effects-${e}`)}copy(e=!0,t=!0,i){let s=N(this._el.cloneNode(e));return t&&s.copyInlineStyles(this,e,i),s}copyInlineStyles(e,t=!0,i){let s=window.getComputedStyle(e._el);for(let n of i||Array.from(s))this.css(n,s.getPropertyValue(n));if(t){let n=this.children,r=e.children;for(let o=0;o<n.length;++o){let a=n[o].tagName==="foreignObject"?void 0:i;n[o].copyInlineStyles(r[o],!0,a)}}}},hs=class extends gp{get offsetTop(){return this._el.offsetTop}get offsetLeft(){return this._el.offsetLeft}get offsetParent(){return N(this._el.offsetParent||void 0)}get width(){return this._el.offsetWidth}get height(){return this._el.offsetHeight}get innerWidth(){let e=parseFloat(this.css("padding-left")),t=parseFloat(this.css("padding-right"));return this._el.clientWidth-e-t}get innerHeight(){let e=parseFloat(this.css("padding-bottom")),t=parseFloat(this.css("padding-top"));return this._el.clientHeight-e-t}get outerWidth(){let e=parseFloat(this.css("margin-left")),t=parseFloat(this.css("margin-right"));return this.width+e+t||0}get outerHeight(){let e=parseFloat(this.css("margin-bottom")),t=parseFloat(this.css("margin-top"));return this.height+e+t||0}get positionTop(){let e=this._el,t=0;for(;e;)t+=e.offsetTop,e=e.offsetParent;return t}get positionLeft(){let e=this._el,t=0;for(;e;)t+=e.offsetLeft,e=e.offsetParent;return t}offset(e){if(e._el===this._el.offsetParent){let t=this.offsetTop+e._el.clientTop,i=this.offsetLeft+e._el.clientLeft,s=t+this.height,n=i+this.width;return{top:t,left:i,bottom:s,right:n}}else{let t=e._el.getBoundingClientRect(),i=this._el.getBoundingClientRect();return{top:i.top-t.top,left:i.left-t.left,bottom:i.bottom-t.top,right:i.right-t.left}}}},vp=["font-family","font-size","font-style","font-weight","letter-spacing","text-decoration","color","display","visibility","alignment-baseline","baseline-shift","text-anchor","clip","clip-path","clip-rule","mask","opacity","filter","fill","fill-rule","marker","marker-start","marker-mid","marker-end","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-width","text-rendering","transform","dominant-baseline","transform-origin","transform-box","paint-order"],wp=class extends gp{constructor(){super(...arguments);this.type="svg"}get $ownerSVG(){return N(this._el.ownerSVGElement||void 0)}get width(){return this.bounds.width}get height(){return this.bounds.height}get positionLeft(){let e=this._el.getBBox().x+this._el.getCTM().e;return this.$ownerSVG.positionLeft+e}get positionTop(){let e=this._el.getBBox().y+this._el.getCTM().f;return this.$ownerSVG.positionTop+e}get inverseTransformMatrix(){let e=this._el.getScreenCTM().inverse(),t=[[e.a,e.c,e.e],[e.b,e.d,e.f]];if(P.isFirefox){let i=this.transformMatrix;t[0][2]-=i[0][2],t[1][2]-=i[1][2]}return t}setTransform(e,t=0,i=1){let s=e?`translate(${Xe(e.x,.1)} ${Xe(e.y,.1)})`:"",n=B(t,0)?"":`rotate(${t*180/Math.PI})`,r=B(i,1)?"":`scale(${i})`;this.setAttr("transform",[s,n,r].join(" "))}get strokeLength(){if(this._el instanceof SVGGeometryElement)return this._el.getTotalLength();{let e=this.bounds;return 2*e.height+2*e.width}}getPointAtLength(e){if(this._el instanceof SVGGeometryElement){let t=this._el.getPointAtLength(e);return new y(t.x,t.y)}else return new y(0,0)}getPointAt(e){return this.getPointAtLength(e*this.strokeLength)}get points(){return Mw(this.attr("d"))}set points(e){let t=e.length?`M${e.map(i=>`${i.x},${i.y}`).join("L")}`:"";this.setAttr("d",t)}addPoint(e){let t=`${this.attr("d")} L ${e.x},${e.y}`;this.setAttr("d",t)}get center(){let e=+this.attr(this.tagName==="TEXT"?"x":"cx"),t=+this.attr(this.tagName==="TEXT"?"y":"cy");return new y(e,t)}setCenter(e){this.setAttr(this.tagName==="TEXT"?"x":"cx",e.x),this.setAttr(this.tagName==="TEXT"?"y":"cy",e.y)}setLine(e,t){this.setAttr("x1",e.x),this.setAttr("y1",e.y),this.setAttr("x2",t.x),this.setAttr("y2",t.y)}setRect(e){this.setAttr("x",e.p.x),this.setAttr("y",e.p.y),this.setAttr("width",e.w),this.setAttr("height",e.h)}draw(e,t={}){if(!e)return this.setAttr("d","");let i={mark:this.attr("mark"),arrows:this.attr("arrows"),size:+this.attr("size")||void 0,fill:this.hasClass("fill"),round:this.hasAttr("round")};this.setAttr("d",vh(e,Object.assign(t,i)))}},Cw=class extends wp{get viewBox(){return this._el.viewBox.baseVal||{width:0,height:0}}get $ownerSVG(){return this}get positionLeft(){return parseInt(this.css("margin-left"))+this.parent.positionLeft}get positionTop(){return parseInt(this.css("margin-top"))+this.parent.positionTop}get svgWidth(){return this.viewBox.width||this.width}get svgHeight(){return this.viewBox.height||this.height}drawPath(e,t={},i={}){let s=S("path",t,this);return s.draw(e,i),s}pngImage(e,t,i){return $e(this,null,function*(){let s=this.copy(!0,!0,vp);t||(t=e||this.svgHeight),e||(e=this.svgWidth),s.setAttr("width",e),s.setAttr("height",t),s.setAttr("viewBox",i||this.attr("viewBox")||`0 0 ${this.svgWidth} ${this.svgHeight}`),s.setAttr("xmlns","http://www.w3.org/2000/svg");let n=s.$$('image[href^="http"]');yield Promise.all(n.map(l=>$e(this,null,function*(){let c=yield tp(l.attr("href")),p=S("canvas",{width:c.width,height:c.height});p.ctx.drawImage(c,0,0,c.width,c.height);let m=yield p.pngImage;l.setAttr("href",m)})));let r=new XMLSerializer().serializeToString(s._el),o=`data:image/svg+xml;utf8,${encodeURIComponent(r)}`,a=S("canvas",{width:e,height:t});a.ctx.fillStyle=de.css("background-color")||"white",a.ctx.fillRect(0,0,e,t);let h=yield tp(o);return a.ctx.drawImage(h,0,0,e,t),a.pngImage})}svgImage(e,t,i){return $e(this,null,function*(){let s=this.copy(!0,!0,vp);t||(t=e||this.svgHeight),e||(e=this.svgWidth),s.setAttr("width",e),s.setAttr("height",t),s.setAttr("viewBox",i||this.attr("viewBox")||`0 0 ${this.svgWidth} ${this.svgHeight}`),s.setAttr("xmlns","http://www.w3.org/2000/svg");let n=new XMLSerializer().serializeToString(s._el);return`data:image/svg+xml;utf8,${encodeURIComponent(n)}`})}downloadImage(e,t="png",i,s,n){let r=P.isIOS?window.open("","_blank"):void 0;this[t==="svg"?"svgImage":"pngImage"](i,s,n).then(a=>{if(r)return r.location.href=a;S("a",{download:e,href:a,target:"_blank"})._el.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!1,cancelable:!0}))})}},yp=class extends hs{constructor(){super(...arguments);this.type="window"}get width(){return window.innerWidth}get height(){return window.innerHeight}get innerWidth(){return window.innerWidth}get innerHeight(){return window.innerHeight}get outerWidth(){return window.outerWidth}get outerHeight(){return window.outerHeight}get scrollWidth(){return document.body.scrollWidth}get scrollHeight(){return document.body.scrollHeight}get scrollTop(){return window.pageYOffset}set scrollTop(e){document.body.scrollTop=document.documentElement.scrollTop=e,this.trigger("scroll",{top:e,left:this.scrollLeft})}get scrollLeft(){return window.pageXOffset}set scrollLeft(e){document.body.scrollLeft=document.documentElement.scrollLeft=e,this.trigger("scroll",{top:this.scrollTop,left:e})}},Tw=class extends hs{constructor(){super(...arguments);this.type="form"}get action(){return this._el.action}get formData(){let e={};for(let t of Array.from(this._el.elements)){let i=t.name||t.id;i&&(e[i]=t.value)}return e}get isValid(){return this._el.checkValidity()}},Ew=class extends hs{constructor(){super(...arguments);this.type="input"}get checked(){return this._el.checked||!1}set checked(e){this._el.checked=e}get value(){return this._el.value}set value(e){this._el.value=e}bindVariable(e,t){let i=this._el.type==="number",s=this._el.type==="checkbox";if(t in e?s?this.checked=e[t]:this.value=e[t]:this.value&&(s?e[t]=this.checked:e[t]=this.value),i){let n=this.hasAttr("min")?+this.attr("min"):-Infinity,r=this.hasAttr("max")?+this.attr("max"):Infinity;this.change(o=>e[t]=xt(+o,n,r)),this.on("blur",()=>this.value=e[t])}else s?this.on("change",()=>e[t]=this.checked):this.change(n=>e[t]=n);e.watch(()=>{s?this.checked=e[t]:this.value=e[t],this.trigger("model-change",{defaultPrevented:!0})})}setInputPattern(e){if(isNaN(+e))return;let t=e.match(/^[0-9]+$/);this.setAttr("inputmode",t?"numeric":"decimal"),t&&this.setAttr("pattern","[0-9]*")}change(e){let t=this.value||"";this.on("change keyup input paste model-change",i=>{this.value!==t&&(t=this.value.trim(),i.defaultPrevented||e(t))})}validate(e){this.change(t=>this.setValidity(e(t)))}setValidity(e){this._el.setCustomValidity(e)}get isValid(){return this._el.checkValidity()}},Aw=class extends hs{constructor(){super(...arguments);this.type="canvas"}getContext(e="2d",t={}){return this._el.getContext(e,t)}get pngImage(){return this._el.toDataURL("image/png")}get canvasWidth(){return this._el.width}get canvasHeight(){return this._el.height}get ctx(){return this._ctx||(this._ctx=this.getContext()),this._ctx}draw(e,t={}){this.ctx.save(),Yd(this.ctx,e,t),this.ctx.restore()}clear(){this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight)}fill(e){this.ctx.save(),this.ctx.fillStyle=e,this.ctx.fillRect(0,0,this.canvasWidth,this.canvasHeight),this.ctx.restore()}clearCircle(e,t){this.ctx.save(),this.ctx.globalCompositeOperation="destination-out",this.ctx.beginPath(),this.ctx.arc(e.x,e.y,t,0,2*Math.PI,!1),this.ctx.fill(),this.ctx.restore()}downloadImage(e){let t=this.pngImage;S("a",{download:e,href:t,target:"_blank"})._el.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!1,cancelable:!0}))}},Vw=class extends hs{play(){return this._el.play()||Promise.resolve()}pause(){return this._el.pause()}},xp=["path","rect","circle","ellipse","polygon","polyline","g","defs","marker","line","text","tspan","pattern","mask","svg","foreignObject","image","use"];function N(e,t){if(!e)return;let i=t?t._el:document.documentElement,s=typeof e=="string"?i.querySelector(e):e;if(!s)return;if(s._view)return s._view;let n=(s.tagName||"").toLowerCase();return n==="svg"?new Cw(s):n==="canvas"?new Aw(s):n==="form"?new Tw(s):n==="input"||n==="select"||n==="textarea"?new Ew(s):n==="video"||n==="audio"?new Vw(s):xp.includes(n)?new wp(s):new hs(s)}function Je(e,t){let i=t?t._el:document.documentElement,s=e?i.querySelectorAll(e):[];return Array.from(s,n=>N(n))}function S(e,t={},i){let s=xp.includes(e)?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);for(let[r,o]of Object.entries(t))o!==void 0&&(r==="id"?s.id=o:r==="html"?s.innerHTML=o:r==="text"?s.textContent=o:r==="path"?s.setAttribute("d",vh(o)):s.setAttribute(r,o));let n=N(s);return i&&i.append(n),n}var Y=new yp(document.body),de=new yp(document.documentElement),Js={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46},no="_M",tn=window.navigator.userAgent.toLowerCase(),bp={};for(let[e,t]of Object.entries(Js))bp[t]=e;var kw=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i,$p=/iphone|ipad|ipod/i,Lw=/^((?!chrome|android).)*safari/i,Mp,Ow=class{constructor(){this.isMobile=kw.test(tn),this.isRetina=(window.devicePixelRatio||1)>1,this.isTouch=!!window.Touch||"ontouchstart"in window,this.isChrome=!!window.chrome,this.isFirefox=tn.indexOf("firefox")>=0,this.isAndroid=tn.indexOf("android")>=0,this.isIOS=$p.test(tn),this.isSafari=$p.test(tn)||Lw.test(tn),this.loadQueue=[],this.loaded=!1,this.width=window.innerWidth,this.height=window.innerHeight,this.resizeCallbacks=[],this.theme={name:"light",isDark:!1},this.themeChangedCallbacks=[],this.themeOverride="",this.darkQuery=(Mp=window.matchMedia)==null?void 0:Mp.call(window,"(prefers-color-scheme: dark)");var e,t;window.onload=()=>this.afterLoad(),document.addEventListener("DOMContentLoaded",()=>this.afterLoad());let i=Oi(()=>this.applyResize());window.addEventListener("resize",i);try{(e=this.darkQuery)==null||e.addEventListener("change",()=>this.applyThemeChange())}catch(n){(t=this.darkQuery)==null||t.addListener(()=>this.applyThemeChange())}let s=this.getCookie("theme");s&&this.setTheme(s);try{this.localStorage=window.localStorage}catch(n){console.warn("Unable to access Local Storage in this context.")}}afterLoad(){if(!this.loaded){this.loaded=!0;for(let e of this.loadQueue)e();setTimeout(()=>this.resize())}}ready(e){this.loaded?e():this.loadQueue.push(e)}redraw(){document.body.offsetHeight}applyResize(){let e=window.innerWidth,t=window.innerHeight;if(!(this.width===e&&this.height===t)){this.width=e,this.height=t;for(let i of this.resizeCallbacks)i({width:this.width,height:this.height});Y.trigger("scroll",{top:Y.scrollTop})}}onResize(e){e({width:this.width,height:this.height}),this.resizeCallbacks.push(e)}offResize(e){let t=this.resizeCallbacks.indexOf(e);t>=0&&this.resizeCallbacks.splice(t,1)}resize(){this.applyResize()}applyThemeChange(){let e=this.theme.name,t=e==="dark"||e==="auto"&&this.darkQuery.matches;if(t!==this.theme.isDark){this.theme.isDark=t,de.setAttr("theme",this.themeOverride||(t?"dark":"light"));for(let i of this.themeChangedCallbacks)i(this.theme)}}setTheme(e){e!==this.theme.name&&(this.theme.name=e,this.setCookie("theme",e),this.applyThemeChange())}onThemeChange(e){this.themeChangedCallbacks.push(e)}getHash(){return window.location.hash.slice(1)}setHash(e){let t=document.body.scrollTop;window.location.hash=e,document.body.scrollTop=t}setURL(e,t=""){window.history.replaceState({},t,e),t&&(window.document.title=t)}getCookies(){let e=document.cookie.split(";"),t={};for(let i=0,s=e.length;i<s;++i){let n=e[i].split("=");t[decodeURIComponent(n[0]).trim()]=decodeURIComponent(n[1])}return t}getCookie(e){let t=document.cookie.match(new RegExp(`(^|;) ?${e}=([^;]*)(;|$)`));return t?t[2]:void 0}setCookie(e,t,i=60*60*24*365){let s=window.location.hostname.replace(/^[a-z]{2}\./,"");document.cookie=`${e}=${t};path=/;max-age=${i};domain=${s}`}deleteCookie(e){this.setCookie(e,"",-1)}setStorage(e,t){var i,s;let n=(e||"").split("."),r=Xa(((i=this.localStorage)==null?void 0:i.getItem(no))||void 0,{}),o=r;for(let a=0;a<n.length-1;++a)o[n[a]]===void 0&&(o[n[a]]={}),o=o[n[a]];o[n[n.length-1]]=t,(s=this.localStorage)==null||s.setItem(no,JSON.stringify(r))}getStorage(e){var t;let i=Xa((t=this.localStorage)==null?void 0:t.getItem(no),{});if(!e)return i;let s=(e||"").split("."),n=s.pop();for(let r of s){if(!(r in i))return;i=i[r]}return i[n]}deleteStorage(e){var t;e?this.setStorage(e,void 0):(t=this.localStorage)==null||t.setItem(no,"")}getActiveInput(){let e=document.activeElement;return(e==null?void 0:e.shadowRoot)&&(e=e.shadowRoot.activeElement),e===document.body?void 0:N(e)}onKey(e,t,i=!1){let s=et(e),n=i?"keyup":"keydown";document.addEventListener(n,r=>{let o=bp[r.keyCode]||r.key;if(!s.includes(o))return;let a=this.getActiveInput();a&&a.is("input, textarea, [contenteditable]")||a&&["space","enter","tab"].includes(o)&&a.is("button, a, [tabindex]")||t(r,o)})}},P=window.BoostBrowser||new Ow;window.BoostBrowser=P;var Iw=/\bTrident\/[567]\b|\bMSIE (?:9|10)\.0\b/,Rw=/\bAppleWebKit\/(\d+)\b/,_w=/\bEdge\/12\.(\d+)\b/,Nw=Iw.test(navigator.userAgent)||+(navigator.userAgent.match(_w)||[])[1]<10547||+(navigator.userAgent.match(Rw)||[])[1]<537,Mh={};function Dw(){if(!Nw)return;Array.from(document.querySelectorAll("svg > use")).forEach(function(t){let i=t.getAttribute("xlink:href"),[s,n]=i.split("#");if(!s.length||!n)return;let r=t.parentNode;r.removeChild(t),s in Mh||(Mh[s]=fetch(s).then(a=>a.text())),Mh[s].then(a=>{let h=document.implementation.createHTMLDocument("");h.documentElement.innerHTML=a;let c=h.getElementById(n).cloneNode(!0),p=document.createDocumentFragment();for(;c.childNodes.length;)p.appendChild(c.firstChild);r.appendChild(p)})})}function Sp(){document.addEventListener("keydown",e=>{if(e.keyCode===Js.enter||e.keyCode===Js.space){let t=P.getActiveInput();t&&t.hasAttr("tabindex")&&t.tagName!=="TEXTAREA"&&(e.preventDefault(),t.trigger("pointerdown",e),t.trigger("pointerstop",e),Y.trigger("pointerstop",e),t.trigger("click",e))}})}var ro=!1;setTimeout(()=>ro=!0);var Gw="cubic-bezier(0.175, 0.885, 0.32, 1.275)",qw="cubic-bezier(0.68, -0.275, 0.825, 0.115)",ls={cancel:()=>{},promise:Promise.resolve()};function re(e,t){if(t===0)return e(1,0,()=>{}),ls;let i=Date.now(),s=Li(),n=0,r=!0,o=()=>{r=!1,s.reject()};function a(){r&&(!t||n<=t)&&window.requestAnimationFrame(a);let h=Date.now()-i;e(t?Math.min(1,h/t):h,h-n,o),t&&h>=t&&s.resolve(),n=h}return a(),{cancel:o,promise:s.promise}}function oo(e,t=0,i=0){switch(e){case"quad":return t**2;case"cubic":return t**3;case"quart":return t**4;case"quint":return t**5;case"circ":return 1-Math.sqrt(1-t**2);case"sine":return 1-Math.cos(t*Math.PI/2);case"exp":return t<=0?0:Math.pow(2,10*(t-1));case"back":return i||(i=1.70158),t*t*((i+1)*t-i);case"elastic":return i||(i=.3),-Math.pow(2,10*(t-1))*Math.sin(((t-1)*2/i-.5)*Math.PI);case"swing":return .5-Math.cos(t*Math.PI)/2;case"spring":return 1-Math.cos(t*4.5*Math.PI)*Math.exp(-t*6);case"bounce":return t<1/11?1/64-7.5625*(.5/11-t)*(.5/11-t):t<3/11?1/16-7.5625*(2/11-t)*(2/11-t):t<7/11?1/4-7.5625*(5/11-t)*(5/11-t):1-7.5625*(1-t)*(1-t);default:return t}}function mi(e,t=0,i=0){if(t===0)return 0;if(t===1)return 1;let[s,n]=e.split("-");return n==="in"?oo(s,t,i):n==="out"?1-oo(s,1-t,i):t<=.5?oo(s,2*t,i)/2:1-oo(s,2*(1-t),i)/2}function te(e,t,i=400,s=0,n="ease-in-out"){if(!ro)return Object.keys(t).forEach(f=>{let b=t[f];e.css(f,Array.isArray(b)?b[1]:b)}),ls;n==="bounce-in"&&(n=Gw),n==="bounce-out"&&(n=qw);let r="";P.isSafari&&(r=e._el.style.transition,e.css("transition","none"),P.redraw());let o=e._data.animation;o&&o.cancel();let a={},h={},l=Li(),c=window.getComputedStyle(e._el);Object.keys(t).forEach(f=>{let b=t[f],$=Fr(f);h[$]=Array.isArray(b)?b[0]:c.getPropertyValue(f),a[$]=Array.isArray(b)?b[1]:b,s&&e.css(f,h[$])});let p=a.height;a.height==="auto"&&(a.height=`${kt(e.children.map(f=>f.outerHeight))}px`);let m,v=!1;ui(()=>{v||(m=e._el.animate([h,a],{duration:i,easing:n,fill:"forwards"}),m.onfinish=()=>{e._el&&Object.keys(t).forEach(f=>e.css(f,f==="height"?p:a[f])),P.isSafari&&e.css("transition",r),l.resolve(),m.cancel()})},s);let M={cancel(){v=!0,e._el&&Object.keys(t).forEach(f=>e.css(f,e.css(f))),m&&m.cancel()},promise:l.promise};return setTimeout(()=>e._data.animation=M),M}var Bw=/matrix\([0-9.\-\s]+,[0-9.\-\s]+,[0-9.\-\s]+,[0-9.\-\s]+,([0-9.\-\s]+),([0-9.\-\s]+)\)/;function Sw(e,t="fade",i=500,s=0){if(e.show(),!ro)return ls;let n=+e.css("opacity")||1;if(t==="fade")return te(e,{opacity:[0,n]},i,s);if(t==="pop"){let r=e.transform.replace(/scale\([0-9.]*\)/,"").replace(Bw,"translate($1px,$2px)");return te(e,{opacity:[0,n]},i,s),te(e,{transform:[`${r} scale(0.5)`,`${r} scale(1)`]},i,s,"bounce-in")}else{if(t==="descend")return te(e,{opacity:[0,1],transform:["translateY(-50%)","none"]},i,s);if(t.startsWith("draw")){let r=e.strokeLength;e.css("stroke-dasharray",`${r}px`),e.css("opacity")||e.css("opacity",1);let o=t==="draw-reverse"?`${2*r}px`:0,a={"stroke-dashoffset":[`${r}px`,o]},h=te(e,a,i,s,"linear");return h.promise.then(()=>e.css("stroke-dasharray","")),h}else if(t.startsWith("slide")){let r={opacity:[0,n],transform:["translateY(50px)","none"]};return t.includes("down")&&(r.transform[0]="translateY(-50px)"),t.includes("right")&&(r.transform[0]="translateX(-50px)"),t.includes("left")&&(r.transform[0]="translateX(50px)"),te(e,r,i,s)}else if(t.startsWith("reveal")){let r={opacity:[0,n],height:[0,"auto"]};return t.includes("left")&&(r.transform=["translateX(-50%)","none"]),t.includes("right")&&(r.transform=["translateX(50%)","none"]),te(e,r,i,s)}}return ls}function Pw(e,t="fade",i=400,s=0,n=!1){if(!e._el)return ls;if(!ro)return e.hide(),ls;if(e.css("display")==="none")return ls;let r;if(t==="fade")r=te(e,{opacity:[1,0]},i,s);else if(t==="pop"){let o=e.transform.replace(/scale\([0-9.]*\)/,"");te(e,{opacity:[1,0]},i,s),r=te(e,{transform:[`${o} scale(1)`,`${o} scale(0.5)`]},i,s,"bounce-out")}else if(t==="ascend")r=te(e,{opacity:[1,0],transform:["none","translateY(-50%)"]},i,s);else if(t.startsWith("draw")){let o=e.strokeLength;e.css("stroke-dasharray",o);let h={"stroke-dashoffset":[t==="draw-reverse"?`${2*o}px`:0,`${o}px`]};r=te(e,h,i,s,"linear")}else if(t.startsWith("slide")){let o={opacity:0,transform:"translateY(50px)"};t.includes("up")&&(o.transform="translateY(-50px)"),r=te(e,o,i,s)}else if(t.startsWith("reveal")){let o={opacity:0,height:0};t.includes("left")&&(o.transform="translateX(-50%)"),t.includes("right")&&(o.transform="translateX(50%)"),r=te(e,o,i,s)}return r.promise.then(()=>n?e.remove():e.hide()),r}var Hw=es(["#cd0e66","#0f82f2","#22ab24","#fd8c00"]),zw=class{constructor(e){this.index=e,this.color=Hw(),this.tilt=Math.floor(Math.random()*10)-10,this.tiltAngleIncrement=Math.random()*.07+.05,this.tiltAngle=0,this.x=Math.random()*P.width,this.y=(Math.random()-1)*P.height,this.r=Jt.uniform(10,30)}draw(e){e.beginPath(),e.lineWidth=this.r/2,e.strokeStyle=this.color,e.moveTo(this.x+this.tilt+this.r/4,this.y),e.lineTo(this.x+this.tilt,this.y+this.tilt+this.r/4),e.stroke()}update(e,t){this.tiltAngle+=this.tiltAngleIncrement,this.y+=(Math.cos(e)+3+this.r/2)/2,this.x+=Math.sin(e),this.tilt=Math.sin(this.tiltAngle-this.index/3)*15,this.x<-20?(this.x=-20,this.y=Math.random()*P.height,this.tilt=Math.floor(Math.random()*10)-20):this.x>P.width+20?(this.x=P.width+20,this.y=Math.random()*P.height,this.tilt=Math.floor(Math.random()*10)-20):t&&this.y>P.height&&(this.x=Math.random()*P.width,this.y=-10,this.tilt=Math.floor(Math.random()*10)-20)}},Fw="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999",cs=void 0;function Wn(e=2e3,t=150){cs||(cs=S("canvas",{style:Fw},Y)),cs.setAttr("width",P.width),cs.setAttr("height",P.height),cs.show();let i=cs.ctx,s=Ze(r=>new zw(r),t),n=re(r=>{i.clearRect(0,0,P.width,P.height);let o=r<e,a=0;for(let h of s)h.draw(i),h.update(r,o),h.y<P.height&&(a+=1);a||(n.cancel(),cs.hide())})}var us=class extends is{constructor(e,t={}){super();this.$el=e,this.startPos=new y(0,0),this.position=new y(0,0),this.disabled=!1,this.options=Object.assign({moveX:!0,moveY:!0,withinBounds:!0},t),P.onResize(()=>this.updateBounds()),os(e,{start:()=>{this.disabled||(this.startPos=this.position,this.trigger("start"),de.addClass("grabbing"))},move:(i,s)=>{this.disabled||(this.setPosition(this.startPos.x+i.x-s.x,this.startPos.y+i.y-s.y),this.trigger("drag",{posn:this.position,pointerPosn:i}),this.checkTarget(i))},end:(i,s)=>{this.disabled||(this.trigger(i.equals(s)?"click":"end",{$target:this.$over}),this.options.$targets&&!this.$over&&this.options.resetOnMiss&&this.resetPosition(),this.$over=void 0,de.removeClass("grabbing"))},click:()=>this.trigger("click"),accessible:!0})}addTarget(e){var t;this.options.$targets||(this.options.$targets=[]),(t=this.options.$targets)==null||t.push(e)}removeTarget(e){var t,i;this.options.$targets=(t=this.options.$targets)==null?void 0:t.filter(s=>s!==e),((i=this.options.$targets)==null?void 0:i.length)||(this.options.$targets=void 0)}checkTarget(e){if(!this.options.$targets)return;let t=this.options.$targets.find(i=>i.boundsRect.contains(e));t!==this.$over&&(this.$over&&this.trigger("exit-target",{$target:this.$over}),t&&this.trigger("enter-target",{$target:t}),this.$over=t)}updateBounds(){if(!this.options.withinBounds)return this.bounds=void 0;if(this.options.bounds)return this.bounds=this.options.bounds;let e=this.bounds,t=this.options.$parent||this.$el.parent,i=t.type==="svg"?t.svgWidth:t.width,s=t.type==="svg"?t.svgHeight:t.height;this.bounds=new be(0,i,0,s),!i&&!s&&setTimeout(()=>this.updateBounds()),e&&this.setPosition(this.position.x*this.bounds.dx/e.dx||0,this.position.y*this.bounds.dy/e.dy||0)}setPosition(e,t){var i;let s=new y(this.options.moveX?e:0,this.options.moveY?t:0);this.bounds&&(s=s.clamp(this.bounds,(i=this.options.margin)!=null?i:0)),s=s.round(this.options.snap||1),this.options.round&&(s=this.options.round(s)),!s.equals(this.position)&&(this.position=s,this.options.useTransform?this.$el.translate(s.x,s.y):(this.options.moveX&&this.$el.css("left",`${s.x}px`),this.options.moveY&&this.$el.css("top",`${s.y}px`)),this.trigger("move",{posn:s}))}resetPosition(e=250){return $e(this,null,function*(){let t=this.position;this.$el.css({"pointer-events":"none"}),yield re(i=>{let s=y.interpolate(t,this.startPos,i);this.setPosition(s.x,s.y)},e).promise,this.$el.css({"pointer-events":"initial"})})}},Uw="position: fixed; top: 0; left: 0; width: 100%; height: 4px; background: #0f82f2; pointer-events: none; z-index: 9999; will-change: transform;";function Pp(e,t){let i=t.regex.exec(e);if(i){i.shift();let s={};for(let[n,r]of t.params.entries())s[r]=i[n];return s}else return}function jw(e,t,i){return $e(this,null,function*(){return e.template?typeof e.template=="string"?e.template:e.template(t):(yield fetch(i+(i.indexOf("?")>=0?"&xhr=1":"?xhr=1"))).text()})}var Cp=document.readyState==="complete";window.addEventListener("load",()=>setTimeout(()=>Cp=!0));"scrollRestoration"in window.history&&(window.history.scrollRestoration="manual");var Ww=class extends is{constructor(){super(...arguments);this.$viewport=Y,this.views=[],this.active={path:"",hash:""},this.preloaded=!1,this.transition=!1,this.noLoad=!1,this.initialise=()=>{}}setup(e={}){e.$viewport&&(this.$viewport=e.$viewport),e.initialise&&(this.initialise=e.initialise),e.preloaded&&(this.preloaded=e.preloaded),e.transition&&(this.transition=e.transition),e.noLoad&&(this.noLoad=e.noLoad),e.click&&Y.on("click",t=>this.onLinkClick(t)),e.history&&window.addEventListener("popstate",t=>$e(this,null,function*(){var i;if(!Cp||!((i=t.state)==null?void 0:i.path))return;(yield this.load(t.state.path,t.state.hash))||window.history.pushState(this.active,"",this.active.path+this.active.hash)}))}view(e,{enter:t,exit:i,template:s}={}){let n=(e.match(/:\w+/g)||[]).map(p=>p.substr(1)),r=`${e.replace(/:\w+/g,"([\\w-]+)").replace("/","\\/")}\\/?`,o=e.includes("?")?"":"(\\?.*)?",h={regex:new RegExp(`^${r}${o}$`,"i"),params:n,enter:t,exit:i,template:s};this.views.push(h);let l=window.location.pathname+window.location.search,c=Pp(l,h);!c||(this.active={path:l,hash:window.location.hash},window.history.replaceState(this.active,"",this.active.path+this.active.hash),P.ready(()=>{setTimeout(()=>{this.preloaded?(this.initialise(this.$viewport,c),h.enter&&h.enter(this.$viewport,c)):this.loadView(h,c)})}))}paths(...e){for(let t of e)this.view(t)}getView(e){for(let t of this.views){let i=Pp(e,t);if(i)return{view:t,params:i}}}load(e,t){return $e(this,null,function*(){if(e===this.active.path&&t!==this.active.hash)return this.trigger("hashChange",t.slice(1)),this.trigger("change",e+t),this.active={path:e,hash:t},!0;let i=this.getView(e);return!i||this.beforeChange&&!(yield this.beforeChange())?!1:(this.active={path:e,hash:t},this.trigger("change",e+t),window.ga&&window.ga("send","pageview",e+t),this.noLoad?i.view.enter&&i.view.enter(this.$viewport,i.params):this.loadView(i.view,i.params),!0)})}loadView(e){return $e(this,arguments,function*(t,i={}){this.showLoadingBar();let s=this.active.path,n=yield jw(t,i,s);if(this.active.path!==s)return;yield this.$viewport.animate({opacity:0},200).promise,this.$viewport.removeChildren(),Y.scrollTop=0,this.$viewport.html=n,P.resize(),Dw(),this.$viewport.animate({opacity:1},200),this.hideLoadingBar();let r=this.$viewport.$("title");r&&(document.title=r.text),this.initialise(this.$viewport,i),t.enter&&t.enter(this.$viewport,i),this.trigger("afterChange",{$viewport:this.$viewport})})}onLinkClick(e){if(e.metaKey||e.ctrlKey||e.shiftKey||e.defaultPrevented)return;let t=e.target;for(;t&&t.nodeName!=="A";)t=t.parentNode;if(!t||t.nodeName!=="A")return;let i=t;if(i.target||i.origin!==window.location.origin||i.hasAttribute("download")||i.getAttribute("rel")==="external")return;let s=i.getAttribute("href");s&&s.indexOf("mailto:")>-1||this.getView(i.pathname+i.search)&&(e.preventDefault(),this.goTo(i.pathname+i.search,i.hash))}goTo(e,t=""){return $e(this,null,function*(){let i=this.active.path+this.active.hash;(yield this.load(e,t))&&i!==this.active.path+this.active.hash&&window.history.pushState(this.active,"",e+t)})}replace(e,t=""){this.active={path:e,hash:t},window.history.replaceState(this.active,"",e+t)}back(){window.history.back()}forward(){window.history.forward()}showLoadingBar(){this.$loadingBar||(this.$loadingBar=S("div",{style:Uw},Y)),this.$loadingBar.css({transform:"translateX(-100%)",opacity:1}),this.$loadingBar.show(),this.animation=re(e=>{this.$loadingBar.css("transform",`translateX(-${10+90*Math.exp(-4*e)}%)`)},3e3)}hideLoadingBar(){return $e(this,null,function*(){var e,t,i;(e=this.animation)==null||e.cancel(),yield(t=this.$loadingBar)==null?void 0:t.animate({transform:"none",opacity:0}).promise,(i=this.$loadingBar)==null||i.hide()})}},Zn=new Ww;function Zw(e,t){let i=Array.from(e.childNodes);e.innerHTML=t;let s={};for(let n of Array.from(e.querySelectorAll("slot")))s[n.getAttribute("name")||""]=n;for(let n of i){let r=n.getAttribute&&n.getAttribute("slot")||"",o=s[r]||s[""];o&&o.parentNode.insertBefore(n,o)}for(let n of Object.values(s))n.parentNode.removeChild(n)}function Tp(e){let t=[];for(let i of Array.from(e.children))i.tagName.startsWith("X-")?t.push(i):t.push(...Tp(i));return t}var Ep=new Map,Kw=class extends HTMLElement{constructor(){super(...arguments);this.wasConnected=!1,this.isReady=!1}connectedCallback(){return $e(this,null,function*(){if(this.wasConnected){this._view.trigger("connected");return}this.wasConnected=!0,this.isReady=!1,this._view.created();let e=Ep.get(this._view.tagName)||{};e.template&&Zw(this,e.template);let t=Tp(this).filter(i=>!i.isReady).map(i=>new Promise(s=>i.addEventListener("ready",s)));yield Promise.all(t),this._view.ready(),this.dispatchEvent(new CustomEvent("ready")),this.isReady=!0})}disconnectedCallback(){this._view.trigger("disconnected")}},I=class extends hs{created(){}ready(){}};function L(e,t={}){return function(i){class s extends Kw{constructor(){super();this._view=new i(this)}}Ep.set(e.toUpperCase(),t),window.customElements.define(e,s)}}var Sh=class{constructor(t){this.clipEndTime=0;this.player=new Audio(t),this.player.preload="true",this.player.addEventListener("timeupdate",()=>{this.player.currentTime>=this.clipEndTime&&this.triggerCallback(!0)}),window.addEventListener("beforeunload",()=>this.player.pause())}playClip(t,i,s){this.triggerCallback(!1),this.player.currentTime=t,this.clipEndTime=i,this.clipCallback=s,this.player.play()}triggerCallback(t){if(!this.clipCallback)return;let i=this.clipCallback;this.clipCallback=void 0,this.player.pause(),i({ended:t})}pause(){this.triggerCallback(!1)}get isPlaying(){return!!this.clipCallback}},Ph=!1,Ch,Th=class{constructor(t,i){this.audio=t;this.paragraphs=[];this.paragraphs=i.$$(".voice").map(s=>new Ap(s,t));for(let[s,n]of this.paragraphs.entries())n.on("end",()=>{var r;if(this.paragraphs[s+1])this.paragraphs[s+1].play();else{let o=i.nextStep;o&&o.isShown&&((r=o.narration)==null||r.play())}})}play(){var t;this.audio.isPlaying||!Ph||(t=this.paragraphs[0])==null||t.play()}},Ap=class extends is{constructor(t,i){super();this.$p=t;this.audio=i;this.playing=void 0;this.sentences=t.$$(".sentence[data-timings]").map(s=>new Vp(s,i)),this.$button=S("button",{class:"playback-btn",title:"Play Narration"}),this.$button.on("click",()=>{this.playing?this.audio.pause():this.play(),Ph=!Ph,Ch=void 0}),t.prepend(this.$button),t.addClass("sentence-wrap");for(let[s,n]of this.sentences.entries())n.on("end",r=>{this.playing=void 0,r&&this.sentences[s+1]?setTimeout(()=>this.play(this.sentences[s+1]),200):(this.$button.removeClass("active"),r&&setTimeout(()=>this.trigger("end"),400))})}play(t){let i=t||this.sentences[0],s=i.$reveal;if(s&&s.css("visibility")==="hidden"){this.$button.removeClass("active"),Ch=s,s.one("reveal",()=>{Ch===s&&!this.audio.isPlaying&&this.play(i)});return}this.playing=i,this.playing.play(),this.$button.addClass("active");let n=this.$p.parents("x-tabbox .tab")[0];if(n){let a=n.parents("x-tabbox")[0];a.makeActive(n.index());let h=a.active;a.one("change",l=>{this.playing&&l!==h&&this.audio.pause()})}let r=this.$p.bounds,o=r.top+r.height-P.height+20;o>0&&Y.scrollBy(o+100),setTimeout(()=>this.$button.focus(),800)}},Vp=class extends is{constructor(t,i){super();this.$el=t;this.audio=i;let s=t.attr("data-timings").split("-");this.start=+s[0]/1e3,this.end=(+s[1]-200)/1e3}play(){this.$el.addClass("playing"),this.audio.playClip(this.start,this.end,({ended:t})=>{this.$el.removeClass("playing"),this.trigger("end",t)})}get $reveal(){return this.$el.parents(".reveal")[0]}};var Xw=Object.defineProperty,Yw=Object.getOwnPropertyDescriptor,Kn=(e,t,i,s)=>{for(var n=s>1?void 0:s?Yw(t,i):t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(n=(s?o(t,i,n):o(n))||n);return s&&n&&Xw(t,i,n),n},kp=(e,t,i)=>new Promise((s,n)=>{var r=h=>{try{a(i.next(h))}catch(l){n(l)}},o=h=>{try{a(i.throw(h))}catch(l){n(l)}},a=h=>h.done?s(h.value):Promise.resolve(h.value).then(r,o);a((i=i.apply(e,t)).next())}),en,Qw=S("div",{class:"snackbar"},Y),Lp=class extends I{ready(){var e;Qw.append(this),(e=this.$("button"))==null||e.on("click",()=>this.close())}open(e=2e3){return kp(this,null,function*(){en!==this&&(en&&(yield en.close()),en=this,yield this.enter("pop",300).promise,this.setAttr("role","alert"),e&&setTimeout(()=>this.close(),e))})}close(){return kp(this,null,function*(){en===this&&(en=void 0,this.removeAttr("role"),yield this.exit("pop",300).promise)})}};Lp=Kn([L("x-alert")],Lp);var Op=class extends I{ready(){if(this.children.length)return;let e=+this.attr("size")||24;this.css({width:`${e}px`,height:`${e}px`});let t=S("svg",{viewBox:"0 0 24 24"},this);t.css({width:`${e}px`,height:`${e}px`});let i=S("use",{},t);this.onAttr("name",s=>i.setAttr("href",`/icons.f1c0c95c.svg#${s}`))}};Op=Kn([L("x-icon")],Op);var ds=S("div",{class:"modal-background"},Y),Eh,gi=void 0,Ah=void 0;function Vh(){gi&&gi.canClose&&gi.close()}ds.on("click",Vh);P.onKey("escape",Vh);Zn.on("change",Vh);ds.on("scrollwheel touchmove",e=>{e.preventDefault(),e.stopPropagation()});P.onKey("space up down pagedown pageup",e=>{gi&&(e.preventDefault(),e.stopPropagation())});var Ip=class extends I{constructor(){super(...arguments);this.isOpen=!1,this.canClose=!0}ready(){this.canClose=!this.hasAttr("no-close"),this.$iframe=this.$("iframe[data-src]"),this.$video=this.$("video");let e=Je(`[data-modal=${this.id}]`);for(let i of e)i.on("click",()=>this.open());Zn.on("afterChange",({$viewport:i})=>{let s=i.$$(`[data-modal=${this.id}]`);for(let n of s)n.on("click",()=>this.open())}),this.hasClass("open")&&!gi&&this.open(!0),this.$("input")&&this.addClass("interactive");let t=this.$(".close");t&&t.on("click",()=>this.close());for(let i of this.$$(".btn"))i.on("click",()=>this.trigger("btn-click",i))}open(e=!1){if(this.isOpen)return;ds.setClass("light",this.hasClass("light")),gi?gi.close(!0):e?ds.show():ds.css("display")==="block"?Eh==null||Eh.cancel():ds.enter("fade",250),this.isOpen=!0,gi=this,this.$iframe&&this.$iframe.setAttr("src",this.$iframe.data.src),this.$video&&this.$video.play(),e?this.show():this.enter("pop",250).promise.then(()=>this.css("transform","")),this.setAttr("role","dialog"),this.trigger("open"),Ah=document.activeElement;let t=this.$('input, a, button, textarea, [tabindex="0"]');t&&t.focus()}close(e=!1,t=!1){!this.isOpen||(this.isOpen=!1,this.removeAttr("role"),gi=void 0,this.$iframe&&this.$iframe.setAttr("src",""),this.$video&&this.$video.pause(),e||(Eh=ds.exit("fade",250)),this.exit("pop",250).promise.then(()=>this.css("transform","")),t||this.trigger("close"),Ah&&Ah.focus())}};Ip=Kn([L("x-modal")],Ip);var Rp=class extends I{constructor(){super(...arguments);this.isOpen=!1}ready(){this.animation=this.attr("animation")||"pop",this.$bubble=this.$(".popup-body"),this.$bubble.hide(),this.$(".popup-target").on("click",()=>this.toggle()),this.on("clickOutside",()=>this.close());for(let t of this.$bubble.$$("a"))t.on("click",()=>this.close());P.onKey("escape",()=>this.close())}toggle(){this.isOpen?this.close():this.open()}open(){this.isOpen||(this.isOpen=!0,this.addClass("active"),this.$bubble.enter(this.animation,150),this.$bubble.setAttr("role","dialog"),this.$bubble.focus())}close(){!this.isOpen||(this.isOpen=!1,this.removeClass("active"),this.$bubble.exit(this.animation,150),this.$bubble.removeAttr("role"))}};Rp=Kn([L("x-popup")],Rp);var _p=class extends I{constructor(){super(...arguments);this.$options={}}ready(){let e=this.children;this.$active=this.$(".active")||e[0],this.$active.addClass("active");for(let[t,i]of e.entries())!tt(i.tagName,"A","BUTTON")&&!i.hasAttr("tabindex")&&i.setAttr("tabindex",0),i.on("click",()=>this.makeActive(i)),this.$options[i.attr("value")||t]=i;this.trigger("change",this.$active)}makeActive(e){e!==this.$active&&(this.$active.removeClass("active"),this.$active=e,e.addClass("active"),this.trigger("change",e))}bindVariable(e,t){e[t]===void 0&&(e[t]=this.$active.attr("value")),this.on("change",i=>e[t]=i.attr("value")),e.watch(()=>{let i=this.$options[e[t]];i&&this.makeActive(i)})}};_p=Kn([L("x-select")],_p);var kh=12;function Jw(e){return`M${e},${e/2}a${e/2},${e/2},0,0,1,0,${e}A${e/2},${e/2},0,0,1,${e},${e/2}`}function t2(e){return`M ${e},0 C ${e/2},0,0,${e/2},0,${e}  s ${e/2},${e},${e},${e} s ${e}-${e/2},${e}-${e}     S ${e*1.5},0,${e},0 z M ${e*44.6/50},${e*76.1/50} L ${e*19.2/50},${e*48.8/50} l ${e*4/50}-${e*4.2/50}     l ${e*19.8/50},${e*11.9/50} l ${e*34.2/50}-${e*32.6/50} l ${e*3.5/50},${e*3.5/50} L ${e*44.6/50},${e*76.1/50} z`}var Lh=class extends I{constructor(){super(...arguments);this.completed=!1}ready(){this.r=+this.attr("r")||10,this.r1=this.r+kh,this.$svg=S("svg",{width:2*this.r1,height:2*this.r1},this),this.$progress=S("path",{class:"pie",d:Jw(this.r),"stroke-width":this.r},this.$svg),this.onAttr("p",t=>this.setProgress(+t,!1))}setProgress(t,i=!0){if(t>.99)return this.complete(i);let s=Math.PI*this.r;this.$progress.css("stroke",t?"currentColor":"none"),this.$progress.css("stroke-dasharray",`${t*s} ${s}`)}complete(t=!0){if(this.completed||(this.completed=!0,this.$progress.css("stroke","none"),this.$progress.css("fill","currentColor"),this.$progress.setAttr("d",t2(this.r)),!t))return;let i=`translate(${this.r1} ${this.r1})`,s=S("g",{transform:i},this.$svg),n=Ze(()=>S("line",{},s),18);re(r=>{let o=this.r+kh*mi("quint-out",r),a=this.r+kh*r;for(let h=0;h<18;++h){let l=Math.cos(Math.PI*2*h/18),c=Math.sin(Math.PI*2*h/18);n[h].setLine({x:l*o,y:c*o},{x:l*a,y:c*a})}},800).promise.then(()=>s.remove())}};Lh=R([L("x-progress")],Lh);var Np="2.4.1",Oh="i5iSjo",Dp="_av",Ih="_au",Rh="(not set)";var ao=[],ho=class{static add(t,i,s){Gp(t,i).add(s)}static remove(t,i,s){Gp(t,i).remove(s)}constructor(t,i){this.context=t,this.methodName=i,this.isTask=/Task$/.test(i),this.originalMethodReference=this.isTask?t.get(i):t[i],this.methodChain=[],this.boundMethodChain=[],this.wrappedMethod=(...s)=>this.boundMethodChain[this.boundMethodChain.length-1](...s),this.isTask?t.set(i,this.wrappedMethod):t[i]=this.wrappedMethod}add(t){this.methodChain.push(t),this.rebindMethodChain()}remove(t){let i=this.methodChain.indexOf(t);i>-1&&(this.methodChain.splice(i,1),this.methodChain.length>0?this.rebindMethodChain():this.destroy())}rebindMethodChain(){this.boundMethodChain=[];for(let t,i=0;t=this.methodChain[i];i++){let s=this.boundMethodChain[i-1]||this.originalMethodReference.bind(this.context);this.boundMethodChain.push(t(s))}}destroy(){let t=ao.indexOf(this);t>-1&&(ao.splice(t,1),this.isTask?this.context.set(this.methodName,this.originalMethodReference):this.context[this.methodName]=this.originalMethodReference)}},vi=ho;function Gp(e,t){let i=ao.filter(s=>s.context==e&&s.methodName==t)[0];return i||(i=new ho(e,t),ao.push(i)),i}var sn=window.Element.prototype,IM=sn.matches||sn.matchesSelector||sn.webkitMatchesSelector||sn.mozMatchesSelector||sn.msMatchesSelector||sn.oMatchesSelector;var s2="80",n2="443",UM=RegExp(":("+s2+"|"+n2+")$"),jM=document.createElement("a");function lo(e,t,i=void 0,s=void 0,n=void 0,r=void 0){if(typeof s=="function"){let o=i.get("buildHitTask");return{buildHitTask:a=>{a.set(e,null,!0),a.set(t,null,!0),s(a,n,r),o(a)}}}else return Ri({},e,t)}var _h={};function Bp(e,t){let i=e.get("trackingId"),s=_h[i]=_h[i]||{},n=()=>{clearTimeout(s.timeout),s.send&&vi.remove(e,"send",s.send),delete _h[i],s.queue.forEach(r=>r())};clearTimeout(s.timeout),s.timeout=setTimeout(n,0),s.queue=s.queue||[],s.queue.push(t),s.send||(s.send=r=>(...o)=>{n(),r(...o)},vi.add(e,"send",s.send))}var Ri=Object.assign||function(e,...t){for(let i=0,s=t.length;i<s;i++){let n=Object(t[i]);for(let r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};function Hp(e){return e.charAt(0).toUpperCase()+e.slice(1)}function zp(e){return typeof e=="object"&&e!==null}function _i(){return+new Date}var Xn=function e(t){return t?(t^Math.random()*16>>t/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e)};function Nh(e,t){let i=window.GoogleAnalyticsObject||"ga";window[i]=window[i]||function(...s){(window[i].q=window[i].q||[]).push(s)},window.gaDevIds=window.gaDevIds||[],window.gaDevIds.indexOf(Oh)<0&&window.gaDevIds.push(Oh),window[i]("provide",e,t),window.gaplugins=window.gaplugins||{},window.gaplugins[Hp(e)]=t}var Dh=class{constructor(){this.registry_={}}on(t,i){this.getRegistry_(t).push(i)}off(t=void 0,i=void 0){if(t&&i){let s=this.getRegistry_(t),n=s.indexOf(i);n>-1&&s.splice(n,1)}else this.registry_={}}emit(t,...i){this.getRegistry_(t).forEach(s=>s(...i))}getEventCount(){let t=0;return Object.keys(this.registry_).forEach(i=>{t+=this.getRegistry_(i).length}),t}getRegistry_(t){return this.registry_[t]=this.registry_[t]||[]}},Fp=Dh;var co="autotrack",nn={},Gh=!1,Yn,De=class extends Fp{static getOrCreate(t,i,s){let n=[co,t,i].join(":");return nn[n]||(nn[n]=new De(n,s),Gh||o2()),nn[n]}static isSupported_(){if(Yn!=null)return Yn;try{window.localStorage.setItem(co,co),window.localStorage.removeItem(co),Yn=!0}catch(t){Yn=!1}return Yn}static get_(t){return window.localStorage.getItem(t)}static set_(t,i){window.localStorage.setItem(t,i)}static clear_(t){window.localStorage.removeItem(t)}constructor(t,i={}){super();this.key_=t,this.defaults_=i,this.cache_=null}get(){if(this.cache_)return this.cache_;if(De.isSupported_())try{this.cache_=qh(De.get_(this.key_))}catch(t){}return this.cache_=Ri({},this.defaults_,this.cache_)}set(t){if(this.cache_=Ri({},this.defaults_,this.cache_,t),De.isSupported_())try{De.set_(this.key_,JSON.stringify(this.cache_))}catch(i){}}clear(){if(this.cache_={},De.isSupported_())try{De.clear_(this.key_)}catch(t){}}destroy(){delete nn[this.key_],Object.keys(nn).length||a2()}},uo=De;function o2(){window.addEventListener("storage",Up),Gh=!0}function a2(){window.removeEventListener("storage",Up),Gh=!1}function Up(e){let t=nn[e.key];if(t){let i=Ri({},t.defaults_,qh(e.oldValue)),s=Ri({},t.defaults_,qh(e.newValue));t.cache_=s,t.emit("externalSet",s,i)}}function qh(e){let t={};if(e)try{t=JSON.parse(e)}catch(i){}return t}var h2=1e3,l2=60*h2,po={},ps=class{static getOrCreate(t,i,s){let n=t.get("trackingId");return po[n]?po[n]:po[n]=new ps(t,i,s)}constructor(t,i,s){this.tracker=t,this.timeout=i||ps.DEFAULT_TIMEOUT,this.timeZone=s,this.sendHitTaskOverride=this.sendHitTaskOverride.bind(this),vi.add(t,"sendHitTask",this.sendHitTaskOverride);try{this.dateTimeFormatter=new Intl.DateTimeFormat("en-US",{timeZone:this.timeZone})}catch(r){}let n={hitTime:0,isExpired:!1};this.store=uo.getOrCreate(t.get("trackingId"),"session",n),this.store.get().id||this.store.set({id:Xn()})}getId(){return this.store.get().id}isExpired(t=this.getId()){if(t!=this.getId())return!0;let i=this.store.get();if(i.isExpired)return!0;let s=i.hitTime;if(s){let n=new Date,r=new Date(s);if(n-r>this.timeout*l2||this.datesAreDifferentInTimezone(n,r))return!0}return!1}datesAreDifferentInTimezone(t,i){return this.dateTimeFormatter?this.dateTimeFormatter.format(t)!=this.dateTimeFormatter.format(i):!1}sendHitTaskOverride(t){return i=>{t(i);let s=i.get("sessionControl"),n=s=="start"||this.isExpired(),r=s=="end",o=this.store.get();o.hitTime=_i(),n&&(o.isExpired=!1,o.id=Xn()),r&&(o.isExpired=!0),this.store.set(o)}}destroy(){vi.remove(this.tracker,"sendHitTask",this.sendHitTaskOverride),this.store.destroy(),delete po[this.tracker.get("trackingId")]}},Bh=ps;ps.DEFAULT_TIMEOUT=30;var Hh={CLEAN_URL_TRACKER:1,EVENT_TRACKER:2,IMPRESSION_TRACKER:3,MEDIA_QUERY_TRACKER:4,OUTBOUND_FORM_TRACKER:5,OUTBOUND_LINK_TRACKER:6,PAGE_VISIBILITY_TRACKER:7,SOCIAL_WIDGET_TRACKER:8,URL_CHANGE_TRACKER:9,MAX_SCROLL_TRACKER:10},jp=Object.keys(Hh).length;function Wp(e,t){u2(e),c2(e,t)}function d2(e){return parseInt(e||"0",16).toString(2)}function p2(e){return parseInt(e||"0",2).toString(16)}function f2(e,t){if(e.length<t){let i=t-e.length;for(;i;)e="0"+e,i--}return e}function m2(e,t){return e.substr(0,t)+1+e.substr(t+1)}function c2(e,t){let i=e.get("&"+Ih),s=f2(d2(i),jp);s=m2(s,jp-t),e.set("&"+Ih,p2(s))}function u2(e){e.set("&"+Dp,Np)}var Qn="hidden",ti="visible",rn=Xn(),Zp=1e3,Kp=class{constructor(t,i){if(Wp(t,Hh.PAGE_VISIBILITY_TRACKER),!document.visibilityState)return;let s={sessionTimeout:Bh.DEFAULT_TIMEOUT,visibleThreshold:5*Zp,sendInitialPageview:!1,fieldsObj:{}};this.opts=Ri(s,i),this.tracker=t,this.lastPageState=document.visibilityState,this.visibleThresholdTimeout_=null,this.isInitialPageviewSent_=!1,this.trackerSetOverride=this.trackerSetOverride.bind(this),this.handleChange=this.handleChange.bind(this),this.handleWindowUnload=this.handleWindowUnload.bind(this),this.handleExternalStoreSet=this.handleExternalStoreSet.bind(this),this.store=uo.getOrCreate(t.get("trackingId"),"plugins/page-visibility-tracker"),this.store.on("externalSet",this.handleExternalStoreSet),this.session=Bh.getOrCreate(t,this.opts.sessionTimeout,this.opts.timeZone),vi.add(t,"set",this.trackerSetOverride),window.addEventListener("unload",this.handleWindowUnload),document.addEventListener("visibilitychange",this.handleChange),Bp(this.tracker,()=>{document.visibilityState==ti?(this.opts.sendInitialPageview&&(this.sendPageview({isPageLoad:!0}),this.isInitialPageviewSent_=!0),this.store.set({time:_i(),state:ti,pageId:rn,sessionId:this.session.getId()})):this.opts.sendInitialPageview&&this.opts.pageLoadsMetricIndex&&this.sendPageLoad()})}handleChange(){if(!(document.visibilityState==ti||document.visibilityState==Qn))return;let t=this.getAndValidateChangeData(),i={time:_i(),state:document.visibilityState,pageId:rn,sessionId:this.session.getId()};document.visibilityState==ti&&this.opts.sendInitialPageview&&!this.isInitialPageviewSent_&&(this.sendPageview(),this.isInitialPageviewSent_=!0),document.visibilityState==Qn&&this.visibleThresholdTimeout_&&clearTimeout(this.visibleThresholdTimeout_),this.session.isExpired(t.sessionId)?(this.store.clear(),this.lastPageState==Qn&&document.visibilityState==ti&&(clearTimeout(this.visibleThresholdTimeout_),this.visibleThresholdTimeout_=setTimeout(()=>{this.store.set(i),this.sendPageview({hitTime:i.time})},this.opts.visibleThreshold))):(t.pageId==rn&&t.state==ti&&this.sendPageVisibilityEvent(t),this.store.set(i)),this.lastPageState=document.visibilityState}getAndValidateChangeData(){let t=this.store.get();return this.lastPageState==ti&&t.state==Qn&&t.pageId!=rn&&(t.state=ti,t.pageId=rn,this.store.set(t)),t}sendPageVisibilityEvent(t,{hitTime:i}={}){let s=this.getTimeSinceLastStoredChange(t,{hitTime:i});if(s&&s>=this.opts.visibleThreshold){let n=Math.round(s/Zp),r={transport:"beacon",nonInteraction:!0,eventCategory:"Page Visibility",eventAction:"track",eventValue:n,eventLabel:Rh};i&&(r.queueTime=_i()-i),this.opts.visibleMetricIndex&&(r["metric"+this.opts.visibleMetricIndex]=n),this.tracker.send("event",lo(r,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}}sendPageLoad(){let t={transport:"beacon",eventCategory:"Page Visibility",eventAction:"page load",eventLabel:Rh,["metric"+this.opts.pageLoadsMetricIndex]:1,nonInteraction:!0};this.tracker.send("event",lo(t,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}sendPageview({hitTime:t,isPageLoad:i}={}){let s={transport:"beacon"};t&&(s.queueTime=_i()-t),i&&this.opts.pageLoadsMetricIndex&&(s["metric"+this.opts.pageLoadsMetricIndex]=1),this.tracker.send("pageview",lo(s,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}trackerSetOverride(t){return(i,s)=>{let n=zp(i)?i:{[i]:s};n.page&&n.page!==this.tracker.get("page")&&this.lastPageState==ti&&this.handleChange(),t(i,s)}}getTimeSinceLastStoredChange(t,{hitTime:i}={}){return t.time?(i||_i())-t.time:0}handleExternalStoreSet(t,i){t.time!=i.time&&i.pageId==rn&&i.state==ti&&!this.session.isExpired(i.sessionId)&&this.sendPageVisibilityEvent(i,{hitTime:t.time})}handleWindowUnload(){this.lastPageState!=Qn&&this.handleChange()}remove(){this.store.destroy(),this.session.destroy(),vi.remove(this.tracker,"set",this.trackerSetOverride),window.removeEventListener("unload",this.handleWindowUnload),document.removeEventListener("visibilitychange",this.handleChange)}};Nh("pageVisibilityTracker",Kp);Sp();de.addClass((P.isMobile?"is":"not")+"-mobile");P.isSafari&&de.addClass("is-safari");setTimeout(()=>de.addClass("ready"));window.addEventListener("keydown",e=>{e.keyCode===9&&de.addClass("is-tabbing")});window.addEventListener("mousedown",()=>{de.removeClass("is-tabbing")});var Xp=N(".cookie-warning");Xp&&N("#yes-to-cookies").on("click",function(){Xp.exit("pop",300),P.setCookie("cookie_consent",1)});var zh=N("x-modal#privacy");zh&&zh.$("form").on("submit",e=>{e.preventDefault(),fetch("/profile/accept-policies",{method:"POST"}),zh.close()});var Yp;(Yp=navigator.serviceWorker)==null||Yp.register("/service_worker.js",{scope:"/"}).catch(()=>console.warn("Unable to register Service Worker."));window.addEventListener("beforeinstallprompt",e=>{e.prompt()});var Qp;(Qp=N("#skip-nav"))==null||Qp.on("click",()=>{var t;(t=(N("article")||N(".panel.active")||N(".body")||Y).$("input, button, a, textarea, [contenteditable], [tabindex]"))==null||t.focus()});var Fh=N("nav x-popup");if(Fh){let e=Fh.$$(".popup-body a, .popup-body button");for(let t of e)t.on("click",()=>Fh.close())}var g2=Je("#language .locale-link");Zn.on("change",e=>{for(let t of g2)t.setAttr("href",t.data.host+e)});var fo=N("#dark-mode");fo&&(fo.checked=P.theme.isDark,fo.on("change",()=>P.setTheme(fo.checked?"dark":"light")));var Jn={},fs=N("#search"),Ni=fs==null?void 0:fs.$(".form-field input"),mo=fs==null?void 0:fs.$(".search-body");Jn[""]=(mo==null?void 0:mo.html)||"";function v2(e){return e=e.trim().replace(/\s+/," ").toLowerCase().slice(0,50),e==="pi"||e.length>=3?e:""}function w2(e){return E(this,null,function*(){if(e=encodeURIComponent(v2(e)),e in Jn)return Jn[e];let t=yield fetch(`/api/search?q=${e}`);return t.ok?Jn[e]=yield t.text():Jn[e]=""})}var y2=0,Jp=0;function tf(e){return E(this,null,function*(){let t=y2+=1,i=yield w2(e);t<=Jp||(Jp=t,mo.html=i)})}Ni==null||Ni.change(e=>{P.setCookie("search",e,60*60*24),setTimeout(()=>{Ni.value===e&&tf(e)},300)});(Ni==null?void 0:Ni.value)&&fs.one("open",()=>tf(Ni.value));var ef='<label class="target"><input maxlength="15" autocomplete="off" aria-label="Fill in this blank"></label>';function sf(e){if(e.match("^[0-9]+/[0-9]+$")){let t=e.split("/");return+t[0]/+t[1]}else return yd(e)}var Uh=class extends I{constructor(){super(...arguments);this.solution="";this.solutionNum=NaN;this.solutionDisplay="";this.range=0;this.input="";this.hint="";this.attempts=0;this.placeholder="???";this.done=!1}ready(){if(this.$input=this.$("input"),this.$target=this.$(".target"),this.solution=this.attr("solution"),this.solution.indexOf("\xB1")>=0){let t=this.solution.split("\xB1");this.solution=t[0].trim(),this.range=+t[1]}this.solutionNum=sf(this.solution),this.solutionDisplay=this.solution,this.hint=this.attr("hint"),this.removeAttr("solution"),this.removeAttr("hint"),this.$input.setInputPattern(this.solution),this.hasAttr("placeholder")&&(this.placeholder=this.attr("placeholder")),this.$input.setAttr("placeholder",this.placeholder),this.removeAttr("placeholder"),this.$input.change(t=>{this.input=t,this.isCorrect&&(this.solve(),this.trigger("valid",t),this.moveCursor())}),this.$input.onKeyDown("enter",()=>this.$input.blur()),this.$input.on("focus",()=>{this.addClass("on"),this.removeClass("invalid"),this.$input.setAttr("placeholder"," ")}),this.$input.on("blur",()=>{if(this.removeClass("on"),this.setClass("invalid",!!this.input&&!this.done),this.$input.setAttr("placeholder",this.placeholder),this.input&&!this.done){this.attempts+=1;let t=this.attempts>=(this.hint?4:3)?`Hmmm\u2026 maybe try ${this.solution}?`:this.attempts>=2?this.hint:void 0;this.trigger("invalid",{hint:t})}})}setup(t,i,s){var n;this.goal=i,this.$step=t,((n=s==null?void 0:s.scores)==null?void 0:n.includes(i))&&this.solve(!0),this.one("valid",()=>{t.addHint("correct"),t.score(this.solvedBlank?this.solvedBlank.goal:i)}),this.on("invalid",r=>t.addHint(r.hint||"incorrect",{class:"incorrect"}))}get isCorrect(){if(this.done)return!0;if(this.linkedBlanks){let t=this.linkedBlanks.map(i=>i.solvedBlank);return this.solvedBlank=this.linkedBlanks.find(i=>{if(i.done&&!i.solvedBlank||t.includes(i))return!1;if(i.checkAnswer(this.input))return!0}),this.solvedBlank&&(this.solutionDisplay=this.solvedBlank.solution),!!this.solvedBlank}return this.checkAnswer(this.input)}checkAnswer(t){let i=sf(t);return t.toLowerCase()===this.solution.toLowerCase()?!0:this.range&&Math.abs(i-this.solutionNum)<=this.range?(this.solutionDisplay=t,!0):B(i,this.solutionNum)||ih(i)===this.solution||t===ih(this.solutionNum)}moveCursor(){if(!this.$step)return;let t=this.$step.$blanks[this.$step.$blanks.indexOf(this)+1];!t||t.done||t.tagName==="X-BLANK-MC"||t.css("visibility")==="hidden"||!t.bounds.width||t.focus()}solve(t=!1){this.done=!0,this.$input.remove(),this.$target.html=this.solutionDisplay,this.addClass("done"),this.trigger("solve",{solution:this.solutionDisplay,restore:t})}focus(){this.$input.focus()}blur(){this.$input.blur()}};Uh=R([L("x-blank",{template:ef})],Uh);var nf='<span class="target" slot="target" tabindex="0" aria-label="Fill in this blank">???</span><div class="popup"><slot></slot></div>';var jh=class extends I{constructor(){super(...arguments);this.done=!1}ready(){this.$target=this.$(".target"),this.$popup=this.$(".popup");let t=this.$popup.$$(".choice");this.solution=t[0].html,Jt.shuffle(Ks(t.length)).forEach(n=>{this.$popup.append(t[n]),t[n].on("click",()=>{this.removeClass("on"),t[n].blur(),n?(this.$target.html=t[n].html,this.addClass("invalid"),this.trigger("invalid")):(this.solve(),this.trigger("valid",this.solution))})});let s=this.$target.bounds.left+this.$popup.width>P.width-15;this.setClass("left",s),Qs(this,{enter:()=>{if(this.done)return;this.addClass("on");let n=this.$target.bounds,r=this.$popup.width,o=this.$popup.height,a=P.width-10-n.left,h=r<a,l=n.right-r>10,c=n.top+n.height+o>P.height-10;this.setClass("left",l&&!h),this.setClass("top",c),this.$popup.css("max-width",!l&&!h?`${a}px`:"none")},exit:()=>{this.removeClass("on")},delay:100,exitDelay:400,$clickTarget:this.$target})}setup(t,i,s){var n;((n=s==null?void 0:s.scores)==null?void 0:n.includes(i))&&this.solve(!0),this.one("valid",()=>{t.addHint("correct"),t.score(i)}),this.on("invalid",r=>t.addHint(r.hint||"incorrect",{class:"incorrect"}))}solve(t=!1){this.done=!0,this.$target.html=this.solution,this.removeClass("on invalid"),this.addClass("done"),this.trigger("solve",{solution:this.solution,restore:t}),setTimeout(()=>this.$popup.remove(),250),this.$target.removeAttr("tabindex")}};jh=R([L("x-blank-mc",{template:nf})],jh);var rf='<div class="text-area" contenteditable="true"></div><div class="toolbar"><button class="command" data-command="bold"><x-icon name="bold" size="20"></x-icon></button><button class="command" data-command="italic"><x-icon name="italic" size="20"></x-icon></button><button class="command" data-command="underline"><x-icon name="underlined" size="20"></x-icon></button><div class="space"></div><button class="btn btn-green submit"><x-icon name="check"></x-icon> Done</button></div>';var of=40,af="free-text",Wh=class extends I{setup(t,i,s){var l,c;let n=this.$(".text-area"),r=this.$(".toolbar .submit"),o=((l=s==null?void 0:s.data)==null?void 0:l[af])||"";o&&(n.html=o);for(let p of this.$$(".toolbar .command")){let m=p.data.command.split(":");p.on("click",()=>document.execCommand(m[0],!1,m[1]))}let a=o,h=Oi(()=>{a!==o&&t.storeData(af,o),a=o},5e3);n.on("change keyup input paste",()=>{o=n.html.replace(/&nbsp;/g," ").trim().slice(0,500).trim(),r.setClass("invisible",o.length<of),h()}),((c=s==null?void 0:s.scores)==null?void 0:c.includes(i))?r.remove():(r.setClass("invisible",o.length<of),r.on("click",()=>{h(),t.score(i),r.exit("pop"),this.trigger("submit")}))}};Wh=R([L("x-free-text",{template:rf})],Wh);var hf='<div class="wrapper"><div class="panel"><slot></slot></div></div><div class="nav"><button class="btn back" aria-label="Previous Step"><x-icon name="left"></x-icon></button><button class="btn next" aria-label="Next Step"><x-icon name="right"></x-icon></button><div class="dots"></div></div>';var Zh=class extends I{ready(){let t=this.$(".wrapper"),i=this.$(".panel"),s=i.children,n=this.$(".next"),r=this.$(".back"),o=this.$(".dots"),a=s.map(()=>S("div",{class:"dot"},o)),h=s.length,l=+this.attr("slide-width")||void 0,c=this.width,p=1,m=c,v=0,M=0,f=yt=>{M=yt,i.translate(yt,0),this.trigger("move",yt)},b=yt=>{v=yt;for(let[je,qn]of a.entries())qn.setClass("on",je>=yt&&je<yt+p);n.setClass("disabled",yt===h-p),r.setClass("disabled",yt===0),this.trigger("change",yt)};P.onResize(()=>{c=this.width,p=l?Math.ceil(c/l):1,m=c/p;for(let yt of s)yt.css("width",m+"px");i.css("width",h*m+"px"),f(-v*m),b(v)});let $="quad",w=500,x,z,Gt,Ft,Ua=!1,nd=()=>{x=Date.now()-Ft,f(z+Gt*mi($,x/w)),!Ua&&x<w?requestAnimationFrame(nd):this.trigger("slide-end")},ja=yt=>{Ua=!1,x=0,z=M,Gt=-yt*m-M,Ft=Date.now(),b(yt),nd()};n.on("click",()=>{$="quad",v<h-p&&ja(v+1)}),r.on("click",()=>{$="quad",v>0&&ja(v-1)});let rd,Wa,Za,zr;os(t,{start:yt=>{Ua=!0,rd=M,Wa=yt.x,zr=Za=Wa},move:yt=>{Za=zr,zr=yt.x;let je=rd-Wa+yt.x,qn=-(h-p)*m,U1=je>0?je/4:je<qn?qn+(je-qn)/4:je;f(U1),this.css("pointer-events","none")},end:()=>{let yt=zr-Za,je=yt>12?1:yt<-12?-1:0;$="quad-out",ja(xt(Math.round(-M/m-je),0,h-p)),setTimeout(()=>this.css("pointer-events","auto"))}})}};Zh=R([L("x-gallery",{template:hf})],Zh);var lf='<svg width="70" height="80"><path d="M20.5,7.4,27.2,24c-1.9-4.7,6-7.1,8-2.3l1.4,3.6c-1.9-4.8,6.1-7.1,8-2.3l1.3,3.1c-2-4.7,5.7-6.5,7.7-1.8,3.3,7.8,5.8,13.6,9,21.3S60.8,56.2,65,66.7L44.9,75A13.9,13.9,0,0,0,36,66.9c-7.7-2.2-11.4-8.3-18.4-14.3a44.2,44.2,0,0,0-9.5-6.5c-2.6-1.5-4.2-3.4-2.2-5.7,3.5-4.1,9.3-1.3,13.1,1.5,1.6,1.2,4.4,4.1,5.9,3.8s1.7-.8,1-2.6L12.8,10.5c-1.9-4.7,5.8-7.9,7.7-3.1Z"></path></svg>';function Kh(e,t){let i=t.positionLeft-e.positionLeft+t.width/2,s=t.positionTop-e.positionTop+t.height/2;return new y(i,s)}function cf(e){return e?new y(...e.split(",").map(t=>+t)):void 0}var Xh=class extends I{constructor(){super(...arguments);this.doAnimation=!1}created(){this.slide=cf(this.attr("slide")),this.shift=cf(this.attr("offset"))}ready(){this.$target=N(this.attr("target")),this.$target&&(this.$target.on("click pointerdown focus",()=>this.stop()),this.hasAttr("start")&&this.start())}setTarget(t,i,s){this.$target=typeof t=="string"?N(t):t,i&&(this.slide=i),s&&(this.slide=s)}start(t){this.doAnimation||!this.from&&!this.$target||(this.doAnimation=!0,t&&(this.slide=t),this.slide||this.$end?this.runSlideAnimation():this.runClickAnimation())}startSlide(t,i){this.$target=t,this.$end=i,this.start()}stop(){this.doAnimation=!1}runSlideAnimation(){return E(this,null,function*(){this.show();let t=this.from||Kh(this,this.$target);this.shift&&(t=t.add(this.shift));let i=this.slide?t.add(this.slide):Kh(this,this.$end),s=`translate(${t.x-15}px,${t.y-10}px)`,n=`translate(${i.x-15}px,${i.y-10}px)`;yield this.animate({transform:[s+" scale(2)",s],opacity:[0,1]},300).promise,yield this.animate({transform:[s,n]},1e3).promise,yield this.animate({transform:[n,n+" scale(2)"],opacity:[1,0]},300).promise,this.hide(),setTimeout(()=>{this.doAnimation&&this.runSlideAnimation()},1e3)})}runClickAnimation(){return E(this,null,function*(){this.show();let t=this.from||Kh(this,this.$target);this.shift&&(t=t.add(this.shift));let i=`translate(${t.x-15}px,${t.y-10}px)`;yield this.animate({transform:[i+" scale(2)",i],opacity:[0,1]},500).promise,yield this.animate({transform:[i,i+" scale(2)"],opacity:[1,0]},500,200).promise,this.hide(),setTimeout(()=>{this.doAnimation&&this.runClickAnimation()},1e3)})}};Xh=R([L("x-gesture",{template:lf})],Xh);var Yh='<span class="target" tabindex="0"><slot></slot></span><div class="popup"></div>';var x2=JSON.parse(N("#glossary").text),b2=JSON.parse(N("#bios").text),Qh=600,go;P.onResize(()=>{go&&go.hide()});var vo=class extends I{ready(){this.xid=this.attr("xid"),this.$target=this.$(".target"),this.$popup=this.$(".popup"),this.$popup.html=this.body()||"",this.setClass("left",P.width>Qh&&this.$target.bounds.left+this.$popup.width>P.width-15),Qs(this,{enter:()=>this.show(),exit:()=>this.hide(),delay:100,exitDelay:200,$clickTarget:this.$target,canFocusWithin:!0,preventMouseover:()=>P.width<=Qh})}show(){if(go=this,this.addClass("on"),P.width<=Qh){let o=N("#glossary-modal");return o.$(".modal-body").html=this.body(),o.open()}let t=this.$target.bounds,i=this.$popup.width,s=this.$popup.height,n=t.top+t.height+s<P.height-10,r=t.top-s>54;this.setClass("top",r&&!n),this.setClass("left",t.left+i>P.width-15)}hide(){go=void 0,this.removeClass("on")}body(){let t=x2[this.xid];if(!t)return console.warn("missing gloss:",this.xid);let i=t.text;return t.image&&(i+=`<img class="gloss-img" alt="" src="/content/shared/glossary/${t.image}"/>`),t.link&&(location.pathname===t.link.split("#")[0]||(i+=`<p><a href="${t.link}" class="btn btn-white btn-small">Learn more\u2026</a></p>`)),i}};vo=R([L("x-gloss",{template:Yh})],vo);var Jh=class extends vo{body(){let t=b2[this.xid];if(!t)return console.warn("missing bio:",this.xid);let i=`<img class="bio-img" alt="" src="/content/shared/bios/${this.xid}.jpg"/>`,s=t.born?`<p><a href="/timeline/${this.xid}" class="btn btn-white btn-small" target="_blank">Timeline</a></p>`:"";return(t.image===!1?"":i)+t.bio+s}};Jh=R([L("x-bio",{template:Yh})],Jh);var uf='<div class="wrap"><img alt=""><div class="credit"></div><button class="zoom"><x-icon name="fullscreen" size="24"></x-icon></button><slot></slot></div>';var $2=document.createElement("a").relList.supports("ar"),wo=!1,tl={x:0,y:0,s:1},df,ms=S("div",{class:"lightbox-overlay"},Y),wi=S("div",{class:"lightbox-img"},ms);function M2(e,t,i){wo=!0,df=e,ms.show(),wi.show();let s=e.bounds,n=wi.bounds,r=s.left+s.width/2-n.left-n.width/2,o=s.top+s.height/2-n.top-n.height/2,a=Math.max(s.width/n.width,s.height/n.height);tl={x:r,y:o,s:a},wi.css("background-image",`url(${i}), url(${t})`),wi.css("transform",`translate(${r}px, ${o}px) scale(${a})`),P.redraw(),wi.addClass("transitions"),P.redraw(),e.css("visibility","hidden"),ms.addClass("on"),wi.css("transform","scale(1) translate(0,0)")}function pf(){!wo||(wo=!1,ms.removeClass("on"),wi.setTransform(tl,0,tl.s),setTimeout(()=>{df.css("visibility","visible"),ms.css("display","none"),wi.css("transform","none"),wi.removeClass("transitions")},400))}ms.on("click touchmove",pf);P.onKey("escape",pf);ms.on("scrollwheel touchmove",e=>{e.preventDefault(),e.stopPropagation()});P.onKey("space up down left right pagedown pageup",e=>{wo&&(e.preventDefault(),e.stopPropagation())});var el=class extends I{ready(){let t=this.attr("src"),i=this.$(".wrap"),s=this.attr("width"),n=this.attr("height");this.css("width",s+"px"),i.css("padding-bottom",+n/+s*100+"%");let r=i.$("img");r.setAttr("src",t),r.setAttr("alt",this.attr("alt")||""),r.setAttr("width",s),r.setAttr("height",n),t.endsWith(".gif")&&r.on("click",()=>r.setAttr("src",t));let o=i.$(".credit"),a=this.attr("credit");a?o.text=a:o.remove();let h=i.$(".zoom");if(this.hasAttr("lightbox")){this.addClass("interactive");let l=t.replace(/\.(?=[^.]*$)/,"-large.");this.on("click",()=>M2(this,t,l))}else h.remove();if($2&&this.hasAttr("ar")){let l=S("a",{href:this.attr("ar"),rel:"ar"});i.prepend(l),l.append(r)}}};el=R([L("x-img",{template:uf})],el);var il=class extends I{constructor(){super(...arguments);this.correctCount=0;this.solvedCount=0;this.isSolved=!1}setup(t,i,s){var a;let n=this.children,r=n.map(()=>!1);for(let[h,l]of n.entries()){let c=l.data.error,p=c?"incorrect":"correct";c||(this.correctCount+=1),l.one("click",()=>{r[h]||this.isSolved||(t.addHint(c||"correct",{class:p}),l.addClass(p),c||(this.solvedCount+=1,t.score("picker-"+h),this.checkSolved()))})}let o=((a=s==null?void 0:s.scores)==null?void 0:a.filter(h=>h.startsWith("picker-")))||[];for(let h of o){let l=+h.slice(7);r[l]=!0,n[l].addClass("correct")}this.solvedCount=o.length,this.checkSolved()}checkSolved(){this.solvedCount<this.correctCount||(this.addClass("solved"),this.isSolved=!0)}};il=R([L("x-picker")],il);var ff='<button class="play" aria-label="Play Slider"><x-icon name="play" size="32"></x-icon></button><div class="bar"><div class="knob"></div></div>';var sl=class extends I{constructor(){super(...arguments);this.current=0}ready(){this.onAttr("steps",o=>this.steps=+o),this.speed=+this.attr("speed")||1;let t=this.$(".bar"),i=this.$(".knob"),s=this.$(".play");this.hasAttr("no-play")?s.remove():s.on("click",()=>this.play());let n=this.hasAttr("continuous"),r=this.hasAttr("snap")?t.width/this.steps:.001;this.drag=new us(i,{moveY:!1,snap:r}),this.drag.on("start",()=>{this.animation&&this.animation.cancel(),this.animation=void 0}),this.drag.on("move",({posn:o})=>{let a=o.x/this.drag.bounds.dx*this.steps;n||(a=Math.round(a)),!B(a,this.current)&&(this.current=a,this.trigger("move",a))}),this.drag.on("end",()=>this.trigger("slide-end"))}setup(t,i){this.bindModel(t.model),this.one("slide-end",()=>t.score(i))}set(t){B(t,this.current)||this.drag.setPosition(t*this.drag.bounds.dx/this.steps,0)}play(){return E(this,null,function*(){this.current>=this.steps&&this.set(0);let t=(1-this.current/this.steps)*3e3/this.speed;this.moveTo(this.steps,t)})}moveTo(t,i=600){return E(this,null,function*(){if(this.animation||t===this.current)return;let s=this.current;this.animation=re(n=>{this.set(s+(t-s)*mi("quad",n))},i),yield this.animation.promise,this.animation=void 0,this.trigger("slide-end")})}bindVariable(t,i){t[i]=0,this.on("move",s=>t[i]=s),t.watch(()=>this.set(t[i]))}};sl=R([L("x-slider",{template:ff})],sl);var mf='<slot name="stage"></slot><div class="nav"><button class="btn back disabled" aria-label="Previous Step"><x-icon name="left" size="24"></x-icon></button><button class="btn next" aria-label="Next Step"><x-icon name="right" size="24"></x-icon></button><div class="dots"></div></div><div class="legend-box"><slot></slot></div>';function S2(e){let t=e.$$("x-blank, x-blank-mc");if(!t.length)return Promise.resolve();let i=0;return new Promise(s=>{for(let n of t)n.on("solve",()=>{i+=1,i>=t.length&&s()})})}var nl=class extends I{constructor(){super(...arguments);this.length=0;this.current=0;this.locked=!1}ready(){this.$legend=this.$(".legend-box"),this.$steps=this.$legend.children,this.$back=this.$(".back"),this.$next=this.$(".next");let t=this.$(".dots");this.$dots=this.$steps.map(()=>S("div",{class:"dot"},t)),this.length=this.$steps.length,this.current=0,this.$back.on("click",()=>this.goBack()),this.$next.on("click",()=>this.goNext()),this.blanks=this.$steps.map(i=>S2(i)),this.reveals=this.$$("[slide]").map(i=>{let s=i.attr("slide").split("-"),n=s.length>1?[+s[0]||0,+s[1]||this.length]:[+s[0],+s[0]],r=[i.data.animation||"fade",+i.data.duration||400];return i.data.display="visibility",n[0]>=0&&!i.hasClass("reveal")&&i.hide(),[i,n,r]}),this.autoAdvance=this.attr("step")==="auto",this.$steps[0].show(),this.$dots[0].addClass("on"),this.setupSlide(0)}setup(t,i,s){var r;let n=(r=s==null?void 0:s.scores)==null?void 0:r.filter(o=>o.startsWith("slide-")).length;if(n&&n<this.$steps.length-1){this.go(n);for(let o=1;o<=n;++o)this.trigger("next",o)}this.on("next",o=>t.score("slide-"+(o-1)))}go(t){if(this.locked||t<0||t>this.length-1||t===this.current)return;this.locked=!0,setTimeout(()=>this.locked=!1,600),this.$back.setClass("disabled",t===0),this.$next.setClass("disabled",t===this.length-1),this.$dots[this.current].removeClass("on"),this.$dots[t].addClass("on"),this.$steps[t].show();let i=this.$steps[t].height+"px";this.$steps[t].hide(),this.$steps[this.current].exit("fade",300).promise.then(()=>this.$steps[t].enter("fade",300)),this.$legend.animate({height:i},600).promise.then(()=>this.$legend.css("height","auto")),this.setupSlide(t),this.current=t,this.trigger("step",t)}setupSlide(t){this.$next.setAttr("disabled","true"),this.blanks[t].then(()=>this.$next.removeAttr("disabled"));for(let[i,s,n]of this.reveals){if(i.hasClass("reveal"))continue;let r=i.css("visibility")!=="hidden",o=t>=s[0]&&t<=s[1];o&&!r&&i.enter(...n,300),!o&&r&&i.exit(...n)}}goNext(){this.locked||(this.go(this.current+1),this.trigger("next",this.current))}goBack(){this.locked||(this.go(this.current-1),this.trigger("back",this.current))}};nl=R([L("x-slideshow",{template:mf})],nl);var rl=class extends I{ready(){var v,M;(v=N(".sidebar-toggle"))==null||v.on("click",()=>this.addClass("open")),(M=N(".sidebar-shadow"))==null||M.on("pointerdown",()=>this.removeClass("open"));let t=N("#feedback form"),i=N("#feedback button"),s=N("#feedback .error"),n=N("#feedback-success"),r=N('#feedback textarea[name="message"]'),o=N("x-course").id;t==null||t.on("submit",f=>{f.preventDefault(),i.setAttr("disabled","true"),s.hide(),fi(`/course/${o}/feedback`,t.formData).then(()=>{n.open(),r.value=""}).catch(()=>s.show()).then(()=>i.removeAttr("disabled"))});let a=JSON.parse(N("#glossary").text),h=N("#glossary-search"),l=h.$(".gloss-body"),c=h.$(".gloss-list"),p=h.$(".gloss-search input"),m;for(let f of Object.keys(a).sort()){let b=a[f],$=S("div",{class:"gloss-item",html:b.title,tabindex:0},c);$.on("click",()=>{m&&m.removeClass("on"),m=$,$.addClass("on"),l.html=b.text});let w=b.title.toLowerCase();p.change(x=>$.setClass("hidden",!!x&&w.indexOf(x.toLowerCase())<0))}}};rl=R([L("x-course-sidebar")],rl);function ol(e,t){let i=pd(e.map(s=>s.h+10));for(let[s,n]of e.entries())n.drag.bounds=new be(0,0,0,ct(i)),n!==t&&n.drag.setPosition(0,i[s-1]||0)}function P2(e){return e.every((t,i)=>t.index===i)||e.every((t,i)=>t.index===e.length-i-1)}var al=class extends I{ready(){this.items=this.children.map(t=>({drag:new us(t,{moveX:!1,useTransform:!0}),index:+t.data.index,h:0}));for(let t of this.children)t.removeAttr("data-index");for(let t of this.items)t.drag.on("drag",()=>{this.items=Qa(this.items,i=>i.drag.position.y-(i===t?10:0)),ol(this.items,t)}),t.drag.on("end",()=>{ol(this.items),P2(this.items)&&this.solve()});P.onResize(()=>{for(let i of this.items)i.h=i.drag.$el.height;let t=kt(this.items.map(i=>i.h));this.css("height",t+this.items.length*10-10+"px"),ol(this.items)})}setup(t,i,s){var n;((n=s==null?void 0:s.scores)==null?void 0:n.includes(i))&&this.solve(),this.one("solve",()=>{t.addHint("correct"),t.score(i)})}solve(){this.trigger("solve"),this.addClass("solved");for(let t of this.items)t.drag.disabled=!0}};al=R([L("x-sortable")],al);function gf(e,t=!1){return E(this,null,function*(){if(e.css("visibility")==="visible")return;e.data.display="visibility";let i=+e.data.duration||400,s=(t?0:600)+(+e.data.delay||0);yield e.enter(e.data.animation||"fade",i,s).promise,e.css({opacity:"",transform:""}),e.trigger("reveal"),e.removeClass("reveal")})}var hl=class extends I{constructor(){super(...arguments);this.model=as({});this.isShown=!1;this.isCompleted=!1;this.scores=new Set}ready(){var i,s,n,r;this.$course=this.parents("x-course")[0],this.$blanks=this.$$("x-blank, x-blank-mc"),this.$components=this.$$("[goal]"),this.userData=(n=(s=(i=this.$course)==null?void 0:i.userData)==null?void 0:s.steps)==null?void 0:n[this.id],this.goals=et(this.attr("goals")),this.$reveals=this.$$(".reveal");let t=this.$$(".check[data-when]");for(let o of[...this.$reveals,...t])this.onScore(o.data.when,()=>gf(o));this.$nextBtn=this.$$(".next-step");for(let[o,a]of this.$nextBtn.entries())this.onScore("next-"+o,()=>a.exit("pop")),a.one("click",()=>this.score("next-"+o));for(let o of this.$$(".step-target"))o.tagName!=="X-TARGET"&&Qs(o,{enter:()=>{let a=this.$$('[target~="'+o.data.to+'"]');for(let h of a)h.addClass("focus");this.addClass("focus"),this.trigger("target-focus",{$targets:a})},exit:()=>{for(let a of this.$$(".focus"))a.removeClass("focus");this.removeClass("focus")}});for(let o of this.$$(".var, .var-action"))o.bindModel(this.model);((r=this.$course)==null?void 0:r.audio)&&(this.narration=new Th(this.$course.audio,this))}show(){var s,n,r;if(this.isShown)return;this.isShown=!0,(s=StepFunctions==null?void 0:StepFunctions[Fr(this.id)])==null||s.call(StepFunctions,this);for(let o of this.$components)o.setup(this,o.attr("goal"),this.userData);let t=((n=this.userData)==null?void 0:n.scores)||[];for(let o of t)this.score(o,!1);let i=this.$$("x-gesture[target]");setTimeout(()=>{if(!this.isReady)for(let o of i)o.start()},2e3),(r=this.$course)==null||r.log("Step","show",this.id),this.trigger("show"),this.addClass("on"),this.narration&&setTimeout(()=>this.narration.play(),400)}complete(){if(!this.isCompleted){this.isShown||this.show(),this.isCompleted=!0;for(let t=0;t<this.$nextBtn.length;++t)this.score("next-"+t);for(let t of this.$reveals)t.parents("svg").length||gf(t,!0);this.trigger("complete")}}get isReady(){return this.goals.every(t=>this.scores.has(t))}get isPageLoaded(){return this.$course?this.$course.isReady:!0}score(t,i=!0){this.scores.has(t)||(this.scores.add(t),this.trigger("score-"+t),this.trigger("score"),this.$course&&(this.$course.trigger("score"),this.$course.saveProgress({steps:{[this.id]:{scores:[t]}}}),this.$course.log("Step","score",this.id+"/"+t)),i&&this.isReady&&this.$course&&this.$course.isReady&&setTimeout(()=>{this.$course.$activeStep===this&&this.$course.nextStep()},1200))}storeData(t,i){var s;(s=this.$course)==null||s.saveProgress({steps:{[this.id]:{data:{[t]:i}}}})}onScore(t,i){let s=et(t);if(s.every(o=>this.scores.has(o)))return i&&i(),Promise.resolve();let n=Li(),r=()=>{!s.every(o=>this.scores.has(o))||(i&&i(),n.resolve(),this.off("score",r))};return this.on("score",r),n.promise}addHint(t,i={}){var s,n,r;return this.trigger("hint",t),((s=this.$course)==null?void 0:s.isReady)?this.isInViewport?(n=this.$course.$tutor)==null?void 0:n.showHint(t,i):(this.one("enterViewport",()=>{var o;return(o=this.$course.$tutor)==null?void 0:o.showHint(t,i)}),{text:((r=this.$course.$tutor)==null?void 0:r.hints[t])||t}):{text:t}}delayedHint(t,i=1e4){let s=setTimeout(t,i);this.on("score",()=>{clearTimeout(s),this.isCompleted||(s=setTimeout(t,i))}),this.on("complete",()=>clearTimeout(s))}get nextStep(){if(!this.$course)return;let t=this.$course.$steps.indexOf(this);return this.$course.$steps[t+1]}groupBlanks(...t){let i=t.map(s=>this.$blanks[s]);for(let s of i)s.linkedBlanks=i}};hl=R([L("x-step")],hl);var C2='<div class="titles"></div><div class="body"><slot></slot></div>',ll=class extends I{constructor(){super(...arguments);this.$titles=[];this.active=0}ready(){let t=this.$(".titles");this.$body=this.$(".body"),this.$tabs=this.$$(".tab");for(let i=0;i<this.$tabs.length;++i){let s=this.$tabs[i].$("h3")||S("h3");s.setAttr("tabindex","0"),t.append(s),this.$titles.push(s),s.on("click",()=>this.makeActive(i))}this.$titles[0].addClass("active"),this.$tabs[0].show()}makeActive(t){if(this.active===t)return;this.$titles[this.active].removeClass("active"),this.$titles[t].addClass("active"),this.$tabs[t].show();let i=this.$tabs[t].outerHeight+"px";this.$tabs[t].hide(),this.$tabs[this.active].exit("fade",300).promise.then(()=>this.$tabs[t].enter("fade",300)),this.$body.animate({height:i},600).promise.then(()=>this.$body.css("height","auto")),this.active=t,this.trigger("change",t)}};ll=R([L("x-tabbox",{template:C2})],ll);var vf='<defs><mask id="masking"><rect width="100%" height="100%" fill="white"></rect></mask></defs><marker id="arrow" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="4" markerHeight="4" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z"></path></marker><rect x="0" y="0" width="100%" height="100%" mask="url(#masking)" opacity="0.8"></rect><path class="target-arrow" stroke-width="5" marker-end="url(#arrow)" opacity="0.4" stroke-linecap="round"></path>';function T2(e,t,i,s){let n=new y(e.left-15,e.top+i-15),r=new ce(n,e.width+30,e.height+30),o=new y(t.left-15,t.top+s-15),a=new ce(o,t.width+30,t.height+30),h=new he(r.center,a.center);return[jt(h,r)[0],jt(h,a)[0]]}function E2(e,t){return Math.abs(e[0]-t[0])+Math.abs(e[1]-t[1])}var wf=Je("header, x-tutor, .sidebar"),on=S("svg",{class:"target-body",html:vf},Y),A2=on.$("mask"),V2=on.$(".target-arrow"),an=!1,yf=[],cl=class extends I{ready(){this.setAttr("tabindex",0);let t=this.attr("to").replace(/_/g," "),i=this.hasClass("no-margins"),s,n,r,o,a=()=>{an=!0;let p=Je(t);if(!p.length)return;let m=p[0].hasParent(...wf);s===void 0&&(s=this.hasParent(...wf));let v=this.bounds,M=p.map(f=>f.bounds).filter(f=>f.width||f.height);if(r=0,!m){let f=Math.min(...M.map(x=>x.top)),b=Math.max(...M.map(x=>x.top+x.height)),$=P.height-12-b,w=56-f;r=$<0?$:w>0?w:0}for(let f of yf)f.remove();yf=[v,...M].map((f,b)=>{let $=!b||i?4:10;return S("rect",{x:f.left-$,y:f.top-$+(b||!s?r:0),width:f.width+2*$,height:f.height+2*$,rx:b?4:18,ry:b?4:18},A2)}),V2.points=T2(v,M[0],s?0:r,m?0:r)},h=()=>{r&&Y.scrollBy(-r,300),on.css("display","block"),P.redraw(),ui(function(){on.css("opacity",1)},r?300:0)},l=p=>{!an||p&&tt(p.type,"mousemove","pointermove")&&E2(n,[p.clientX,p.clientY])<40||(clearTimeout(o),an=!1,on.css("opacity",0),setTimeout(()=>{an||on.css("display","none")},300),Y.off("mousewheel mousemove touchend touchmove",l),this.off("mouseleave blur",l))},c=()=>{r&&!s?Y.on("mousemove",l):this.on("mouseleave",l),Y.on("mousewheel touchend touchmove",l),this.on("blur",l)};this.on("mouseenter touchstart focus",p=>{n=[p.clientX,p.clientY],a(),o=window.setTimeout(h,r?50:30),c()}),this.on("click",p=>{an?(p.handled=!0,l(),setTimeout(()=>N(t).trigger("click mousedown"))):(an=!0,r=0,h(),c())})}};cl=R([L("x-target")],cl);var Q=class extends Error{constructor(e,t){super(t);this.name=e}static undefinedVariable(e){return new Q("EvalError",`Undefined variable \u201C${e}\u201D.`)}static undefinedFunction(e){return new Q("EvalError",`Undefined function \u201C${e}\u201D.`)}static evalLoop(e){return new Q("EvalError",`Loop in nested evaluation \u201C${e}\u201D.`)}static invalidCharacter(e){return new Q("SyntaxError",`Unknown symbol \u201C${e}\u201D.`)}static conflictingBrackets(e){return new Q("SyntaxError",`Conflicting brackets \u201C${e}\u201D.`)}static unclosedBracket(e){return new Q("SyntaxError",`Unclosed bracket \u201C${e}\u201D.`)}static startOperator(e){return new Q("SyntaxError",`A term cannot start with a \u201C${e}\u201D.`)}static endOperator(e){return new Q("SyntaxError",`A term cannot end with a \u201C${e}\u201D.`)}static consecutiveOperators(e,t){return new Q("SyntaxError",`A \u201C${e}\u201D cannot be followed by a \u201C${t}\u201D.`)}static invalidExpression(){return new Q("SyntaxError","This expression is invalid.")}},ul={pi:Math.PI,\u03C0:Math.PI,e:Math.E},dl={"(":")","[":"]","{":"}"},hn={"*":"\xB7","**":"\u2217","//":"//","+-":"\xB1","\u2013":"\u2212","-":"\u2212",xx:"\xD7",sum:"\u2211",prod:"\u220F",int:"\u222B",del:"\u2202",grad:"\u2207",aleph:"\u2135",not:"\xAC",AA:"\u2200",EE:"\u2203","'":"\u2019","!=":"\u2260","<=":"\u2264",">=":"\u2265",in:"\u2208","!in":"\u2209","==":"\u2261","~=":"\u2245","~~":"\u2248",sub:"\u2282",sube:"\u2286",prop:"\u221D",oo:"\u221E",cap:"\u2229",cup:"\u222A","<-":"\u2190","->":"\u2192","=>":"\u21D2","<=>":"\u21D4","|->":"\u21A6",uarr:"\u2191",darr:"\u2193",lArr:"\u21D0"},tr={Gamma:"\u0393",Delta:"\u0394",Theta:"\u0398",Lambda:"\u039B",Xi:"\u039E",Pi:"\u03A0",Sigma:"\u03A3",Phi:"\u03A6",Psi:"\u03A8",Omega:"\u03A9",alpha:"\u03B1",beta:"\u03B2",gamma:"\u03B3",delta:"\u03B4",epsilon:"\u025B",zeta:"\u03B6",eta:"\u03B7",theta:"\u03B8",iota:"\u03B9",kappa:"\u03BA",lambda:"\u03BB",mu:"\u03BC",nu:"\u03BD",xi:"\u03BE",pi:"\u03C0",rho:"\u03C1",sigma:"\u03C3",tau:"\u03C4",upsilon:"\u03C5",phi:"\u03C6",chi:"\u03C7",psi:"\u03C8",omega:"\u03C9",CC:"\u2102",NN:"\u2115",QQ:"\u211A",RR:"\u211D",ZZ:"\u2124"},xf="abcdefghijklmnopqrstuvwxyz",k2=xf.split(""),L2=xf.toUpperCase().split(""),O2=Object.values(tr),I2=[...k2,...L2,...O2,"$"],R2="|()[]{}\xF7,!<>=*/+-\u2013\u2212~^_\u2026\xB0\u2022\u2225\u22A5'\u2220:%\u223C\u25B3",_2=Object.values(hn),N2=[...R2,..._2],D2={_:"sub","^":"sup","//":"/","\xF7":"/"},bf={"<":"&lt;",">":"&gt;"};function $f(e){return e in bf?bf[e]:e}var G2=["abs","round","floor","ceil","max","min","mod","lcm","gcd","gcf","log","exp","ln","sqrt","root","sin","cos","tan","sec","csc","cot","cosec","cotan","arcsin","arccos","arctan","sinh","cosh","tanh","sech","csch","coth","cosech"];function er(e){return G2.includes(e)}var ln={"+":"plus","\u2212":"minus","\xB7":"times","\xD7":"times","/":"over","//":"divided by","%":"percent","!":"factorial","\xB1":"plus-minus","=":"equals","\u2260":"does not equal","<":"is less than",">":"is greater than","\u2264":"is less than or equal to","\u2265":"is greater than or equal to",\u03C0:"pi","\u2245":"is congruent to","\u2225":"is parallel to","\u22A5":"is perpendicular to"};for(let e of Object.keys(tr))ln[tr[e]]=e;var Mf=e=>typeof e=="number"?e:e[0],Sf=e=>typeof e=="number"?[e,e]:e,Di=class{evaluate(e={},t){return NaN}interval(e={},t){return Sf(this.evaluate(e))}substitute(e={}){return this}recursiveSubstitute(e){let t=Object.keys(e);return this.unknowns.filter(i=>t.includes(i)).length?this.substitute(e).recursiveSubstitute(e):this}get simplified(){return this}get unknowns(){return this.variables.filter(e=>!Object.prototype.hasOwnProperty.call(ul,e))}get variables(){return[]}get functions(){return[]}collapse(){return this}toString(){return""}toVoice(e={}){return""}toMathML(e={}){return""}},pl=new Set;function fl(e,t,i=!1){var s;let n=(s=t[e])!=null?s:ul[e];if(n===void 0)throw Q.undefinedVariable(e);if(typeof n=="string"||n instanceof Di){if(i||pl.clear(),pl.has(e))throw Q.evalLoop(e);return pl.add(e),typeof n=="string"&&(n=pe.parse(n)),n.evaluate(t,!0)}else return typeof n=="function"?n():n}var yo=class extends Di{constructor(e){super();this.n=e}evaluate(){return this.n}toString(){return`${this.n}`}toVoice(){return`${this.n}`}toMathML(){return`<mn>${this.n}</mn>`}},ml=class extends Di{constructor(e){super();this.i=e}evaluate(e={},t){return Mf(fl(this.i,e,t))}interval(e={},t){return Sf(fl(this.i,e,t))}toMathML(){return`<mi${er(this.i)?' mathvariant="normal"':""}>${this.i}</mi>`}substitute(e={}){return e[this.i]||this}get variables(){return[this.i]}toString(){return this.i}toVoice(){return this.i in ln?ln[this.i]:this.i.length===1?`_${this.i}_`:this.i}},q2=class extends Di{constructor(e){super();this.s=e}evaluate(e={},t){return Mf(fl(this.s,e,t))}toString(){return`"${this.s}"`}toVoice(){return this.s}toMathML(){return`<mtext>${this.s}</mtext>`}},Pf=class extends Di{toString(){return" "}toMathML(){return"<mspace></mspace>"}},yi=class extends Di{constructor(e){super();this.o=e}toString(){return this.o.replace("//","/")}toVoice(){return ln[this.o]||this.o}get functions(){return[this.o]}toMathML(){let e=$f(this.toString());return`<mo value="${e}">${e}</mo>`}},Cf=[-Infinity,Infinity],cn=[NaN,NaN],gs=Math.PI/2,gl=Math.PI*2,pt=(e,t)=>[e-Number.EPSILON,t+Number.EPSILON],vs=(...e)=>pt(Math.min(...e),Math.max(...e)),B2=e=>Math.abs(e[1]-e[0]),un=e=>isNaN(e[0])||isNaN(e[1]),Tf=e=>!isFinite(e[0])&&e[0]===e[1],H2=(e,t)=>Ut(t,e[0]-Number.EPSILON,e[1]+Number.EPSILON),xo=e=>H2(e,0),xi={add:(...e)=>e.reduce((t,i)=>t+i,0),sub:(...e)=>e.length>1?e[0]-e[1]:-e[0],mul:(...e)=>e.reduce((t,i)=>t*i,1),div:(e,t)=>e/t,abs:e=>Math.abs(e),round:e=>Math.round(e),floor:e=>Math.floor(e),ceil:e=>Math.ceil(e),max:(...e)=>Math.max(...e),min:(...e)=>Math.min(...e),mod:(e,t)=>e%t,lcm:(...e)=>Hn(...e),gcd:(...e)=>ns(...e),gcf:(...e)=>ns(...e),sup:(e,t)=>Math.pow(e,t),log:(e,t)=>Math.log(e)/(t===void 0?1:Math.log(t)),exp:e=>Math.exp(e),ln:e=>Math.log(e),sqrt:e=>Math.sqrt(e),root:(e,t)=>Math.pow(e,1/t),sin:e=>Math.sin(e),cos:e=>Math.cos(e),tan:e=>Math.tan(e),sec:e=>1/Math.cos(e),csc:e=>1/Math.sin(e),cot:e=>1/Math.tan(e),cosec:e=>xi.csc(e),cotan:e=>xi.cot(e),arcsin:e=>Math.asin(e),arccos:e=>Math.acos(e),arctan:e=>Math.atan(e),sinh:e=>Math.sinh(e),cosh:e=>Math.cosh(e),tanh:e=>Math.tanh(e),sech:e=>1/Math.cosh(e),csch:e=>1/Math.sinh(e),coth:e=>1/Math.tanh(e),cosech:e=>xi.csch(e)};function bo(e,t){if(e[0]>0)return t[0]>=0?pt(e[0]**t[0],e[1]**t[1]):vs(e[0]**t[0],e[0]**t[1],e[1]**t[0],e[1]**t[1]);let i=t[0];return Number.isInteger(i)&&i===t[1]?i===0?[xo(e)?0:1,1]:i%2?pt(e[0]**i,e[1]**i):xo(e)?[0,Math.max(e[0]**i,e[1]**i)]:vs(e[1]**i,e[0]**i):cn}function Ef(e,t=gl){let i=Math.floor(e[0]/t)*t;return[e[0]-i,e[1]-i]}var K={add:(...e)=>pt(kt(e.map(t=>t[0])),kt(e.map(t=>t[1]))),sub:(e,t)=>t!==void 0?pt(e[0]-t[1],e[1]-t[0]):pt(-e[1],-e[0]),mul:(e,...t)=>(t.length>1&&(t=[K.mul(...t)]),vs(e[0]*t[0][0],e[0]*t[0][1],e[1]*t[0][0],e[1]*t[0][1])),div:(e,t)=>xo(t)?Cf:vs(e[0]/t[0],e[0]/t[1],e[1]/t[0],e[1]/t[1]),abs:e=>xo(e)?pt(0,Math.max(-e[0],e[1])):vs(Math.abs(e[0]),Math.abs(e[1])),round:e=>pt(Math.round(e[0]),Math.round(e[1])),floor:e=>pt(Math.floor(e[0]),Math.floor(e[1])),ceil:e=>pt(Math.ceil(e[0]),Math.ceil(e[1])),max:(...e)=>pt(Math.max(...e.map(t=>t[0])),Math.max(...e.map(t=>t[1]))),min:(...e)=>pt(Math.min(...e.map(t=>t[0])),Math.min(...e.map(t=>t[1]))),mod:(e,t)=>{if(un(e)||un(t))return cn;let i=e[0]/(e[0]<0?t[0]:t[1]);return i=i<0?Math.ceil(i):Math.floor(i),K.sub(e,K.mul(t,[i,i]))},lcm:(...e)=>vs(Hn(...e.map(t=>t[0]))),gcd:(...e)=>vs(ns(...e.map(t=>t[0]))),gcf:(...e)=>K.gcd(...e),sup:(e,t)=>bo(e,t),log:(e,t)=>(t!==void 0&&K.div(K.log(e),K.log(t)),pt(e[0]<=0?-Infinity:Math.log(e[0]),Math.log(e[1]))),exp:e=>bo([Math.E,Math.E],e),ln:e=>K.log(e),sqrt:e=>bo(e,[.5,.5]),root:(e,t)=>bo(e,K.div([1,1],t)),sin:e=>K.cos(K.sub(e,[gs,gs])),cos:e=>un(e)||Tf(e)?cn:B2(e)>=gl-Number.EPSILON?[-1,1]:(e=Ef(e),e[0]>=Math.PI?K.sub(K.cos(K.sub(e,[Math.PI,Math.PI]))):e[1]<=Math.PI?pt(Math.cos(e[1]),Math.cos(e[0])):e[1]<=gl?pt(-1,Math.max(Math.cos(e[1]),Math.cos(e[0]))):pt(-1,1)),tan:e=>un(e)||Tf(e)?cn:(e=Ef(e,Math.PI),e[0]>=gs&&(e=K.sub(e,[Math.PI,Math.PI])),e[0]<=-gs||e[1]>=gs?Cf:pt(Math.tan(e[0]),Math.tan(e[1]))),sec:e=>K.div([1,1],K.cos(e)),csc:e=>K.div([1,1],K.sin(e)),cot:e=>K.div([1,1],K.tan(e)),cosec:e=>K.csc(e),cotan:e=>K.cot(e),arcsin:e=>un(e)||e[1]<-1||e[0]>1?cn:pt(e[0]<=-1?-gs:Math.asin(e[0]),e[1]>=1?gs:Math.asin(e[1])),arccos:e=>un(e)||e[1]<-1||e[0]>1?cn:pt(e[1]>=1?0:Math.acos(e[1]),e[0]<=-1?Math.PI:Math.acos(e[0])),arctan:e=>pt(Math.atan(e[0]),Math.atan(e[1])),sinh:e=>pt(Math.sinh(e[0]),Math.sinh(e[1])),cosh:e=>e[1]<0?pt(Math.cosh(e[1]),Math.cosh(e[0])):e[0]>0?pt(Math.cosh(e[0]),Math.cosh(e[1])):pt(1,Math.cosh(Math.max(-e[0],e[1]))),tanh:e=>pt(Math.tanh(e[0]),Math.tanh(e[1])),sech:e=>K.div([1,1],K.cosh(e)),csch:e=>K.div([1,1],K.sinh(e)),coth:e=>K.div([1,1],K.tanh(e)),cosech:e=>K.csch(e)},$o=et("+ \u2212 * \xD7 \xB7 / \xF7 // sup sub subsup"),Af=et("sub sup subsup"),vl='<mo value="," lspace="0">,</mo>';function Vf(e,t){return $o.includes(t)?e instanceof Mo?!0:!(e instanceof Se)||!$o.includes(e.fn)?!1:Af.includes(e.fn)&&Af.includes(t)?!0:$o.indexOf(t)>$o.indexOf(e.fn):!1}function z2(e,t,i){return Vf(e,t)?`<mfenced>${i}</mfenced>`:i}function Gi(e,t){return e instanceof Mo||e instanceof Se?`<mrow>${t}</mrow>`:t}function kf(e){return e==="2"?"squared":e==="3"?"cubed":`to the power of ${e}`}var Se=class extends Di{constructor(e,t=[]){super();this.fn=e,this.args=t}evaluate(e={}){let t=this.args.map(i=>i.evaluate(e));if(this.fn in e)return e[this.fn](...t);if(this.fn==="+")return xi.add(...t);if(this.fn==="\u2212")return xi.sub(...t);if(["*","\xB7","\xD7"].includes(this.fn))return xi.mul(...t);if(this.fn==="/")return xi.div(...t);if(this.fn==="sup")return xi.sup(...t);if(er(this.fn))return xi[this.fn](...t);if(this.fn==="(")return t[0];throw Q.undefinedFunction(this.fn)}interval(e={}){if(this.fn in e)return di(this.evaluate(e),2);let t=this.args.map(i=>i.interval(e));if(this.fn==="+")return K.add(...t);if(this.fn==="\u2212")return K.sub(...t);if(["*","\xB7","\xD7"].includes(this.fn))return K.mul(...t);if(this.fn==="/")return K.div(...t);if(this.fn==="sup")return K.sup(...t);if(er(this.fn))return K[this.fn](...t);if(this.fn==="(")return t[0];throw Q.undefinedFunction(this.fn)}substitute(e={}){return new Se(this.fn,this.args.map(t=>t.substitute(e)))}collapse(){return this.fn==="("?this.args[0].collapse():new Se(this.fn,this.args.map(e=>e.collapse()))}get simplified(){return this}get variables(){return Ke(Ii(this.args.map(e=>e.variables)))}get functions(){return Ke([this.fn,...Ii(this.args.map(e=>e.functions))])}toString(){let e=this.args.map(t=>Vf(t,this.fn)?`(${t.toString()})`:t.toString());return this.fn==="\u2212"?e.length>1?e.join(" \u2212 "):`\u2212${e[0]}`:this.fn==="sup"?e.join("^"):this.fn==="sub"?e.join("_"):this.fn==="subsup"?`${e[0]}_${e[1]}^${e[2]}`:et("+ * \xD7 \xB7 / = < > \u2264 \u2265 \u2248").includes(this.fn)?e.join(` ${this.fn} `):tt(this.fn,"(","[","{")?this.fn+this.args.join(", ")+dl[this.fn]:tt(this.fn,"!","%")?e[0]+this.fn:`${this.fn}(${e.join(", ")})`}toMathML(e={}){let t=this.args.map(n=>n.toMathML(e)),i=this.args.map((n,r)=>z2(n,this.fn,t[r]));if(this.fn in e){let n=t.map((r,o)=>({toString:()=>r,val:this.args[o]}));return e[this.fn](...n)}if(this.fn==="\u2212")return i.length>1?i.join('<mo value="\u2212">\u2212</mo>'):`<mo rspace="0" value="\u2212">\u2212</mo>${i[0]}`;if(tt(this.fn,"+","=","<",">","\u2264","\u2265","\u2248")){let n=$f(this.fn);return i.join(`<mo value="${n}">${n}</mo>`)}if(tt(this.fn,"*","\xD7","\xB7")){let n=i[0];for(let r=1;r<i.length-1;++r)n+=(this.args[0]instanceof yo&&this.args[1]instanceof yo?'<mo value="\xD7">\xD7</mo>':"")+i[1];return n}if(this.fn==="//")return i.join('<mo value="/">/</mo>');if(this.fn==="sqrt")return`<msqrt>${i[0]}</msqrt>`;if(tt(this.fn,"/","root")){let n=this.fn==="/"?"mfrac":"mroot",r=this.args.map((o,a)=>Gi(o,t[a]));return`<${n}>${r.join("")}</${n}>`}if(tt(this.fn,"sup","sub")){let n=[Gi(this.args[0],i[0]),Gi(this.args[1],t[1])];return`<m${this.fn}>${n.join("")}</m${this.fn}>`}return this.fn==="subsup"?`<msubsup>${[Gi(this.args[0],i[0]),Gi(this.args[1],t[1]),Gi(this.args[2],t[2])].join("")}</msubsup>`:tt(this.fn,"(","[","{")?`<mfenced open="${this.fn}" close="${dl[this.fn]}">${i.join(vl)}</mfenced>`:tt(this.fn,"!","%")?`${i[0]}<mo value="${this.fn}" lspace="0">${this.fn}</mo>`:this.fn==="abs"?`<mfenced open="|" close="|">${i.join(vl)}</mfenced>`:this.fn==="bar"?`<mover>${Gi(this.args[0],i[0])}<mo value="\u203E">\u203E</mo></mover>`:this.fn==="vec"?`<mover>${Gi(this.args[0],i[0])}<mo value="\u2192">\u2192</mo></mover>`:`<mi${er(this.fn)?' mathvariant="normal"':""}>${this.fn}</mi><mfenced>${i.join(vl)}</mfenced>`}toVoice(e={}){let t=this.args.map(s=>s.toVoice(e)),i=t.join(" ");if(this.fn in e){let s=t.map((n,r)=>({toString:()=>n,val:this.args[r]}));return e[this.fn](...s)}return tt(this.fn,"(","[","{")?i:this.fn==="sqrt"?`square root of ${i}`:this.fn==="%"?`${i} percent`:this.fn==="!"?`${i} factorial`:this.fn==="/"?`${t[0]} over ${t[1]}`:this.fn==="//"?`${t[0]} divided by ${t[1]}`:this.fn==="sub"?i:this.fn==="subsup"?`${t[0]} ${t[1]} ${kf(t[2])}`:this.fn==="sup"?`${t[0]} ${kf(t[1])}`:ln[this.fn]?t.join(` ${ln[this.fn]} `):er(this.fn)?`${this.fn} ${i}`:`${this.fn} of ${i}`}},Mo=class extends Di{constructor(e){super();this.items=e}evaluate(e={}){return this.collapse().evaluate(e)}interval(e={}){return this.collapse().interval(e)}substitute(e={}){return this.collapse().substitute(e)}get simplified(){return this.collapse().simplified}get variables(){return Ke(fd(...this.items.map(e=>e.variables)))}get functions(){return this.collapse().functions}toString(){return this.items.map(e=>e.toString()).join(" ")}toMathML(e={}){return this.items.map(t=>t.toMathML(e)).join("")}toVoice(e={}){return this.items.map(t=>t.toVoice(e)).join(" ")}collapse(){return wl(this.items).collapse()}},Lf;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SPACE=1]="SPACE",e[e.STR=2]="STR",e[e.NUM=3]="NUM",e[e.VAR=4]="VAR",e[e.OP=5]="OP"})(Lf||(Lf={}));function yl(e,t){if(t===2)return new q2(e);if(!(!e||!t)){if(t===1&&e.length>1)return new Pf;if(t===3){if(isNaN(+e))throw Q.invalidExpression();return new yo(+e)}if(t===4)return e in tr?new ml(tr[e]):e in hn?new yi(hn[e]):new ml(e);if(t===5)return e in hn?new yi(hn[e]):new yi(e)}}function F2(e){let t=[],i="",s=0;for(let r of e){if(r==='"'){let a=s===2?0:2,h=yl(i,s);h&&t.push(h),i="",s=a;continue}else if(s===2){i+=r;continue}let o=r.match(/[0-9.]/)?3:I2.includes(r)?4:N2.includes(r)?5:r.match(/\s/)?1:0;if(!o)throw Q.invalidCharacter(r);if(!s||s===3&&o!==3||s===4&&o!==4&&o!==3||s===5&&!(i+r in hn)||s===1&&o!==1){let a=yl(i,s);a&&t.push(a),i="",s=o}i+=r}let n=yl(i,s);return n&&t.push(n),t}function U2(e){return e.length>1?new Mo(e):e[0]instanceof yi?new Mo(e):e[0]}function j2(e,t){let i=[[]];for(let s of e)t(s)?i.push([]):ct(i).push(s);return i}function Wt(e,t){return e instanceof yi&&et(t).includes(e.o)}function ir(e){return e instanceof Se&&e.fn==="("?e.args[0]:e}function So(e,t){if(Wt(e[0],t))throw Q.startOperator(e[0]);if(Wt(ct(e),t))throw Q.endOperator(ct(e));for(let i=1;i<e.length-1;++i){if(!Wt(e[i],t))continue;let s=e[i],n=e[i-1],r=e[i+1];if(n instanceof yi)throw Q.consecutiveOperators(n.o,s.o);if(r instanceof yi)throw Q.consecutiveOperators(s.o,r.o);let o=e[i+2];if(t==="^ _"&&Wt(s,"_ ^")&&Wt(o,"_ ^")&&s.o!==o.o){let a=e[i+3];if(a instanceof yi)throw Q.consecutiveOperators(o.o,a.o);let h=[ir(n),ir(r),ir(a)];s.o==="^"&&([h[1],h[2]]=[h[2],h[1]]),e.splice(i-1,5,new Se("subsup",h)),i-=4}else{let a=D2[s.o]||s.o,h=[ir(n),ir(r)];e.splice(i-1,3,new Se(a,h)),i-=2}}}function Of(e){return So(e,"^ _"),So(e,"/"),U2(e)}function W2(e,t){let i=[[]],s=["\u03C0",...(t==null?void 0:t.variables)||[]];for(let n of e){let r=ct(i).length?ct(i)[0].o:void 0;if(Wt(n,") ] }")){if(!Wt(n,dl[r]))throw Q.conflictingBrackets(n.o);let o=i.pop(),a=ct(i),h=ct(a),c=Wt(n,")")&&h instanceof ml&&!s.includes(h.i)?a.pop().i:o[0].o,p=j2(o.slice(1),m=>Wt(m,","));a.push(new Se(c,p.map(Of)))}else Wt(n,"( [ {")?i.push([n]):ct(i).push(n)}if(i.length>1)throw Q.unclosedBracket(ct(i)[0].o);return Of(i[0])}function If(e,t,i=!1){let s=[],n=[],r=!1;function o(){if(r)throw Q.invalidExpression();!n.length||(s.push(n.length>1?new Se(t[0],n):n[0]),n=[])}for(let a of e)if(Wt(a,t)){if(r||!n.length)throw Q.invalidExpression();r=!0}else if(a instanceof yi)o(),s.push(a),r=!1;else{let h=!i||a instanceof yo;if(n.length&&!r&&h)throw Q.invalidExpression();n.push(a),r=!1}return o(),s}function wl(e){if(e=e.filter(i=>!(i instanceof Pf)),!e.length)throw Q.invalidExpression();let t=e.findIndex(i=>Wt(i,"= < > \u2264 \u2265"));if(t===0)throw Q.startOperator(e[0]);if(t===e.length-1)throw Q.endOperator(e[0]);if(t>0){let i=wl(e.slice(0,t)),s=wl(e.slice(t+1));return new Se(e[t].o,[i,s])}if(Wt(e[0],"%!"))throw Q.startOperator(e[0]);for(let i=0;i<e.length;++i)!Wt(e[i],"%!")||(e.splice(i-1,2,new Se(e[i].o,[e[i-1]])),i-=1);if(So(e,"// \xF7"),e=If(e,"\xD7 * \xB7",!0),Wt(e[0],"\u2212 \xB1")&&e.splice(0,2,new Se(e[0].o,[e[1]])),So(e,"\u2212 \xB1"),Wt(e[0],"+")&&(e=e.slice(1)),e=If(e,"+"),e.length>1)throw Q.invalidExpression();return e[0]}function Z2(e,t=!1,i){let s=W2(F2(e),i);return t?s.collapse():s}function K2(e,t){try{let i=Ke([...e.variables,...t.variables]),s=e.collapse(),n=t.collapse(),r=0;for(let o=0;o<5;++o){let a={};for(let c of i)a[c]=ul[c]||Math.random()*5;let h=s.evaluate(a),l=n.evaluate(a);if(!(isNaN(h)||isNaN(l))){if(!B(h,l))return!1;r+=1}}return!!r}catch(i){return!1}}var pe={numEquals:K2,parse:ud(Z2)};var Rf='<div class="toasts"><div class="msg-wrap"><button class="msg archie" aria-label="Virtual Tutor"><slot name="icon"></slot></button></div></div><div class="chat" data-display="flex"><div class="chat-header"><slot name="header"></slot><button class="close"><x-icon name="close" size="24"></x-icon></button></div><div class="chat-body"></div><div class="chat-footer"><div class="input" contenteditable></div><button class="hint"><x-icon name="lightbulb" size="24"></x-icon></button></div></div>';var X2=/[0-9+\-*/()^\s]+/g,Y2=es(Jt.shuffle(["happy","spongebob","sloth","party","robot","excited","cute","highfive1","applause","highfive2"])),Q2=es(Jt.shuffle(["minions","panther","dog","snape","what","door","horrible"]));function xl(e,t,i={}){let s=S("div",{class:"msg-wrap","data-display":"flex"}),n=S("div",{class:"msg "+t},s);return i.class&&n.addClass(i.class),i.visible||s.hide(),tt(t,"hint","question")?n.html=e:t==="img"?n.css("background-image",`url(${e})`):t==="video"&&S("iframe",{src:e,allowfullscreen:!0},n),s}var bl=class extends I{constructor(){super(...arguments);this.recentMessages=[];this.isOpen=!1;this.queuePromise=Promise.resolve()}ready(){var n;this.$course=this.parents("x-course")[0],this.hints=this.$course?JSON.parse(this.$course.$("#hints").text):{};let t=window.user;this.correct=es(Jt.shuffle(this.hints.correct||[])),this.incorrect=es(Jt.shuffle(this.hints.incorrect||[])),this.$toasts=this.$(".toasts"),this.$chat=this.$(".chat"),this.$chatBody=this.$(".chat-body"),this.$toasts.on("click",r=>{r.handled||this.open()}),this.$(".close").on("click",()=>this.close());let i=this.$(".chat-footer");if(this.$query=i.$(".input"),this.$query.onKeyDown("enter",r=>{r.preventDefault(),this.askQuestion(this.$query.text.trim()),this.$query.text=""}),this.$query.on("focus",()=>i.addClass("focus")),this.$query.on("blur",()=>i.removeClass("focus")),this.$(".hint").on("click",()=>{this.queue(this.hints.tutorial1),this.queue(t?this.hints.tutorial2:this.hints.account)}),this.$course&&((n=this.$course.userData)==null?void 0:n.messages))for(let r of this.$course.userData.messages)this.$chatBody.append(xl(r.content,r.kind||"hint",{visible:!0}));if(!P.getCookie("sessionWelcome")&&this.$course){P.setCookie("sessionWelcome",1,60*60*4);let r=new Date().getHours(),o=r<12?"Morning":r<18?"Afternoon":"Evening";t?setTimeout(()=>this.showHint(`welcome${o}Named`,{variables:{name:t.shortName}}),3e3):P.getCookie("welcome")?(setTimeout(()=>this.showHint(`welcome${o}`),3e3),setTimeout(()=>this.queue(this.hints.account),4500)):(P.setCookie("welcome",1),setTimeout(()=>this.queue(this.hints.welcome),3e3),setTimeout(()=>this.queue(this.hints.tutorial1),4500))}}open(){this.isOpen||(this.isOpen=!0,this.$chat.enter("slide-up",200),this.$chatBody.scrollTop=this.$chatBody.scrollHeight,this.trigger("open"))}close(){!this.isOpen||(this.isOpen=!1,this.$query.blur(),this.trigger("close"),this.$chat.exit("slide-down",200))}queue(t,i="hint",s={}){this.queuePromise=this.queuePromise.then(()=>(this.display(t,i,s),Bn(500)))}display(t,i="hint",s={}){let n=s.timeout||8e3;if(P.width<640&&(n*=.7),(s.toast==null?!0:s.toast)&&!this.isOpen){let a=xl(t,i,s);a.setAttr("role","alert"),this.$toasts.append(a),a.enter("reveal-right"),setTimeout(()=>a.exit("reveal-right",400,0,!0),n),this.on("open",()=>a.exit("reveal",200,0,!0))}let o=xl(t,i,{class:s.class,visible:!this.isOpen});this.$chatBody.append(o),this.isOpen&&(o.enter("reveal",300),re(()=>this.$chatBody.scrollTop=this.$chatBody.scrollHeight,200))}showHint(t,i={}){if(tt(t,"correct","incorrect")){let n=t==="correct"?this.correct():this.incorrect(),r=t==="correct"?3e3:5e3;if(this.queue(n,"hint",{class:i.class||t,timeout:r}),Math.random()<.2){let o=t==="correct"?Y2():Q2(),a="";this.queue(`${a}/images/gifs/${o}.gif`,"img",{timeout:r})}return{text:n}}let s=this.hints[t]||t;if(i.variables)for(let[n,r]of Object.entries(i.variables))s=s.replace(new RegExp("\\$"+n,"g"),r);return!i.force&&this.recentMessages.includes(t)?{text:s}:(this.recentMessages.push(t),setTimeout(()=>this.recentMessages.shift(),1e4),i.store!==!1&&this.$course&&this.$course.saveProgress({hints:[{content:s,kind:"hint"}]}),this.queue(s,"hint",{class:i.class}),{text:s})}askQuestion(t){if(!t)return;this.queue(t,"question"),this.$course&&this.$course.log("Tutor","ask",t);let i=(t.match(X2)||[]).filter(s=>s.length>=3&&!s.match(/^[\s0-9]+$/));if(i.length)try{let s=pe.parse(i[0],!0),n=pe.parse("="+s.evaluate());return this.queue(`<span class="math">${s.toMathML()}${n.toMathML()}</span>`)}catch(s){console.log("Parse Error:",i[0])}this.$chatBody.addClass("loading"),fi(this.attr("api"),{query:t}).then(s=>{this.$chatBody.removeClass("loading");let n=JSON.parse(s);for(let r of n)this.queue(r.content,r.kind)}).catch(s=>{this.$chatBody.removeClass("loading"),this.queue(this.hints.serverError),console.error("Tutor Error:",s)})}};bl=R([L("x-tutor",{template:Rf})],bl);var _f='<div class="left" tabindex="0"><x-icon name="left" size="14"></x-icon></div><div class="content"><slot></slot></div><div class="right" tabindex="0"><x-icon name="right" size="14"></x-icon></div><div class="bubble"><div class="bubble-box"><div class="progress"></div></div><div class="bubble-arrow"></div></div>';var Nf=S("div",{class:"var-overlay"},Y),$l=class extends I{constructor(){super(...arguments);this.valueChange=!1}ready(){let t=this.attr("bind");if(!t)return;let[i,s,n]=t.split("|");[this.min,this.max,this.step]=n.split(",").map(h=>+h),this.name=i,this.model=this.getParentModel(),this.$(".content").bindModel(this.model),this.$progress=this.$(".progress"),this.setValue(+s);let r=20*(P.isMobile?1.5:1)/xt((this.max-this.min)/this.step/12,1,3),o=0,a=0;for(let h of this.$$(".left, .right")){let l=h.hasClass("left")?-this.step:this.step;h.on("click",()=>{this.setValue(this.value+l),this.trigger("slide-end")})}os(this,{start:h=>{o=h.x,a=this.value,this.addClass("on"),this.valueChange=!1,Nf.show(),de.addClass("grabbing")},move:h=>{let l=(h.x-o)/r;this.setValue(a+pi(l)*this.step)},end:()=>{this.removeClass("on"),this.valueChange&&this.trigger("slide-end"),Nf.hide(),de.removeClass("grabbing")}})}setup(t,i){this.one("slide-end",()=>t.score(i))}setValue(t){let i=pi(xt(t,this.min,this.max),2);if(i===this.value)return;this.value=i,this.valueChange=!0,this.model&&(this.model[this.name]=i);let s=this.max-this.min;this.$progress.css("width",116*(i-this.min)/s+"px")}};$l=R([L("x-var",{template:_f})],$l);var Df='<button class="play-btn-box" aria-label="Play"><x-icon name="play" size="44"></x-icon></button>';var Ml=class extends I{constructor(){super(...arguments);this.visible=!0}ready(){this.on("click",()=>{this.play(),setTimeout(()=>this.trigger("play"),400)})}play(){!this.visible||(this.visible=!1,this.exit("pop",400))}reset(){this.visible||(this.visible=!0,setTimeout(()=>this.enter("pop"),400))}};Ml=R([L("x-play-btn",{template:Df})],Ml);var Sl=class extends I{constructor(){super(...arguments);this.playing=!1}ready(){this.$icon=this.$("x-icon"),this.$("button").on("click",()=>this.toggle())}toggle(){this.playing?this.pause():this.play()}play(){this.playing||(this.playing=!0,this.$icon.setAttr("name","pause"),this.trigger("play"))}pause(){!this.playing||(this.playing=!1,this.$icon.setAttr("name","play"),this.trigger("pause"))}};Sl=R([L("x-play-toggle",{template:'<button class="icon-btn"><x-icon name="play"></x-icon></button>'})],Sl);var Gf='<div class="video-wrap"><video preload playsinline></video></div><div class="credit"></div><x-play-btn></x-play-btn><div class="controls"><div class="shadow"></div><div class="play-pause-btn"><div class="play-icon" tabindex="0" aria-label="Play Video"><x-icon name="play" size="32"></x-icon></div><div class="pause-icon" aria-label="Pause Video"><x-icon name="pause" size="32"></x-icon></div></div><div class="timeline"><div class="bar"><div class="background"></div><div class="buffer"></div><div class="progress"></div></div><div class="handle"></div></div><div class="timecode"></div></div>';function qf(e){let t=Math.floor(e/60),i=Math.floor(e%60);return t+":"+(i<10?"0":"")+i}var Pl=class extends I{ready(){let t=this.attr("src"),i=this.$(".video-wrap"),s=this.$("video"),n=this.attr("width"),r=this.attr("height");this.css("width",n+"px"),i.css("padding-bottom",+r/+n*100+"%"),s.setAttr("poster",this.attr("poster")||t.replace(/mp4$/,"jpg")),this.hasAttr("loop")&&(s._el.loop=!0),this.hasAttr("audio")||(s._el.muted=!0),S("source",{src:t,type:"video/mp4"},s),this.hasAttr("credit")&&(this.$(".credit").text=this.attr("credit"));let o=this.$(".bar"),a=this.$(".progress"),h=this.$(".buffer"),l=this.$(".timecode"),c=new us(this.$(".handle"),{$parent:o,moveY:!1}),p=this.video=s._el,m=this.width-110;P.onResize(()=>m=this.width-110),s.on("canplay",()=>{l.text=qf(+p.duration)}),s.on("timeupdate",()=>{let f=p.currentTime/p.duration;a.css("width",f*100+"%"),l.text=qf(+p.currentTime),c.setPosition(f*m,0),this.trigger("timeupdate",p.currentTime)}),s.on("progress",()=>{if(p.buffered.length<=0||p.duration<=0)return;let b=p.buffered.end(p.buffered.length-1)/p.duration*100;h.css("width",b+"%")}),s.on("ended",()=>{p.pause(),this.removeClass("playing"),this.trigger("end")});let v=()=>p.paused?this.play():this.pause(),M=f=>this.setTime(f/m*p.duration);this.hasAttr("hover")?(s.on("mouseover touchstart",()=>this.play()),s.on("mouseout touchend touchcancel",()=>this.pause())):s.on("click",v),this.hasAttr("controls")&&(this.$(".controls").show(),this.$(".play-pause-btn").on("click",v),c.on("start",()=>this.pause()),c.on("drag",({posn:f})=>M(f.x)),o.on("click",f=>M(f.offsetX)))}setTime(t){this.video.currentTime=t}play(){this.video.play(),this.addClass("playing"),this.trigger("play")}pause(){this.video.pause(),this.removeClass("playing")}};Pl=R([L("x-video",{template:Gf})],Pl);var Cl=class extends I{constructor(){super(...arguments);this.isCompleted=!1;this.isReady=!1}created(){this.userData=window.progressData||JSON.parse(this.$("#userdata").text)||{},this.$steps=this.$$("x-step");for(let t of this.$steps)t.on("score",()=>this.trigger("score"));this.data.audio&&(this.audio=new Sh(this.data.audio))}ready(){this.$footer=this.$("footer"),this.$skipStep=this.$footer.$(".skip-step"),this.$progress=this.$(".sidebar-row.active x-progress"),this.$tutor=this.$("x-tutor"),this.$stepsWrap=this.$(".steps");let t=this.findStep(P.getHash()),i=this.findStep(this.userData.activeStep);this.$activeStep=i||this.$steps[0];for(let n of this.$steps){if(n.show(),n===this.$activeStep)break;n.complete()}if(this.userData.completed||P.getHash()==="full"||this.data.reveal)this.complete();else for(;this.$activeStep&&this.$activeStep.isReady&&!this.isCompleted;)this.nextStep();(t||i&&!this.userData.completed)&&this.goToStep(t||i,!1),this.$(".section-dev")&&this.complete();let s=this.$(".reveal-banner");setTimeout(()=>{this.isCompleted||(s.removeClass("off"),this.on("score complete",()=>s.addClass("off")))},1500),s.$(".complete").one("click",()=>this.complete()),P.onKey("space",n=>{n.preventDefault(),this.nextStep(),s.addClass("off")}),this.$footer.$(".skip").on("click",()=>this.nextStep()),this.$footer.$(".show-all").on("click",()=>this.complete()),this.$footer.show(),this.isReady=!0,setTimeout(()=>this.addClass("ready"))}nextStep(){if(this.isCompleted)return;let t=this.$activeStep,i=this.$stepsWrap.height;do{if(t.complete(),t=this.$steps[this.$steps.indexOf(t)+1],!t)return this.complete(!0);t.show()}while(t.isReady);this.$stepsWrap.animate({height:[i+"px","auto"]},800),this.$activeStep=t,this.saveProgress({activeStep:t.id})}goToStep(t,i=!0){let s=this.$stepsWrap.height;for(let o of this.$steps){if(o.isShown||(this.$activeStep=o),o.show(),t.isShown&&!o.isReady)break;o.complete()}let n=t.positionTop-Math.max(50,(P.height-t.height)/2);i?(this.$stepsWrap.animate({height:[s+"px","auto"]},800),Y.scrollTo(n)):Y.scrollTop=n;let r=ct(this.$steps);if(r.isShown&&r.isReady)return this.complete();this.$activeStep&&this.saveProgress({activeStep:this.$activeStep.id})}complete(t=!1){if(this.isCompleted)return;this.isCompleted=!0,this.$steps.forEach(s=>s.complete()),this.$activeStep=void 0;let i=this.$footer.$(".next-section");t?(this.$skipStep.exit("fade",200),i&&i.enter("pop")):(this.$skipStep.hide(),i&&i.show()),this.trigger("complete"),this.saveProgress({completed:!0}),this.log("Course","complete")}findStep(t){for(let i of this.$steps)if(i.id===t)return i}saveProgress(t){if(!this.isReady)return;let s=kt(this.$steps.map(n=>n.scores.size))/+this.data.goals||0;this.$progress.setProgress(s),np(`/course/${this.id}/${this.data.section}`,t)}log(t,i,s){if(window.ga&&this.isReady){let n=i+(s?":"+s:"");window.ga("send","event",t,n,this.id)}}};Cl=R([L("x-course")],Cl);function qi(e=10){return Math.random().toString(36).substr(2,e)}function gt(e,...t){return t.includes(e)}var J2=(e,t)=>e.concat(t);function Tl(e,t,i=J2){for(let s of Object.keys(t))s in e&&Array.isArray(e[s])&&Array.isArray(t[s])?e[s]=i(e[s],t[s]):s in e&&e[s]instanceof Object&&t[s]instanceof Object?Tl(e[s],t[s]):e[s]=t[s]}function sr(e,t=0){return t?+setTimeout(e,t):(e(),0)}function Po(e){return new Promise(t=>setTimeout(t,e))}function Co(){let e=()=>{},t=()=>{},i=new Promise((s,n)=>{e=s,t=n});return i.catch(s=>s),{promise:i,resolve:e,reject:t}}var Bf=class extends Error{constructor(e){super("[Cache Error]");this.data=e}};function Pe(e){let t=new Map;return function(...i){let s=i.join("--");if(!t.has(s))try{t.set(s,e(...i))}catch(r){t.set(s,new Bf(r))}let n=t.get(s);if(n instanceof Bf)throw n.data;return n}}function To(e,t=0,i=!1){let s=!1,n=!1;return(...r)=>{s?n=!0:(i?n=!0:e(...r),s=!0,setTimeout(()=>{n&&e(...r),s=n=!1},t))}}function ty(e){return function(t,i){if(!t||Array.isArray(this)||e.includes(t))return i}}function El(e,t,i){if(!e)return t;try{return JSON.parse(e,i?ty(i):void 0)||t}catch(s){return t}}function Ce(e,t){return new Array(t).fill(e)}function Hf(e,t,i){let s=[];for(let n=0;n<t;++n)s.push(Ce(e,i));return s}function F(e,t){let i=[];for(let s=0;s<t;++s)i.push(e(s));return i}function zf(e,t,i){let s=[];for(let n=0;n<t;++n){let r=[];for(let o=0;o<i;++o)r.push(e(n,o));s.push(r)}return s}function Ff(e,t,i=1){let s=[];if(t===void 0&&e>=0)for(let n=0;n<e;n+=i)s.push(n);else if(t===void 0)for(let n=0;n>e;n-=i)s.push(n);else if(e<=t)for(let n=e;n<=t;n+=i)s.push(n);else for(let n=e;n>=t;n-=i)s.push(n);return s}function G(e,t=0){return e[e.length-1-t]}function U(e){return e.reduce((t,i)=>t+i,0)}function Eo(e,t,i=!1){return e.slice(0).sort((s,n)=>{let r=t(s),o=t(n);return r<o?i?1:-1:r>o?i?-1:1:0})}function Uf(e){let t=0;return()=>e[t++%e.length]}function fe(e){return e.filter((t,i)=>e.indexOf(t)===i)}function Te(e){return e.reduce((t,i)=>t.concat(Array.isArray(i)?Te(i):i),[])}function Ao(e){let t=0;return e.map(i=>t+=i)}function dn(e,t){let i=[];for(let s=0;s<e.length;s+=t)i.push(e.slice(s,s+t));return i}function Al(e,t=1){let i=e.length;t=(t%i+i)%i;let s=e.slice(0,t);return e.slice(t).concat(s)}function Vo(...e){return e.reduce((t,i)=>t.concat(i),[])}var jf=class{constructor(e){let t=e.length,i=e.map(s=>({val:s}));for(let[s,n]of i.entries())n.next=i[(s+1)%t],n.prev=i[(s-1+t)%t];this.root=i[0]}*traverse(){let e=this.root;for(;e;)if(yield e,e=e.next,e===this.root)return}get array(){return Array.from(this.traverse())}delete(e){if(e===this.root){if(e.next===e)return this.root=void 0;this.root=e.next}e.prev.next=e.next,e.next.prev=e.prev}};function Et(e,t=/\s+/){return e?e.trim().split(t):[]}function Wf(e){return e.toLowerCase().replace(/^-/,"").replace(/-(.)/g,(t,i)=>i.toUpperCase())}var nr=class{constructor(){this.events=new Map}on(e,t){for(let i of Et(e))this.events.has(i)||this.events.set(i,[]),this.events.get(i).push(t)}one(e,t){let i=s=>{this.off(e,i),t(s)};this.on(e,i)}off(e,t){for(let i of Et(e))this.events.has(i)&&this.events.set(i,this.events.get(i).filter(s=>s!==t))}trigger(e,t){for(let i of Et(e))if(this.events.has(i))for(let s of this.events.get(i))s(t)}},ey=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,iy=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i,sy=/rgba?\(([0-9,]+), ?([0-9,]+), ?([0-9,]+)(, ?([0-9,]+))?\)/,ny=["#22ab24","#009ea6","#0f82f2","#6d3bbf","#cd0e66","#eb4726","#fd8c00"];function Zf(e){return e.length===1?`0${e}`:e}function Kf(e,t){if(t<=0)return q.from(e[0]);if(t>=1)return q.from(G(e));let i=Math.floor(t*(e.length-1)),s=t*(e.length-1)-i;return q.mix(e[i+1],e[i],s)}function Vl(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*(2/3-i)*6:e}var q=class{constructor(e,t,i,s=1){this.r=e,this.g=t,this.b=i,this.a=s}get hex(){let e=[this.r,this.g,this.b].map(i=>Zf(Math.round(i).toString(16))),t=this.a>=1?"":Zf(Math.round(this.a*255).toString(16));return`#${e.join("")}${t}`}get rgb(){return`rgba(${[this.r,this.g,this.b].map(t=>Math.round(t)).join(",")},${this.a})`}get brightness(){return(this.r*299+this.g*587+this.g*114)/1e3}get hsl(){let e=this.r/255,t=this.g/255,i=this.b/255,s=Math.max(e,t,i),n=Math.min(e,t,i),r=(n+s)/2,o=s-n;if(s===n)return[0,0,Math.round(r*100)];let a=e===s?(t-i)/o:t===s?2+(i-e)/o:4+(e-t)/o;a=Math.min(a*60,360),a<0&&(a+=360);let h=r<=.5?o/(s+n):o/(2-s-n);return[Math.round(a),Math.round(h*100),Math.round(r*100)]}get chroma(){return Math.max(this.r,this.g,this.b)-Math.min(this.r,this.g,this.b)}toString(){return this.rgb}copy(){return new q(this.r,this.g,this.b,this.a)}static from(e){return typeof e!="string"?e:e.startsWith("#")?q.fromHex(e):q.fromRgb(e)}static fromRgb(e){let t=e.match(sy);if(!t)return new q(0,0,0);let i=t[4]?+t[5]||0:1;return new q(+t[1],+t[2],+t[3],i)}static fromHex(e){e=e.replace(ey,(i,s,n,r)=>s+s+n+n+r+r);let t=iy.exec(e);return t?new q(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),t[4]?parseInt(t[4],16)/255:1):new q(0,0,0)}static fromHsl(e,t,i){if(e/=360,t/=100,i/=100,t===0){let h=Math.round(i*255);return new q(h,h,h)}let s=i<.5?i*(1+t):i+t-i*t,n=2*i-s,r=Vl(n,s,e+1/3),o=Vl(n,s,e),a=Vl(n,s,e-1/3);return new q(Math.round(r*255),Math.round(o*255),Math.round(a*255))}static rainbow(e){return F(t=>Kf(ny,t/(e-1)),e)}static gradient(e,t){return F(i=>Kf(e,i/(t-1)),t)}static shades(e,t,i=.5){let s=q.mix("#fff",e,i),n=q.mix("#000",e,i);return q.gradient([s,e,n],t)}static mix(e,t,i=.5){return e=q.from(e),t=q.from(t),new q(i*e.r+(1-i)*t.r,i*e.g+(1-i)*t.g,i*e.b+(1-i)*t.b,i*e.a+(1-i)*t.a)}static mixMany(e,t){t||(t=e.map(()=>1));let i=U(t),s=e.map(f=>f.hsl),n=s.map(f=>f[0]),r=n.map(f=>f<180?f+360:f),o=t.map((f,b)=>f*Math.sqrt(e[b].chroma)),a=U(o),h=U(n.map((f,b)=>f*o[b]))/a,l=U(r.map((f,b)=>f*o[b]))/a,c=U(n.map((f,b)=>Math.abs(f-h)*o[b])),p=U(r.map((f,b)=>Math.abs(f-l)*o[b])),m=c<=p?h:l%360,v=U(s.map((f,b)=>t[b]*f[1]))/i,M=U(s.map((f,b)=>t[b]*f[2]))/i;return q.fromHsl(m,v,M)}};function ko(e){return e[Symbol.iterator]().next().value}function Xf(e,t){for(let i of e)if(!t(i))return!1;return!0}function Bi(e,t){for(let i of e)if(t(i))return!0;return!1}function*Lo(e,t){for(let i of e)for(let s of t(i))yield s}function*Yf(e,t){for(let i of e)for(let s of t)yield[i,s]}function ws(e,t,i=Infinity,s){let n,r=i;for(let o of e){let a=t(o);if(a<r&&(n=o,r=a,s!==void 0&&r<s))return n}return n}var Oo=class{constructor(...e){this.values=e}map(e){let t=this.values;return new Oo(function*(){let i=0;for(let s of t)for(let n of s)yield e(n,i),i+=1}())}every(e){let t=0;for(let i of this.values)for(let s of i){if(!e(s,t))return!1;t+=1}return!0}some(e){let t=0;for(let i of this.values)for(let s of i){if(e(s,t))return!0;t+=1}return!1}slice(e,t){let i=this.values;return new Oo(function*(){let s=0;for(let n of i)for(let r of n)s<e||t!==void 0&&s>e+t||(yield r,s+=1)}())}filter(e){let t=this.values;return new Oo(function*(){let i=0;for(let s of t)for(let n of s)e(n,i)&&(yield n),i+=1}())}concat(e){this.values.push(e)}[Symbol.iterator](){let e=this.values;return function*(){for(let t of e)for(let i of t)yield i}()}static make(e,t){return new Oo(function*(){let i=0;for(;t===void 0||i<t;)yield e(i),i+=1}())}};var Qf=Object.defineProperty,ry=e=>Qf(e,"__esModule",{value:!0}),kl=(e,t)=>{ry(e);for(var i in t)Qf(e,i,{get:t[i],enumerable:!0})},Jf=1e-6;function T(e,t,i=Jf){return isNaN(e)||isNaN(t)?!1:Math.abs(e-t)<i}function at(e,t,i,s=Jf){return t>i&&([t,i]=[i,t]),e>t+s&&e<i-s}var tm=/(\d+)(\d{3})/,oy=["","k","m","b","t","q"];function ay(e){let[t,i]=e.split(".");for(;tm.test(t);)t=t.replace(tm,"$1,$2");return t+(i?`.${i}`:"")}function hy(e,t=6){if(!t)return`${e}`;let i=`${Math.abs(Math.floor(e))}`.length,s=e<0?1:0;if(i<=t-s)return`${Ee(e,t-i-s-1)}`;let n=Math.floor(Math.log10(Math.abs(e))/3);return Ee(e/Math.pow(10,3*n),t-(i%3||3)-s-1)+oy[n]}function Mt(e,t=0,i=!0){let s=hy(e,t).replace("-","\u2013");return i?ay(s):s}var ly=/^-?0,[0-9]+$/,cy=/^-?([0-9]+(,[0-9]{3})*)?\.?[0-9]*$/,uy=/^-?[0-9]+(\.[0-9]{3})*,?[0-9]*$/;function Ll(e){return e=e.replace(/^–/,"-").trim(),!e||e.match(/[^0-9.,-]/)?NaN:ly.test(e)?parseFloat(e.replace(/,/,".")):cy.test(e)?parseFloat(e.replace(/,/g,"")):uy.test(e)?parseFloat(e.replace(/\./g,"").replace(/,/,".")):NaN}var Ol=["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],em=["","","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"],dy=[""," thousand"," million"," billion"," trillion"," quadrillion"," quintillion"," sextillion"];function py(e){let[t,i,s]=e.split(""),n=t==="0"?"":` ${Ol[+t]} hundred`;return i+s==="00"?n:+i<2?`${n} ${Ol[+(i+s)]}`:s==="0"?`${n} ${em[+i]}`:`${n} ${em[+i]}-${Ol[+s]}`}function Il(e){if(e===0)return"zero";let t=Math.round(Math.abs(e)).toString(),i=Math.ceil(t.length/3),s=t.padStart(3*i,"0"),n="";for(let r=0;r<i;r+=1){let o=s.substr(r*3,3);o!=="000"&&(n+=py(o)+dy[i-1-r])}return n.trim()}function Ee(e,t=0){let i=Math.pow(10,t);return Math.round(e*i)/i}function ht(e,t=1){return Math.round(e/t)*t}function k(e,t=-Infinity,i=Infinity){return Math.min(i,Math.max(t,e))}function vt(e,t,i=.5){return e+(t-e)*i}function me(e){return e*e}function At(e,t){return(e%t+t)%t}function Rl(e,t,i){if(T(e,0)&&T(t,0))return[];if(T(e,0))return[-i/t];let s=-t/2/e,n=Math.sqrt(t*t-4*e*i)/2/e;return[s+n,s-n]}function sm(e,t=0){let i=e.slice(0),s=im(i);return t?s.filter(n=>n.length===t):s}function im(e){if(e.length===1)return[[],e];let t=e.pop(),i=im(e),s=[];for(let n of i)s.push(n,[...n,t]);return s}function ys(...e){let[t,...i]=e;if(i.length>1)return ys(t,ys(...i));let s=Math.abs(t),n=Math.abs(i[0]);for(;n;)[s,n]=[n,s%n];return s}function xs(...e){let[t,...i]=e;return i.length>1?xs(t,xs(...i)):Math.abs(t*i[0])/ys(t,i[0])}function _l(e){if(e%1!=0||e<2)return!1;if(e%2==0)return e===2;if(e%3==0)return e===3;let t=Math.sqrt(e);for(let i=5;i<=t;i+=6)if(e%i==0||e%(i+2)==0)return!1;return!0}function bi(e){if(e===1)return[];if(_l(e))return[e];let t=Math.sqrt(e);for(let i=2;i<=t;++i)if(e%i==0)return bi(i).concat(bi(e/i));return[]}var St={};kl(St,{determinant:()=>wy,fill:()=>nm,identity:()=>rm,inverse:()=>hm,product:()=>Io,reflection:()=>gy,rotation:()=>fy,scalarProduct:()=>vy,shear:()=>my,sum:()=>om,transpose:()=>am});function nm(e,t,i){return Hf(e,t,i)}function rm(e=2){let t=nm(0,e,e);for(let i=0;i<e;++i)t[i][i]=1;return t}function fy(e){let t=Math.sin(e),i=Math.cos(e);return[[i,-t],[t,i]]}function my(e){return[[1,e],[0,1]]}function gy(e){let t=Math.sin(2*e),i=Math.cos(2*e);return[[i,t],[t,-i]]}function om(...e){let[t,...i]=e,s=i.length>1?om(...i):i[0];if(t.length!==s.length||t[0].length!==s[0].length)throw new Error("Matrix sizes don\u2019t match");let n=[];for(let r=0;r<t.length;++r){let o=[];for(let a=0;a<t[r].length;++a)o.push(t[r][a]+s[r][a]);n.push(o)}return n}function vy(e,t){return e.map(i=>i.map(s=>s*t))}function Io(...e){let[t,...i]=e,s=i.length>1?Io(...i):i[0];if(t[0].length!==s.length)throw new Error("Matrix sizes don\u2019t match.");let n=[];for(let r=0;r<t.length;++r){let o=[];for(let a=0;a<s[0].length;++a){let h=0;for(let l=0;l<s.length;++l)h+=t[r][l]*s[l][a];o.push(h)}n.push(o)}return n}function am(e){let t=[];for(let i=0;i<e[0].length;++i){let s=[];for(let n=0;n<e.length;++n)s.push(e[n][i]);t.push(s)}return t}function wy(e){if(e.length!==e[0].length)throw new Error("Not a square matrix.");let t=e.length;if(t===1)return e[0][0];if(t===2)return e[0][0]*e[1][1]-e[0][1]*e[1][0];let i=0;for(let s=0;s<t;++s){let n=e[0][s],r=e[0][s];for(let o=1;o<t;++o)r*=e[o][s+o%t],n*=e[o][s-o%t];i+=r-n}return i}function hm(e){let t=e.length;if(t!==e[0].length)throw new Error("Not a square matrix.");let i=rm(t),s=zf((n,r)=>e[n][r],t,t);for(let n=0;n<t;++n){let r=s[n][n];if(!r){for(let o=n+1;o<t;++o)if(s[o][n]!==0){for(let a=0;a<t;++a)[s[o][a],s[n][a]]=[s[n][a],s[o][a]],[i[o][a],i[n][a]]=[i[n][a],i[o][a]];break}if(r=s[n][n],!r)throw new Error("Matrix not invertible.")}for(let o=0;o<t;++o)s[n][o]=s[n][o]/r,i[n][o]=i[n][o]/r;for(let o=0;o<t;++o){if(o===n)continue;let a=s[o][n];for(let h=0;h<t;++h)s[o][h]-=a*s[n][h],i[o][h]-=a*i[n][h]}}return i}var Zt={};kl(Zt,{bernoulli:()=>cm,binomial:()=>My,cauchy:()=>Ay,chiCDF:()=>ky,exponential:()=>Ty,find:()=>by,geometric:()=>Ey,integer:()=>xy,integrate:()=>um,normal:()=>Cy,normalPDF:()=>Vy,poisson:()=>Sy,shuffle:()=>yy,smart:()=>$y,uniform:()=>Py,weighted:()=>lm});function yy(e){e=e.slice(0);for(let t=e.length-1;t>0;--t){let i=Math.floor(Math.random()*(t+1));[e[t],e[i]]=[e[i],e[t]]}return e}function xy(e,t){let i=t===void 0?0:e,s=t===void 0?e:t-e+1;return i+Math.floor(s*Math.random())}function lm(e){let t=Math.random()*U(e),i=0;return e.findIndex(s=>(i+=s)>=t)}function by(e){return e[Math.floor(e.length*Math.random())]}var Ro=new Map;function $y(e,t){t||(t=qi()),Ro.has(t)||Ro.set(t,Ce(1,e));let i=Ro.get(t),s=lm(i.map(n=>n*n));return i[s]-=1,i[s]<=0&&Ro.set(t,i.map(n=>n+1)),s}function cm(e=.5){return Math.random()<e?1:0}function My(e=1,t=.5){let i=0;for(let s=0;s<e;++s)i+=cm(t);return i}function Sy(e=1){if(e<=0)return 0;let t=Math.exp(-e),i=1,s=0;for(;i>t;++s)i*=Math.random();return s-1}function Py(e=0,t=1){return e+(t-e)*Math.random()}function Cy(e=0,t=1){let i=Math.random(),s=Math.random();return Math.sqrt(-2*Math.log(i))*Math.cos(2*Math.PI*s)*Math.sqrt(t)+e}function Ty(e=1){return e<=0?0:-Math.log(Math.random())/e}function Ey(e=.5){if(!(e<=0||e>1))return Math.floor(Math.log(Math.random())/Math.log(1-e))}function Ay(){let e,t,i;do t=2*Math.random()-1,i=2*Math.random()-1,e=t*t+i*i;while(e>=1);return t/i}function Vy(e,t=1,i=0){return Math.exp(-((e-t)**2)/(2*i))/Math.sqrt(2*Math.PI*i)}var dm=7,pm=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,15056327351493116e-23];function fm(e){if(e<.5)return Math.PI/(Math.sin(Math.PI*e)*fm(1-e));e-=1;let t=pm[0];for(let s=1;s<dm+2;s++)t+=pm[s]/(e+s);let i=e+dm+.5;return Math.sqrt(2*Math.PI)*Math.pow(i,e+.5)*Math.exp(-i)*t}function um(e,t,i,s=1){let n=0;for(let r=t;r<i;r+=s)n+=e(r)*s||0;return n}function ky(e,t){let i=um(s=>Math.pow(s,(t-2)/2)*Math.exp(-s/2),0,e);return 1-i/Math.pow(2,t/2)/fm(t/2)}var Ly={};kl(Ly,{bestPolynomial:()=>Ny,coefficient:()=>gm,exponential:()=>Iy,linear:()=>Oy,logarithmic:()=>Ry,polynomial:()=>mm,power:()=>_y});function Dy(e,t){let i=1,s=e[0];for(let n=1;n<e.length;++n)i*=t,s+=i*e[n];return s}function Oy(e,t=!1){let i=0,s=0,n=0,r=0,o=e.length;for(let l=0;l<o;l++)i+=e[l][0],s+=e[l][1],n+=e[l][0]*e[l][0],r+=e[l][0]*e[l][1];if(t){let l=r/n;return[0,l]}let a=(o*r-i*s)/(o*n-i*i);return[s/o-a*i/o,a]}function Iy(e){let t=[0,0,0,0,0,0];for(let r of e)t[0]+=r[0],t[1]+=r[1],t[2]+=r[0]*r[0]*r[1],t[3]+=r[1]*Math.log(r[1]),t[4]+=r[0]*r[1]*Math.log(r[1]),t[5]+=r[0]*r[1];let i=t[1]*t[2]-t[5]*t[5],s=Math.exp((t[2]*t[3]-t[5]*t[4])/i),n=(t[1]*t[4]-t[5]*t[3])/i;return[s,n]}function Ry(e){let t=[0,0,0,0],i=e.length;for(let r of e)t[0]+=Math.log(r[0]),t[1]+=r[1]*Math.log(r[0]),t[2]+=r[1],t[3]+=Math.pow(Math.log(r[0]),2);let s=(i*t[1]-t[2]*t[0])/(i*t[3]-t[0]*t[0]);return[(t[2]-s*t[0])/i,s]}function _y(e){let t=[0,0,0,0],i=e.length;for(let r of e)t[0]+=Math.log(r[0]),t[1]+=Math.log(r[1])*Math.log(r[0]),t[2]+=Math.log(r[1]),t[3]+=Math.pow(Math.log(r[0]),2);let s=(i*t[1]-t[2]*t[0])/(i*t[3]-t[0]*t[0]);return[Math.exp((t[2]-s*t[0])/i),s]}function mm(e,t=2){let i=e.map(h=>Ff(t+1).map(l=>Math.pow(h[0],l))),s=am(i),n=e.map(h=>[h[1]]),r=Io(s,i),o=hm(r);return Io(o,s,n).map(h=>h[0])}function gm(e,t){let s=e.reduce((o,a)=>o+a[1],0)/e.length,n=e.reduce((o,a)=>o+(a[1]-s)**2,0),r=e.reduce((o,a)=>o+(a[1]-t(a[0]))**2,0);return 1-r/n}function Ny(e,t=.85,i=8){if(!(e.length<=1))for(let s=1;s<i;++s){let n=mm(e,s),r=a=>Dy(n,a);if(gm(e,r)>=t)return{order:s,coefficients:n,fn:r}}}function pn(e){return e.length?U(e)/e.length:0}function fn(e,t){let i=e.length;if(!i)return 0;let s=e.slice(0).sort((r,o)=>r-o);if(t===1)return s[i-1];let n=i*t;return Number.isInteger(n)?(s[n-1]+s[n])/2:s[Math.floor(n)]}var it=class extends Error{constructor(e,t){super(t);this.name=e}static undefinedVariable(e){return new it("EvalError",`Undefined variable \u201C${e}\u201D.`)}static undefinedFunction(e){return new it("EvalError",`Undefined function \u201C${e}\u201D.`)}static evalLoop(e){return new it("EvalError",`Loop in nested evaluation \u201C${e}\u201D.`)}static invalidCharacter(e){return new it("SyntaxError",`Unknown symbol \u201C${e}\u201D.`)}static conflictingBrackets(e){return new it("SyntaxError",`Conflicting brackets \u201C${e}\u201D.`)}static unclosedBracket(e){return new it("SyntaxError",`Unclosed bracket \u201C${e}\u201D.`)}static startOperator(e){return new it("SyntaxError",`A term cannot start with a \u201C${e}\u201D.`)}static endOperator(e){return new it("SyntaxError",`A term cannot end with a \u201C${e}\u201D.`)}static consecutiveOperators(e,t){return new it("SyntaxError",`A \u201C${e}\u201D cannot be followed by a \u201C${t}\u201D.`)}static invalidExpression(){return new it("SyntaxError","This expression is invalid.")}},Nl={pi:Math.PI,\u03C0:Math.PI,e:Math.E},Dl={"(":")","[":"]","{":"}"},mn={"*":"\xB7","**":"\u2217","//":"//","+-":"\xB1","\u2013":"\u2212","-":"\u2212",xx:"\xD7",sum:"\u2211",prod:"\u220F",int:"\u222B",del:"\u2202",grad:"\u2207",aleph:"\u2135",not:"\xAC",AA:"\u2200",EE:"\u2203","'":"\u2019","!=":"\u2260","<=":"\u2264",">=":"\u2265",in:"\u2208","!in":"\u2209","==":"\u2261","~=":"\u2245","~~":"\u2248",sub:"\u2282",sube:"\u2286",prop:"\u221D",oo:"\u221E",cap:"\u2229",cup:"\u222A","<-":"\u2190","->":"\u2192","=>":"\u21D2","<=>":"\u21D4","|->":"\u21A6",uarr:"\u2191",darr:"\u2193",lArr:"\u21D0"},rr={Gamma:"\u0393",Delta:"\u0394",Theta:"\u0398",Lambda:"\u039B",Xi:"\u039E",Pi:"\u03A0",Sigma:"\u03A3",Phi:"\u03A6",Psi:"\u03A8",Omega:"\u03A9",alpha:"\u03B1",beta:"\u03B2",gamma:"\u03B3",delta:"\u03B4",epsilon:"\u025B",zeta:"\u03B6",eta:"\u03B7",theta:"\u03B8",iota:"\u03B9",kappa:"\u03BA",lambda:"\u03BB",mu:"\u03BC",nu:"\u03BD",xi:"\u03BE",pi:"\u03C0",rho:"\u03C1",sigma:"\u03C3",tau:"\u03C4",upsilon:"\u03C5",phi:"\u03C6",chi:"\u03C7",psi:"\u03C8",omega:"\u03C9",CC:"\u2102",NN:"\u2115",QQ:"\u211A",RR:"\u211D",ZZ:"\u2124"},vm="abcdefghijklmnopqrstuvwxyz",Gy=vm.split(""),qy=vm.toUpperCase().split(""),By=Object.values(rr),Hy=[...Gy,...qy,...By,"$"],zy="|()[]{}\xF7,!<>=*/+-\u2013\u2212~^_\u2026\xB0\u2022\u2225\u22A5'\u2220:%\u223C\u25B3",Fy=Object.values(mn),Uy=[...zy,...Fy],jy={_:"sub","^":"sup","//":"/","\xF7":"/"},wm={"<":"&lt;",">":"&gt;"};function ym(e){return e in wm?wm[e]:e}var Wy=["abs","round","floor","ceil","max","min","mod","lcm","gcd","gcf","log","exp","ln","sqrt","root","sin","cos","tan","sec","csc","cot","cosec","cotan","arcsin","arccos","arctan","sinh","cosh","tanh","sech","csch","coth","cosech"];function or(e){return Wy.includes(e)}var gn={"+":"plus","\u2212":"minus","\xB7":"times","\xD7":"times","/":"over","//":"divided by","%":"percent","!":"factorial","\xB1":"plus-minus","=":"equals","\u2260":"does not equal","<":"is less than",">":"is greater than","\u2264":"is less than or equal to","\u2265":"is greater than or equal to",\u03C0:"pi","\u2245":"is congruent to","\u2225":"is parallel to","\u22A5":"is perpendicular to"};for(let e of Object.keys(rr))gn[rr[e]]=e;var xm=e=>typeof e=="number"?e:e[0],bm=e=>typeof e=="number"?[e,e]:e,Hi=class{evaluate(e={},t){return NaN}interval(e={},t){return bm(this.evaluate(e))}substitute(e={}){return this}recursiveSubstitute(e){let t=Object.keys(e);return this.unknowns.filter(i=>t.includes(i)).length?this.substitute(e).recursiveSubstitute(e):this}get simplified(){return this}get unknowns(){return this.variables.filter(e=>!Object.prototype.hasOwnProperty.call(Nl,e))}get variables(){return[]}get functions(){return[]}collapse(){return this}toString(){return""}toVoice(e={}){return""}toMathML(e={}){return""}},Gl=new Set;function ql(e,t,i=!1){var s;let n=(s=t[e])!=null?s:Nl[e];if(n===void 0)throw it.undefinedVariable(e);if(typeof n=="string"||n instanceof Hi){if(i||Gl.clear(),Gl.has(e))throw it.evalLoop(e);return Gl.add(e),typeof n=="string"&&(n=ei.parse(n)),n.evaluate(t,!0)}else return typeof n=="function"?n():n}var zi=class extends Hi{constructor(e){super();this.n=e}evaluate(){return this.n}toString(){return`${this.n}`}toVoice(){return`${this.n}`}toMathML(){return`<mn>${this.n}</mn>`}},vn=class extends Hi{constructor(e){super();this.i=e}evaluate(e={},t){return xm(ql(this.i,e,t))}interval(e={},t){return bm(ql(this.i,e,t))}toMathML(){return`<mi${or(this.i)?' mathvariant="normal"':""}>${this.i}</mi>`}substitute(e={}){return e[this.i]||this}get variables(){return[this.i]}toString(){return this.i}toVoice(){return this.i in gn?gn[this.i]:this.i.length===1?`_${this.i}_`:this.i}},Zy=class extends Hi{constructor(e){super();this.s=e}evaluate(e={},t){return xm(ql(this.s,e,t))}toString(){return`"${this.s}"`}toVoice(){return this.s}toMathML(){return`<mtext>${this.s}</mtext>`}},$m=class extends Hi{toString(){return" "}toMathML(){return"<mspace></mspace>"}},$i=class extends Hi{constructor(e){super();this.o=e}toString(){return this.o.replace("//","/")}toVoice(){return gn[this.o]||this.o}get functions(){return[this.o]}toMathML(){let e=ym(this.toString());return`<mo value="${e}">${e}</mo>`}},Mm=[-Infinity,Infinity],wn=[NaN,NaN],bs=Math.PI/2,Bl=Math.PI*2,ft=(e,t)=>[e-Number.EPSILON,t+Number.EPSILON],$s=(...e)=>ft(Math.min(...e),Math.max(...e)),Ky=e=>Math.abs(e[1]-e[0]),yn=e=>isNaN(e[0])||isNaN(e[1]),Sm=e=>!isFinite(e[0])&&e[0]===e[1],Xy=(e,t)=>at(t,e[0]-Number.EPSILON,e[1]+Number.EPSILON),_o=e=>Xy(e,0),Mi={add:(...e)=>e.reduce((t,i)=>t+i,0),sub:(...e)=>e.length>1?e[0]-e[1]:-e[0],mul:(...e)=>e.reduce((t,i)=>t*i,1),div:(e,t)=>e/t,abs:e=>Math.abs(e),round:e=>Math.round(e),floor:e=>Math.floor(e),ceil:e=>Math.ceil(e),max:(...e)=>Math.max(...e),min:(...e)=>Math.min(...e),mod:(e,t)=>e%t,lcm:(...e)=>xs(...e),gcd:(...e)=>ys(...e),gcf:(...e)=>ys(...e),sup:(e,t)=>Math.pow(e,t),log:(e,t)=>Math.log(e)/(t===void 0?1:Math.log(t)),exp:e=>Math.exp(e),ln:e=>Math.log(e),sqrt:e=>Math.sqrt(e),root:(e,t)=>Math.pow(e,1/t),sin:e=>Math.sin(e),cos:e=>Math.cos(e),tan:e=>Math.tan(e),sec:e=>1/Math.cos(e),csc:e=>1/Math.sin(e),cot:e=>1/Math.tan(e),cosec:e=>Mi.csc(e),cotan:e=>Mi.cot(e),arcsin:e=>Math.asin(e),arccos:e=>Math.acos(e),arctan:e=>Math.atan(e),sinh:e=>Math.sinh(e),cosh:e=>Math.cosh(e),tanh:e=>Math.tanh(e),sech:e=>1/Math.cosh(e),csch:e=>1/Math.sinh(e),coth:e=>1/Math.tanh(e),cosech:e=>Mi.csch(e)};function No(e,t){if(e[0]>0)return t[0]>=0?ft(e[0]**t[0],e[1]**t[1]):$s(e[0]**t[0],e[0]**t[1],e[1]**t[0],e[1]**t[1]);let i=t[0];return Number.isInteger(i)&&i===t[1]?i===0?[_o(e)?0:1,1]:i%2?ft(e[0]**i,e[1]**i):_o(e)?[0,Math.max(e[0]**i,e[1]**i)]:$s(e[1]**i,e[0]**i):wn}function Pm(e,t=Bl){let i=Math.floor(e[0]/t)*t;return[e[0]-i,e[1]-i]}var X={add:(...e)=>ft(U(e.map(t=>t[0])),U(e.map(t=>t[1]))),sub:(e,t)=>t!==void 0?ft(e[0]-t[1],e[1]-t[0]):ft(-e[1],-e[0]),mul:(e,...t)=>(t.length>1&&(t=[X.mul(...t)]),$s(e[0]*t[0][0],e[0]*t[0][1],e[1]*t[0][0],e[1]*t[0][1])),div:(e,t)=>_o(t)?Mm:$s(e[0]/t[0],e[0]/t[1],e[1]/t[0],e[1]/t[1]),abs:e=>_o(e)?ft(0,Math.max(-e[0],e[1])):$s(Math.abs(e[0]),Math.abs(e[1])),round:e=>ft(Math.round(e[0]),Math.round(e[1])),floor:e=>ft(Math.floor(e[0]),Math.floor(e[1])),ceil:e=>ft(Math.ceil(e[0]),Math.ceil(e[1])),max:(...e)=>ft(Math.max(...e.map(t=>t[0])),Math.max(...e.map(t=>t[1]))),min:(...e)=>ft(Math.min(...e.map(t=>t[0])),Math.min(...e.map(t=>t[1]))),mod:(e,t)=>{if(yn(e)||yn(t))return wn;let i=e[0]/(e[0]<0?t[0]:t[1]);return i=i<0?Math.ceil(i):Math.floor(i),X.sub(e,X.mul(t,[i,i]))},lcm:(...e)=>$s(xs(...e.map(t=>t[0]))),gcd:(...e)=>$s(ys(...e.map(t=>t[0]))),gcf:(...e)=>X.gcd(...e),sup:(e,t)=>No(e,t),log:(e,t)=>(t!==void 0&&X.div(X.log(e),X.log(t)),ft(e[0]<=0?-Infinity:Math.log(e[0]),Math.log(e[1]))),exp:e=>No([Math.E,Math.E],e),ln:e=>X.log(e),sqrt:e=>No(e,[.5,.5]),root:(e,t)=>No(e,X.div([1,1],t)),sin:e=>X.cos(X.sub(e,[bs,bs])),cos:e=>yn(e)||Sm(e)?wn:Ky(e)>=Bl-Number.EPSILON?[-1,1]:(e=Pm(e),e[0]>=Math.PI?X.sub(X.cos(X.sub(e,[Math.PI,Math.PI]))):e[1]<=Math.PI?ft(Math.cos(e[1]),Math.cos(e[0])):e[1]<=Bl?ft(-1,Math.max(Math.cos(e[1]),Math.cos(e[0]))):ft(-1,1)),tan:e=>yn(e)||Sm(e)?wn:(e=Pm(e,Math.PI),e[0]>=bs&&(e=X.sub(e,[Math.PI,Math.PI])),e[0]<=-bs||e[1]>=bs?Mm:ft(Math.tan(e[0]),Math.tan(e[1]))),sec:e=>X.div([1,1],X.cos(e)),csc:e=>X.div([1,1],X.sin(e)),cot:e=>X.div([1,1],X.tan(e)),cosec:e=>X.csc(e),cotan:e=>X.cot(e),arcsin:e=>yn(e)||e[1]<-1||e[0]>1?wn:ft(e[0]<=-1?-bs:Math.asin(e[0]),e[1]>=1?bs:Math.asin(e[1])),arccos:e=>yn(e)||e[1]<-1||e[0]>1?wn:ft(e[1]>=1?0:Math.acos(e[1]),e[0]<=-1?Math.PI:Math.acos(e[0])),arctan:e=>ft(Math.atan(e[0]),Math.atan(e[1])),sinh:e=>ft(Math.sinh(e[0]),Math.sinh(e[1])),cosh:e=>e[1]<0?ft(Math.cosh(e[1]),Math.cosh(e[0])):e[0]>0?ft(Math.cosh(e[0]),Math.cosh(e[1])):ft(1,Math.cosh(Math.max(-e[0],e[1]))),tanh:e=>ft(Math.tanh(e[0]),Math.tanh(e[1])),sech:e=>X.div([1,1],X.cosh(e)),csch:e=>X.div([1,1],X.sinh(e)),coth:e=>X.div([1,1],X.tanh(e)),cosech:e=>X.csch(e)},Do=Et("+ \u2212 * \xD7 \xB7 / \xF7 // sup sub subsup"),Cm=Et("sub sup subsup"),Hl='<mo value="," lspace="0">,</mo>';function Tm(e,t){return Do.includes(t)?e instanceof Go?!0:!(e instanceof ee)||!Do.includes(e.fn)?!1:Cm.includes(e.fn)&&Cm.includes(t)?!0:Do.indexOf(t)>Do.indexOf(e.fn):!1}function Yy(e,t,i){return Tm(e,t)?`<mfenced>${i}</mfenced>`:i}function Fi(e,t){return e instanceof Go||e instanceof ee?`<mrow>${t}</mrow>`:t}function Em(e){return e==="2"?"squared":e==="3"?"cubed":`to the power of ${e}`}var ee=class extends Hi{constructor(e,t=[]){super();this.fn=e,this.args=t}evaluate(e={}){let t=this.args.map(i=>i.evaluate(e));if(this.fn in e)return e[this.fn](...t);if(this.fn==="+")return Mi.add(...t);if(this.fn==="\u2212")return Mi.sub(...t);if(["*","\xB7","\xD7"].includes(this.fn))return Mi.mul(...t);if(this.fn==="/")return Mi.div(...t);if(this.fn==="sup")return Mi.sup(...t);if(or(this.fn))return Mi[this.fn](...t);if(this.fn==="(")return t[0];throw it.undefinedFunction(this.fn)}interval(e={}){if(this.fn in e)return Ce(this.evaluate(e),2);let t=this.args.map(i=>i.interval(e));if(this.fn==="+")return X.add(...t);if(this.fn==="\u2212")return X.sub(...t);if(["*","\xB7","\xD7"].includes(this.fn))return X.mul(...t);if(this.fn==="/")return X.div(...t);if(this.fn==="sup")return X.sup(...t);if(or(this.fn))return X[this.fn](...t);if(this.fn==="(")return t[0];throw it.undefinedFunction(this.fn)}substitute(e={}){return new ee(this.fn,this.args.map(t=>t.substitute(e)))}collapse(){return this.fn==="("?this.args[0].collapse():new ee(this.fn,this.args.map(e=>e.collapse()))}get simplified(){return this}get variables(){return fe(Te(this.args.map(e=>e.variables)))}get functions(){return fe([this.fn,...Te(this.args.map(e=>e.functions))])}toString(){let e=this.args.map(t=>Tm(t,this.fn)?`(${t.toString()})`:t.toString());return this.fn==="\u2212"?e.length>1?e.join(" \u2212 "):`\u2212${e[0]}`:this.fn==="sup"?e.join("^"):this.fn==="sub"?e.join("_"):this.fn==="subsup"?`${e[0]}_${e[1]}^${e[2]}`:Et("+ * \xD7 \xB7 / = < > \u2264 \u2265 \u2248").includes(this.fn)?e.join(` ${this.fn} `):gt(this.fn,"(","[","{")?this.fn+this.args.join(", ")+Dl[this.fn]:gt(this.fn,"!","%")?e[0]+this.fn:`${this.fn}(${e.join(", ")})`}toMathML(e={}){let t=this.args.map(n=>n.toMathML(e)),i=this.args.map((n,r)=>Yy(n,this.fn,t[r]));if(this.fn in e){let n=t.map((r,o)=>({toString:()=>r,val:this.args[o]}));return e[this.fn](...n)}if(this.fn==="\u2212")return i.length>1?i.join('<mo value="\u2212">\u2212</mo>'):`<mo rspace="0" value="\u2212">\u2212</mo>${i[0]}`;if(gt(this.fn,"+","=","<",">","\u2264","\u2265","\u2248")){let n=ym(this.fn);return i.join(`<mo value="${n}">${n}</mo>`)}if(gt(this.fn,"*","\xD7","\xB7")){let n=i[0];for(let r=1;r<i.length-1;++r)n+=(this.args[0]instanceof zi&&this.args[1]instanceof zi?'<mo value="\xD7">\xD7</mo>':"")+i[1];return n}if(this.fn==="//")return i.join('<mo value="/">/</mo>');if(this.fn==="sqrt")return`<msqrt>${i[0]}</msqrt>`;if(gt(this.fn,"/","root")){let n=this.fn==="/"?"mfrac":"mroot",r=this.args.map((o,a)=>Fi(o,t[a]));return`<${n}>${r.join("")}</${n}>`}if(gt(this.fn,"sup","sub")){let n=[Fi(this.args[0],i[0]),Fi(this.args[1],t[1])];return`<m${this.fn}>${n.join("")}</m${this.fn}>`}return this.fn==="subsup"?`<msubsup>${[Fi(this.args[0],i[0]),Fi(this.args[1],t[1]),Fi(this.args[2],t[2])].join("")}</msubsup>`:gt(this.fn,"(","[","{")?`<mfenced open="${this.fn}" close="${Dl[this.fn]}">${i.join(Hl)}</mfenced>`:gt(this.fn,"!","%")?`${i[0]}<mo value="${this.fn}" lspace="0">${this.fn}</mo>`:this.fn==="abs"?`<mfenced open="|" close="|">${i.join(Hl)}</mfenced>`:this.fn==="bar"?`<mover>${Fi(this.args[0],i[0])}<mo value="\u203E">\u203E</mo></mover>`:this.fn==="vec"?`<mover>${Fi(this.args[0],i[0])}<mo value="\u2192">\u2192</mo></mover>`:`<mi${or(this.fn)?' mathvariant="normal"':""}>${this.fn}</mi><mfenced>${i.join(Hl)}</mfenced>`}toVoice(e={}){let t=this.args.map(s=>s.toVoice(e)),i=t.join(" ");if(this.fn in e){let s=t.map((n,r)=>({toString:()=>n,val:this.args[r]}));return e[this.fn](...s)}return gt(this.fn,"(","[","{")?i:this.fn==="sqrt"?`square root of ${i}`:this.fn==="%"?`${i} percent`:this.fn==="!"?`${i} factorial`:this.fn==="/"?`${t[0]} over ${t[1]}`:this.fn==="//"?`${t[0]} divided by ${t[1]}`:this.fn==="sub"?i:this.fn==="subsup"?`${t[0]} ${t[1]} ${Em(t[2])}`:this.fn==="sup"?`${t[0]} ${Em(t[1])}`:gn[this.fn]?t.join(` ${gn[this.fn]} `):or(this.fn)?`${this.fn} ${i}`:`${this.fn} of ${i}`}},Go=class extends Hi{constructor(e){super();this.items=e}evaluate(e={}){return this.collapse().evaluate(e)}interval(e={}){return this.collapse().interval(e)}substitute(e={}){return this.collapse().substitute(e)}get simplified(){return this.collapse().simplified}get variables(){return fe(Vo(...this.items.map(e=>e.variables)))}get functions(){return this.collapse().functions}toString(){return this.items.map(e=>e.toString()).join(" ")}toMathML(e={}){return this.items.map(t=>t.toMathML(e)).join("")}toVoice(e={}){return this.items.map(t=>t.toVoice(e)).join(" ")}collapse(){return zl(this.items).collapse()}},Am;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SPACE=1]="SPACE",e[e.STR=2]="STR",e[e.NUM=3]="NUM",e[e.VAR=4]="VAR",e[e.OP=5]="OP"})(Am||(Am={}));function Fl(e,t){if(t===2)return new Zy(e);if(!(!e||!t)){if(t===1&&e.length>1)return new $m;if(t===3){if(isNaN(+e))throw it.invalidExpression();return new zi(+e)}if(t===4)return e in rr?new vn(rr[e]):e in mn?new $i(mn[e]):new vn(e);if(t===5)return e in mn?new $i(mn[e]):new $i(e)}}function Qy(e){let t=[],i="",s=0;for(let r of e){if(r==='"'){let a=s===2?0:2,h=Fl(i,s);h&&t.push(h),i="",s=a;continue}else if(s===2){i+=r;continue}let o=r.match(/[0-9.]/)?3:Hy.includes(r)?4:Uy.includes(r)?5:r.match(/\s/)?1:0;if(!o)throw it.invalidCharacter(r);if(!s||s===3&&o!==3||s===4&&o!==4&&o!==3||s===5&&!(i+r in mn)||s===1&&o!==1){let a=Fl(i,s);a&&t.push(a),i="",s=o}i+=r}let n=Fl(i,s);return n&&t.push(n),t}function Jy(e){return e.length>1?new Go(e):e[0]instanceof $i?new Go(e):e[0]}function tx(e,t){let i=[[]];for(let s of e)t(s)?i.push([]):G(i).push(s);return i}function Kt(e,t){return e instanceof $i&&Et(t).includes(e.o)}function ar(e){return e instanceof ee&&e.fn==="("?e.args[0]:e}function qo(e,t){if(Kt(e[0],t))throw it.startOperator(e[0]);if(Kt(G(e),t))throw it.endOperator(G(e));for(let i=1;i<e.length-1;++i){if(!Kt(e[i],t))continue;let s=e[i],n=e[i-1],r=e[i+1];if(n instanceof $i)throw it.consecutiveOperators(n.o,s.o);if(r instanceof $i)throw it.consecutiveOperators(s.o,r.o);let o=e[i+2];if(t==="^ _"&&Kt(s,"_ ^")&&Kt(o,"_ ^")&&s.o!==o.o){let a=e[i+3];if(a instanceof $i)throw it.consecutiveOperators(o.o,a.o);let h=[ar(n),ar(r),ar(a)];s.o==="^"&&([h[1],h[2]]=[h[2],h[1]]),e.splice(i-1,5,new ee("subsup",h)),i-=4}else{let a=jy[s.o]||s.o,h=[ar(n),ar(r)];e.splice(i-1,3,new ee(a,h)),i-=2}}}function Vm(e){return qo(e,"^ _"),qo(e,"/"),Jy(e)}function ex(e,t){let i=[[]],s=["\u03C0",...(t==null?void 0:t.variables)||[]];for(let n of e){let r=G(i).length?G(i)[0].o:void 0;if(Kt(n,") ] }")){if(!Kt(n,Dl[r]))throw it.conflictingBrackets(n.o);let o=i.pop(),a=G(i),h=G(a),c=Kt(n,")")&&h instanceof vn&&!s.includes(h.i)?a.pop().i:o[0].o,p=tx(o.slice(1),m=>Kt(m,","));a.push(new ee(c,p.map(Vm)))}else Kt(n,"( [ {")?i.push([n]):G(i).push(n)}if(i.length>1)throw it.unclosedBracket(G(i)[0].o);return Vm(i[0])}function km(e,t,i=!1){let s=[],n=[],r=!1;function o(){if(r)throw it.invalidExpression();!n.length||(s.push(n.length>1?new ee(t[0],n):n[0]),n=[])}for(let a of e)if(Kt(a,t)){if(r||!n.length)throw it.invalidExpression();r=!0}else if(a instanceof $i)o(),s.push(a),r=!1;else{let h=!i||a instanceof zi;if(n.length&&!r&&h)throw it.invalidExpression();n.push(a),r=!1}return o(),s}function zl(e){if(e=e.filter(i=>!(i instanceof $m)),!e.length)throw it.invalidExpression();let t=e.findIndex(i=>Kt(i,"= < > \u2264 \u2265"));if(t===0)throw it.startOperator(e[0]);if(t===e.length-1)throw it.endOperator(e[0]);if(t>0){let i=zl(e.slice(0,t)),s=zl(e.slice(t+1));return new ee(e[t].o,[i,s])}if(Kt(e[0],"%!"))throw it.startOperator(e[0]);for(let i=0;i<e.length;++i)!Kt(e[i],"%!")||(e.splice(i-1,2,new ee(e[i].o,[e[i-1]])),i-=1);if(qo(e,"// \xF7"),e=km(e,"\xD7 * \xB7",!0),Kt(e[0],"\u2212 \xB1")&&e.splice(0,2,new ee(e[0].o,[e[1]])),qo(e,"\u2212 \xB1"),Kt(e[0],"+")&&(e=e.slice(1)),e=km(e,"+"),e.length>1)throw it.invalidExpression();return e[0]}function ix(e,t=!1,i){let s=ex(Qy(e),i);return t?s.collapse():s}function sx(e,t){try{let i=fe([...e.variables,...t.variables]),s=e.collapse(),n=t.collapse(),r=0;for(let o=0;o<5;++o){let a={};for(let c of i)a[c]=Nl[c]||Math.random()*5;let h=s.evaluate(a),l=n.evaluate(a);if(!(isNaN(h)||isNaN(l))){if(!T(h,l))return!1;r+=1}}return!!r}catch(i){return!1}}var ei={numEquals:sx,parse:Pe(ix)};var Ae=2*Math.PI;function Ms(e,t){let i=Math.atan2(e.y-(t?t.y:0),e.x-(t?t.x:0));return At(i,Ae)}var d=class{constructor(e=0,t=0){this.x=e,this.y=t,this.type="point"}get unitVector(){return T(this.length,0)?new d(1,0):this.scale(1/this.length)}get length(){return Math.sqrt(this.x**2+this.y**2)}get inverse(){return new d(-this.x,-this.y)}get flip(){return new d(this.y,this.x)}get perpendicular(){return new d(-this.y,this.x)}get array(){return[this.x,this.y]}distanceFromLine(e){return d.distance(this,e.project(this))}clamp(e,t=0){let i=k(this.x,e.xMin+t,e.xMax-t),s=k(this.y,e.yMin+t,e.yMax-t);return new d(i,s)}changeCoordinates(e,t){let i=t.xMin+(this.x-e.xMin)/e.dx*t.dx,s=t.yMin+(this.y-e.yMin)/e.dy*t.dy;return new d(i,s)}add(e){return d.sum(this,e)}subtract(e){return d.difference(this,e)}round(e=1){return new d(ht(this.x,e),ht(this.y,e))}floor(){return new d(Math.floor(this.x),Math.floor(this.y))}mod(e,t=e){return new d(this.x%e,this.y%t)}angle(e=C){return Ms(this,e)}snap(e,t=5){return T(this.x,e.x,t)?new d(e.x,this.y):T(this.y,e.y,t)?new d(this.x,e.y):this}static average(...e){let t=U(e.map(s=>s.x))/e.length,i=U(e.map(s=>s.y))/e.length;return new d(t,i)}static dot(e,t){return e.x*t.x+e.y*t.y}static sum(e,t){return new d(e.x+t.x,e.y+t.y)}static difference(e,t){return new d(e.x-t.x,e.y-t.y)}static distance(e,t){return Math.sqrt(me(e.x-t.x)+me(e.y-t.y))}static manhattan(e,t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}static interpolate(e,t,i=.5){return new d(vt(e.x,t.x,i),vt(e.y,t.y,i))}static interpolateList(e,t=.5){let i=e.length-1,s=Math.floor(k(t,0,1)*i);return d.interpolate(e[s],e[s+1],i*t-s)}static fromPolar(e,t=1){return new d(t*Math.cos(e),t*Math.sin(e))}static random(e){let t=Zt.uniform(e.xMin,e.xMax),i=Zt.uniform(e.yMin,e.yMax);return new d(t,i)}static equals(e,t,i){return T(e.x,t.x,i)&&T(e.y,t.y,i)}static colinear(e,t,i,s){let n=e.x-t.x,r=e.y-t.y,o=t.x-i.x,a=t.y-i.y;return T(n*a,o*r,s)}transform(e){let t=e[0][0]*this.x+e[0][1]*this.y+e[0][2],i=e[1][0]*this.x+e[1][1]*this.y+e[1][2];return new d(t,i)}rotate(e,t=C){if(T(e,0))return this;let i=this.x-t.x,s=this.y-t.y,n=Math.cos(e),r=Math.sin(e),o=i*n-s*r+t.x,a=i*r+s*n+t.y;return new d(o,a)}reflect(e){let t=e.p2.x-e.p1.x,i=e.p2.y-e.p1.y,s=this.x-e.p1.x,n=this.y-e.p1.y,r=(t*n-i*s)/(t*t+i*i),o=this.x+2*r*i,a=this.y-2*r*t;return new d(o,a)}scale(e,t=e){return new d(this.x*e,this.y*t)}shift(e,t=e){return new d(this.x+e,this.y+t)}translate(e){return this.shift(e.x,e.y)}equals(e,t){return d.equals(this,e,t)}toString(){return`Point(x: ${this.x}, y: ${this.y})`}},C=new d(0,0),Ss=class{constructor(e,t,i){this.c=e,this.start=t,this.angle=i,this.type="arc"}get radius(){return d.distance(this.c,this.start)}get end(){return this.start.rotate(this.angle,this.c)}get startAngle(){return Ms(this.start,this.c)}contract(e){return new this.constructor(this.c,this.at(e/2),this.angle*(1-e))}get minor(){return this.angle<=Math.PI?this:new this.constructor(this.c,this.end,Ae-this.angle)}get major(){return this.angle>=Math.PI?this:new this.constructor(this.c,this.end,Ae-this.angle)}get center(){return this.at(.5)}project(e){let t=this.startAngle,i=t+this.angle,s=Ms(e,this.c);return i>Ae&&s<i-Ae&&(s+=Ae),s=k(s,t,i),this.c.shift(this.radius,0).rotate(s,this.c)}at(e){return this.start.rotate(this.angle*e,this.c)}contains(e){return e.equals(this.project(e))}transform(e){return new this.constructor(this.c.transform(e),this.start.transform(e),this.angle)}rotate(e,t=C){return T(e,0)?this:new this.constructor(this.c.rotate(e,t),this.start.rotate(e,t),this.angle)}reflect(e){return new this.constructor(this.c.reflect(e),this.start.reflect(e),this.angle)}scale(e,t=e){return new this.constructor(this.c.scale(e,t),this.start.scale(e,t),this.angle)}shift(e,t=e){return new this.constructor(this.c.shift(e,t),this.start.shift(e,t),this.angle)}translate(e){return this.shift(e.x,e.y)}equals(){return!1}},Ps=class extends Ss{constructor(){super(...arguments);this.type="sector"}contains(e){return d.distance(e,this.c)<=this.radius&&new Xt(this.start,this.c,e).rad<=this.angle}},Ot=class{constructor(e,t){this.p1=e,this.p2=t,this.type="line"}make(e,t){return new Ot(e,t)}get length(){return d.distance(this.p1,this.p2)}get lengthSquared(){return(this.p1.x-this.p2.x)**2+(this.p1.y-this.p2.y)**2}get midpoint(){return d.average(this.p1,this.p2)}get slope(){return(this.p2.y-this.p1.y)/(this.p2.x-this.p1.x)}get intercept(){return this.p1.y+this.slope*this.p1.x}get angle(){return Ms(this.p2,this.p1)}get unitVector(){return this.p2.subtract(this.p1).unitVector}get perpendicularVector(){return new d(this.p2.y-this.p1.y,this.p1.x-this.p2.x).unitVector}parallel(e){let t=d.sum(e,d.difference(this.p2,this.p1));return new Ot(e,t)}perpendicular(e){return new Ot(e,d.sum(e,this.perpendicularVector))}get perpendicularBisector(){return this.perpendicular(this.midpoint)}distanceSquared(e){let t=this.project(e);return(e.x-t.x)**2+(e.y-t.y)**2}offset(e){let t=d.difference(this.p2,this.p1),i=d.difference(e,this.p1);return d.dot(t,i)/this.lengthSquared}project(e){return this.at(this.offset(e))}side(e,t){let i=d.difference(this.p2,this.p1),s=d.difference(e,this.p1),n=s.x*i.y-s.y*i.x;return T(n,0,t)?0:Math.sign(n)}contains(e,t){return this.side(e,t)===0}at(e){return d.interpolate(this.p1,this.p2,e)}transform(e){return new this.constructor(this.p1.transform(e),this.p2.transform(e))}rotate(e,t=C){return T(e,0)?this:new this.constructor(this.p1.rotate(e,t),this.p2.rotate(e,t))}reflect(e){return new this.constructor(this.p1.reflect(e),this.p2.reflect(e))}scale(e,t=e){return this.make(this.p1.scale(e,t),this.p2.scale(e,t))}shift(e,t=e){return this.make(this.p1.shift(e,t),this.p2.shift(e,t))}translate(e){return this.shift(e.x,e.y)}equals(e,t){return this.contains(e.p1,t)&&this.contains(e.p2,t)}toString(){return`Line(p1: ${this.p1}, p2: ${this.p2})`}};var rt=class extends Ot{constructor(){super(...arguments);this.type="segment"}contains(e,t){return Ot.prototype.contains.call(this,e,t)?this.p1.equals(e,t)||this.p2.equals(e,t)?!0:T(this.p1.x,this.p2.x,t)?at(e.y,this.p1.y,this.p2.y):at(e.x,this.p1.x,this.p2.x):!1}make(e,t){return new rt(e,t)}project(e){let t=d.difference(this.p2,this.p1),i=d.difference(e,this.p1),s=k(d.dot(t,i)/this.lengthSquared,0,1);return d.sum(this.p1,t.scale(s))}contract(e){return new rt(this.at(e),this.at(1-e))}equals(e,t,i=!1){return e.type!=="segment"?!1:this.p1.equals(e.p1,t)&&this.p2.equals(e.p2,t)||!i&&this.p1.equals(e.p2,t)&&this.p2.equals(e.p1,t)}toString(){return`Segment(p1: ${this.p1}, p2: ${this.p2})`}},wT=180/Math.PI,nx=Math.PI/180;function Ul(e){return e*nx}var Xt=class{constructor(e,t,i){this.a=e,this.b=t,this.c=i,this.type="angle"}static fromDegrees(e){return Xt.fromRadians(e*(Math.PI/180))}static fromRadians(e){let t=new d(1,0),i=t.rotate(e);return new Xt(t,C,i)}get rad(){let e=Math.atan2(this.a.y-this.b.y,this.a.x-this.b.x),i=Math.atan2(this.c.y-this.b.y,this.c.x-this.b.x)-e;return i<0&&(i+=Ae),i}get deg(){return this.rad*180/Math.PI}get isRight(){return T(this.rad,Math.PI/2,Math.PI/360)}get bisector(){if(this.b.equals(this.a)||this.b.equals(this.c))return;let e=Math.atan2(this.a.y-this.b.y,this.a.x-this.b.x),t=Math.atan2(this.c.y-this.b.y,this.c.x-this.b.x),i=(e+t)/2;e>t&&(i+=Math.PI);let s=Math.cos(i)+this.b.x,n=Math.sin(i)+this.b.y;return new Ot(this.b,new d(s,n))}get sup(){return this.rad<Math.PI?this:new Xt(this.c,this.b,this.a)}get arc(){return new Ss(this.b,this.a,this.rad)}project(){return this.c}at(){return this.c}contains(){return!1}transform(e){return new Xt(this.a.transform(e),this.b.transform(e),this.c.transform(e))}rotate(e,t){return T(e,0)?this:new Xt(this.a.rotate(e,t),this.b.rotate(e,t),this.c.rotate(e,t))}reflect(e){return new Xt(this.a.reflect(e),this.b.reflect(e),this.c.reflect(e))}scale(e,t=e){return new Xt(this.a.scale(e,t),this.b.scale(e,t),this.c.scale(e,t))}shift(e,t=e){return new Xt(this.a.shift(e,t),this.b.shift(e,t),this.c.shift(e,t))}translate(e){return new Xt(this.a.translate(e),this.b.translate(e),this.c.translate(e))}equals(e){return!1}},Cs=1e-6;function jl(e,t,i){let s=(i.x-t.x)*(e.y-t.y),n=(i.y-t.y)*(e.x-t.x);return s-n>=-Cs}function Lm(e,t,i){let s=e.y-t.y,n=i.x-t.x,r=e.x-t.x,o=i.y-t.y,a=r*n+s*o;if(a<Cs)return!1;let h=n*n+o*o;return a-h<=-Cs}function Om(e,t){return T(e.x,t.x)?T(e.y,t.y)?0:e.y<t.y?-1:1:e.x<t.x?-1:1}function Im(e){return e<=-Cs?-2:e<Cs?-1:e-1<=-Cs?0:e-1<Cs?1:2}function rx(e,t,i,s){let n=t.x-e.x,r=t.y-e.y,o=s.x-i.x,a=s.y-i.y,h=n*a-r*o;if(T(h,0))return!1;let l=e.x-i.x,c=e.y-i.y,p=(o*c-a*l)/h,m=(n*c-r*l)/h,v=new d(e.x+p*n,e.y+p*r);return{alongA:Im(p),alongB:Im(m),pt:v}}var xn=class{constructor(){this.root={root:!0,next:void 0}}exists(e){return e!==void 0&&e!==this.root}get head(){return this.root.next}insertBefore(e,t){let i=this.root,s=this.root.next;for(;s;){if(t(s)){e.prev=s.prev,e.next=s,s.prev.next=e,s.prev=e;return}i=s,s=s.next}i.next=e,e.prev=i,e.next=void 0}findTransition(e){let t=this.root,i=this.root.next;for(;i&&!e(i);)t=i,i=i.next;return{before:t===this.root?void 0:t,after:i,insert:s=>(s.prev=t,s.next=i,t.next=s,i&&(i.prev=s),s)}}static node(e){let t=e;return t.remove=()=>{t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t.prev=t.next=void 0},t}};function Wl(e,t,i){let s={above:i.myFill.above,below:i.myFill.below};return{start:e,end:t,myFill:s}}function ox(e,t,i,s,n,r){let o=Om(t,n);return o!==0?o:d.equals(i,r)?0:e!==s?e?1:-1:jl(i,s?n:r,s?r:n)?1:-1}function Zl(e,t,i){e.insertBefore(t,s=>ox(!!t.isStart,t.pt,i,!!s.isStart,s.pt,s.other.pt)<0)}function ax(e,t,i){let s=xn.node({isStart:!0,pt:t.start,seg:t,primary:i});return Zl(e,s,t.end),s}function hx(e,t,i,s){let n=xn.node({pt:i.end,seg:i,primary:s,other:t});t.other=n,Zl(e,n,t.pt)}function Bo(e,t,i){let s=ax(e,t,i);return hx(e,s,t,i),s}function lx(e,t,i){t.other.remove(),t.seg.end=i,t.other.pt=i,Zl(e,t.other,t.pt)}function Ge(e,t,i){let s=Wl(i,t.seg.end,t.seg);return lx(e,t,i),Bo(e,s,!!t.primary)}function cx(e,t){let i=e.seg.start,s=e.seg.end,n=t.seg.start,r=t.seg.end;return d.colinear(i,n,r)?d.colinear(s,n,r)||jl(s,n,r)?1:-1:jl(i,n,r)?1:-1}function Kl(e,t,i){let s=t.seg,n=i.seg,r=s.start,o=s.end,a=n.start,h=n.end,l=rx(r,o,a,h);if(l===!1){if(!d.colinear(r,o,a)||d.equals(r,h)||d.equals(o,a))return!1;let c=d.equals(r,a),p=d.equals(o,h);if(c&&p)return i;let m=!c&&Lm(r,a,h),v=!p&&Lm(o,a,h);if(c)return v?Ge(e,i,o):Ge(e,t,h),i;m&&(p||(v?Ge(e,i,o):Ge(e,t,h)),Ge(e,i,r))}else l.alongA===0&&(l.alongB===-1?Ge(e,t,a):l.alongB===0?Ge(e,t,l.pt):l.alongB===1&&Ge(e,t,h)),l.alongB===0&&(l.alongA===-1?Ge(e,i,r):l.alongA===0?Ge(e,i,l.pt):l.alongA===1&&Ge(e,i,o));return!1}function Rm(e,t){var i,s;let n=new xn,r=[];for(;e.head;){let o=e.head;if(o.isStart){let a=function(){if(l){let m=Kl(e,o,l);if(m)return m}return c?Kl(e,o,c):!1},h=n.findTransition(m=>cx(o,m.ev)>0),l=(i=h.before)==null?void 0:i.ev,c=(s=h.after)==null?void 0:s.ev,p=a();if(p&&(t?(o.seg.myFill.below?o.seg.myFill.above!==o.seg.myFill.below:!0)&&(p.seg.myFill.above=!p.seg.myFill.above):p.seg.otherFill=o.seg.myFill,o.other.remove(),o.remove()),e.head!==o)continue;if(t){let m=o.seg.myFill.below?o.seg.myFill.above!==o.seg.myFill.below:!0;o.seg.myFill.below=c?c.seg.myFill.above:!1,o.seg.myFill.above=m?!o.seg.myFill.below:o.seg.myFill.below}else if(o.seg.otherFill===void 0){let m=c?o.primary===c.primary?c.seg.otherFill.above:c.seg.myFill.above:!1;o.seg.otherFill={above:m,below:m}}o.other.status=h.insert(xn.node({ev:o}))}else{let a=o.status;if(a===void 0)throw new Error("[Euclid.js] Zero-length segment detected!");if(n.exists(a.prev)&&n.exists(a.next)&&Kl(e,a.prev.ev,a.next.ev),a.remove(),!o.primary){let h=o.seg.myFill;o.seg.myFill=o.seg.otherFill,o.seg.otherFill=h}r.push(o.seg)}e.head.remove()}return r}function ux(e){let t=[],i=[];return e.forEach(s=>{let n=s.start,r=s.end;if(d.equals(n,r))return;let o={index:0,matchesHead:!1,matchesPt1:!1},a={index:0,matchesHead:!1,matchesPt1:!1},h=o;function l(f,b,$){h.index=f,h.matchesHead=b,h.matchesPt1=$;let w=h===o;return h=w?a:void 0,!w}for(let f=0;f<t.length;f++){let b=t[f],$=b[0],w=G(b);if(d.equals($,n)){if(l(f,!0,!0))break}else if(d.equals($,r)){if(l(f,!0,!1))break}else if(d.equals(w,n)){if(l(f,!1,!0))break}else if(d.equals(w,r)&&l(f,!1,!1))break}if(h===o){t.push([n,r]);return}if(h===a){let f=o.index,b=o.matchesPt1?r:n,$=o.matchesHead,w=t[f],x=$?w[0]:w[w.length-1],z=$?w[1]:w[w.length-2],Gt=$?w[w.length-1]:w[0],Ft=$?w[w.length-2]:w[1];if(d.colinear(z,x,b)&&($?w.shift():w.pop(),x=z),d.equals(Gt,b)){t.splice(f,1),d.colinear(Ft,Gt,x)&&($?w.pop():w.shift()),i.push(w);return}$?w.unshift(b):w.push(b);return}function c(f){t[f].reverse()}function p(f,b){let $=t[f],w=t[b],x=$[$.length-1],z=$[$.length-2],Gt=w[0],Ft=w[1];d.colinear(z,x,Gt)&&($.pop(),x=z),d.colinear(x,Gt,Ft)&&w.shift(),t[f]=$.concat(w),t.splice(b,1)}let m=o.index,v=a.index,M=t[m].length<t[v].length;o.matchesHead?a.matchesHead?M?(c(m),p(m,v)):(c(v),p(v,m)):p(v,m):a.matchesHead?p(m,v):M?(c(m),p(v,m)):(c(v),p(m,v))}),i}function dx(e,t){let i=[];for(let s of e){let n=(s.myFill.above?8:0)+(s.myFill.below?4:0)+(s.otherFill&&s.otherFill.above?2:0)+(s.otherFill&&s.otherFill.below?1:0);t[n]!==0&&i.push({start:s.start,end:s.end,myFill:{above:t[n]===1,below:t[n]===2}})}return i}function _m(e){let t=new xn;for(let i of e)for(let s=0;s<i.length;s++){let n=s?i[s-1]:G(i),r=i[s],o=Om(n,r);if(o===0)continue;let a=o<0?n:r,h=o<0?r:n;Bo(t,{start:a,end:h,myFill:{}},!0)}return Rm(t,!0)}function Xl(e,t,i){let s=new xn;for(let r of _m(e))Bo(s,Wl(r.start,r.end,r),!0);for(let r of _m(t))Bo(s,Wl(r.start,r.end,r),!1);let n=dx(Rm(s,!1),i);return ux(n)}var px=[0,2,1,0,2,2,0,0,1,0,1,0,0,0,0,0],fx=[0,0,0,0,0,2,0,2,0,0,1,1,0,2,1,0],mx=[0,0,0,0,2,0,2,0,1,1,0,0,0,1,2,0],gx=(e,t)=>Xl(e,t,px),vx=(e,t)=>Xl(e,t,fx),wx=(e,t)=>Xl(e,t,mx),Z=class{constructor(e=C,t=1){this.c=e,this.r=t,this.type="circle"}get circumference(){return Ae*this.r}get area(){return Math.PI*this.r**2}get arc(){let e=this.c.shift(this.r,0);return new Ss(this.c,e,Ae)}tangentAt(e){let t=this.at(e),i=this.c.rotate(Math.PI/2,t);return new Ot(t,i)}collision(e){let t=this.c.x<e.p.x?e.p.x:this.c.x>e.p.x+e.w?e.p.x+e.w:this.c.x,i=this.c.y<e.p.y?e.p.y:this.c.y>e.p.y+e.h?e.p.y+e.h:this.c.y;return d.distance(this.c,new d(t,i))<=this.r}project(e){let t=e.subtract(this.c).unitVector.scale(this.r);return d.sum(this.c,t)}at(e){let t=Ae*e;return this.c.shift(this.r*Math.cos(t),this.r*Math.sin(t))}contains(e){return d.distance(e,this.c)<=this.r}transform(e){let t=Math.abs(e[0][0])+Math.abs(e[1][1]);return new Z(this.c.transform(e),this.r*t/2)}rotate(e,t=C){return T(e,0)?this:new Z(this.c.rotate(e,t),this.r)}reflect(e){return new Z(this.c.reflect(e),this.r)}scale(e,t=e){return new Z(this.c.scale(e,t),this.r*(e+t)/2)}shift(e,t=e){return new Z(this.c.shift(e,t),this.r)}translate(e){return this.shift(e.x,e.y)}equals(e,t){return T(this.r,e.r,t)&&this.c.equals(e.c,t)}toString(){return`Circle(c: ${this.c}, r: ${this.r})`}};function ii(e){return["polygon","polyline","rectangle","triangle"].includes(e.type)}function Ho(e){return["polygon","triangle"].includes(e.type)}function zo(e){return e.type==="polyline"}function Yl(e){return e.type==="rectangle"}function ie(e){return["line","ray","segment"].includes(e.type)}function Ql(e){return e.type==="line"}function yx(e){return e.type==="ray"}function bn(e){return e.type==="segment"}function $t(e){return e.type==="circle"}function $n(e){return e.type==="arc"}function Ts(e){return e.type==="sector"}function xx(e){return e.type==="angle"}function It(e){return e.type==="point"}function bx(e,t){return T(e.p1.x,e.p2.x)?at(t.y,e.p1.y,e.p2.y):at(t.x,e.p1.x,e.p2.x)}function $x(e,t){return T(e.p1.x,e.p2.x)?(t.y-e.p1.y)/(e.p2.y-e.p1.y)>0:(t.x-e.p1.x)/(e.p2.x-e.p1.x)>0}function Mx(e,t){let i=e.p1.x-e.p2.x,s=e.p1.y-e.p2.y,n=t.p1.x-t.p2.x,r=t.p1.y-t.p2.y,o=i*r-s*n;if(T(o,0))return[];let a=e.p1.x*e.p2.y-e.p1.y*e.p2.x,h=t.p1.x*t.p2.y-t.p1.y*t.p2.x,l=a*n-i*h,c=a*r-s*h;return[new d(l/o,c/o)]}function Sx(e,t){let i=d.distance(e.c,t.c);if(i>e.r+t.r)return[];if(i<Math.abs(e.r-t.r))return[];if(T(i,0)&&T(e.r,t.r))return[];if(T(i,e.r+t.r))return[new Ot(e.c,t.c).midpoint];let s=(me(e.r)-me(t.r)+me(i))/(2*i),n=Math.sqrt(me(e.r)-me(s)),r=(t.c.x-e.c.x)*s/i+(t.c.y-e.c.y)*n/i+e.c.x,o=(t.c.y-e.c.y)*s/i-(t.c.x-e.c.x)*n/i+e.c.y,a=(t.c.x-e.c.x)*s/i-(t.c.y-e.c.y)*n/i+e.c.x,h=(t.c.y-e.c.y)*s/i+(t.c.x-e.c.x)*n/i+e.c.y;return[new d(r,o),new d(a,h)]}function Nm(e,t){let i=e.p2.x-e.p1.x,s=e.p2.y-e.p1.y,n=me(i)+me(s),r=t.c.x,o=t.c.y,a=(e.p1.x-r)*(e.p2.y-o)-(e.p2.x-r)*(e.p1.y-o),h=me(t.r)*n-me(a);if(h<0)return[];let l=a*s/n,c=-a*i/n;if(T(h,0))return[t.c.shift(l,c)];let p=i*(s<0?-1:1)*Math.sqrt(h)/n,m=Math.abs(s)*Math.sqrt(h)/n;return[t.c.shift(l+p,c+m),t.c.shift(l-p,c-m)]}function Px(e,t){let i=[];ie(e)&&ie(t)?i=Mx(e,t):ie(e)&&$t(t)?i=Nm(e,t):$t(e)&&ie(t)?i=Nm(t,e):$t(e)&&$t(t)&&(i=Sx(e,t));for(let s of[e,t])s.type==="segment"&&(i=i.filter(n=>bx(s,n))),s.type==="ray"&&(i=i.filter(n=>$x(s,n)));return i}function oe(...e){if(e.length<2)return[];if(e.length>2)return Te(sm(e,2).map(s=>oe(...s)));let[t,i]=e;if(ii(i)&&([t,i]=[i,t]),ii(t)){let s=ie(i)?t.points.filter(n=>i.contains(n)):[];for(let n of t.edges)s.push(...oe(n,i));return s}return Px(t,i)}var O=class{constructor(...e){this.type="polygon",this.points=e}get circumference(){if(this.points.length<=1)return 0;let e=d.distance(this.points[0],G(this.points));for(let t=1;t<this.points.length;++t)e+=d.distance(this.points[t-1],this.points[t]);return e}get signedArea(){let e=this.points,t=e.length,i=e[t-1].x*e[0].y-e[0].x*e[t-1].y;for(let s=1;s<t;++s)i+=e[s-1].x*e[s].y-e[s].x*e[s-1].y;return i/2}get area(){return Math.abs(this.signedArea)}get centroid(){let e=this.points,t=e.length,i=0;for(let n=0;n<t;++n)i+=e[n].x;let s=0;for(let n=0;n<t;++n)s+=e[n].y;return new d(i/t,s/t)}get edges(){let e=this.points,t=e.length,i=[];for(let s=0;s<t;++s)i.push(new rt(e[s],e[(s+1)%t]));return i}get radius(){let e=this.centroid,t=this.points.map(i=>d.distance(i,e));return Math.max(...t)}get oriented(){if(this.signedArea>=0)return this;let e=[...this.points].reverse();return new this.constructor(...e)}cut(e){let t=this.radius/e.length*10,i=e.at(-t),s=e.at(t),n=e.perpendicularVector.scale(e.length*t),r=[i,s,s.add(n),i.add(n)],o=vx([this.points],[r]),a=wx([this.points],[r]);return[...o,...a].map(h=>new O(...h))}static collision(e,t){if(e.points.some(i=>t.contains(i))||t.points.some(i=>e.contains(i)))return!0;for(let i of e.edges)for(let s of t.edges)if(oe(i,s)[0])return!0;return!1}static union(...e){let[t,...i]=e;if(!i.length)return[t];let s=[t.points],n=i.length>1?O.union(...i).map(r=>r.points):[e[1].points];return gx(s,n).map(r=>new O(...r))}static regular(e,t=1){let i=Ae/e,s=Math.PI/2-i/2,n=F(r=>d.fromPolar(s+i*r,t),e);return new O(...n)}static interpolate(e,t,i=.5){let s=e.points.map((n,r)=>d.interpolate(n,t.points[r],i));return new O(...s)}static convexHull(...e){if(e.length<=3)return new O(...e);let t=e.sort((r,o)=>r.x!==o.x?r.x-o.x:r.y-o.y),i=t.slice(0).reverse(),s=[],n=[];for(let[r,o]of[[t,s],[i,n]]){for(let a of r){for(;o.length>=2;){let h=o[o.length-1],l=o[o.length-2];if((h.x-l.x)*(a.y-l.y)>=(a.x-l.x)*(h.y-l.y))o.pop();else break}o.push(a)}o.pop()}return new O(...s.concat(n))}contains(e){let t=!1;for(let i of this.edges){if(i.p1.equals(e)||i.contains(e))return!1;if(i.p1.y>e.y==i.p2.y>e.y)continue;let s=(i.p2.x-i.p1.x)/(i.p2.y-i.p1.y);e.x<s*(e.y-i.p1.y)+i.p1.x&&(t=!t)}return t}at(e){return d.interpolateList([...this.points,this.points[0]],e)}project(e){let t,i=Infinity;for(let s of this.edges){let n=s.project(e),r=d.distance(e,n);r<i&&(t=n,i=r)}return t||this.points[0]}centerAt(e=C){return this.translate(e.subtract(this.centroid))}transform(e){return new this.constructor(...this.points.map(t=>t.transform(e)))}rotate(e,t=C){if(T(e,0))return this;let i=this.points.map(s=>s.rotate(e,t));return new this.constructor(...i)}reflect(e){let t=this.points.map(i=>i.reflect(e));return new this.constructor(...t)}scale(e,t=e){let i=this.points.map(s=>s.scale(e,t));return new this.constructor(...i)}shift(e,t=e){let i=this.points.map(s=>s.shift(e,t));return new this.constructor(...i)}translate(e){return this.shift(e.x,e.y)}equals(e,t,i){let s=this.points.length;if(s!==e.points.length)return!1;let n=i?this:this.oriented,r=i?e:e.oriented;for(let o=0;o<s;++o)if(n.points.every((a,h)=>a.equals(r.points[(h+o)%s],t)))return!0;return!1}},Es=class extends O{constructor(){super(...arguments);this.type="polyline"}get length(){let e=0;for(let t=1;t<this.points.length;++t)e+=d.distance(this.points[t-1],this.points[t]);return e}get edges(){let e=[];for(let t=0;t<this.points.length-1;++t)e.push(new rt(this.points[t],this.points[t+1]));return e}},Jl=class extends O{constructor(){super(...arguments);this.type="triangle"}get circumcircle(){let[e,t,i]=this.points,s=2*(e.x*(t.y-i.y)+t.x*(i.y-e.y)+i.x*(e.y-t.y)),n=(e.x**2+e.y**2)*(t.y-i.y)+(t.x**2+t.y**2)*(i.y-e.y)+(i.x**2+i.y**2)*(e.y-t.y),r=(e.x**2+e.y**2)*(i.x-t.x)+(t.x**2+t.y**2)*(e.x-i.x)+(i.x**2+i.y**2)*(t.x-e.x),o=new d(n/s,r/s),a=d.distance(o,this.points[0]);return new Z(o,a)}get incircle(){let e=this.edges,t=e.map(c=>c.length),i=t[0]+t[1]+t[2],[s,n,r]=this.points,o=t[1]*s.x+t[2]*n.x+t[0]*r.x,a=t[1]*s.y+t[2]*n.y+t[0]*r.y,h=new d(o/i,a/i),l=h.distanceFromLine(e[0]);return new Z(h,l)}get orthocenter(){let[e,t,i]=this.points,s=new Ot(e,t).perpendicular(i),n=new Ot(e,i).perpendicular(t);return oe(s,n)[0]}},A=class{constructor(e,t=1,i=t){this.p=e,this.w=t,this.h=i,this.type="rectangle"}static aroundPoints(e){let t=Infinity,i=-Infinity,s=Infinity,n=-Infinity;for(let r of e)t=t<r.x?t:r.x,i=i>r.x?i:r.x,s=s<r.y?s:r.y,n=n>r.y?n:r.y;return new A(new d(t,s),i-t,n-s)}get center(){return new d(this.p.x+this.w/2,this.p.y+this.h/2)}get centroid(){return this.center}get circumference(){return 2*Math.abs(this.w)+2*Math.abs(this.h)}get area(){return Math.abs(this.w*this.h)}get edges(){return this.polygon.edges}get points(){return this.polygon.points}get polygon(){let e=new d(this.p.x+this.w,this.p.y),t=new d(this.p.x+this.w,this.p.y+this.h),i=new d(this.p.x,this.p.y+this.h);return new O(this.p,e,t,i)}collision(e){return this.p.x<e.p.x+e.w&&this.p.x+this.w>e.p.x&&this.p.y<e.p.y+e.h&&this.p.y+this.h>e.p.y}contains(e,t){return at(e.x,this.p.x,this.p.x+this.w,t)&&at(e.y,this.p.y,this.p.y+this.h,t)}project(e){let t;for(let i of this.edges){let s=i.project(e);(!t||d.distance(e,s)<d.distance(e,t))&&(t=s)}return t}at(e){return this.p}transform(e){return this.polygon.transform(e)}rotate(e,t=C){return T(e,0)?this:this.polygon.rotate(e,t)}reflect(e){return this.polygon.reflect(e)}scale(e,t=e){return new A(this.p.scale(e,t),this.w*e,this.h*t)}shift(e,t=e){return new A(this.p.shift(e,t),this.w,this.h)}translate(e){return this.shift(e.x,e.y)}equals(e){return!1}toString(){return`Rectangle(p: ${this.p}, w: ${this.w}, h: ${this.h})`}},Ve=class{constructor(e,t,i,s){this.xMin=e,this.xMax=t,this.yMin=i,this.yMax=s}contains(e){return this.containsX(e)&&this.containsY(e)}containsX(e){return at(e.x,this.xMin,this.xMax)}containsY(e){return at(e.y,this.yMin,this.yMax)}resize(e,t){return new Ve(this.xMin,this.xMax+e,this.yMin,this.yMax+t)}get dx(){return this.xMax-this.xMin}get dy(){return this.yMax-this.yMin}get xRange(){return[this.xMin,this.xMax]}get yRange(){return[this.yMin,this.yMax]}get rect(){return new A(new d(this.xMin,this.yMin),this.dx,this.dy)}get center(){return new d(this.xMin+this.dx/2,this.yMin+this.dy/2)}get flip(){return new Ve(this.yMin,this.yMax,this.xMin,this.xMax)}};function Dm(e,t,i={}){if(i.fill&&(e.fillStyle=i.fill),i.opacity&&(e.globalAlpha=i.opacity),i.stroke&&(e.strokeStyle=i.stroke,e.lineWidth=i.strokeWidth||1,i.lineCap&&(e.lineCap=i.lineCap),i.lineJoin&&(e.lineJoin=i.lineJoin)),e.beginPath(),bn(t))e.moveTo(t.p1.x,t.p1.y),e.lineTo(t.p2.x,t.p2.y);else if($t(t))e.arc(t.c.x,t.c.y,t.r,0,Ae);else if(Ho(t)){e.moveTo(t.points[0].x,t.points[0].y);for(let s of t.points.slice(1))e.lineTo(s.x,s.y);e.closePath()}else if(zo(t)){e.moveTo(t.points[0].x,t.points[0].y);for(let s of t.points.slice(1))e.lineTo(s.x,s.y)}i.fill&&e.fill(),i.stroke&&e.stroke()}function tc(e,t,i){let n=t.x*(i.y-e.y)+e.x*(t.y-i.y)+i.x*(e.y-t.y)>0?1:0,r=d.distance(t,e);return[e.x,`${e.y}A${r}`,r,0,n,1,i.x,i.y].join(",")}function Cx(e,t={}){return e.isRight&&!t.round?20:24+20*(1-k(e.rad,0,Math.PI)/Math.PI)}function Tx(e,t={}){let i=e.a,s=e.b,n=e.c,r=t.size||Cx(e,t),o=d.difference(i,s).unitVector,a=d.difference(n,s).unitVector;i=d.sum(s,o.scale(r)),n=d.sum(s,a.scale(r));let h=t.fill?`M${s.x},${s.y}L`:"M";if(e.isRight&&!t.round){let l=d.sum(i,a.scale(r));h+=`${i.x},${i.y}L${l.x},${l.y}L${n.x},${n.y}`}else h+=tc(i,s,n);return t.fill&&(h+="Z"),h}function ge(...e){return`M${e.map(t=>`${t.x},${t.y}`).join("L")}`}function Gm(e,t){let i=e.perpendicularVector.scale(6),s=e.unitVector.scale(3),n=e.midpoint;switch(t){case"bar":return ge(n.add(i),n.add(i.inverse));case"bar2":return ge(n.add(s).add(i),n.add(s).add(i.inverse))+ge(n.add(s.inverse).add(i),n.add(s.inverse).add(i.inverse));case"arrow":return ge(n.add(s.inverse).add(i),n.add(s),n.add(s.inverse).add(i.inverse));case"arrow2":return ge(n.add(s.scale(-2)).add(i),n,n.add(s.scale(-2)).add(i.inverse))+ge(n.add(i),n.add(s.scale(2)),n.add(i.inverse));default:return""}}function Fo(e,t){if(!e||!t)return"";let i=t.perpendicular,s=e.add(t.scale(9)).add(i.scale(9)),n=e.add(t.scale(9)).add(i.scale(-9));return ge(s,e,n)}function Ex(e,t){let i="";return gt(t,"start","both")&&(i+=Fo(e.p1,e.unitVector)),gt(t,"end","both")&&(i+=Fo(e.p2,e.unitVector.inverse)),i}function Ax(e,t){let i="";if(gt(t,"start","both")){let s=new Ot(e.c,e.start).perpendicularVector.inverse;i+=Fo(e.start,s)}if(gt(t,"end","both")){let s=new Ot(e.c,e.end).perpendicularVector;i+=Fo(e.end,s)}return i}function si(e,t={}){if(xx(e))return Tx(e,t);if(bn(e)){if(e.p1.equals(e.p2))return"";let i=ge(e.p1,e.p2);return t.mark&&(i+=Gm(e,t.mark)),t.arrows&&(i+=Ex(e,t.arrows)),i}if(yx(e)){if(!t.box)return"";let i=oe(e,t.box)[0];return i?ge(e.p1,i):""}if(Ql(e)){if(!t.box)return"";let i=oe(e,t.box);if(i.length<2)return"";let s=ge(i[0],i[1]);return t.mark&&(s+=Gm(e,t.mark)),s}if($t(e))return`M ${e.c.x-e.r} ${e.c.y} a ${e.r},${e.r} 0 1 0 ${2*e.r} 0 a ${e.r} ${e.r} 0 1 0 ${-2*e.r} 0`;if($n(e)){let i=`M${tc(e.start,e.c,e.end)}`;return t.arrows&&(i+=Ax(e,t.arrows)),i}return Ts(e)?`M ${e.c.x} ${e.c.y} L ${tc(e.start,e.c,e.end)} Z`:zo(e)?ge(...e.points):Ho(e)?`${ge(...e.points)}Z`:Yl(e)?`${ge(...e.polygon.points)}Z`:""}var qe=(e,t,i)=>new Promise((s,n)=>{var r=h=>{try{a(i.next(h))}catch(l){n(l)}},o=h=>{try{a(i.throw(h))}catch(l){n(l)}},a=h=>h.done?s(h.value):Promise.resolve(h.value).then(r,o);a((i=i.apply(e,t)).next())});function Vx(e){let t=[];for(let i of Object.keys(e)){let s=e[i];if(i=encodeURIComponent(i),s==null){t.push(i);continue}s=Array.isArray(s)?s.join(","):`${s}`,s=s.replace(/(\r)?\n/g,`\r
`),s=encodeURIComponent(s),s=s.replace(/%20/g,"+"),t.push(`${i}=${s}`)}return t.join("&")}function kx(e,t){return qe(this,null,function*(){let i=t instanceof FormData,s={method:"POST",body:i?t:t?Vx(t):void 0,headers:{"X-CSRF-Token":window.csrfToken||""}};i||(s.headers["Content-Type"]="application/x-www-form-urlencoded");let n=e.includes("?")?"&xhr=1":"?xhr=1",r=yield fetch(e+n,s);if(!r.ok)throw new Error(`Fetch error ${r.status}: ${e}`);return r.text()})}function Uo(e,t=!1){return new Promise(i=>{let s=new Image;t||(s.crossOrigin="Anonymous"),s.onload=()=>i(s),s.src=e})}var hr=new Map;function Lx(e,t){hr.has(e)?Tl(hr.get(e),t,(i,s)=>fe(i.concat(s))):hr.set(e,t)}function qm(){if(!!window.navigator.onLine)for(let[e,t]of hr)hr.delete(e),kx(e,{data:JSON.stringify(t)}).catch(i=>{console.error("Failed to send POST request:",i),Lx(e,t)})}var Ox=To(qm,5e3);window.addEventListener("online",Ox);window.onbeforeunload=qm;var ni=class{constructor(e,t=1,i=!0){this.src=e,this.defaultVolume=t,this.player=new Audio,this.player.src=e,i&&(this.player.preload="auto")}play(e){this.player.currentTime=0,this.player.volume=e||this.defaultVolume,this.player.play()}},Bm;(function(e){e[e.Array=0]="Array",e[e.BinaryOp=1]="BinaryOp",e[e.Call=2]="Call",e[e.Conditional=3]="Conditional",e[e.Identifier=4]="Identifier",e[e.Literal=5]="Literal",e[e.Member=6]="Member",e[e.UnaryOp=7]="UnaryOp"})(Bm||(Bm={}));var Hm={"===":(e,t)=>e===t,"!==":(e,t)=>e!==t,"||":(e,t)=>e||t,"&&":(e,t)=>e&&t,"==":(e,t)=>e==t,"!=":(e,t)=>e!=t,"<=":(e,t)=>e<=t,">=":(e,t)=>e>=t,"**":(e,t)=>e**t,"<":(e,t)=>e<t,">":(e,t)=>e>t,"+":(e,t)=>e+t,"-":(e,t)=>e-t,"*":(e,t)=>e*t,"/":(e,t)=>e/t,"%":(e,t)=>e%t},zm={"-":e=>-e,"+":e=>+e,"!":e=>!e},Fm={"||":1,"&&":2,"==":3,"!=":3,"===":3,"!==":3,"<":4,">":4,"<=":4,">=":4,"+":5,"-":5,"*":6,"/":6,"%":6,"**":7},Um={true:!0,false:!1,undefined:void 0},Ix=/\s/,ec=/[0-9]/,ic=/[a-zA-Zα-ωΑ-Ω$_]/,Rx=/[0-9a-zA-Zα-ωΑ-Ω$_]/;function _x(e){let t=e.length,i=0;function s(f){throw new Error(`${f} at character ${i} of "${e}"`)}function n(){for(;Ix.test(e[i]);)i+=1}function r(){let f="";for(;ec.test(e[i]);)f+=e[i++];if(e[i]===".")for(f+=e[i++];ec.test(e[i]);)f+=e[i++];let b=e[i];if(b&&ic.test(b)){let $=f+e[i];s(`Variable names cannot start with a number (${$})`)}else b==="."&&s("Unexpected period");return{type:5,value:parseFloat(f)}}function o(){let f=e[i];i+=1;let b=!1,$="";for(;i<t;){let w=e[i++];if(w===f){b=!0;break}$+=w}return b||s(`Unclosed quote after "${$}"`),{type:5,value:$}}function a(){let f=e[i];for(ic.test(e[i])||s(`Unexpected ${f}`),i+=1;i<t&&Rx.test(e[i]);)f+=e[i++];return f in Um?{type:5,value:Um[f]}:{type:4,name:f}}function h(f){let b=[],$=!1,w;for(;i<t;)if(e[i]===f){w&&b.push(w),$=!0,i+=1;break}else e[i]===","?(b.push(w||{type:5,value:void 0}),i+=1):w=v();return $||s(`Expected ${f}`),b}function l(){let f;if(e[i]==="("){if(i+=1,f=v(),n(),e[i]===")")return i+=1,f;s("Unclosed (")}else f=a();for(n();".[(".includes(e[i]);)e[i]==="."?(i++,n(),f={type:6,object:f,computed:!1,property:a()}):e[i]==="["?(i++,f={type:6,object:f,computed:!0,property:v()},n(),e[i]!=="]"&&s("Unclosed ["),i++):e[i]==="("&&(i++,f={type:2,args:h(")"),callee:f}),n();return f}function c(){n();for(let f of[3,2,1]){let b=e.substr(i,f);if(b in Hm)return i+=f,b}}function p(){n();let f=e[i];if(ec.test(f)||f===".")return r();if(f==="'"||f==='"')return o();if(f==="[")return i+=1,{type:0,elements:h("]")};if(f in zm)return i+=1,{type:7,operator:f,argument:p()};if(ic.test(f)||f==="(")return l();s("Expression parsing error")}function m(){let f=p(),b=c();if(!b)return f;let $=p();$||s(`Expected expression after ${b}`);let w,x=[f,b,$];for(;b=c();){let Gt=Fm[b],Ft=b;for(;x.length>2&&Gt<=Fm[x[x.length-2]];)$=x.pop(),b=x.pop(),f=x.pop(),w={type:1,operator:b,left:f,right:$},x.push(w);w=p(),w||s(`Expected expression after ${Ft}`),x.push(Ft,w)}let z=x.length-1;for(w=x[z];z>1;)w={type:1,operator:x[z-1],left:x[z-2],right:w},z-=2;return w}function v(){let f=m();if(n(),f&&e[i]==="?"){i+=1;let b=v();if(b||s("Expected expression"),n(),e[i]===":"){i++;let $=v();return $||s("Expected expression"),{type:3,test:f,consequent:b,alternate:$}}else s("Expected :")}else return f}let M=v();return i<e.length&&s(`Unexpected "${e[i]}"`),M}var jo=[void 0,void 0];function ke(e,t,i){switch(e.type){case 0:let s=e.elements.map(M=>ke(M,t,i)[0]);return s.some(M=>M===void 0)?jo:[s,void 0];case 1:let n=ke(e.left,t,i)[0],r=ke(e.right,t,i)[0];return"+-**/%".includes(e.operator)&&(n===void 0||r===void 0)?jo:[Hm[e.operator](n,r),void 0];case 2:let[o,a]=ke(e.callee,t,i),h=e.args.map(M=>ke(M,t,i)[0]);return h.some(M=>M===void 0)||typeof o!="function"?jo:[o.apply(a,h),void 0];case 3:let l=ke(e.consequent,t,i),c=ke(e.alternate,t,i);return ke(e.test,t,i)[0]?l:c;case 4:return[i[e.name]||t[e.name],void 0];case 5:return[e.value,void 0];case 6:let p=ke(e.object,t,i)[0],m=e.computed?ke(e.property,t,i)[0]:e.property.name;return p?[p[m],p]:[void 0,void 0];case 7:let v=ke(e.argument,t,i)[0];return v===void 0&&e.operator!=="!"?jo:[zm[e.operator](v),void 0]}}function Be(e){let t=_x(e);return t?(i={},s={})=>ke(t,i,s)[0]:(i={})=>{}}var Nx=/\${([^}]+)}/g;function jm(e){let t=e.split(Nx),i=t.map((s,n)=>n%2?Be(s.replace(/×/g,"*")):void 0);return s=>t.map((n,r)=>{if(!(r%2))return n;let o=i[r](s);return typeof o=="number"&&o<0?`\u2013${-o}`:o}).join("")}var lr="ontouchstart"in window,Mn="onpointerdown"in window;function Ui(e){if(e.touches){let t=e.targetTouches.length?e.targetTouches:e.changedTouches;return new d(t[0].clientX,t[0].clientY)}else return new d(e.clientX||0,e.clientY||0)}function ri(e,t){return Ui(e).transform(t.inverseTransformMatrix)}function Dx(e){if(e instanceof PointerEvent&&e.pointerType==="mouse")return Pt(e.target);let t=Ui(e);return Pt(document.elementFromPoint(t.x,t.y)||void 0)}function Gx(e){if(e._data.tapEvent)return;e._data.tapEvent=!0;let t;e.on("pointerdown",i=>t=Ui(i)),e.on("pointerup",i=>{if(!t)return;let s=Ui(i);d.distance(t,s)<6&&e.trigger("tap",i),t=void 0}),e.on("pointercancel",()=>t=void 0)}function qx(e){e._data.clickOutsideEvent||(e._data.clickOutsideEvent=!0,Nt.on("pointerdown",t=>{var i,s;let n=t.target,r=(s=(i=e._el).getRootNode)==null?void 0:s.call(i),o=Ui(t);(r==null?void 0:r.host)&&(n=r.elementFromPoint(o.x,o.y)),!(!n||e._el===n||e._el.contains(n))&&e.trigger("clickOutside",t)}))}function Bx(e){if(e._data.scrollEvents)return;e._data.scrollEvents=!0;let t=!1,i;function s(){let h=e.scrollTop;if(h===i){t=!1;return}i=h,e.trigger("scroll",{top:i}),window.requestAnimationFrame(s)}function n(){t||window.requestAnimationFrame(s),t=!0}(e.type==="window"?window:e._el).addEventListener("scroll",n);function o(){window.addEventListener("touchmove",n),window.addEventListener("touchend",a)}function a(){window.removeEventListener("touchmove",n),window.removeEventListener("touchend",a)}e._el.addEventListener("touchstart",function(h){h.handled||o()})}var sc;function Hx(e){for(let t of e){let i=t.isIntersecting?"enterViewport":"exitViewport";setTimeout(()=>Pt(t.target).trigger(i))}}function Wm(e){if(!e._data.intersectionEvents){if(e._data.intersectionEvents=!0,!window.IntersectionObserver){let t=!1;Nt.on("scroll",()=>{let i=e.isInViewport;t&&!i?(e.trigger("exitViewport"),t=!1):i&&!t&&(e.trigger("enterViewport"),t=!0)});return}sc||(sc=new IntersectionObserver(Hx)),sc.observe(e._el)}}function zx(e,t=!1){if(t&&(e._data.resizeObserver&&e._data.resizeObserver.disconnect(),e._data.resizeObserver=void 0),!e._data.resizeObserver){if(window.ResizeObserver){let i=new window.ResizeObserver(()=>e.trigger("resize"));i.observe(e._el),e._data.resizeObserver=i}else if(window.MutationObserver){let i=new MutationObserver(()=>e.trigger("resize"));i.observe(e._el,{attributes:!0,childList:!0,characterData:!0,subtree:!0}),e._data.resizeObserver=i}}}function Zm(e){if(e._data.pointerPositionEvents)return;e._data.pointerPositionEvents=!0;let t=e.parent,i;t.on("pointerend",()=>i=void 0),t.on("pointermove",s=>{let n=i,r=Dx(s);i=r.equals(e)||r.hasParent(e),n!==void 0&&i&&!n&&e.trigger("pointerenter",s),!i&&n&&e.trigger("pointerleave",s)})}function nc(e,t){t._data[`_${e}`]||(t._data[`_${e}`]=!0,Mn?t.on(e.replace("mouse","pointer"),i=>{i.pointerType==="mouse"&&t.trigger(e,i)}):lr||t._el.addEventListener(e,i=>t.trigger(e,i)))}function Fx(e){e.on("keydown",t=>{if(t.metaKey||t.ctrlKey||H.isAndroid&&t.keyCode===229)return;let i=t.key||String.fromCharCode(t.which),s=i.toLowerCase(),n=!!t.shiftKey;e.trigger("key",{code:t.keyCode,key:s,char:i,shift:n})}),H.isAndroid&&e.type==="input"&&e.on("input",t=>{let i=t.data[t.data.length-1],s=i.toLowerCase();e.trigger("key",{code:void 0,key:s,char:i}),e.value=""})}var Wo={scrollwheel:"DOMMouseScroll mousewheel",pointerdown:Mn?"pointerdown":lr?"touchstart":"mousedown",pointermove:Mn?"pointermove":lr?"touchmove":"mousemove",pointerup:Mn?"pointerup":lr?"touchend":"mouseup",pointercancel:Mn?"pointercancel":"touchcancel",pointerstop:Mn?"pointerup pointercancel":lr?"touchend touchcancel":"mouseup"},Zo={scroll:Bx,tap:Gx,clickOutside:qx,key:Fx,mousedown:nc.bind(void 0,"mousedown"),mousemove:nc.bind(void 0,"mousemove"),mouseup:nc.bind(void 0,"mouseup"),pointerenter:Zm,pointerleave:Zm,enterViewport:Wm,exitViewport:Wm,resize:zx};function Ux(e,t,i,s){if(t in Zo)Zo[t](e,!1);else if(t in Wo){let n=Et(Wo[t]);for(let r of n)e._el.addEventListener(r,i,s)}else e._el.addEventListener(t,i,s)}function jx(e,t,i){if(t in Zo)(!e._events[t]||!e._events[t].length)&&Zo[t](e,!0);else if(i&&t in Wo){let s=Et(Wo[t]);for(let n of s)e._el.removeEventListener(n,i)}else i&&e._el.removeEventListener(t,i)}var Ko=0,rc=new Map;function Km(e,t){rc.set(e,t)}function Wx(e){if(Ko++,e(),Ko--,Ko===0){for(let[t,i]of rc.entries())t(i);rc.clear()}}function ji(e,t){let i=new Map,s=new Map,n=new Set,r,o=0;function a(w){r=w;let x=w($,!0);return r=void 0,x}function h(w){for(let x of i.values())x.has(w)&&x.delete(w);n.delete(w)}function l(w,x){return n.add(w),x?void 0:w($,!0)}function c(w,x){s.has(w)&&h(s.get(w));let z=()=>{e[w]=x($),r===z&&(r=void 0),p(w)};s.set(w,z),a(z)}function p(w){if(Ko>0){for(let x of i.get(w)||[])Km(x,e);for(let x of n)Km(x,e)}else{for(let x of i.get(w)||[])x(e);for(let x of n)x(e)}}function m(){for(let w of i.values())for(let x of w)x(e);for(let w of n)w(e)}function v(w){Wx(()=>{for(let[x,z]of Object.entries(w))$[x]=z})}function M(){for(o+=1;`_x${o}`in e;)o+=1;return`_x${o}`}function f(){e={},i.clear(),s.clear(),o=0}function b(w){!t||t.watch(()=>$[w]=t[w])}let $=new Proxy(e,{get(w,x){return x==="watch"?a:x==="unwatch"?h:x==="watchAll"?l:x==="setComputed"?c:x==="forceUpdate"?m:x==="assign"?v:x==="getKey"?M:x==="clear"?f:x==="_internal"?[e,i]:(r&&(i.has(x)||i.set(x,new Set),i.get(x).add(r)),x in e||b(x),e[x])},set(w,x,z){return e[x]===z||(e[x]=z,s.has(x)&&(h(s.get(x)),s.delete(x)),p(x)),!0},deleteProperty(w,x){return delete e[x],i.delete(x),s.delete(x),!0}});return $}var Zx={A:7,C:6,H:1,L:2,M:2,Q:4,S:4,T:2,V:1,Z:0},Kx=/[astvzqmhlc]([^astvzqmhlc]*)/ig,Xx=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig;function Xo(e){let t=[],i;for(let s of e.match(Kx)||[]){let n=s[0].toUpperCase();if(n==="Z"){t.push({type:"Z",points:[]});continue}let r=(s.slice(1).match(Xx)||[]).map(a=>+a),o=n===s[0];for(let[a,h]of dn(r,Zx[n]).entries()){let l=[],c=n==="M"&&a>0?"L":n,p;n==="H"?(c="L",l=[new d(h[0],o&&(i==null?void 0:i.y)||0)]):n==="V"?(c="L",l=[new d(o&&(i==null?void 0:i.x)||0,h[0])]):n==="A"?(c="A",l=[new d(h[5],h[6])],p=h.slice(0,5)):"MLCSQT".includes(n)&&(l=dn(h,2).map(m=>new d(m[0],m[1]))),!o&&i&&(l=l.map(m=>m.translate(i))),i=G(l),t.push({type:c,points:l,options:p})}}return t}function As(e){return e?Xo(e).map(i=>G(i.points)).filter(i=>!!i):[]}var Yo=class{constructor(e){this._el=e,this._data={},this._events={},this.type="default",e._view=this}get id(){return this._el.id}get data(){return this._el.dataset}get tagName(){return this._el.tagName.toUpperCase()}equals(e){return this._el===e._el}addClass(e){for(let t of Et(e))this._el.classList.add(t)}removeClass(e){for(let t of Et(e))this._el.classList.remove(t)}hasClass(e){return this._el.classList.contains(e)}toggleClass(e){return this._el.classList.toggle(e)}setClass(e,t){t?this.addClass(e):this.removeClass(e)}attr(e){return this._el.getAttribute(e)||""}hasAttr(e){return this._el.hasAttribute(e)}setAttr(e,t){t===void 0?this.removeAttr(e):this._el.setAttribute(e,t.toString())}removeAttr(e){this._el.removeAttribute(e)}get attributes(){return Array.from(this._el.attributes||[])}get html(){return this._el.innerHTML||""}set html(e){this._el.innerHTML=e}get text(){return this._el.textContent||""}set text(e){this._el.textContent=e}set textStr(e){this._el.textContent=`${e}`}blur(){this._el.blur()}focus(){this._el.focus()}getParentModel(){let e=this.parent;return e?e.model||e.getParentModel():void 0}bindModel(e,t=!0){var i;if(!this.model){if(this.model=e,this.hasAttr(":for"))return this.makeDynamicList(e);for(let{name:s,value:n}of this.attributes)this.makeDynamicAttribute(s,n,e);for(let s of this.childNodes)if(s instanceof Text){if((i=s.textContent)==null?void 0:i.includes("${")){let n=jm(s.textContent);e.watch(()=>s.textContent=n(e)||"")}}else t&&s.bindModel(e)}}bindVariable(e,t){}makeDynamicAttribute(e,t,i){if(e.startsWith("@")){let s=e.slice(1),n=Be(t);this.on(s,r=>n(i,{$event:r}))}else if(e===":show"){let s=Be(t);i.watch(()=>this.toggle(!!s(i)))}else if(e===":if"){let s=Be(t),n=Pt(document.createComment(""));this.insertBefore(n);let r=!0;i.watch(()=>{let o=!!s(i);o!==r&&(o&&n.insertBefore(this),o||this.detach(),r=o)})}else if(e===":html"){let s=Be(t);i.watch(()=>this.html=s(i)||"")}else if(e===":draw"){let s=Be(t);i.watch(()=>this.draw(s(i)))}else if(e===":class"){let s=Be(t),n=`${this.attr("class")} `;i.watch(()=>this.setAttr("class",n+s(i)))}else if(e===":bind")this.bindVariable(i,t);else if(e.startsWith(":")){let s=Be(t),n=e.slice(1);i.watch(()=>this.setAttr(n,s(i)))}else if(t.includes("${")){let s=jm(t);i.watch(()=>this.setAttr(e,s(i)||""))}(e.startsWith("@")||e.startsWith(":"))&&this.removeAttr(e)}makeDynamicList(e){let[t,i]=this.attr(":for").split(" in ");this.removeAttr(":for");let s=Be(i),n=Pt(document.createComment(""));this.insertBefore(n),this.detach();let r=[],o=0;e.watch(()=>{let a=s(e);Array.isArray(a)||(a=[]);for(let h=a.length;h<o;++h)r[h].detach();for(let h=o;h<r.length;++h)n.insertBefore(r[h]);for(let h=r.length;h<a.length;++h){let l=this.copy(!0);l.bindModel(ji({[t]:void 0},e)),n.insertBefore(l),r.push(l)}o=a.length;for(let h=0;h<o;++h)r[h].model[t]=a[h]})}get bounds(){return this._el.getBoundingClientRect()}get boundsRect(){let e=this.bounds;return new A(new d(e.x,e.y),e.width,e.height)}contains(e){return this.boundsRect.contains(e)}get isInViewport(){if(this.height===0)return!1;let e=this.bounds;return at(e.top,-e.height,H.height)}get topLeftPosition(){let e=this.bounds;return new d(e.left,e.top)}get boxCenter(){let e=this.bounds;return new d(e.left+e.width/2,e.top+e.height/2)}get scrollWidth(){return this._el.scrollWidth}get scrollHeight(){return this._el.scrollHeight}get scrollTop(){return this._el.scrollTop}set scrollTop(e){this._el.scrollTop=e,this.trigger("scroll",{top:e,left:this.scrollLeft})}get scrollLeft(){return this._el.scrollLeft}set scrollLeft(e){this._el.scrollLeft=e,this.trigger("scroll",{top:this.scrollTop,left:e})}scrollTo(e,t=1e3,i="cubic"){e<0&&(e=0);let s=this.scrollTop,n=e-s;this._data.scrollAnimation&&this._data.scrollAnimation.cancel(),this._data.scrollAnimation=ot(r=>{let o=s+n*mt(i,r);this.scrollTop=o,this.trigger("scroll",{top:o})},t)}scrollBy(e,t=1e3,i="cubic"){!e||this.scrollTo(this.scrollTop+e,t,i)}css(e,t){if(t===void 0){if(typeof e=="string")return window.getComputedStyle(this._el).getPropertyValue(e);{let i=Object.keys(e);for(let s of i)this._el.style.setProperty(s,`${e[s]}`)}}else typeof e=="string"&&this._el.style.setProperty(e,`${t}`)}get transform(){return this.css("transform").replace("none","")}get transformMatrix(){let e=this.transform;if(!e)return[[1,0,0],[0,1,0]];let t=e.match(/matrix\(([0-9,.\s-]*)\)/);if(!t||!t[1])return[[1,0,0],[0,1,0]];let i=t[1].split(",");return[[+i[0],+i[2],+i[4]],[+i[1],+i[3],+i[5]]]}get scale(){let e=this.transformMatrix;return[e[0][0],e[1][1]]}setTransform(e,t=0,i=1){let s="";e&&(s+=`translate(${ht(e.x,.1)}px,${ht(e.y,.1)}px)`),t&&(s+=` rotate(${t}rad)`),i&&(s+=` scale(${i})`),this._el.style.transform=s}translate(e,t){this.setTransform(new d(e,t))}show(){this.hasAttr("hidden")&&this.removeAttr("hidden"),this.data.display==="visibility"?this._el.style.visibility="visible":this._el.style.display=this.data.display||"block"}hide(){this.data.display==="visibility"?this._el.style.visibility="hidden":this._el.style.display="none"}toggle(e){e?this.show():this.hide()}is(e){return this._el.matches?this._el.matches(e):Array.from(document.querySelectorAll(e)).includes(this._el)}index(){let e=0,t=this._el;for(;(t=t.previousSibling||void 0)!==void 0;)++e;return e}prepend(e){let t=this._el.childNodes;t.length?this._el.insertBefore(e._el,t[0]):this._el.appendChild(e._el)}append(e){this._el.appendChild(e instanceof Text?e:e._el)}insertBefore(e){this.parent._el.insertBefore(e._el,this._el)}insertAfter(e){let t=this._el.nextSibling;t?this.parent._el.insertBefore(e._el,t):this.parent._el.appendChild(e._el)}get next(){return Pt(this._el.nextSibling)}get prev(){return Pt(this._el.previousSibling)}$(e){return Pt(e,this)}$$(e){return Yx(e,this)}get parent(){return Pt(this._el.parentElement||void 0)}parents(e){let t=[],i=this.parent;for(;i;)(!e||i.is(e))&&t.push(i),i=i.parent;return t}hasParent(...e){let t=e.map(s=>s._el),i=this._el.parentNode;for(;i;){if(gt(i,...t))return!0;i=i.parentNode}return!1}get children(){return Array.from(this._el.children||[],e=>Pt(e))}get childNodes(){return Array.from(this._el.childNodes,e=>{if(!(e instanceof Comment))return e instanceof Text?e:Pt(e)}).filter(e=>e)}restartAnimation(){let e=this.next,t=this.parent;this.detach(),e?e.insertBefore(this):t.append(this)}detach(){this._el&&this._el.parentNode&&this._el.parentNode.removeChild(this._el)}remove(){this.detach()}removeChildren(){for(;this._el.firstChild;)this._el.removeChild(this._el.firstChild)}on(e,t,i){for(let s of Et(e))s in this._events?this._events[s].includes(t)||this._events[s].push(t):this._events[s]=[t],Ux(this,s,t,i)}one(e,t,i){let s=n=>{this.off(e,s),t(n)};this.on(e,s,i)}off(e,t){for(let i of Et(e))i in this._events&&(this._events[i]=t?this._events[i].filter(s=>s!==t):[]),jx(this,i,t)}trigger(e,t={}){for(let i of Et(e)){if(!this._events[i])return;for(let s of this._events[i])s.call(this,t)}}onKeyDown(e,t){let i=Et(e).map(s=>He[s]||s);this._el.addEventListener("keydown",s=>{i.indexOf(s.keyCode)>=0&&t(s)})}onAttr(e,t){new MutationObserver(s=>{for(let n of s)n.type==="attributes"&&n.attributeName===e&&t(this.attr(e))}).observe(this._el,{attributes:!0}),t(this.attr(e),!0)}onPromise(e,t=!1){return t?Promise.resolve():new Promise(i=>this.one("solve",()=>i()))}animate(e,t=400,i=0,s="ease-in-out"){return se(this,e,t,i,s)}enter(e="fade",t=500,i=0){return Qx(this,e,t,i)}exit(e="fade",t=500,i=0,s=!1){return Jx(this,e,t,i,s)}effect(e){this.one("animationend",()=>this.removeClass(`effects-${e}`)),this.addClass(`effects-${e}`)}copy(e=!0,t=!0,i){let s=Pt(this._el.cloneNode(e));return t&&s.copyInlineStyles(this,e,i),s}copyInlineStyles(e,t=!0,i){let s=window.getComputedStyle(e._el);for(let n of i||Array.from(s))this.css(n,s.getPropertyValue(n));if(t){let n=this.children,r=e.children;for(let o=0;o<n.length;++o){let a=n[o].tagName==="foreignObject"?void 0:i;n[o].copyInlineStyles(r[o],!0,a)}}}},Vs=class extends Yo{get offsetTop(){return this._el.offsetTop}get offsetLeft(){return this._el.offsetLeft}get offsetParent(){return Pt(this._el.offsetParent||void 0)}get width(){return this._el.offsetWidth}get height(){return this._el.offsetHeight}get innerWidth(){let e=parseFloat(this.css("padding-left")),t=parseFloat(this.css("padding-right"));return this._el.clientWidth-e-t}get innerHeight(){let e=parseFloat(this.css("padding-bottom")),t=parseFloat(this.css("padding-top"));return this._el.clientHeight-e-t}get outerWidth(){let e=parseFloat(this.css("margin-left")),t=parseFloat(this.css("margin-right"));return this.width+e+t||0}get outerHeight(){let e=parseFloat(this.css("margin-bottom")),t=parseFloat(this.css("margin-top"));return this.height+e+t||0}get positionTop(){let e=this._el,t=0;for(;e;)t+=e.offsetTop,e=e.offsetParent;return t}get positionLeft(){let e=this._el,t=0;for(;e;)t+=e.offsetLeft,e=e.offsetParent;return t}offset(e){if(e._el===this._el.offsetParent){let t=this.offsetTop+e._el.clientTop,i=this.offsetLeft+e._el.clientLeft,s=t+this.height,n=i+this.width;return{top:t,left:i,bottom:s,right:n}}else{let t=e._el.getBoundingClientRect(),i=this._el.getBoundingClientRect();return{top:i.top-t.top,left:i.left-t.left,bottom:i.bottom-t.top,right:i.right-t.left}}}},Xm=["font-family","font-size","font-style","font-weight","letter-spacing","text-decoration","color","display","visibility","alignment-baseline","baseline-shift","text-anchor","clip","clip-path","clip-rule","mask","opacity","filter","fill","fill-rule","marker","marker-start","marker-mid","marker-end","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-width","text-rendering","transform","dominant-baseline","transform-origin","transform-box","paint-order"],Ym=class extends Yo{constructor(){super(...arguments);this.type="svg"}get $ownerSVG(){return Pt(this._el.ownerSVGElement||void 0)}get width(){return this.bounds.width}get height(){return this.bounds.height}get positionLeft(){let e=this._el.getBBox().x+this._el.getCTM().e;return this.$ownerSVG.positionLeft+e}get positionTop(){let e=this._el.getBBox().y+this._el.getCTM().f;return this.$ownerSVG.positionTop+e}get inverseTransformMatrix(){let e=this._el.getScreenCTM().inverse(),t=[[e.a,e.c,e.e],[e.b,e.d,e.f]];if(H.isFirefox){let i=this.transformMatrix;t[0][2]-=i[0][2],t[1][2]-=i[1][2]}return t}setTransform(e,t=0,i=1){let s=e?`translate(${ht(e.x,.1)} ${ht(e.y,.1)})`:"",n=T(t,0)?"":`rotate(${t*180/Math.PI})`,r=T(i,1)?"":`scale(${i})`;this.setAttr("transform",[s,n,r].join(" "))}get strokeLength(){if(this._el instanceof SVGGeometryElement)return this._el.getTotalLength();{let e=this.bounds;return 2*e.height+2*e.width}}getPointAtLength(e){if(this._el instanceof SVGGeometryElement){let t=this._el.getPointAtLength(e);return new d(t.x,t.y)}else return new d(0,0)}getPointAt(e){return this.getPointAtLength(e*this.strokeLength)}get points(){return As(this.attr("d"))}set points(e){let t=e.length?`M${e.map(i=>`${i.x},${i.y}`).join("L")}`:"";this.setAttr("d",t)}addPoint(e){let t=`${this.attr("d")} L ${e.x},${e.y}`;this.setAttr("d",t)}get center(){let e=+this.attr(this.tagName==="TEXT"?"x":"cx"),t=+this.attr(this.tagName==="TEXT"?"y":"cy");return new d(e,t)}setCenter(e){this.setAttr(this.tagName==="TEXT"?"x":"cx",e.x),this.setAttr(this.tagName==="TEXT"?"y":"cy",e.y)}setLine(e,t){this.setAttr("x1",e.x),this.setAttr("y1",e.y),this.setAttr("x2",t.x),this.setAttr("y2",t.y)}setRect(e){this.setAttr("x",e.p.x),this.setAttr("y",e.p.y),this.setAttr("width",e.w),this.setAttr("height",e.h)}draw(e,t={}){if(!e)return this.setAttr("d","");let i={mark:this.attr("mark"),arrows:this.attr("arrows"),size:+this.attr("size")||void 0,fill:this.hasClass("fill"),round:this.hasAttr("round")};this.setAttr("d",si(e,Object.assign(t,i)))}},tb=class extends Ym{get viewBox(){return this._el.viewBox.baseVal||{width:0,height:0}}get $ownerSVG(){return this}get positionLeft(){return parseInt(this.css("margin-left"))+this.parent.positionLeft}get positionTop(){return parseInt(this.css("margin-top"))+this.parent.positionTop}get svgWidth(){return this.viewBox.width||this.width}get svgHeight(){return this.viewBox.height||this.height}drawPath(e,t={},i={}){let s=u("path",t,this);return s.draw(e,i),s}pngImage(e,t,i){return qe(this,null,function*(){let s=this.copy(!0,!0,Xm);t||(t=e||this.svgHeight),e||(e=this.svgWidth),s.setAttr("width",e),s.setAttr("height",t),s.setAttr("viewBox",i||this.attr("viewBox")||`0 0 ${this.svgWidth} ${this.svgHeight}`),s.setAttr("xmlns","http://www.w3.org/2000/svg");let n=s.$$('image[href^="http"]');yield Promise.all(n.map(l=>qe(this,null,function*(){let c=yield Uo(l.attr("href")),p=u("canvas",{width:c.width,height:c.height});p.ctx.drawImage(c,0,0,c.width,c.height);let m=yield p.pngImage;l.setAttr("href",m)})));let r=new XMLSerializer().serializeToString(s._el),o=`data:image/svg+xml;utf8,${encodeURIComponent(r)}`,a=u("canvas",{width:e,height:t});a.ctx.fillStyle=Wi.css("background-color")||"white",a.ctx.fillRect(0,0,e,t);let h=yield Uo(o);return a.ctx.drawImage(h,0,0,e,t),a.pngImage})}svgImage(e,t,i){return qe(this,null,function*(){let s=this.copy(!0,!0,Xm);t||(t=e||this.svgHeight),e||(e=this.svgWidth),s.setAttr("width",e),s.setAttr("height",t),s.setAttr("viewBox",i||this.attr("viewBox")||`0 0 ${this.svgWidth} ${this.svgHeight}`),s.setAttr("xmlns","http://www.w3.org/2000/svg");let n=new XMLSerializer().serializeToString(s._el);return`data:image/svg+xml;utf8,${encodeURIComponent(n)}`})}downloadImage(e,t="png",i,s,n){let r=H.isIOS?window.open("","_blank"):void 0;this[t==="svg"?"svgImage":"pngImage"](i,s,n).then(a=>{if(r)return r.location.href=a;u("a",{download:e,href:a,target:"_blank"})._el.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!1,cancelable:!0}))})}},Qm=class extends Vs{constructor(){super(...arguments);this.type="window"}get width(){return window.innerWidth}get height(){return window.innerHeight}get innerWidth(){return window.innerWidth}get innerHeight(){return window.innerHeight}get outerWidth(){return window.outerWidth}get outerHeight(){return window.outerHeight}get scrollWidth(){return document.body.scrollWidth}get scrollHeight(){return document.body.scrollHeight}get scrollTop(){return window.pageYOffset}set scrollTop(e){document.body.scrollTop=document.documentElement.scrollTop=e,this.trigger("scroll",{top:e,left:this.scrollLeft})}get scrollLeft(){return window.pageXOffset}set scrollLeft(e){document.body.scrollLeft=document.documentElement.scrollLeft=e,this.trigger("scroll",{top:this.scrollTop,left:e})}},eb=class extends Vs{constructor(){super(...arguments);this.type="form"}get action(){return this._el.action}get formData(){let e={};for(let t of Array.from(this._el.elements)){let i=t.name||t.id;i&&(e[i]=t.value)}return e}get isValid(){return this._el.checkValidity()}},ib=class extends Vs{constructor(){super(...arguments);this.type="input"}get checked(){return this._el.checked||!1}set checked(e){this._el.checked=e}get value(){return this._el.value}set value(e){this._el.value=e}bindVariable(e,t){let i=this._el.type==="number",s=this._el.type==="checkbox";if(t in e?s?this.checked=e[t]:this.value=e[t]:this.value&&(s?e[t]=this.checked:e[t]=this.value),i){let n=this.hasAttr("min")?+this.attr("min"):-Infinity,r=this.hasAttr("max")?+this.attr("max"):Infinity;this.change(o=>e[t]=k(+o,n,r)),this.on("blur",()=>this.value=e[t])}else s?this.on("change",()=>e[t]=this.checked):this.change(n=>e[t]=n);e.watch(()=>{s?this.checked=e[t]:this.value=e[t],this.trigger("model-change",{defaultPrevented:!0})})}setInputPattern(e){if(isNaN(+e))return;let t=e.match(/^[0-9]+$/);this.setAttr("inputmode",t?"numeric":"decimal"),t&&this.setAttr("pattern","[0-9]*")}change(e){let t=this.value||"";this.on("change keyup input paste model-change",i=>{this.value!==t&&(t=this.value.trim(),i.defaultPrevented||e(t))})}validate(e){this.change(t=>this.setValidity(e(t)))}setValidity(e){this._el.setCustomValidity(e)}get isValid(){return this._el.checkValidity()}},sb=class extends Vs{constructor(){super(...arguments);this.type="canvas"}getContext(e="2d",t={}){return this._el.getContext(e,t)}get pngImage(){return this._el.toDataURL("image/png")}get canvasWidth(){return this._el.width}get canvasHeight(){return this._el.height}get ctx(){return this._ctx||(this._ctx=this.getContext()),this._ctx}draw(e,t={}){this.ctx.save(),Dm(this.ctx,e,t),this.ctx.restore()}clear(){this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight)}fill(e){this.ctx.save(),this.ctx.fillStyle=e,this.ctx.fillRect(0,0,this.canvasWidth,this.canvasHeight),this.ctx.restore()}clearCircle(e,t){this.ctx.save(),this.ctx.globalCompositeOperation="destination-out",this.ctx.beginPath(),this.ctx.arc(e.x,e.y,t,0,2*Math.PI,!1),this.ctx.fill(),this.ctx.restore()}downloadImage(e){let t=this.pngImage;u("a",{download:e,href:t,target:"_blank"})._el.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!1,cancelable:!0}))}},nb=class extends Vs{play(){return this._el.play()||Promise.resolve()}pause(){return this._el.pause()}},Jm=["path","rect","circle","ellipse","polygon","polyline","g","defs","marker","line","text","tspan","pattern","mask","svg","foreignObject","image","use"];function Pt(e,t){if(!e)return;let i=t?t._el:document.documentElement,s=typeof e=="string"?i.querySelector(e):e;if(!s)return;if(s._view)return s._view;let n=(s.tagName||"").toLowerCase();return n==="svg"?new tb(s):n==="canvas"?new sb(s):n==="form"?new eb(s):n==="input"||n==="select"||n==="textarea"?new ib(s):n==="video"||n==="audio"?new nb(s):Jm.includes(n)?new Ym(s):new Vs(s)}function Yx(e,t){let i=t?t._el:document.documentElement,s=e?i.querySelectorAll(e):[];return Array.from(s,n=>Pt(n))}function u(e,t={},i){let s=Jm.includes(e)?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);for(let[r,o]of Object.entries(t))o!==void 0&&(r==="id"?s.id=o:r==="html"?s.innerHTML=o:r==="text"?s.textContent=o:r==="path"?s.setAttribute("d",si(o)):s.setAttribute(r,o));let n=Pt(s);return i&&i.append(n),n}var Nt=new Qm(document.body),Wi=new Qm(document.documentElement),He={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46},Qo="_M",Sn=window.navigator.userAgent.toLowerCase(),t0={};for(let[e,t]of Object.entries(He))t0[t]=e;var rb=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i,e0=/iphone|ipad|ipod/i,ob=/^((?!chrome|android).)*safari/i,i0,ab=class{constructor(){this.isMobile=rb.test(Sn),this.isRetina=(window.devicePixelRatio||1)>1,this.isTouch=!!window.Touch||"ontouchstart"in window,this.isChrome=!!window.chrome,this.isFirefox=Sn.indexOf("firefox")>=0,this.isAndroid=Sn.indexOf("android")>=0,this.isIOS=e0.test(Sn),this.isSafari=e0.test(Sn)||ob.test(Sn),this.loadQueue=[],this.loaded=!1,this.width=window.innerWidth,this.height=window.innerHeight,this.resizeCallbacks=[],this.theme={name:"light",isDark:!1},this.themeChangedCallbacks=[],this.themeOverride="",this.darkQuery=(i0=window.matchMedia)==null?void 0:i0.call(window,"(prefers-color-scheme: dark)");var e,t;window.onload=()=>this.afterLoad(),document.addEventListener("DOMContentLoaded",()=>this.afterLoad());let i=To(()=>this.applyResize());window.addEventListener("resize",i);try{(e=this.darkQuery)==null||e.addEventListener("change",()=>this.applyThemeChange())}catch(n){(t=this.darkQuery)==null||t.addListener(()=>this.applyThemeChange())}let s=this.getCookie("theme");s&&this.setTheme(s);try{this.localStorage=window.localStorage}catch(n){console.warn("Unable to access Local Storage in this context.")}}afterLoad(){if(!this.loaded){this.loaded=!0;for(let e of this.loadQueue)e();setTimeout(()=>this.resize())}}ready(e){this.loaded?e():this.loadQueue.push(e)}redraw(){document.body.offsetHeight}applyResize(){let e=window.innerWidth,t=window.innerHeight;if(!(this.width===e&&this.height===t)){this.width=e,this.height=t;for(let i of this.resizeCallbacks)i({width:this.width,height:this.height});Nt.trigger("scroll",{top:Nt.scrollTop})}}onResize(e){e({width:this.width,height:this.height}),this.resizeCallbacks.push(e)}offResize(e){let t=this.resizeCallbacks.indexOf(e);t>=0&&this.resizeCallbacks.splice(t,1)}resize(){this.applyResize()}applyThemeChange(){let e=this.theme.name,t=e==="dark"||e==="auto"&&this.darkQuery.matches;if(t!==this.theme.isDark){this.theme.isDark=t,Wi.setAttr("theme",this.themeOverride||(t?"dark":"light"));for(let i of this.themeChangedCallbacks)i(this.theme)}}setTheme(e){e!==this.theme.name&&(this.theme.name=e,this.setCookie("theme",e),this.applyThemeChange())}onThemeChange(e){this.themeChangedCallbacks.push(e)}getHash(){return window.location.hash.slice(1)}setHash(e){let t=document.body.scrollTop;window.location.hash=e,document.body.scrollTop=t}setURL(e,t=""){window.history.replaceState({},t,e),t&&(window.document.title=t)}getCookies(){let e=document.cookie.split(";"),t={};for(let i=0,s=e.length;i<s;++i){let n=e[i].split("=");t[decodeURIComponent(n[0]).trim()]=decodeURIComponent(n[1])}return t}getCookie(e){let t=document.cookie.match(new RegExp(`(^|;) ?${e}=([^;]*)(;|$)`));return t?t[2]:void 0}setCookie(e,t,i=60*60*24*365){let s=window.location.hostname.replace(/^[a-z]{2}\./,"");document.cookie=`${e}=${t};path=/;max-age=${i};domain=${s}`}deleteCookie(e){this.setCookie(e,"",-1)}setStorage(e,t){var i,s;let n=(e||"").split("."),r=El(((i=this.localStorage)==null?void 0:i.getItem(Qo))||void 0,{}),o=r;for(let a=0;a<n.length-1;++a)o[n[a]]===void 0&&(o[n[a]]={}),o=o[n[a]];o[n[n.length-1]]=t,(s=this.localStorage)==null||s.setItem(Qo,JSON.stringify(r))}getStorage(e){var t;let i=El((t=this.localStorage)==null?void 0:t.getItem(Qo),{});if(!e)return i;let s=(e||"").split("."),n=s.pop();for(let r of s){if(!(r in i))return;i=i[r]}return i[n]}deleteStorage(e){var t;e?this.setStorage(e,void 0):(t=this.localStorage)==null||t.setItem(Qo,"")}getActiveInput(){let e=document.activeElement;return(e==null?void 0:e.shadowRoot)&&(e=e.shadowRoot.activeElement),e===document.body?void 0:Pt(e)}onKey(e,t,i=!1){let s=Et(e),n=i?"keyup":"keydown";document.addEventListener(n,r=>{let o=t0[r.keyCode]||r.key;if(!s.includes(o))return;let a=this.getActiveInput();a&&a.is("input, textarea, [contenteditable]")||a&&["space","enter","tab"].includes(o)&&a.is("button, a, [tabindex]")||t(r,o)})}},H=window.BoostBrowser||new ab;window.BoostBrowser=H;var hb=/\bTrident\/[567]\b|\bMSIE (?:9|10)\.0\b/,lb=/\bAppleWebKit\/(\d+)\b/,cb=/\bEdge\/12\.(\d+)\b/,ub=hb.test(navigator.userAgent)||+(navigator.userAgent.match(cb)||[])[1]<10547||+(navigator.userAgent.match(lb)||[])[1]<537,oc={};function db(){if(!ub)return;Array.from(document.querySelectorAll("svg > use")).forEach(function(t){let i=t.getAttribute("xlink:href"),[s,n]=i.split("#");if(!s.length||!n)return;let r=t.parentNode;r.removeChild(t),s in oc||(oc[s]=fetch(s).then(a=>a.text())),oc[s].then(a=>{let h=document.implementation.createHTMLDocument("");h.documentElement.innerHTML=a;let c=h.getElementById(n).cloneNode(!0),p=document.createDocumentFragment();for(;c.childNodes.length;)p.appendChild(c.firstChild);r.appendChild(p)})})}var Jo=!1;setTimeout(()=>Jo=!0);var pb="cubic-bezier(0.175, 0.885, 0.32, 1.275)",fb="cubic-bezier(0.68, -0.275, 0.825, 0.115)",ks={cancel:()=>{},promise:Promise.resolve()};function ot(e,t){if(t===0)return e(1,0,()=>{}),ks;let i=Date.now(),s=Co(),n=0,r=!0,o=()=>{r=!1,s.reject()};function a(){r&&(!t||n<=t)&&window.requestAnimationFrame(a);let h=Date.now()-i;e(t?Math.min(1,h/t):h,h-n,o),t&&h>=t&&s.resolve(),n=h}return a(),{cancel:o,promise:s.promise}}function ta(e,t=0,i=0){switch(e){case"quad":return t**2;case"cubic":return t**3;case"quart":return t**4;case"quint":return t**5;case"circ":return 1-Math.sqrt(1-t**2);case"sine":return 1-Math.cos(t*Math.PI/2);case"exp":return t<=0?0:Math.pow(2,10*(t-1));case"back":return i||(i=1.70158),t*t*((i+1)*t-i);case"elastic":return i||(i=.3),-Math.pow(2,10*(t-1))*Math.sin(((t-1)*2/i-.5)*Math.PI);case"swing":return .5-Math.cos(t*Math.PI)/2;case"spring":return 1-Math.cos(t*4.5*Math.PI)*Math.exp(-t*6);case"bounce":return t<1/11?1/64-7.5625*(.5/11-t)*(.5/11-t):t<3/11?1/16-7.5625*(2/11-t)*(2/11-t):t<7/11?1/4-7.5625*(5/11-t)*(5/11-t):1-7.5625*(1-t)*(1-t);default:return t}}function mt(e,t=0,i=0){if(t===0)return 0;if(t===1)return 1;let[s,n]=e.split("-");return n==="in"?ta(s,t,i):n==="out"?1-ta(s,1-t,i):t<=.5?ta(s,2*t,i)/2:1-ta(s,2*(1-t),i)/2}function se(e,t,i=400,s=0,n="ease-in-out"){if(!Jo)return Object.keys(t).forEach(f=>{let b=t[f];e.css(f,Array.isArray(b)?b[1]:b)}),ks;n==="bounce-in"&&(n=pb),n==="bounce-out"&&(n=fb);let r="";H.isSafari&&(r=e._el.style.transition,e.css("transition","none"),H.redraw());let o=e._data.animation;o&&o.cancel();let a={},h={},l=Co(),c=window.getComputedStyle(e._el);Object.keys(t).forEach(f=>{let b=t[f],$=Wf(f);h[$]=Array.isArray(b)?b[0]:c.getPropertyValue(f),a[$]=Array.isArray(b)?b[1]:b,s&&e.css(f,h[$])});let p=a.height;a.height==="auto"&&(a.height=`${U(e.children.map(f=>f.outerHeight))}px`);let m,v=!1;sr(()=>{v||(m=e._el.animate([h,a],{duration:i,easing:n,fill:"forwards"}),m.onfinish=()=>{e._el&&Object.keys(t).forEach(f=>e.css(f,f==="height"?p:a[f])),H.isSafari&&e.css("transition",r),l.resolve(),m.cancel()})},s);let M={cancel(){v=!0,e._el&&Object.keys(t).forEach(f=>e.css(f,e.css(f))),m&&m.cancel()},promise:l.promise};return setTimeout(()=>e._data.animation=M),M}var mb=/matrix\([0-9.\-\s]+,[0-9.\-\s]+,[0-9.\-\s]+,[0-9.\-\s]+,([0-9.\-\s]+),([0-9.\-\s]+)\)/;function Qx(e,t="fade",i=500,s=0){if(e.show(),!Jo)return ks;let n=+e.css("opacity")||1;if(t==="fade")return se(e,{opacity:[0,n]},i,s);if(t==="pop"){let r=e.transform.replace(/scale\([0-9.]*\)/,"").replace(mb,"translate($1px,$2px)");return se(e,{opacity:[0,n]},i,s),se(e,{transform:[`${r} scale(0.5)`,`${r} scale(1)`]},i,s,"bounce-in")}else{if(t==="descend")return se(e,{opacity:[0,1],transform:["translateY(-50%)","none"]},i,s);if(t.startsWith("draw")){let r=e.strokeLength;e.css("stroke-dasharray",`${r}px`),e.css("opacity")||e.css("opacity",1);let o=t==="draw-reverse"?`${2*r}px`:0,a={"stroke-dashoffset":[`${r}px`,o]},h=se(e,a,i,s,"linear");return h.promise.then(()=>e.css("stroke-dasharray","")),h}else if(t.startsWith("slide")){let r={opacity:[0,n],transform:["translateY(50px)","none"]};return t.includes("down")&&(r.transform[0]="translateY(-50px)"),t.includes("right")&&(r.transform[0]="translateX(-50px)"),t.includes("left")&&(r.transform[0]="translateX(50px)"),se(e,r,i,s)}else if(t.startsWith("reveal")){let r={opacity:[0,n],height:[0,"auto"]};return t.includes("left")&&(r.transform=["translateX(-50%)","none"]),t.includes("right")&&(r.transform=["translateX(50%)","none"]),se(e,r,i,s)}}return ks}function Jx(e,t="fade",i=400,s=0,n=!1){if(!e._el)return ks;if(!Jo)return e.hide(),ks;if(e.css("display")==="none")return ks;let r;if(t==="fade")r=se(e,{opacity:[1,0]},i,s);else if(t==="pop"){let o=e.transform.replace(/scale\([0-9.]*\)/,"");se(e,{opacity:[1,0]},i,s),r=se(e,{transform:[`${o} scale(1)`,`${o} scale(0.5)`]},i,s,"bounce-out")}else if(t==="ascend")r=se(e,{opacity:[1,0],transform:["none","translateY(-50%)"]},i,s);else if(t.startsWith("draw")){let o=e.strokeLength;e.css("stroke-dasharray",o);let h={"stroke-dashoffset":[t==="draw-reverse"?`${2*o}px`:0,`${o}px`]};r=se(e,h,i,s,"linear")}else if(t.startsWith("slide")){let o={opacity:0,transform:"translateY(50px)"};t.includes("up")&&(o.transform="translateY(-50px)"),r=se(e,o,i,s)}else if(t.startsWith("reveal")){let o={opacity:0,height:0};t.includes("left")&&(o.transform="translateX(-50%)"),t.includes("right")&&(o.transform="translateX(50%)"),r=se(e,o,i,s)}return r.promise.then(()=>n?e.remove():e.hide()),r}var gb=Uf(["#cd0e66","#0f82f2","#22ab24","#fd8c00"]),vb=class{constructor(e){this.index=e,this.color=gb(),this.tilt=Math.floor(Math.random()*10)-10,this.tiltAngleIncrement=Math.random()*.07+.05,this.tiltAngle=0,this.x=Math.random()*H.width,this.y=(Math.random()-1)*H.height,this.r=Zt.uniform(10,30)}draw(e){e.beginPath(),e.lineWidth=this.r/2,e.strokeStyle=this.color,e.moveTo(this.x+this.tilt+this.r/4,this.y),e.lineTo(this.x+this.tilt,this.y+this.tilt+this.r/4),e.stroke()}update(e,t){this.tiltAngle+=this.tiltAngleIncrement,this.y+=(Math.cos(e)+3+this.r/2)/2,this.x+=Math.sin(e),this.tilt=Math.sin(this.tiltAngle-this.index/3)*15,this.x<-20?(this.x=-20,this.y=Math.random()*H.height,this.tilt=Math.floor(Math.random()*10)-20):this.x>H.width+20?(this.x=H.width+20,this.y=Math.random()*H.height,this.tilt=Math.floor(Math.random()*10)-20):t&&this.y>H.height&&(this.x=Math.random()*H.width,this.y=-10,this.tilt=Math.floor(Math.random()*10)-20)}},wb="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999",Ls=void 0;function s0(e=2e3,t=150){Ls||(Ls=u("canvas",{style:wb},Nt)),Ls.setAttr("width",H.width),Ls.setAttr("height",H.height),Ls.show();let i=Ls.ctx,s=F(r=>new vb(r),t),n=ot(r=>{i.clearRect(0,0,H.width,H.height);let o=r<e,a=0;for(let h of s)h.draw(i),h.update(r,o),h.y<H.height&&(a+=1);a||(n.cancel(),Ls.hide())})}var yb="position: fixed; top: 0; left: 0; width: 100%; height: 4px; background: #0f82f2; pointer-events: none; z-index: 9999; will-change: transform;";function n0(e,t){let i=t.regex.exec(e);if(i){i.shift();let s={};for(let[n,r]of t.params.entries())s[r]=i[n];return s}else return}function xb(e,t,i){return qe(this,null,function*(){return e.template?typeof e.template=="string"?e.template:e.template(t):(yield fetch(i+(i.indexOf("?")>=0?"&xhr=1":"?xhr=1"))).text()})}var r0=document.readyState==="complete";window.addEventListener("load",()=>setTimeout(()=>r0=!0));"scrollRestoration"in window.history&&(window.history.scrollRestoration="manual");var bb=class extends nr{constructor(){super(...arguments);this.$viewport=Nt,this.views=[],this.active={path:"",hash:""},this.preloaded=!1,this.transition=!1,this.noLoad=!1,this.initialise=()=>{}}setup(e={}){e.$viewport&&(this.$viewport=e.$viewport),e.initialise&&(this.initialise=e.initialise),e.preloaded&&(this.preloaded=e.preloaded),e.transition&&(this.transition=e.transition),e.noLoad&&(this.noLoad=e.noLoad),e.click&&Nt.on("click",t=>this.onLinkClick(t)),e.history&&window.addEventListener("popstate",t=>qe(this,null,function*(){var i;if(!r0||!((i=t.state)==null?void 0:i.path))return;(yield this.load(t.state.path,t.state.hash))||window.history.pushState(this.active,"",this.active.path+this.active.hash)}))}view(e,{enter:t,exit:i,template:s}={}){let n=(e.match(/:\w+/g)||[]).map(p=>p.substr(1)),r=`${e.replace(/:\w+/g,"([\\w-]+)").replace("/","\\/")}\\/?`,o=e.includes("?")?"":"(\\?.*)?",h={regex:new RegExp(`^${r}${o}$`,"i"),params:n,enter:t,exit:i,template:s};this.views.push(h);let l=window.location.pathname+window.location.search,c=n0(l,h);!c||(this.active={path:l,hash:window.location.hash},window.history.replaceState(this.active,"",this.active.path+this.active.hash),H.ready(()=>{setTimeout(()=>{this.preloaded?(this.initialise(this.$viewport,c),h.enter&&h.enter(this.$viewport,c)):this.loadView(h,c)})}))}paths(...e){for(let t of e)this.view(t)}getView(e){for(let t of this.views){let i=n0(e,t);if(i)return{view:t,params:i}}}load(e,t){return qe(this,null,function*(){if(e===this.active.path&&t!==this.active.hash)return this.trigger("hashChange",t.slice(1)),this.trigger("change",e+t),this.active={path:e,hash:t},!0;let i=this.getView(e);return!i||this.beforeChange&&!(yield this.beforeChange())?!1:(this.active={path:e,hash:t},this.trigger("change",e+t),window.ga&&window.ga("send","pageview",e+t),this.noLoad?i.view.enter&&i.view.enter(this.$viewport,i.params):this.loadView(i.view,i.params),!0)})}loadView(e){return qe(this,arguments,function*(t,i={}){this.showLoadingBar();let s=this.active.path,n=yield xb(t,i,s);if(this.active.path!==s)return;yield this.$viewport.animate({opacity:0},200).promise,this.$viewport.removeChildren(),Nt.scrollTop=0,this.$viewport.html=n,H.resize(),db(),this.$viewport.animate({opacity:1},200),this.hideLoadingBar();let r=this.$viewport.$("title");r&&(document.title=r.text),this.initialise(this.$viewport,i),t.enter&&t.enter(this.$viewport,i),this.trigger("afterChange",{$viewport:this.$viewport})})}onLinkClick(e){if(e.metaKey||e.ctrlKey||e.shiftKey||e.defaultPrevented)return;let t=e.target;for(;t&&t.nodeName!=="A";)t=t.parentNode;if(!t||t.nodeName!=="A")return;let i=t;if(i.target||i.origin!==window.location.origin||i.hasAttribute("download")||i.getAttribute("rel")==="external")return;let s=i.getAttribute("href");s&&s.indexOf("mailto:")>-1||this.getView(i.pathname+i.search)&&(e.preventDefault(),this.goTo(i.pathname+i.search,i.hash))}goTo(e,t=""){return qe(this,null,function*(){let i=this.active.path+this.active.hash;(yield this.load(e,t))&&i!==this.active.path+this.active.hash&&window.history.pushState(this.active,"",e+t)})}replace(e,t=""){this.active={path:e,hash:t},window.history.replaceState(this.active,"",e+t)}back(){window.history.back()}forward(){window.history.forward()}showLoadingBar(){this.$loadingBar||(this.$loadingBar=u("div",{style:yb},Nt)),this.$loadingBar.css({transform:"translateX(-100%)",opacity:1}),this.$loadingBar.show(),this.animation=ot(e=>{this.$loadingBar.css("transform",`translateX(-${10+90*Math.exp(-4*e)}%)`)},3e3)}hideLoadingBar(){return qe(this,null,function*(){var e,t,i;(e=this.animation)==null||e.cancel(),yield(t=this.$loadingBar)==null?void 0:t.animate({transform:"none",opacity:0}).promise,(i=this.$loadingBar)==null||i.hide()})}},sE=new bb;function $b(e,t){let i=Array.from(e.childNodes);e.innerHTML=t;let s={};for(let n of Array.from(e.querySelectorAll("slot")))s[n.getAttribute("name")||""]=n;for(let n of i){let r=n.getAttribute&&n.getAttribute("slot")||"",o=s[r]||s[""];o&&o.parentNode.insertBefore(n,o)}for(let n of Object.values(s))n.parentNode.removeChild(n)}function o0(e){let t=[];for(let i of Array.from(e.children))i.tagName.startsWith("X-")?t.push(i):t.push(...o0(i));return t}var a0=new Map,Mb=class extends HTMLElement{constructor(){super(...arguments);this.wasConnected=!1,this.isReady=!1}connectedCallback(){return qe(this,null,function*(){if(this.wasConnected){this._view.trigger("connected");return}this.wasConnected=!0,this.isReady=!1,this._view.created();let e=a0.get(this._view.tagName)||{};e.template&&$b(this,e.template);let t=o0(this).filter(i=>!i.isReady).map(i=>new Promise(s=>i.addEventListener("ready",s)));yield Promise.all(t),this._view.ready(),this.dispatchEvent(new CustomEvent("ready")),this.isReady=!0})}disconnectedCallback(){this._view.trigger("disconnected")}},h0=class extends Vs{created(){}ready(){}};function l0(e,t={}){return function(i){class s extends Mb{constructor(){super();this._view=new i(this)}}a0.set(e.toUpperCase(),t),window.customElements.define(e,s)}}var Sb={"*":"\xB7","**":"\u2217","//":"//","+-":"\xB1","\u2013":"\u2212","-":"\u2212",xx:"\xD7",sum:"\u2211",prod:"\u220F",int:"\u222B",del:"\u2202",grad:"\u2207",aleph:"\u2135",not:"\xAC",AA:"\u2200",EE:"\u2203","'":"\u2019","!=":"\u2260","<=":"\u2264",">=":"\u2265",in:"\u2208","!in":"\u2209","==":"\u2261","~=":"\u2245","~~":"\u2248",sub:"\u2282",sube:"\u2286",prop:"\u221D",oo:"\u221E",cap:"\u2229",cup:"\u222A","<-":"\u2190","->":"\u2192","=>":"\u21D2","<=>":"\u21D4","|->":"\u21A6",uarr:"\u2191",darr:"\u2193",lArr:"\u21D0"},Pn={Gamma:"\u0393",Delta:"\u0394",Theta:"\u0398",Lambda:"\u039B",Xi:"\u039E",Pi:"\u03A0",Sigma:"\u03A3",Phi:"\u03A6",Psi:"\u03A8",Omega:"\u03A9",alpha:"\u03B1",beta:"\u03B2",gamma:"\u03B3",delta:"\u03B4",epsilon:"\u025B",zeta:"\u03B6",eta:"\u03B7",theta:"\u03B8",iota:"\u03B9",kappa:"\u03BA",lambda:"\u03BB",mu:"\u03BC",nu:"\u03BD",xi:"\u03BE",pi:"\u03C0",rho:"\u03C1",sigma:"\u03C3",tau:"\u03C4",upsilon:"\u03C5",phi:"\u03C6",chi:"\u03C7",psi:"\u03C8",omega:"\u03C9",CC:"\u2102",NN:"\u2115",QQ:"\u211A",RR:"\u211D",ZZ:"\u2124"},c0="abcdefghijklmnopqrstuvwxyz",Pb=c0.split(""),Cb=c0.toUpperCase().split(""),Tb=Object.values(Pn),aE=[...Pb,...Cb,...Tb,"$"],Eb="|()[]{}\xF7,!<>=*/+-\u2013\u2212~^_\u2026\xB0\u2022\u2225\u22A5'\u2220:%\u223C\u25B3",Ab=Object.values(Sb),hE=[...Eb,...Ab];var Vb=["abs","round","floor","ceil","max","min","mod","lcm","gcd","gcf","log","exp","ln","sqrt","root","sin","cos","tan","sec","csc","cot","cosec","cotan","arcsin","arccos","arctan","sinh","cosh","tanh","sech","csch","coth","cosech"];function u0(e){return Vb.includes(e)}var kb={"+":"plus","\u2212":"minus","\xB7":"times","\xD7":"times","/":"over","//":"divided by","%":"percent","!":"factorial","\xB1":"plus-minus","=":"equals","\u2260":"does not equal","<":"is less than",">":"is greater than","\u2264":"is less than or equal to","\u2265":"is greater than or equal to",\u03C0:"pi","\u2245":"is congruent to","\u2225":"is parallel to","\u22A5":"is perpendicular to"};for(let e of Object.keys(Pn))kb[Pn[e]]=e;var ac=class{constructor(){this.callbacks=[]}add(t){this.callbacks.push(t)}start(t=1e3){return ot(s=>{for(let n of this.callbacks)n(s)},t).promise}};function d0(e,t){return e.every((i,s)=>T(i,t[s]))}function p0(e,t){e.scale*=t.scale,e.x=e.x*t.scale+t.x,e.y=e.y*t.scale+t.y}function f0(e,t){return T(e.x,t.x)&&T(e.y,t.y)&&T(e.scale,t.scale)}function ea(e,t,i){if(i==="adding"){let s=e.strokeLength,n=t<.5?0:mt("cubic-in",t*2-1);e.css({"stroke-dasharray":s+"px","stroke-dashoffset":s*(1-n)+"px"})}else if(i==="deleting"){let s=e.strokeLength,n=t<.5?mt("cubic-in",2*t):1;e.css({"stroke-dasharray":s+"px","stroke-dashoffset":s*(2-n)+"px"})}}function m0(e,t){let i=[e],s=e.expr;for(;t.startsWith(s);){if(t===s)return i;let n=G(i).next;if(!n)return;i.push(n),s+=n.expr}}function g0(e,t,i=1){let s=i*Math.abs(t.x-e.x)/3,n=d.average(e,t).shift(0,s);return function(r){let o=(1-r)**2*e.x+2*r*(1-r)*n.x+r*r*t.x,a=(1-r)**2*e.y+2*r*(1-r)*n.y+r*r*t.y;return{x:o,y:a}}}function hc(e,t){return Math.max(t*e,.4)/e}function Pi(e){return e instanceof Si&&e.children.length>1||e instanceof Cn?`(${e.expr})`:e.expr}function oi(e,t){return t.length===1&&t[0].type==="mrow"?t[0]:new Si(t,e)}var qt=class{constructor(t,i,s,n){this.type=t;this.equation=s;this.$element=n;this.children=[];this.status="";this.value="";this.customColor="";this.roundedMotion=!1;this.width=0;this.height=0;this.baseline=0;this.transform={x:0,y:0,scale:1};this.currentDimensions=[0,0,0];this.currentWorldTransform={x:0,y:0,scale:1};this.addChildren(i),n&&s.$row.append(n)}get expr(){return""}get log(){let t=this.children.map(i=>i.log);return`<${this.type}>${t.join("")}</${this.type}>`}get color(){return this.customColor||(this.parent?this.parent.color:"")}static create(t,i){let s=t.nodeName.toLowerCase();if(gt(s,"mn","mi","mo","mtext")){if(t.textContent==="placeholder")return new sa(i);let r=t.getAttribute("mathvariant")||void 0;return new Os(s,t.textContent||"",i,r)}if(!gt(s,"mrow","mfrac","mfenced","msqrt","mroot","msub","msup","msubsup","munder","mover","munderover","mspace"))return new y0(t,i);if(s==="mfenced"&&t.getAttribute("open")==="["){let r=t.children.length,o=Te(Array.from(t.children,h=>Array.from(h.children,l=>qt.create(l,i)))),a=new w0(o,i,r);return new cr([a],i)}let n=Array.from(t.children,r=>qt.create(r,i));switch(s){case"mrow":return new Si(n,i);case"mfrac":return n=n.map(r=>oi(i,[r])),new na(n,i);case"mfenced":return n=[oi(i,n)],new cr(n,i);case"msqrt":return n=[oi(i,n)],new Tn(s,n,i);case"mroot":return n=n.map(r=>oi(i,[r])),new Tn(s,n,i);case"msub":case"msup":case"msubsup":return n=n.map(r=>oi(i,[r])),new Cn(s,n,i);case"munder":case"mover":case"munderover":return n=n.map(r=>oi(i,[r])),new v0(s,n,i);case"mspace":return new ia(i)}throw new Error(`Unknown element type tag ${t.nodeName}`)}get marginLeft(){return .1}get marginRight(){return .1}setTransform(t=0,i=0,s=1){this.transform.x=t,this.transform.y=i,this.transform.scale=s}get worldTransform(){let t=this,i=Object.assign({},this.transform);for(;t=t.parent;)p0(i,t.transform);return i}get index(){return this.parent?this.parent.children.indexOf(this):-1}get next(){if(!this.parent)return;let t=this.parent.children.indexOf(this);return this.parent.children[t+1]}get prev(){if(!this.parent)return;let t=this.parent.children.indexOf(this);return this.parent.children[t-1]}addChildren(t,i=this.children.length){for(let s of this.children)s.type==="placeholder"&&s.deleteFromDom();for(let s of t)s.detach(),s.parent=this;this.children.splice(i,0,...t)}insertAfter(t){let i=this.parent.children.indexOf(this);this.parent.addChildren(t,i+1)}insertBefore(t){let i=this.parent.children.indexOf(this);this.parent.addChildren(t,i)}detach(){if(this.parent){let t=this.parent.children.indexOf(this);t>=0&&this.parent.children.splice(t,1),this.parent=void 0}}deleteFromDom(){this.parent&&this.detach(),this.$element&&this.$element.remove(),this.$element=void 0;for(let t of this.children.slice(0))t.deleteFromDom()}*parents(t=!1){let i=t?this:this.parent;for(;i;)yield i,i=i.parent}hasParent(t,i=!1){return Bi(this.parents(i),t)}hitTest(t){let{x:i,scale:s}=this.worldTransform,n=this.marginLeft*s*this.equation.fontSize,r=this.marginRight*s*this.equation.fontSize;if(at(t.x,i-n,i+this.width*s+n+r))return this.hitTestChildren(t)||this}hitTestChildren(t){for(let i of this.children){let s=i.hitTest(t);if(s)return s}}measure(t=1){for(let i of this.children)i.measure(t)}clean(){for(let t of this.children)t.clean()}setStatus(t){this.status=t;for(let i of this.children)i.setStatus(t)}render(t){for(let h of this.children)h.render(t);if(!this.$element)return;let i=this.currentWorldTransform,s=this.currentWorldTransform=this.worldTransform,n=this.currentDimensions,r=this.currentDimensions=[this.width,this.height,this.baseline];if(f0(i,s)&&d0(n,r)&&!this.status)return;if(!t){this.positionElement(s),this.drawElement(1,r[0],r[1],r[2],s.scale);return}this.status==="adding"&&this.positionElement(s);let o=s.y+this.baseline<this.equation.root.baseline?-1:1,a=this.roundedMotion?g0(i,s,o):void 0;this.roundedMotion=!1,t.add(h=>{if(!this.$element)return;let l=mt("cubic",h),c=gt(this.status,"adding","deleting"),p=c?r[0]:vt(n[0],r[0],l),m=c?r[1]:vt(n[1],r[1],l),v=c?r[2]:vt(n[2],r[2],l),M=c?s.scale:vt(i.scale,s.scale,l);if(this.drawElement(h,p,m,v,M),!this.status){let f=a?a(l):d.interpolate(i,s,l);this.positionElement({x:f.x,y:f.y,scale:M})}})}positionElement(t){this.$element.setTransform(t,0,t.scale)}drawElement(t,i,s,n,r){}},Lb="acegmnopqrsuvwxyz",Is=1.1,En=.2,lc=["=","\u2248","<",">","\u2264","\u2265"],Ob=document.createElement("canvas"),x0=Ob.getContext("2d"),Ib=Pe((e,t)=>(x0.font=`${t}px "Source Sans Pro", sans-serif`,x0.measureText(e).width)),Os=class extends qt{constructor(t,i,s,n){super(t,[],s,u("text",{}));this.variant=n;this.setValue(i)}setValue(t){this.$element.text=this.value=t;let i=this.value.split("").every(n=>Lb.includes(n));this.width=Ib(t,this.equation.fontSize),this.height=(Is-(i?.1:0))*this.equation.fontSize,this.baseline=this.height-En*this.equation.fontSize;let s=this.type==="mtext"||this.variant==="normal";this.$element.setClass("font-normal",s||u0(this.value))}get expr(){return this.value==="xx"?'"xx"':this.type==="mtext"?`"${this.value}"`:this.value}get log(){return`<${this.type}>${this.value}</${this.type}>`}get marginLeft(){if(this.type==="mo")return lc.includes(this.value)?this.equation.isDisplay?.5:.35:gt(this.value,"\u2221","\u25B3","!","%","\u2019")||gt(this.value,"\u2026","\xB0")&&this.prev&&this.prev.type==="mn"?0:.25;if(this.type==="mi"){if(this.prev&&this.prev.type==="mn")return .1;if(this.prev&&this.prev.type==="mi")return .05;if(this.prev&&this.prev.type==="mfrac")return .15}return 0}get marginRight(){return this.type==="mo"?this.equation.isDisplay&&lc.includes(this.value)?.5:gt(this.value,"\u2221","\u25B3")?0:this.value==="\u2212"&&(!this.prev||lc.includes(this.prev.value))?.1:.25:0}positionElement(t){if(!this.$element)return;let i=(this.equation.fontSize-this.baseline)*t.scale;this.$element.setTransform({x:t.x,y:t.y-i},0,t.scale)}drawElement(t,i,s,n,r){this.status==="adding"?this.$element.setAttr("opacity",t<.5?0:mt("cubic-in",t*2-1)):this.status==="deleting"&&this.$element.setAttr("opacity",t<.5?1-mt("cubic-in",2*t):0),this.$element.css("stroke-width",(1-r)*1.5+"px"),this.$element.css("color",this.color||"currentColor")}},ia=class extends qt{constructor(t){super("mspace",[],t);this.height=(Is-.1)*t.fontSize,this.baseline=this.height-En*this.equation.fontSize,this.width=t.fontSize*.2}get expr(){return" "}},Si=class extends qt{constructor(t,i,s,n=0){super("mrow",t,i);this.align=s;this.dx=n}addChildren(t,i=this.children.length){let s=[];for(let n of t)n.type==="mrow"?(s.push(...n.children),n.detach()):s.push(n);super.addChildren(s,i)}get expr(){return this.children.map(t=>t.expr).join(" ").replace(/− /,"\u2212")||"placeholder"}measure(t=1){if(super.measure(t),!this.children.length){this.height=this.width=this.baseline=0;return}this.baseline=Math.max(...this.children.map(s=>s.baseline)),this.height=this.baseline+Math.max(...this.children.map(s=>s.height-s.baseline));let i=0;for(let[s,n]of this.children.entries())n.setTransform(i,this.baseline-n.baseline),i+=n.width,s<this.children.length-1&&(i+=Math.max(n.marginRight,this.children[s+1].marginLeft)*this.equation.fontSize);if(this.align){let s=this.children.find(n=>n.expr===this.align);s&&(this.transform.x=this.dx-s.transform.x-s.width/2)}this.width=i}},sa=class extends qt{constructor(t){let i=t.fontSize,s=`M${.1*i} ${.3*i}h${i/2}v${i/2}h-${i/2}Z`,n=u("path",{class:"placeholder",d:s});super("placeholder",[],t,n);this.width=.7*i,this.height=Is*i,this.baseline=this.height-En*i}get expr(){return"placeholder"}get marginLeft(){return 0}get marginRight(){return 0}},na=class extends qt{constructor(t,i){super("mfrac",t,i,u("line"))}get expr(){return this.children.map(t=>Pi(t)).join("/")}measure(t){let i=this.hasParent(a=>a.type==="mfrac"||a.type==="matrix"),s=hc(t,!this.equation.isDisplay||i?.66:1),n=.1*this.equation.fontSize,[r,o]=this.children;super.measure(t*s),this.width=(Math.max(r.width,o.width)+2*n)*s,this.height=(r.height+o.height)*s,this.baseline=r.height*s+this.equation.fontSize*(Is/2-En),r.setTransform((this.width-r.width*s)/2,0,s),o.setTransform((this.width-o.width*s)/2,r.height*s,s)}drawElement(t,i,s,n){let r=n-this.equation.fontSize*(Is/2-En);this.$element.setLine({x:0,y:r},{x:i,y:r}),this.$element.setAttr("stroke",this.color||"currentColor"),ea(this.$element,t,this.status)}hitTestChildren(t){let{scale:i,y:s}=this.worldTransform,n=this.baseline-this.equation.fontSize*(Is/2-En),r=t.y<=s+n*i,o=this.children[r?0:1];return o.hitTestChildren(t)||o}},Cn=class extends qt{get expr(){let t=Pi(this.children[0]);return this.type!=="msup"&&(t+="_"+Pi(this.children[1])),this.type==="msup"&&(t+="^"+Pi(this.children[1])),this.type==="msubsup"&&(t+="^"+Pi(this.children[2])),t}measure(t){let[i,s,n]=this.children,r=this.type==="msup"?void 0:s,o=this.type==="msubsup"?n:this.type==="msup"?s:void 0,a=.05*this.equation.fontSize,h=hc(t,.65);i.measure(t),r&&r.measure(t*h),o&&o.measure(t*h);let l=o?o.height*h-.4*this.equation.fontSize:0,c=r?r.height*h-.5*this.equation.fontSize:0,p=o?o.width:0,m=r?r.width:0;this.width=i.width+a+Math.max(p,m)*h,this.height=i.height+l+c,this.baseline=i.baseline+l,i.setTransform(0,this.baseline-i.baseline),o&&o.setTransform(i.width+a,0,h),r&&r.setTransform(i.width+a,this.height-r.height*h,h)}clean(){if(super.clean(),this.children=this.children.filter(t=>t.type!=="mrow"||t.children.length),this.children.length===0)return this.detach();this.children.length===1&&(this.insertAfter(this.children),this.detach())}},v0=class extends qt{get expr(){let t=this.children[0].expr;return this.type!=="munder"&&(t+="_"+Pi(this.children[1])),this.type==="mover"&&(t+="^"+Pi(this.children[1])),this.type==="munderover"&&(t+="^"+Pi(this.children[2])),t}measure(t){super.measure(t)}},cr=class extends qt{constructor(t,i){super("mfenced",t,i,u("path"))}get expr(){return`(${this.children.map(t=>t.expr).join()})`}get marginLeft(){return .2}get marginRight(){return .2}measure(t){super.measure(t);let i=this.children[0];this.height=i.height+2,this.baseline=i.baseline+1;let s=1+this.height/this.equation.fontSize,n=.1*this.equation.fontSize;this.width=i.width+2*(s+n),i.setTransform(s+n,1)}drawElement(t,i,s){let n=Math.min(2+s/this.equation.fontSize,5),r=s-4,o=i-n,a=`M${n},2c${-2*n/3},${.15*r},${-n},${.32*r},${-n},${r/2}s${n/3},${.35*r},${n},${r/2}M${o},2c${2*n/3},${.15*r},${n},${.32*r},${n},${r/2}s${-n/3},${.35*r},${-n},${r/2}`;this.$element.setAttr("d",a),this.$element.css("stroke",this.color||"currentColor"),ea(this.$element,t,this.status)}clean(){super.clean(),this.children.length||this.detach()}},Tn=class extends qt{constructor(t,i,s){super(t,i,s,u("path"))}get expr(){return`sqrt(${this.children.map(t=>t.expr).join(", ")})`}get marginLeft(){return .2}get marginRight(){return .2}measure(t){super.measure(t);let i=this.children[0];this.height=i.height+2,this.baseline=i.baseline+2;let s=Math.min(16,3+5*this.height/this.equation.fontSize),n=.05*this.equation.fontSize;this.width=i.width+s+2*n,i.setTransform(s+n,2)}drawElement(t,i,s){let n=Math.min(16,3+5*s/this.equation.fontSize),r=s-2,o=`M0,${.55*r}L${.18*n},${.51*r}L${.45*n},${r}L${n},2L${i},2`;this.$element.setAttr("d",o),this.$element.css("stroke",this.color||"currentColor"),ea(this.$element,t,this.status)}clean(){super.clean(),this.children.length||this.detach()}},w0=class extends qt{constructor(t,i,s){super("matrix",t,i,u("g"));this.rows=s;this.cols=Math.floor(t.length/s)}get expr(){return`${this.children.map(t=>t.expr).join(", ")}`}measure(t){super.measure(t);let i=.6*this.equation.fontSize,s=F(o=>Math.max(...F(a=>this.children[o*this.cols+a].height,this.cols)),this.rows),n=F(o=>Math.max(...F(a=>this.children[a*this.cols+o].width,this.rows)),this.cols);this.height=U(s)+(this.rows-1)*i/2,this.width=U(n)+this.cols*i,this.baseline=(this.height+Is*this.equation.fontSize)/2;let r=0;for(let o=0;o<this.rows;++o){let a=i/2;for(let h=0;h<this.cols;++h){let l=this.children[o*this.cols+h],c=a+(n[h]-l.width)/2,p=r+(s[o]-l.height)/2;l.setTransform(c,p),a+=n[h]+i}r+=s[o]+i/2}}},y0=class extends qt{constructor(t,i){super("foreign",[],i,u("g"));var s;this.$body=u("div",{},i.$overlay),this.$body._el.appendChild(t),this.$measure=u("span",{text:".",style:"font-size: 0"},this.$body),this.checkForResize(),this.$body.on("resize",()=>{this.checkForResize()&&this.equation.resize()}),(s=this.$body.$("x-blank, x-blank-mc"))==null||s.on("solve",n=>{sr(()=>this.replace(n.solution,"#0f82f2"),n.restore?0:200)})}deleteFromDom(){var t;super.deleteFromDom(),(t=this.$body)==null||t.remove(),this.$body=void 0,this.$measure=void 0}replace(t,i){var r;let s=isNaN(+t)?"mtext":"mn",n=new Os(s,t,this.equation);n.customColor=i,this.insertAfter([n]),(r=this.$body)==null||r.off("resize"),this.deleteFromDom(),this.equation.resize()}checkForResize(){var n,r;let t=this.height,i=this.width,s=this.baseline;return this.height=((n=this.$body)==null?void 0:n.height)||0,this.width=((r=this.$body)==null?void 0:r.width)||0,this.baseline=this.$measure.bounds.top-this.$body.bounds.top,!(T(t,this.height)&&T(i,this.width)&&T(s,this.baseline))}positionElement(t){var i,s;(i=this.$body)==null||i.css({left:t.x+"px",top:t.y+"px"}),T(t.scale,1)||(s=this.$body)==null||s.css("transform",`scale(${t.scale})`)}get expr(){var t;return`"${(t=this.$body)==null?void 0:t.text}"`}get log(){return`<foreign>${this.expr}</foreign>`}};var Ci=class extends nr{constructor(t,i,s=0,n="=",r=18,o=!0){super();this.$row=t;this.$overlay=i;this.fontSize=r;this.isDisplay=o;this.isReady=!0;this.deletedNodes=new Set;this.root=new Si([],this,n,s)}setValue(t){let i=Array.isArray(t)?t.map(s=>qt.create(s,this)):this.parse(t);for(let s of this.root.children)s.deleteFromDom();this.root.addChildren(i),this.updateDescription(),this.resize()}updateDescription(){let t=ei.parse(this.root.expr).toVoice();this.$row.setAttr("aria-label",t)}resize(){this.root.measure(),this.root.render()}parse(t){var o;let i=new DOMParser,s=ei.parse(t).toMathML(),n=i.parseFromString(`<math>${s}</math>`,"text/xml");if(((o=n.firstChild)==null?void 0:o.nodeName)==="parsererror")throw new Error(n.firstChild.textContent);let r=n.firstChild.childNodes;return Array.from(r,a=>qt.create(a,this))}find(t){let[i,s]=t.split("`");i=i.replace(/[–-]/g,"\u2212");let n=+s||1,r=this.root.children.slice(0),o=0;for(;r.length;){let a=r.shift(),h=a instanceof Si?void 0:m0(a,i);if(h&&(o+=1,o===n))return h;r.unshift(...a.children)}throw new Error(`Can't find element ${i}.`)}animate(t=1200){return E(this,null,function*(){this.isReady=!1,this.root.clean(),this.root.measure();let i=new ac;this.root.render(i),this.trigger("resize",{height:this.root.height});for(let s of this.deletedNodes)s.render(i);yield i.start(t);for(let s of this.deletedNodes)s.deleteFromDom();this.root.setStatus(""),this.deletedNodes.clear(),this.isReady=!0})}addTermAfter(t,i){let s=G(i?this.find(i):this.root.children),n=this.parse(t);s.insertAfter(n);for(let r of n)r.setStatus("adding");this.updateDescription()}addTermBefore(t,i){let s=i?this.find(i)[0]:this.root.children[0],n=this.parse(t);s.insertBefore(n);for(let r of n)r.setStatus("adding");this.updateDescription()}deleteTerm(t){for(let i of this.find(t))i.setStatus("deleting"),i.detach(),this.deletedNodes.add(i);this.updateDescription()}replaceTerm(t,i){let s=this.find(t),n=this.parse(i);s[0].insertBefore(n);for(let r of n)r.setStatus("adding");for(let r of s)r.setStatus("deleting"),r.detach(),this.deletedNodes.add(r);this.updateDescription()}moveTermAfter(t,i){let s=this.find(t);for(let r of s)r.roundedMotion=!0;G(i?this.find(i):this.root.children).insertAfter(s),this.updateDescription()}moveTermBefore(t,i){let s=this.find(t);for(let r of s)r.roundedMotion=!0;(i?this.find(i)[0]:this.root.children[0]).insertBefore(s),this.updateDescription()}moveTermToStart(t){let i=this.find(t);for(let s of i)s.roundedMotion=!0;this.root.children[0].insertBefore(i),this.updateDescription()}wrapTerms(t,...i){let s=i.map(r=>this.find(r));for(let r of s)for(let o of r)o.roundedMotion=!0;let n=this.parse(t);for(let r of n)r.setStatus("adding");s[0][0].insertBefore(n);for(let[r,o]of s.entries()){let a=this.find("$"+(r+1))[0];a.insertAfter(o),a.deleteFromDom()}this.updateDescription()}unwrapTerm(t,i=1){let s=this.find(t),n=s[0],r=1;for(;r<=i;)n=n.parent,n instanceof Si&&(n=n.parent),r+=1;n.insertAfter(s),n.setStatus("deleting"),n.detach(),this.deletedNodes.add(n),this.updateDescription()}get leftSide(){let t=this.root.children.findIndex(i=>i.expr==="=");return this.root.children.slice(0,t-1)}get rightSide(){let t=this.root.children.findIndex(i=>i.expr==="=");return this.root.children.slice(t+1)}};var b0='<svg class="equation"><g></g></svg><div class="overlay"></div><div class="nav"><div class="btn back hide"><x-icon name="left"></x-icon></div><div class="btn next"><x-icon name="right"></x-icon></div></div><div class="legend-box"><slot></slot></div>';var $0=1200,Rb=400,M0=1200,An=600,ur=16,cc=class extends I{constructor(){super(...arguments);this.rows=[];this.isReady=!0;this.topOffset=4;this.currentHeight=0;this.currentStep=0;this.nextEvents={};this.backEvents={}}ready(){this.$svg=this.$("svg"),this.$lastRow=this.$svg.$("g"),this.$overlay=this.$(".overlay"),this.$legend=this.$(".legend-box"),this.$steps=this.$legend.$$("li"),this.$back=this.$(".back"),this.$next=this.$(".next");let t=+this.attr("dx")||0;this.equation=new Ci(this.$lastRow,this.$overlay,t);let i=this.$(".math"),s=i?Array.from(i._el.children):[];this.equation.setValue(this.attr("expr")||s),this.currentHeight=this.topOffset+this.$lastRow.height+16,this.$svg.css("height",this.currentHeight+"px"),this.equation.on("resize",({height:r})=>{let o=this.topOffset+r+ur;Math.abs(o-this.currentHeight)<ur/2||(this.currentHeight=o,this.$svg.animate({height:o+"px"},M0))}),this.$back.on("click",()=>this.goBack()),this.$next.on("click",()=>this.goNext()),this.$steps[0].show(),P.onResize(()=>{let r=this.$svg.width/2;for(let o of[this.$lastRow,this.$overlay])o.css("transform",`translate(${r}px, ${this.topOffset}px)`);for(let o of this.rows)o.$el.css("transform",`translate(${r}px, ${o.top}px)`)});let n=this.$overlay.$$("x-blank, x-blank-mc");n.length&&(this.$next.addClass("hide"),Promise.all(n.map(r=>r.onPromise("solve"))).then(()=>setTimeout(()=>this.goNext(),$0)))}setup(t){this.one("next",({step:i})=>t.score("algebra-flow-"+(i-1)))}newRow(){return E(this,null,function*(){let t=this.$lastRow.copy(!0,!1),i=this.equation.root.height;this.rows.push({$el:t,height:i,top:this.topOffset}),this.$lastRow.insertBefore(t),P.redraw(),this.topOffset+=i+ur,this.currentHeight=this.topOffset+i+ur;for(let s of[this.$lastRow,this.$overlay])s.animate({transform:`translate(${this.$svg.width/2}px, ${this.topOffset}px)`},An);yield this.$svg.animate({height:this.currentHeight+"px"},An).promise})}hideLastRow(){return E(this,null,function*(){if(!this.rows.length)return;let t=this.rows.pop();this.topOffset=t.top;for(let i of[this.$lastRow,this.$overlay])i.animate({transform:`translate(${this.$svg.width/2}px, ${t.top}px)`},An);this.currentHeight=t.top+this.$lastRow.height+ur,this.$svg.animate({height:this.currentHeight+"px"},An),yield t.$el.exit("fade",An/2,An/2).promise,t.$el.remove()})}onNextStep(t){this.nextEvents=t}onBackStep(t){this.backEvents=t}goNext(){return E(this,null,function*(){if(!this.isReady||!this.equation.isReady||this.currentStep>=this.$steps.length-1)return;this.isReady=!1;let t=this.currentStep+1;this.$steps[t].hasClass("new-row")&&(yield this.newRow(),yield Bn(Rb)),t in this.nextEvents&&(yield this.nextEvents[t](this.equation),yield this.equation.animate(M0),yield Bn($0)),yield this.go(t),this.trigger("next",{step:t}),this.isReady=!0})}goBack(){return E(this,null,function*(){if(!this.isReady||!this.equation.isReady||this.currentStep<=0)return;let t=this.currentStep-1;this.isReady=!1,this.currentStep in this.backEvents&&(yield this.backEvents[this.currentStep](this.equation),yield this.equation.animate()),this.$steps[this.currentStep].hasClass("new-row")&&this.hideLastRow(),yield this.go(t),this.trigger("back",{step:t}),this.isReady=!0})}go(t){return E(this,null,function*(){this.$steps[t].show();let i=this.$steps[t].height+"px";this.$steps[t].hide(),this.$legend.animate({height:i},800).promise.then(()=>this.$legend.css("height","auto"));let s=this.currentStep;this.currentStep=t,this.trigger("step",t),yield this.$steps[s].exit("fade",400).promise,this.$back.setClass("hide",t<=0),this.$next.setClass("hide",t>=this.$steps.length-1),yield this.$steps[t].enter("fade",400).promise})}};cc=R([L("x-algebra-flow",{template:b0})],cc);var S0='<div class="input"><textarea></textarea></div><div class="math empty"><span class="cursor">&#8203;</span></div><div class="keys"><!-- TODO Make these buttons tabbable--><div class="btn" data-type="+">+</div><div class="btn" data-type="\u2212">\u2212</div><div class="btn" data-type="\xD7">\xD7</div><div class="btn" data-type="\xF7">\xF7</div><div class="btn i" data-type="\u03C0">\u03C0</div><div class="btn" data-type="frac"><x-icon name="fraction"></x-icon></div><div class="btn" data-type="sup"><x-icon name="power"></x-icon></div><div class="btn" data-type="sqrt"><x-icon name="sqrt"></x-icon></div><div class="btn" data-type="brackets"><x-icon name="brackets"></x-icon></div></div><div class="error"><x-icon name="warning"></x-icon></div><div class="error-message"></div>';var Zi=Js;function P0(e){let t=e.prev;t&&tt(t.tagName,"MO","MI","MN")?t.insertBefore(e):t?ct(t.children).append(e):e.parent.hasClass("math")||(e.parent.prev?e.parent.prev.append(e):e.parent.parent.insertBefore(e))}function _b(e){let t=e.next;if(t&&tt(t.tagName,"MO","MI","MN"))return t.insertAfter(e);t?t.children[0].prepend(e):e.parent.hasClass("math")||(e.parent.next?e.parent.next.prepend(e):e.parent.parent.insertAfter(e))}function Nb(e){let t=e.parent;for(;t.parent.tagName!=="MFRAC"||!t.prev;){if(t.hasClass("math"))return;t=t.parent}t.prev.append(e)}function Db(e){let t=e.parent;for(;t.parent.tagName!=="MFRAC"||!t.next;){if(t.hasClass("math"))return;t=t.parent}t.next.prepend(e)}function Gb(e){let t=e.prev,i=e.parent;if(t&&tt(t.tagName,"MO","MI","MN"))t.remove(),i.children.length<=1&&i.addClass("empty");else if(!t&&!i.prev&&!i.hasClass("math")){let s=i.parent;s.insertBefore(e);for(let n of s.children)for(let r of n.children)s.insertBefore(r);s.remove(),e.parent.children.length<=1&&e.parent.addClass("empty")}else P0(e)}function Rs(e,t){t.insertBefore(e),t.parent.removeClass("empty"),e.children.length&&e.children[0].append(t)}function C0(e,t){"abcdefghijklmnopqrstuvwxyz\u03C0".includes(t)?Rs(S("mi",{text:t}),e):"0123456789.".includes(t)?Rs(S("mn",{text:t}),e):"+\u2212\xB1\xD7\xF7<>\u2264\u2265=%!".includes(t)?Rs(S("mo",{text:t,value:t}),e):t==="frac"?Rs(S("mfrac",{html:'<mrow class="empty"></mrow><mrow class="empty"></mrow>'}),e):t==="sqrt"?Rs(S("msqrt",{html:'<mrow class="empty"></mrow>'}),e):tt(t,"^","sup")?Rs(S("msup",{html:'<mrow class="empty"></mrow>'}),e):t==="brackets"||"([{|".includes(t)?Rs(S("mfenced",{html:'<mrow class="empty"></mrow>',type:"("}),e):")]}".includes(t)&&!e.next&&e.parent.parent.tagName==="MFENCED"&&e.parent.parent.insertAfter(e)}function T0(e,t){let i=e.$$(`${t}:first-child, *:not(${t}) + ${t}`);for(let s of i)if(s.parent.tagName!=="MFRAC")for(;s.next&&s.next.tagName===t.toUpperCase();)s.text+=s.next.text,s.next.remove()}var qb="This is not a valid mathematical expression.",Bb="Fill in all empty placeholders in the expression.",Hb={"+":"addition","\xD7":"multiplication","/":"fractions or division","\u2212":"subtraction",sqrt:"square roots","^":"powers"};function _s(e,t){if(e instanceof Text)return e.textContent||"";if(e.hasClass("cursor"))return"";let i=e.childNodes;return e.tagName==="MI"?e.text+(t?" ":""):e.tagName==="MFENCED"?"("+_s(i[0],t)+")":e.tagName==="MSUP"?"^("+_s(i[0],t)+")":e.tagName==="MFRAC"?`(${_s(i[0],t)})/(${_s(i[1],t)})`:e.tagName==="MSQRT"?"sqrt("+_s(i[0],t)+")":i.map(s=>_s(s,t)).join("")}function zb(e,t){try{return{expr:pe.parse(e,!0,{variables:t})}}catch(i){return{error:i instanceof Q?i.message:qb}}}function Fb(e,t,i){let s=e.variables;if(t.length){let n=s.find(o=>!t.includes(o));if(n){let o=md(n,i||t);return o?`Did you mean \u201C<em>${o}</em>\u201D instead of \u201C<em>${n}</em>\u201D?`:`There shouldn\u2019t be a variable called \u201C<em>${n}</em>\u201D.`}let r=t.find(o=>!s.includes(o));if(r)return`Your expression should contain \u201C<em>${r}</em>\u201D.`}}function Ub(e,t){if(t.length){let i=e.functions.find(s=>!t.includes(s));if(i)return`This expression should not contain ${Hb[i]||"\u201C"+i+"\u201D"}.`}}function jb(e,t,i=.001){try{return B(e.evaluate(),t.evaluate(),i)}catch(s){return!1}}var uc=class extends I{constructor(){super(...arguments);this.isDone=!1;this.shortVar=!1;this.lastAttempt="";this.errorCount=0;this.hints=[];this.fns=[];this.vars=[];this.validate=void 0}ready(){if(this.$math=this.$(".math"),this.$textarea=this.$("textarea"),this.$cursor=this.$(".cursor"),this.$error=this.$(".error-message"),this.solution=pe.parse(this.attr("solution")),this.hasAttr("numeric")&&(this.numeric=+this.attr("precision")||.01),this.vars=this.hasAttr("vars")?et(this.attr("vars")):this.solution?this.solution.variables:[],this.hasAttr("fns")&&(this.fns=et(this.attr("fns"))),this.solution&&this.fns.push(...this.solution.functions),this.fns.includes("/")&&!this.fns.includes("\xD7")&&this.fns.push("\xD7"),this.hasAttr("hints")&&(this.hints=et(this.attr("hints"))),this.hasAttr("substitutions")){this.substitutions={},this.autocomplete=this.vars.slice(0);for(let s of this.attr("substitutions").split("|"))if(s.trim()){let[n,r]=s.split(":");this.autocomplete.push(n.trim()),this.substitutions[n.trim()]=pe.parse(r)}}for(let s of["solution","precision","vars","fns","vars-required","substitutions"])this.removeAttr(s);this.shortVar=this.hasAttr("short-var");let t=et(this.attr("keys")||"+ \u2212 \xD7 \xF7 frac sup sqrt brackets"),i=this.$(".keys");for(let s of i.children)t.includes(s.data.type)?(s.on("pointerdown",n=>n.preventDefault()),s.on("pointerup",()=>{C0(this.$cursor,s.data.type),this.check()})):s.remove();this.on("pointerdown",s=>this.onPointerdown(s)),this.$textarea.on("focus",()=>this.onPointerdown()),this.$textarea.on("blur",()=>this.onBlur()),this.$textarea.on("key",s=>this.onKey(s))}setup(t,i,s){var n;this.$step=t,((n=s==null?void 0:s.scores)==null?void 0:n.includes(i))&&this.solve(),this.on("solve",()=>{t.addHint("correct"),t.score(i)})}focus(){this.trigger("pointerdown")}onPointerdown(t){if(this.isDone)return;t&&t.preventDefault&&t.preventDefault(),this.addClass("active"),this.$textarea.focus();let i=t&&t.target?N(t.target):this;if(i.tagName==="X-EQUATION"||i.hasClass("math")){let s=this.$math.children,n=kt(s.map(o=>o.outerWidth))/2;(t?Ne(t).x<this.$math.bounds.left+n:!0)?this.$math.prepend(this.$cursor):this.$math.append(this.$cursor)}else if(i.tagName[0]==="M"){let s=Ne(t).x<i.boxCenter.x;i.tagName==="MROW"?s?i.prepend(this.$cursor):i.append(this.$cursor):s?i.insertBefore(this.$cursor):i.insertAfter(this.$cursor)}}onKey(t){if(tt(t.code,Zi.enter,Zi.escape))this.$textarea.blur();else if(t.code===Zi.left)P0(this.$cursor);else if(t.code===Zi.right)_b(this.$cursor);else if(t.code===Zi.up)Nb(this.$cursor);else if(t.code===Zi.down)Db(this.$cursor);else if(tt(t.code,Zi.backspace,Zi.delete))Gb(this.$cursor),this.check();else{let i=t.key.replace("*","\xD7").replace("/","\xF7").replace("-","\u2212");C0(this.$cursor,i),this.check()}}onBlur(){if(this.isDone)return;if(!this.value)return this.removeClass("active has-error");if(this.removeClass("active"),this.addClass("has-error"),this.value===this.lastAttempt||(this.lastAttempt=this.value,!this.$step))return;let t=this.error||(this.hints||[]).shift()||"incorrect",i=this.$step.addHint(t,{class:"incorrect"});this.$error.html=(i==null?void 0:i.text)||"",this.errorCount+=1,this.trigger("error",{count:this.errorCount,msg:t}),this.errorCount>=5&&this.$step.addHint(`Hmmm\u2026 maybe try ${this.solution.toMathML()}?`)}check(){if(this.error=void 0,this.value=_s(this.$math,this.shortVar).trim(),!this.value)return;if(this.$math.$(".empty"))return this.error=Bb;let t=zb(this.value,this.vars);if(t.error)return this.error=t.error;let i=this.substitutions?t.expr.substitute(this.substitutions):t.expr;if(this.numeric&&jb(this.solution,i,this.numeric))return this.solve();if(this.validate){let r=this.validate(t.expr)||{};if(r.isCorrect)return this.complete(t.expr);if(r.error)return this.error=r.error}if(this.solution&&pe.numEquals(this.solution,i))return this.complete(t.expr);let s=Fb(i,this.vars,this.autocomplete);if(s)return this.error=s;let n=Ub(i,this.fns);if(n)return this.error=n}complete(t){this.isDone||(this.isDone=!0,this.removeClass("has-error active"),this.addClass("done"),this.$textarea.blur(),this.shortVar||T0(this.$math,"mi"),T0(this.$math,"mn"),this.trigger("solve",{expr:t}))}solve(){this.$math.removeClass("empty"),this.$math.html=this.solution.toMathML(),this.complete(this.solution)}};uc=R([L("x-equation",{template:S0})],uc);var Wb={opacity:[0,1],transform:["translateX(-50px)","none"]},Zb={error:"You\u2019ve already had this expression before. Try simplifying it."},Kb="You have to fully simplify this expression. The correct solution is $0.",dc=class extends I{constructor(){super(...arguments);this.rowCount=1;this.previousAnswers=[];this.isSolved=!1;this.maxRows=6;this.steps=[];this.hints=[]}created(){this.$table=this.$("table tbody"),this.lastRowContent=this.$table.$("tr:last-child").html}ready(){this.hasAttr("max-rows")&&(this.maxRows=+this.attr("max-rows")),this.hasAttr("steps")&&(this.steps=this.attr("steps").split("|")),this.hasAttr("hints")&&(this.hints=this.attr("hints").split("|")),this.removeAttr("steps"),this.removeAttr("hints"),this.setupEquation(this.$("x-equation"))}setup(t,i,s){var n;this.$step=this.$equation.$step=t,((n=s==null?void 0:s.scores)==null?void 0:n.includes(i))&&this.solve(),this.on("solve",()=>{t.addHint("correct"),t.score(i)}),this.on("hint",r=>t.addHint(r))}setupEquation(t){this.$equation=t,this.$equation.$step=this.$step,t.one("solve",i=>this.onSolveRow(i.expr)),t.hints=this.hints,t.validate=i=>{let s=this.previousAnswers.includes(i.toString());return(this.validate?this.validate(i,s):void 0)||(s?Zb:{})}}onSolveRow(t){if(this.trigger("solve-row",{expr:t,$math:this.$equation.$math}),this.isFinal&&this.isFinal(t))return this.trigger("solve");if(this.isSolved)return;if(this.rowCount+=1,this.previousAnswers.push(t.toString()),this.rowCount>this.maxRows){let s=this.$equation.solution.toMathML();this.trigger("hint",Kb.replace("$0",s)),this.trigger("solve")}let i=S("tr",{html:this.lastRowContent},this.$table);i.animate(Wb,400,500),this.setupEquation(i.$("x-equation")),setTimeout(()=>this.$equation.focus(),1200)}solve(){if(this.isSolved=!0,this.steps.length){let t=this.$table.$("tr:last-child"),i=this.lastRowContent.replace(/<x-equation.*<\/x-equation>/,'<span class="math fill"></span>');for(let s of this.steps){let n=S("tr",{html:i},this.$table),r=n.$(".math.fill"),o=pe.parse(s);r.html=o.toMathML(),t.insertBefore(n),this.trigger("solve-row",{expr:o,$math:r})}}this.$equation.solve()}};dc=R([L("x-equation-system")],dc);function ra(e,t,i,s){let n,r;t:for(let[o,a]of i)for(let h of t){let l=(s?s(o,h):o).subtract(h),c=l.length;if(c<e&&(e=c,n=l,r=a,c<1))break t}return n?{shift:n,target:r}:void 0}function E0(e){if(It(e))return[e];if(ii(e))return e.points;if(bn(e))return[e.p1,e.p2];if($t(e))return[e.c.shift(e.r,0),e.c.shift(-e.r,0),e.c.shift(0,e.r),e.c.shift(0,-e.r)];if(Ts(e)||$n(e)){let t=[e.start,e.end];Ts(e)&&t.push(e.c);let i=e.radius;for(let[s,n]of[[i,0],[0,i],[-i,0],[0,-i]]){let r=e.c.shift(s,n);Ss.prototype.contains.call(e,r)&&t.push(r)}return t}return[]}function Ki(...e){return A.aroundPoints(function*(){for(let t of e)for(let i of E0(t))yield i}())}function oa(e,t,i=0){if(!e.size&&!t.size)return new Ve(0,100,0,100);let s=A.aroundPoints(function*(){for(let n of e.values())if(n.transformed)for(let r of E0(n.transformed))yield r;for(let n of t.values()){yield n.segments[0].p1;for(let r of n.segments)yield r.p2}}());return new Ve(s.p.x-i,s.p.x+s.w+i,s.p.y-i,s.p.y+s.h+i)}function dr(e,t,i){if(It(t))return e.contains(t);if(Ho(t))return O.collision(e.polygon,t);if(Yl(t))return t.collision(e);if(ie(t))return oe(t,e).length>0||e.contains(t.p1);if($t(t))return i==="geo"?oe(t,e).length>0||e.contains(t.at(0)):t.collision(e);if(Ts(t)){let s=new O(t.c,t.start,t.at(.25),t.at(.5),t.at(.75),t.end);return O.collision(e.polygon,s)}return!1}var pc=class{constructor(t){this.$parent=t;this.visible=!1;this.$el=u("div",{class:"tile-error",hidden:!0},t.$html),this.$text=u("span",{},this.$el),this.$button=u("button",{text:"Select Errors"},this.$el),this.$button.on("click",()=>{t.selection.clear(),this.error&&t.selection.select(this.error.locations),this.hide()})}show(t,i){this.visible&&this.error===i||(this.visible=!0,this.$el.setTransform(t),this.$text.html=i.message,this.$button.toggle(!!(i==null?void 0:i.locations.length)),this.$el.enter("pop",200),this.error=i)}hide(){!this.visible||(this.visible=!1,this.$el.exit("pop",200),this.error=void 0)}},fc=new Map;function _(e){if(!e||!H.theme.isDark)return e;if(fc.has(e))return fc.get(e);let t=q.fromHex(e),i=t.hsl;at(i[2],20,80)||(i[2]=100-i[2]);let s=q.fromHsl(...i);s.a=t.a;let n=s.hex;return fc.set(e,n),n}function A0(e){let t=e==null?void 0:e.items;if(!!(t==null?void 0:t.length))for(let i=0;i<t.length;++i){if(!t[i].type.startsWith("image/"))continue;let s=t[i].getAsFile();if(s)return s}}function V0(e,t){let i;if(It(t)){let p=ws(e.edges,v=>d.distance(v.midpoint,t)),m=p.p1.subtract(p.p2);i=[p,new rt(t.subtract(m),t.add(m))]}else $t(t)&&(t=new A(t.c.shift(-t.r),2*t.r,2*t.r)),i=ws(Yf(e.edges,t.edges),([p,m])=>d.distance(p.midpoint,m.midpoint));let s=i.map(p=>p.midpoint),n=i.map(p=>p.perpendicularBisector),r=d.distance(s[0],s[1]),o=s[0],a=n[1].at(20),h=n[0].at(r/2),l=n[1].at(20+r/2);return[`M${o.x} ${o.y}C${h.x} ${h.y},${l.x} ${l.y},${a.x} ${a.y}`,n[1].at(12),n[1].angle+Math.PI]}function pr(e,t,i){return e.hasAttr(t)?e.attr(t)!=="no":i}function Ns(e,t){return ie(e)?e.offset(t):$t(e)?new Ot(e.c,t).angle/2/Math.PI:$n(e)?new Xt(e.start,e.c,t).rad/e.angle:.5}var Xb=80,Yb=[5,2,1];function Xi(e,t,i,s=.01){let n=e?e.split(","):[];if(n.length===3)return n.map(m=>+m);let r=n.length>0?+n[0]:i?i[0]:0,o=n.length>1?+n[1]:i?i[1]:t;if(T(r,o))return[r-1,o+1,1];s&&(o+=.01*(o-r));let a=Math.floor(Math.abs(t)/Xb),h=(o-r)/a,l=Math.floor(Math.log10(h)),c=Math.pow(10,l),p=Yb.find(m=>c*m<=h)*c;return o=p*Math.ceil(o/p),r=p*Math.floor(r/p),[r,o,p]}function aa(e,t=4e3){let i=Pt(`x-alert[key=${e}]`);return i==null?void 0:i.open(t)}function mc(e){let t=Math.min(...e.map(s=>Math.min(...s.map(n=>n.y)))),i=Math.max(...e.map(s=>Math.max(...s.map(n=>n.y))));return[t,i]}function ai(e,t,i){return e.hasAttr(t)?e.attr(t)!=="no":i}function k0(e){let t=et(e).map(i=>+i);return t.length===1?[t[0],t[0],t[0],t[0]]:t.length===2?[t[0],t[1],t[0],t[1]]:t.length===3?[t[0],t[1],t[2],t[1]]:t}function L0(e){let t=e.split(",");return[t[0]!=="no",(t.length>1?t[1]:t[0])!=="no"]}var O0={hasGeoModel:!0,pi:Math.PI,point:(e,t)=>e!==void 0&&t!==void 0?new y(e,t):void 0,angle:(e,t,i)=>e&&t&&i?new ne(e,t,i):void 0,line:(e,t)=>e&&t&&!e.equals(t)?new zt(e,t):void 0,ray:(e,t)=>e&&t&&!e.equals(t)?new ah(e,t):void 0,segment:(e,t)=>e&&t&&!e.equals(t)?new he(e,t):void 0,circle:(e,t)=>e&&t?new le(e,t):void 0,arc:(e,t,i)=>e&&t&&i?new zn(e,t,i):void 0,sector:(e,t,i)=>e&&t&&i?new Dd(e,t,i):void 0,polygon:(...e)=>e.every(t=>t)?new xe(...e):void 0,polyline:(...e)=>e.every(t=>t)?new Kd(...e):void 0,triangle:(e,t,i)=>e&&t&&i?new Xd(e,t,i):void 0,rectangle:(e,t,i)=>e?new ce(e,t,i):void 0,distance:y.distance,round:(e,t=0)=>pi(e,t),sqrt:Math.sqrt,floor:Math.floor,ceil:Math.ceil,intersections:jt};function ha(e,t,i){let s=i,n;for(let r of e){let o=t(r);o!==void 0&&o<s&&(s=o,n=r)}return n}function I0(e,t){t.clear();for(let i of e)if(!(i.isHidden||!i.value))for(let s of e){if(i.isHidden||!s.value||i===s)continue;let n=jt(i.value,s.value);for(let[r,o]of n.entries())t.add({path1:i,path2:s,posn:o,index:r})}}var R0="M100,50h0l-5.2-4.9L52.6,10.2v-9C52.6.6,51.4,0,50,0s-2.6.6-2.6,1.2v9L5.2,45.1,0,50H0l6.6-3L35,25.9H65L93.4,47ZM38.4,23.5,50,14.8l11.6,8.7Z",_0="M0,0V8H100V0ZM7,6A2,2,0,1,1,9,4,2,2,0,0,1,7,6Z";function Ds(e,t,i,s){return`translate(${e.x}px, ${e.y-t}px) scale(${s/100}) rotate(${i}rad)`}var N0=4,Qb=`<marker id="axis-arrow" refX="3" refY="3" markerWidth="6"
    markerHeight="6" orient="auto"><path d="M 0 0 L 6 3 L 0 6 z"/></marker>`,Gs=class extends I{constructor(){super(...arguments);this.labelSuffix=["",""];this.gridSize=[1,1];this.showGrid=!1;this.showXAxis=!1;this.showYAxis=!1;this.showLabels=!1}setupCoordinates(t,i={}){this.$svg=t,t.addClass("canvas"),this.proportional=!!i.proportional,this.padding=k0(this.attr("padding")||i.padding||"0"),ai(this,"grid",i.showGrid||!1)&&(this.$grid=S("g",{class:"grid"}),t.prepend(this.$grid),this.showGrid=!0);let s=this.attr("axes")||(i.showAxes?"yes":"no");[this.showXAxis,this.showYAxis]=L0(s),(this.showXAxis||this.showYAxis)&&(S("defs",{html:Qb},t),this.$axes=S("g",{class:"axes"}),t.prepend(this.$axes),this.axisNames=(this.attr("axis-names")||",").split(",")),this.$axes&&ai(this,"labels",!0)&&(this.labelSuffix=(this.attr("label-suffix")||",").split(","),this.showLabels=!0),(this.showLabels||this.axisNames)&&(this.$labels=S("g",{class:"labels"},t)),this.resize()}resize(){this.css("max-width","none");let t=+this.attr("width")||this.width,i=+this.attr("height")||(this.hasAttr("width")?t:this.height);this.css("max-width",t+"px"),this.$svg.setAttr("width",t),this.$svg.setAttr("height",i),this.$svg.setAttr("viewBox",`0 0 ${t} ${i}`);let s=this.padding;this.viewportBounds=new be(s[3],t-s[1],s[0],i-s[2]),this.updatePlotBounds(),this.positionElements(t,i)}updatePlotBounds(t){let[i,s,n]=Xi(this.attr("x-axis"),this.viewportBounds.dx,t==null?void 0:t.xRange),[r,o,a]=Xi(this.attr("y-axis"),this.viewportBounds.dy,t==null?void 0:t.yRange),h=Math.abs(this.viewportBounds.dx/(s-i)),l=Math.abs(this.viewportBounds.dy/(o-r)),c=Math.min(h,l),p=this.proportional?h/c:1,m=this.proportional?l/c:1;this.plotBounds=new be(p*i,p*s,m*o,m*r),this.plotScale=this.proportional?c:(h+l)/2,this.gridSize=[n,a];let[v,M]=[this.plotBounds,this.viewportBounds];this.plotToViewportMatrix=[[M.dx/v.dx,0,M.xMin-v.xMin/v.dx*M.dx],[0,M.dy/v.dy,M.yMin-v.yMin/v.dy*M.dy]];let f=i>0?p*i:s<0?p*s:0,b=r>0?m*r:o<0?m*o:0;this.plotOrigin=new y(f,b),this.drawAxes()}drawAxes(){let[t,i]=[this.plotBounds,this.viewportBounds],s=this.toViewportCoords(this.plotOrigin),[n,r]=this.gridSize;if(this.$grid&&this.$grid.removeChildren(),this.$axes&&this.$axes.removeChildren(),this.$labels&&this.$labels.removeChildren(),this.showGrid||this.showXAxis){let o=n*Math.trunc(t.xMin/n+.01);for(let a=o;a<t.xMax;a+=n){if(this.showYAxis&&a===this.plotOrigin.x)continue;let h=this.toViewportCoords(new y(a,0)).x;this.showGrid&&S("line",{x1:h,y1:i.yMin,x2:h,y2:i.yMax},this.$grid),this.showLabels&&this.makeLabel(0,a,h,s)}}if(this.showGrid||this.showYAxis){let[o,a]=t.yMin<t.yMax?[t.yMin,t.yMax]:[t.yMax,t.yMin],h=r*Math.trunc(o/r+.01);for(let l=h;l<a;l+=r){if(this.showXAxis&&l===this.plotOrigin.y)continue;let c=this.toViewportCoords(new y(0,l)).y;this.showGrid&&S("line",{x1:i.xMin,y1:c,x2:i.xMax,y2:c},this.$grid),this.showLabels&&this.makeLabel(1,l,c,s)}}this.showXAxis&&(this.$xAxis=S("line",{x1:i.xMin,x2:i.xMax,y1:s.y,y2:s.y},this.$axes)),this.showYAxis&&(this.$yAxis=S("line",{x1:s.x,x2:s.x,y1:i.yMax,y2:i.yMin},this.$axes)),this.showLabels&&this.showXAxis&&this.showYAxis&&(t.xMin===0&&t.yMax===0&&!this.labelSuffix[0]&&!this.labelSuffix[1]?S("text",{text:0,x:s.x-5,y:s.y+15,"text-anchor":"end"},this.$labels):t.yMax===this.plotOrigin.y?this.makeLabel(0,this.plotOrigin.x,s.x,s):this.makeLabel(1,this.plotOrigin.y,s.y,s)),this.axisNames&&(this.axisNames[0]&&S("text",{text:this.axisNames[0],x:this.viewportBounds.xMax-2,y:s.y-12,"text-anchor":"end"},this.$labels),this.axisNames[1]&&S("text",{text:this.axisNames[1],x:s.x+10,y:this.viewportBounds.yMin+5},this.$labels))}makeLabel(t,i,s,n){let r=this.labelSuffix[t],o=r==="i"?new bt(0,i).toString():ss(i,4)+r;S("text",{text:o,x:t?n.x-8:s,y:t?s+4:n.y+18,"text-anchor":t?"end":"middle"},this.$labels),S("line",{class:"tick",x1:t?n.x:s,y1:t?s:n.y,x2:t?n.x-N0:s,y2:t?s:n.y+N0},this.$axes)}positionElements(t,i){for(let s of this.$$("[data-bounds]")){let n=s.data.bounds.split(","),r=this.toViewportCoords(new y(+n[3],+n[0])),o=this.toViewportCoords(new y(+n[1],+n[2]));s.css({left:`${r.x/t*100}%`,top:`${r.y/i*100}%`,width:`${(o.x-r.x)/t*100}%`,height:`${(o.y-r.y)/i*100}%`})}}toPlotCoords(t){return t.changeCoordinates(this.viewportBounds,this.plotBounds)}toViewportCoords(t){return t.transform(this.plotToViewportMatrix)}};var gc=class extends Gs{constructor(){super(...arguments);this.steps=400}ready(){let t=S("svg",{},this),i=S("g",{class:"plot"},t);this.$path=S("path",{},i),this.setupCoordinates(t,{showGrid:!0,showAxes:!0,padding:"20"}),this.clear();let s=this.viewportBounds,n=this.steps/s.dx,r;os(t,{start:()=>r=void 0,move:o=>{let a=xt(Math.round((o.x-s.xMin)*n),0,this.steps-1);this.points[a]=this.toPlotCoords(new y(s.xMin+a/n,o.y)),r&&this.interpolate(r,a),r=a,this.redraw()},end:()=>this.snap()})}interpolate(t,i){i<t&&([t,i]=[i,t]);let s=this.points[t],n=this.points[i];for(let r=t+1;r<i;++r)this.points[r]=y.interpolate(s,n,(r-t)/(i-t))}redraw(){let t="",i=!0;for(let s of this.points){if(s){let n=this.toViewportCoords(s);t+=(i?"M":"L")+`${n.x},${n.y}`}i=!s}this.$path.setAttr("d",t)}snap(){let t=this.points.filter(s=>s).map(s=>[s.x,s.y]),i=oh.bestPolynomial(t);if(!!i){for(let s=0;s<this.steps;++s){if(!this.points[s])continue;let n=this.plotBounds.xMin+s/this.steps*this.plotBounds.dx;this.points[s]=new y(n,i.fn(n))}this.redraw(),this.trigger("snap",{regression:i})}}clear(){this.points=di(void 0,this.steps),this.$path.setAttr("d","")}};gc=R([L("x-coordinate-sketch")],gc);var Jb=2,D0=5e3,vc=class extends Gs{constructor(){super(...arguments);this.isAnimated=this.hasAttr("animate");this.crosshairGrid=10;this.getCrosshairPosn=t=>t}ready(){let t=S("svg",{},this);if(this.$plot=S("g",{class:"plot"},t),this.$overlay=S("g",{class:"overlay"},t),this.setupCoordinates(t,{showGrid:!0,showAxes:!0,padding:"20"}),this.hasAttr("fn")){let i=pe.parse(this.attr("fn"),!0);this.setFunctions(s=>i.evaluate({x:s}))}ai(this,"crosshairs",!0)&&(this.crosshairGrid=+this.attr("crosshair-grid")||10,this.setupCrosshairs(t))}setPoints(t,i=1){let s=t.map((n,r)=>new y(r+i,n));this.setSeries(s)}setSeries(...t){let i=Math.max(...t.map(r=>ct(r).x)),[s,n]=mc(t);this.updatePlotBounds(new be(0,i,s,n)),this.$plot.removeChildren();for(let r of t)this.drawLinePlot(r);this.getCrosshairPosn=r=>t[0].reduce((o,a)=>Math.abs(a.x-r.x)<=Math.abs(o.x-r.x)?a:o)}setFunctions(...t){let[i,s]=[this.plotBounds,this.viewportBounds],n=t.map(h=>{let l=[];for(let c=s.xMin;c<s.xMax;c+=Jb){let p=this.toPlotCoords(new y(c,0)).x;l.push(new y(p,h(p)))}return l}),[r,o]=mc(n);this.updatePlotBounds(new be(i.xMin,i.xMax,r,o)),this.$plot.removeChildren();for(let h of n)this.drawLinePlot(h);let a=this.gridSize[0]/this.crosshairGrid;this.getCrosshairPosn=h=>{let l=Xe(xt(h.x,i.xMin,i.xMax),a);return new y(l,t[0](l))}}drawLinePlot(t){let i=S("g",{},this.$plot),s=S("path",{},i),n=this.plotBounds;t=t.filter(o=>o.y>=n.yMax&&o.y<=n.yMin);let r=t.map(o=>this.toViewportCoords(o));this.isAnimated?re(o=>{let a=t.findIndex(h=>h.x>n.xMin+o*n.dx);s.points=r.slice(0,a)},D0):s.points=r}drawPoints(t){let i=S("g",{},this.$plot),s=this.plotBounds;for(let n of t){let r=this.toViewportCoords(n),o=S("circle",{r:4,cx:r.x,cy:r.y},i);if(this.isAnimated){o.hide();let a=D0*(n.x-s.xMin)/(s.xMax-s.xMin);setTimeout(()=>o.show(),a)}}}setupCrosshairs(t){let i=S("g",{class:"crosshair"},t),s=S("path",{},i),n=S("circle",{r:4},i),r=S("text",{},i),o=0,a=h=>{let l=this.getCrosshairPosn(this.toPlotCoords(h));if(B(l.x,o))return;o=l.x;let c=this.toViewportCoords(l),p=this.toViewportCoords(this.plotOrigin);n.setCenter(c),s.points=[new y(p.x,c.y),c,new y(c.x,p.y)],r.text=`(${ss(l.x,5,!1)}, ${ss(l.y,5,!1)})`;let m=r.width,v=c.x+8+m<this.viewportBounds.dx;r.setAttr("x",v?c.x+5:c.x-m-5),r.setAttr("y",c.y>20?c.y-7:c.y+18)};dp(t,{enter:()=>i.show(),move:h=>a(h),exit:()=>i.hide()})}};vc=R([L("x-coordinate-system")],vc);var fr=class{constructor(t,i){this.$canvas=t;this.defaultCallbacks=i;this.callbacks=new WeakMap;this.isMoving=!1;this.shiftKey=!1;this.altKey=!1;this.cancelled=!1;setTimeout(()=>{document.addEventListener("keydown",s=>{this.shiftKey=s.shiftKey,this.altKey=s.altKey}),document.addEventListener("keyup",s=>{this.shiftKey=s.shiftKey,this.altKey=s.altKey}),document.addEventListener("visibilitychange",()=>{this.shiftKey=this.altKey=!1})},2e3),t.css("touch-action","none"),t.on("pointerdown",s=>this.startEvent(s)),H.onKey("escape",()=>this.cancel()),i.hover&&t.on("pointermove",s=>{this.isMoving||i.hover({posn:ri(s,t),event:s})})}listen(t,i){this.callbacks.set(t._el,i),t.hasParent(this.$canvas)||(t.css("touch-action","none"),t.on("pointerdown",s=>this.startEvent(s)))}startEvent(t){var l;if(t.handled||t.button)return;this.isMoving=!0,this.cancelled=!1,t.preventDefault();let i=t.pointerId,s=this.getCallbacks(t.target);"shiftKey"in t&&(this.shiftKey=t.shiftKey),s.blurInput!==!1&&((l=H.getActiveInput())==null||l.blur());let n=ri(t,this.$canvas),r=n,o=!1,a=c=>{if(c.pointerId&&c.pointerId!==i)return;if(c.preventDefault(),this.cancelled)return h(c);let p=ri(c,this.$canvas);d.distance(p,r)<.5||(!o&&s.start&&s.start({posn:n,event:c}),s.move&&s.move({posn:p,startPosn:n,lastPosn:r,event:c}),!o&&s.cursor!==!1&&Wi.addClass("grabbing"),r=p,o=!0)},h=c=>{var p,m;c.pointerId&&c.pointerId!==i||(c.preventDefault(),Nt.off("pointermove",a),Nt.off("pointerstop",h),o?(p=s.end)==null||p.call(s,{posn:r,lastPosn:r,startPosn:n,event:c,cancelled:this.cancelled}):this.cancelled||(m=s.click)==null||m.call(s,{posn:n,event:c}),Wi.removeClass("grabbing"),this.isMoving=this.cancelled=!1)};s.down&&s.down({posn:n,event:t}),Nt.on("pointermove",a),Nt.on("pointerstop",h)}getCallbacks(t){for(;t;){let i=this.callbacks.get(t);if(i&&(!i.checkIfActive||i.checkIfActive()))return i;t=t.parentNode||void 0}return this.defaultCallbacks}cancel(){this.cancelled=!0}};function t$(e,t){if(typeof e=="string"){let i=Lt(e);return s=>{var n;return(n=i(t))==null?void 0:n.equals(s)}}return typeof e=="function"?e:i=>e.equals(i)}function wc(e,t,i){let s=t.map(v=>t$(v,e.model)),n=di(void 0,t.length),r=Li(),o=[],a=({point:v})=>o.push(v),h=i.maxErrors||4,l=0,c=({path:v})=>{i.onBegin&&i.onBegin(v)},p=()=>{n.every(v=>v)&&(i.onComplete&&i.onComplete(!0),e.off("add:path",m),e.off("begin:path",c),e.off("add:point",a),r.resolve(n))},m=({path:v})=>{let M=v.value;if(!!M){for(let[f,b]of s.entries())if(!n[f]&&b(M))return n[f]=v,i.onCorrect&&i.onCorrect(v,f),l=0,o=[],p();v.delete();for(let f of o)f.delete();if(o=[],!(_e(M)&&M.length<1))if(l+=1,l>=h){let f=n.findIndex($=>!$),b=t[f];if(typeof b!="function"){let $=e.drawPath(b,{animated:1e3});n[f]=$,i.onHint&&i.onHint($,f),l=0,p()}}else i.onIncorrect&&i.onIncorrect(v)}};return e.on("begin:path",c),e.on("add:path",m),e.on("add:point",a),r.promise}function G0(e,t){return S("text",{target:e.attr("target")||void 0,class:e.attr("label-class")||e.attr("class")||void 0,"data-when":e.data.when,style:t?`color: ${t}`:void 0,"text-anchor":"middle"})}function q0(e,t){let i=[];for(let s of t.paths)s!==e&&s.value&&i.push(s.value.transform(t.plotToViewportMatrix));return i}var e$=new le(new y(0,-9),12);function B0(e,t,i){for(let s of i)if(t.every(n=>!jt(e$.translate(s),n).length))return s;return i[0]}function H0(e,t){let i=e.value.transform(t.plotToViewportMatrix),s=e.$el;if(_e(i)){let n=i.perpendicularVector,r=i.angle;n.y>=0&&(n=n.scale(-1),r+=Math.PI);let o=[];for(let l of[.5,.35,.65])for(let c of[-15,5])o.push(i.at(l).add(n.scale(c)));if(!t.labelPositioning)return[o[0],r];let a=q0(e,t),h=B0(i,a,o);return s.hasAttr("mark")&&(h=h.add(i.unitVector.scale(12))),[h,r]}if(ph(i))return[i.at(.5).subtract(i.c).scale(.6).add(i.c).shift(0,5)];if(Fn(i)){let n=new zt(i.start,i.end),r=n.perpendicularVector.y>=0,o=n.angle+(r?Math.PI:0);return[i.at(.5).add(n.perpendicularVector.scale(r?14:5)),o]}if(fh(i)){let n=(+s.attr("size")||gh(i,{round:s.hasAttr("round")}))+8;return[i.b.add(i.bisector.unitVector.scale(n+5)).shift(0,3)]}if(Wd(i)){let n=s.hasClass("move")?10:8,r=[i.shift(n,-n),i.shift(-n,-n),i.shift(n,10+n),i.shift(-n,10+n)];if(!t.labelPositioning)return[r[0]];let o=q0(e,t);return[B0(i,o,r)]}return Yr(i)?[i.centroid.shift(0,5)]:Qe(i)?[i.c.shift(0,5)]:[]}var yc=class{constructor(t,i,s,n){this.$parent=t;this.$el=s;this.color="";this.label="";this.isPending=!1;this.isLocked=!1;this.components=[];this.dependencies=[];this.fixedLabel=!1;this.name=n||t.model.getKey(),t.shapes.set(this.name,this),t.model.watch(r=>{let o=r[this.name];this.$el.css("display",o?"block":"none"),this.$label&&this.$label.css("display",o?"block":"none"),o&&this.redraw(o),t.queueLabelPositioning()}),this.color=s.css("color")||"",this.setValue(i),s.hasAttr("label")&&this.setLabel(s.attr("label"))}get value(){return this.$parent.model[this.name]}get type(){var t;return(t=this.value)==null?void 0:t.type}get locked(){return this.isLocked}get isHidden(){return this.isPending||this.$el.hasAttr("hidden")||this.$el.hasClass("transparent")}setValue(t){t instanceof Function?this.$parent.model.setComputed(this.name,t):this.$parent.model[this.name]=t}setLabel(t,i,s){this.$label||(this.$label=G0(this.$el,i),this.$parent.$objLabels.append(this.$label));let n=to(t);if(this.$parent.model.watch(r=>this.$label.text=n(r)||""),this.fixedLabel=!!s,s){let r=Lt(s);this.$parent.model.watch(o=>{this.$label.setTransform(r(o).shift(0,5))})}this.updateLabelPosition()}setColor(t){this.color=t,this.$el.css("color",t);for(let i of this.dependencies)i.setColor(t);this.$label&&this.$label.css("color",t)}updateLabelPosition(){if(!this.$label||!this.value||this.fixedLabel)return;let[t,i]=H0(this,this.$parent);this.$label.setTransform(t,i)}select(){this.$el.addClass("selected"),this.$el.parent.append(this.$el);for(let t of this.dependencies)t.select()}deselect(){this.$el.removeClass("selected");for(let t of this.dependencies)t.deselect()}hover(t=!1){if(!t){if(this.$parent.hovering===this)return;this.$parent.hovering&&this.$parent.hovering.unhover(),this.$parent.hovering=this}this.$el.addClass("hover");for(let i of this.dependencies)i.hover(!0)}unhover(t=!1){if(!t){if(this.$parent.hovering!==this)return;this.$parent.hovering=void 0}this.$el.removeClass("hover");for(let i of this.dependencies)i.unhover(!0)}delete(t=300){return E(this,null,function*(){this.$parent.shapes.delete(this.name);for(let i of this.components)i.deselect();this.$label&&this.$label.exit("fade",t,0,!0),yield this.removeElement(t),this.$parent.model[this.name]=void 0})}},Ti=class extends yc{constructor(t,i,s,n,r=!1){n||(n=S("circle",{})),super(t,i,n,s),this.$parent.hidePoints||t.$points.append(this.$el),t.points.add(this),this.projectionId=t.model.getKey(),this.projectionOffset=void 0,t.model.watch(o=>{this.projection=o[this.projectionId],this.projection&&(this.projectionOffset===void 0&&(this.projectionOffset=Ns(this.projection,this.$parent.model[this.name])),this.$parent.model[this.name]=this.projection.at(this.projectionOffset))}),this.lock(r)}setValue(t){t instanceof Function?(this.project(void 0),this.$parent.model.setComputed(this.name,t)):(t&&this.projection&&(t=this.projection.project(t),this.projectionOffset=Ns(this.projection,t)),this.$parent.model[this.name]=t)}redraw(t){let i=t.transform(this.$parent.plotToViewportMatrix);this.$el.setCenter(i),this.$halo&&this.$halo.setCenter(i),this.$pulse&&this.$pulse.setCenter(i)}removeElement(t){return E(this,null,function*(){this.$parent.points.delete(this),yield this.$el.exit("pop",t,0,!0).promise})}distance(t){return this.value?y.distance(t,this.value):Infinity}lock(t=!0){this.isLocked=t,this.$el.setClass("move",!t),t?this.$el.removeAttr("tabindex"):this.$el.setAttr("tabindex",0)}project(t){if(this.projectionOffset=void 0,typeof t=="string"){let i=Lt(t);this.$parent.model.setComputed(this.projectionId,i)}else t?this.$parent.model.setComputed(this.projectionId,()=>t.value):this.$parent.model[this.projectionId]=void 0}makeIntersection({path1:t,path2:i,index:s}){this.setValue(n=>{if(!n[t.name]||!n[i.name])return;let r=jt(n[t.name],n[i.name]);return r[Math.min(s,r.length-1)]}),this.lock()}addHalo(){this.$halo=S("circle",{class:"halo",r:18},this.$parent.$pulses),this.$halo.setCenter(this.$el.center),this.$halo.enter("pop")}removeHalo(){return E(this,null,function*(){!this.$halo||(this.$halo.exit("pop",500,0,!0),this.$halo=void 0)})}pulsate(){this.$pulse=S("circle",{class:"pulse",r:8},this.$parent.$pulses),this.$pulse.setCenter(this.$el.center),this.$el.one("mouseover pointerdown focus",()=>{this.$pulse&&this.$pulse.remove(),this.$pulse=void 0})}},Yi=class extends yc{constructor(t,i,s,n){super(t,i,n||S("path"),s);t.$paths.append(this.$el),t.paths.add(this)}get locked(){return this.isLocked||!this.components.length||this.components.every(t=>t.locked)}redraw(t){let i=t.transform(this.$parent.plotToViewportMatrix);this.$el.draw(i,{box:this.$parent.viewportRect})}distance(t){return this.value?y.distance(t,this.value.project(t)):Infinity}removeElement(t){return E(this,null,function*(){this.$parent.paths.delete(this),yield this.$el.exit("draw",t,0,!0).promise})}setComponents(t,i){this.components=this.dependencies=t,this.setValue(()=>{let s=t.map(n=>n.value);if(!s.some(n=>n===void 0))return i(...s)})}};var la=class{constructor(t){this.$parent=t}enable(){}down(t){}start(t){}move(t,i){}end(t){}hover(t){}click(t){}cancel(){}snapToGrid(t){return this.$parent.snapToGrid?t.round(this.$parent.snapToGrid):t}snapToPoint(t,i){if(this.snapPoint=this.$parent.getPointAt(i),this.snapPoint)return t.$el.setClass("move",!this.snapPoint.locked),t.setValue(this.snapPoint.value);if(this.snapIntersect=this.$parent.getIntersectionAt(i),this.snapIntersect)return t.$el.removeClass("move"),t.setValue(this.snapIntersect.posn);if(!this.$parent.snapToGrid&&(this.snapPath=this.$parent.getPathAt(i),this.snapPath))return t.setValue(this.snapPath.value.project(i));t.$el.addClass("move"),t.setValue(this.snapToGrid(i))}getOrMakePointAt(t){let i=this.$parent.getPointAt(t);if(!i){i=new Ti(this.$parent,this.snapToGrid(t));let s=this.$parent.getIntersectionAt(t);if(s)i.makeIntersection(s);else if(!this.$parent.snapToGrid){let n=this.$parent.getPathAt(t);n&&i.project(n)}this.$parent.trigger("add:point",{point:i})}return i}showPendingPointAt(t){var n,r,o;let i=((n=this.$parent.getIntersectionAt(t))==null?void 0:n.posn)||((o=(r=this.$parent.getPathAt(t))==null?void 0:r.value)==null?void 0:o.project(t)),s=!!i;if(this.$parent.$pendingPoint.toggle(s),s){let a=this.$parent.toViewportCoords(i||t);this.$parent.$pendingPoint.setCenter(a)}}},ca=class extends la{constructor(){super(...arguments);this.isMoving=!1}enable(){}down(t){this.obj=this.$parent.getPointAt(t)||this.$parent.getPathAt(t),this.obj||this.$parent.deselect();let i=this.$parent.selection;i!==this.obj&&(i&&i.components.includes(this.obj)||this.$parent.select(this.obj))}start(){!this.obj||(this.isMoving=!0,this.obj.isPending=!0,this.$parent.updateIntersections(),this.$parent.trigger("move",{obj:this.obj}))}move(t,i){if(!(!this.obj||this.obj.locked||this.$parent.locked))if(this.obj instanceof Yi){let s=t.subtract(i);for(let n of this.obj.components)n.locked||n.setValue(n.value.add(s))}else this.obj instanceof Ti&&this.obj.setValue(this.snapToGrid(t))}end(){!this.obj||(this.isMoving=!1,this.obj.isPending=!1,this.snapPoint||(this.snapIntersect?this.obj.makeIntersection(this.snapIntersect):this.snapPath&&this.obj.project(this.snapPath)),this.$parent.trigger("moveEnd",{path:this.obj}),this.obj=void 0,this.$parent.updateIntersections())}hover(t){if(this.isMoving)return;let i=this.$parent.getPointAt(t)||this.$parent.getPathAt(t),s=i&&!this.$parent.locked&&!i.locked,n=i&&this.$parent.canSelect;this.$parent.setCursor(s?"grab":n?"pointer":"default"),s||n?i.hover():this.$parent.hovering&&this.$parent.hovering.unhover()}},xc=class extends ca{down(t){this.$parent.deselect(),this.obj=this.getOrMakePointAt(t),this.$parent.select(this.obj)}hover(t){let i=this.$parent.getPointAt(t);if(i)return this.$parent.setCursor(this.$parent.locked||i.locked?"default":"grab"),this.$parent.$pendingPoint.hide(),i.hover();this.$parent.hovering&&this.$parent.hovering.unhover(),this.$parent.setCursor("crosshair"),this.showPendingPointAt(t)}},mr=class extends la{enable(){this.$parent.setCursor("crosshair")}down(t){this.$parent.deselect(),this.startPoint=this.getOrMakePointAt(t)}start(t){!this.startPoint||(this.$parent.$pendingPoint.hide(),this.endPoint=new Ti(this.$parent,t),this.endPoint.isPending=!0,this.endPoint.$el.addClass("pending"),this.path=new Yi(this.$parent,void 0),this.path.setComponents([this.startPoint,this.endPoint],this.expr),this.path.isPending=!0,this.$parent.updateIntersections(),this.$parent.trigger("begin:path",{path:this.path,start:this.startPoint}))}move(t){if(!this.startPoint||!this.path||!this.endPoint)return;if(y.distance(t,this.startPoint.value)<20/this.$parent.plotScale)return this.endPoint.setValue(this.snapToGrid(t));this.snapToPoint(this.endPoint,t)}end(){if(!this.startPoint||!this.path||!this.endPoint)return;this.path.isPending=!1,this.endPoint.isPending=!1,this.startPoint.value.equals(this.endPoint.value)?(this.endPoint.delete(),this.path.delete(),this.path=this.endPoint=void 0):this.snapPoint?(this.path.setComponents([this.startPoint,this.snapPoint],this.expr),this.endPoint.delete(),this.endPoint=void 0):this.snapIntersect?this.endPoint.makeIntersection(this.snapIntersect):this.snapPath&&this.endPoint.project(this.snapPath),this.endPoint&&(this.$parent.trigger("add:point",{point:this.endPoint}),this.endPoint.$el.removeClass("pending"));let t=this.path;this.startPoint=this.endPoint=this.path=void 0,t&&(this.$parent.trigger("add:path",{path:t}),this.$parent.updateIntersections())}hover(t){let i=this.$parent.getPointAt(t);if(i)return this.$parent.$pendingPoint.hide(),i.hover();this.$parent.hovering&&this.$parent.hovering.unhover(),this.showPendingPointAt(t)}cancel(){this.endPoint&&this.endPoint.delete(),this.path&&this.path.delete(),this.$parent.$pendingPoint.hide(),this.startPoint=this.endPoint=this.path=void 0}},bc=class extends mr{expr(t,i){return new he(t,i)}},$c=class extends mr{expr(t,i){return new le(t,y.distance(t,i))}},Mc=class extends mr{expr(t,i){return new ce(t,i.x-t.x,i.y-t.y)}},Sc=class extends mr{expr(t,i){return new he(t,i).perpendicularBisector}},z0=(e,t,i)=>new ne(e,t,i).bisector,Pc=class extends la{enable(){}down(t){if(this.$parent.deselect(),!this.firstPoint)this.firstPoint=this.getOrMakePointAt(t),this.firstPoint&&this.firstPoint.addHalo();else if(this.secondPoint){this.path.isPending=this.thirdPoint.isPending=!1,this.thirdPoint.$el.removeClass("pending"),this.firstPoint.removeHalo(),this.secondPoint.removeHalo(),this.snapPoint?(this.path.setComponents([this.firstPoint,this.secondPoint,this.snapPoint],z0),this.thirdPoint.delete(),this.thirdPoint=void 0):this.snapIntersect?this.thirdPoint.makeIntersection(this.snapIntersect):this.snapPath&&this.thirdPoint.project(this.snapPath);let i=this.path,s=this.thirdPoint;this.firstPoint=this.secondPoint=this.thirdPoint=this.path=void 0,s&&this.$parent.trigger("add:point",{point:s}),this.$parent.trigger("add:path",{path:i}),this.$parent.updateIntersections()}else{if(this.secondPoint=this.getOrMakePointAt(t),!this.secondPoint)return;this.secondPoint.addHalo(),this.thirdPoint=new Ti(this.$parent,this.secondPoint.value),this.thirdPoint.$el.addClass("pending"),this.path=new Yi(this.$parent,void 0),this.path.setComponents([this.firstPoint,this.secondPoint,this.thirdPoint],z0),this.path.isPending=this.thirdPoint.isPending=!0}}hover(t){if(this.$parent.$pendingPoint.hide(),this.thirdPoint){this.snapToPoint(this.thirdPoint,t),this.$parent.setCursor(this.snapPoint?"pointer":"crosshair");return}let i=this.$parent.getPointAt(t);if(i)return this.$parent.setCursor("pointer"),i.hover();this.$parent.hovering&&this.$parent.hovering.unhover(),this.$parent.setCursor("crosshair"),this.showPendingPointAt(t)}cancel(){this.firstPoint&&this.firstPoint.removeHalo(),this.secondPoint&&this.secondPoint.removeHalo(),this.thirdPoint&&this.thirdPoint.delete(),this.path&&this.path.delete(),this.firstPoint=this.secondPoint=this.thirdPoint=this.path=void 0}};var F0='<x-select class="tools"><div class="tool" data-tool="move"><x-icon name="hand" size="28"></x-icon></div><div class="tool" data-tool="point"><x-icon name="geo-point" size="28"></x-icon></div><div class="tool" data-tool="line"><x-icon name="geo-line" size="28"></x-icon></div><div class="tool" data-tool="rectangle"><x-icon name="geo-rectangle" size="28"></x-icon></div><div class="tool" data-tool="circle"><x-icon name="geo-circle" size="28"></x-icon></div><div class="tool" data-tool="perpBisector"><x-icon name="geo-perp-bisector" size="28"></x-icon></div><div class="tool" data-tool="angleBisector"><x-icon name="geo-angle-bisector" size="28"></x-icon></div></x-select><slot></slot>';var Cc=class extends Gs{constructor(){super(...arguments);this.shapes=new Map;this.points=new Set;this.paths=new Set;this.intersections=new Set;this.snapToGrid=0;this.locked=!1;this.hidePoints=!1;this.canSelect=!1;this.canIntersect=!1;this.canProject=!0;this.labelPositioning=!1;this.cursor="default"}ready(){let t=this.children.filter(a=>a.tagName==="SVG")[0];if(this.hasAttr("complex")&&(this.setAttr("label-suffix",",i"),this.setAttr("axis-names","Real, Imaginary"),this.setAttr("axes","true"),this.setAttr("grid","true")),!this.hasAttr("x-axis")&&!this.hasAttr("y-axis")){let a=+this.attr("grid"),h=+this.attr("width")||this.width,l=+this.attr("height")||h;this.setAttr("x-axis",a?`-0.5,${h/a-.5},1`:`0,${h},1`),this.setAttr("y-axis",a?`${l/a-.5},-0.5,1`:`${l},0,1`),a&&this.setAttr("snap",1)}this.setupCoordinates(t,{proportional:!0}),this.viewportRect=this.viewportBounds.rect,this.model=this.getParentModel()||as({}),this.model.hasGeoModel||this.model.assign(O0),this.$paths=S("g",{class:"paths"},t),this.$pulses=S("g",{class:"pulses"},t),this.$points=S("g",{class:"points"},t),this.$objLabels=S("g",{class:"labels"},t),this.snapToGrid=this.hasAttr("snap")?+this.attr("snap")||1:0,this.hidePoints=this.hasAttr("no-points"),this.canIntersect=ai(this,"intersections",!1),this.canProject=ai(this,"projections",!0),this.canSelect=ai(this,"selectable",!1),this.labelPositioning=ai(this,"label-positioning",!0),this.hasClass("sticky")&&this.css("top",`calc(50vh - ${this.height/2}px)`),this.queueLabelPositioning=Oi(()=>{for(let a of this.shapes.values())a.updateLabelPosition()},0,!0);let i=t.$$("path[x], path[\\:d], circle");for(let a of i){let h=a.hasAttr("x")?Lt(a.attr("x")):void 0,l=a.attr("name");if(a.hasAttr(":d"))this.$paths.append(a),a.bindModel(this.model);else if(a.tagName==="PATH")this.$paths.append(a),new Yi(this,h,l,a);else{this.$points.append(a);let c=!a.hasClass("move"),p=h||a.center,m=new Ti(this,p,l,a,c);a.hasAttr("project")&&m.project(a.attr("project")),a.hasClass("pulsate")&&m.pulsate()}}this.$pendingPoint=S("circle",{class:"pending"},this.$points),this.$pendingPoint.hide(),this.updateIntersections();let s={move:new ca(this),point:new xc(this),line:new bc(this),circle:new $c(this),perpBisector:new Sc(this),angleBisector:new Pc(this),rectangle:new Mc(this)};this.$tools=this.$(".tools");let n=s[this.$tools.$active.data.tool];n.enable();let r=()=>this.toolOverride||n;this.$tools.on("change",a=>{r().cancel(),this.toolOverride=void 0,n=s[a.data.tool],this.hovering&&this.hovering.unhover(),this.$pendingPoint.hide(),this.hovering=void 0,this.deselect(),n.enable()});let o=(a,h=!1)=>this.toPlotCoords(h?a.clamp(this.viewportBounds,8):a);new fr(t,{down:a=>r().down(o(a.posn)),start:a=>r().start(o(a.posn)),move:a=>r().move(o(a.posn,!0),o(a.lastPosn,!0)),end:a=>r().end(o(a.posn,!0)),click:a=>r().click(o(a.posn)),hover:a=>r().hover(o(a.posn))}),P.onKey("escape",()=>r().cancel()),P.onKey("backspace delete",()=>this.delete()),document.addEventListener("keydown",a=>{if([37,38,39,40].indexOf(a.keyCode)<0)return;let l=P.getActiveInput();if(!(!l||!l.hasParent(this))){a.preventDefault();for(let c of this.points){if(c.$el!==l||!c.value)continue;let p=15/this.plotScale,m=this.plotBounds.yMin>this.plotBounds.yMax?-1:1,v=a.keyCode===37?-p:a.keyCode===39?p:0,M=a.keyCode===38?-m*p:a.keyCode===40?m*p:0;c.setValue(c.value.shift(v,M));return}}})}switchTool(t){this.$tools.makeActive(this.$(`.tool[data-tool="${t}"]`))}setCursor(t="default"){t!==this.cursor&&(this.cursor=t,this.$svg.css("cursor",t))}select(t){!this.canSelect||(this.deselect(),t&&(this.selection=t,t.select()),this.trigger("select",{shape:t}))}deselect(){!this.selection||(this.selection.deselect(),this.selection=void 0,this.trigger("select",{shape:void 0}))}delete(){this.hovering&&this.hovering.unhover(),this.selection&&this.selection.delete(),this.trigger("select",{shape:void 0})}redraw(){this.resize(),this.viewportRect=this.viewportBounds.rect,this.model.forceUpdate()}getPointAt(t,i=20){if(this.hidePoints)return;let s=n=>n.isHidden?void 0:n.distance(t);return ha(this.points,s,i/this.plotScale)}getPathAt(t,i=10){if(this.hidePoints||!this.canProject)return;let s=n=>n.isHidden?void 0:n.distance(t);return ha(this.paths,s,i/this.plotScale)}getIntersectionAt(t,i=20){if(!this.canIntersect)return;let s=n=>y.distance(t,n.posn);return ha(this.intersections,s,i/this.plotScale)}updateIntersections(){!this.canIntersect||this.hidePoints||I0(this.paths,this.intersections)}drawPath(t,i={}){typeof t=="string"&&(t=Lt(t));let s=new Yi(this,t,i.name);i.classes&&s.$el.addClass(i.classes),i.target&&s.$el.setAttr("target",i.target);let n=s.$el.hasClass("fill")?"fade":"draw";return i.animated&&s.$el.enter(n,i.animated),s}drawPoint(t,i={}){typeof t=="string"&&(t=Lt(t));let s=new Ti(this,t,i.name,void 0,i.interactive===!1);return i.classes&&s.$el.addClass(i.classes),i.target&&s.$el.setAttr("target",i.target),i.animated!==0&&s.$el.enter("pop",i.animated||500),s}animatePoint(t,i,s=400){let n=this.shapes.get(t),r=new he(this.model[t],i);return re(o=>n.setValue(r.at(mi("quad",o))),s)}animateConstruction(t,i=2e3){return E(this,null,function*(){let s=this.shapes.get(t),n=s.value;if(Qe(n)&&(n=n.arc),_e(n)){this.$ruler||(this.$ruler=S("path",{d:_0,class:"sketch"},this.$svg));let r=Ds(n.at(-.1),12,n.angle-.3,n.length*1.2),o=Ds(n.at(-.1),12,n.angle,n.length*1.2);this.$ruler.show(),s.$el.hide(),yield this.$ruler.animate({opacity:[0,1],transform:[r,o]},500).promise,yield s.$el.enter("draw",i).promise,yield this.$ruler.animate({opacity:[1,0],transform:[o,r]},500).promise}else if(Fn(n)){this.$compass||(this.$compass=S("path",{d:R0,class:"sketch"},this.$svg));let r=Ds(n.c,50,n.startAngle,n.radius*1.5),o=Ds(n.c,50,n.startAngle,n.radius),a=Ds(n.c,50,n.startAngle+n.angle,n.radius),h=Ds(n.c,50,n.startAngle+n.angle,n.radius*1.5);this.$compass.show(),s.$el.hide(),yield this.$compass.animate({opacity:[0,1],transform:[r,o]},500).promise,s.$el.enter("draw",i),yield this.$compass.animate({transform:[o,a]},i,0,"linear").promise,yield this.$compass.animate({opacity:[1,0],transform:[a,h]},500).promise}})}showGesture(t,i){this.$gesture||(this.$gesture=S("x-gesture",{},this)),this.$gesture.stop();let s=this.toViewportCoords(Lt(t)(this.model));if(this.$gesture.from=s,i){let n=this.toViewportCoords(Lt(i)(this.model));this.$gesture.start(n.subtract(s))}else this.$gesture.start();this.one("click mouseover pointerdown",()=>this.$gesture.stop())}waitForPoint(){return E(this,null,function*(){return new Promise(t=>{this.one("add:point",({point:i})=>t(i))})})}waitForPath(s){return E(this,arguments,function*(t,i={}){return(yield wc(this,[t],i))[0]})}waitForPaths(t,i={}){return wc(this,t,i)}};Cc=R([L("x-geopad",{template:F0})],Cc);var U0='<div class="image"></div><div class="content"><slot></slot></div>';var Tc=class extends I{ready(){let t=this.$(".image"),i=this.positionTop<50,s,n;t.css({"background-image":`url("${this.attr("background")}")`,height:i?"100%":"150%"});let r=({height:a})=>{let h=this.positionTop;s=Math.max(0,h-a),n=h+this.height};function o(a){if(a.top<s||a.top>n)return;let h=(a.top-s)/(n-s)*(i?50:33);t.css("transform",`translateY(${h}%)`)}P.onResize(r),Y.on("scroll",o)}};Tc=R([L("x-parallax",{template:U0})],Tc);var wt=180/Math.PI,lt=Math.PI/180,g={grey:"#cccccc",darkGrey:"#242436",red:"#cd0e66",orange:"#eb4726",yellow:"#fd8c00",lime:"#bfc212",green:"#22ab24",teal:"#009ea6",blue:"#0f82f2",purple:"#6d3bbf"},i$="M12.5,0H0V25H12.5a12.5,12.5,0,0,0,0-25Z",s$="M0,0V12.5a12.5,12.5,0,0,0,25,0V0Z",n$="M22.1,19.5l-9.2-16a1,1,0,0,0-1.8,0l-9.2,16A1,1,0,0,0,2.7,21H21.3A1,1,0,0,0,22.1,19.5Zm-8.7-11v2.4l-.4,4.4H11.1l-.4-4.4V8.5ZM12,19.4a1.6,1.6,0,0,1-1.6-1.6,1.6,1.6,0,1,1,3.2,0A1.6,1.6,0,0,1,12,19.4Z",ua=new Map,qs=class{constructor(t,i){this.source=t;let s=t.linkTypes||[],n=u("g",{class:"link-bar"});t.$el.prepend(n),this.$line=u("path",{},n),this.$handle=u("path",{class:"link-handle",d:"M-6 -8L6 0L-6 8Z"},n);let r;t.$parent.events.listen(n,{down:()=>r=this.target,start:()=>t.$parent.selection.add(t,!0),move:({posn:o})=>this.link(t.$parent.getTileAt(o,s),t.relativePosn(o),!0),end:()=>{var o;this.target||this.link(),(o=this.target)==null||o.highlight(!1),this.redraw(),this.target!==r&&t.$parent.change({changed:[t]})},click:()=>{this.link(),r&&t.$parent.change({changed:[t]})}}),i&&this.link(i),this.redraw()}redraw(t){var o,a,h,l;if(!this.source.path)return;if(!((o=this.target)==null?void 0:o.transformed)&&!t){this.$line.setAttr("d","");let c=this.source.path.edges[1].midpoint.shift(10,0);return this.$handle.setTransform(c)}let i=(l=(h=(a=this.target)==null?void 0:a.transformed)==null?void 0:h.translate(this.source.posn.scale(-1)))==null?void 0:l.rotate(-this.source.rot*lt),[s,n,r]=V0(this.source.path,i||t);this.$line.setAttr("d",s),this.$handle.setTransform(n,r)}change(){var t;(t=this.target)==null||t.link(this)}delete(){this.link(),this.target=void 0,this.source.links.delete(this);for(let t of[this.$line,this.$handle])t.remove()}link(t,i,s){var n,r;t&&t===this.target||(s&&((n=this.target)==null||n.highlight(!1),t==null||t.highlight()),(r=this.target)==null||r.unlink(this),this.target=t,this.redraw(i),t==null||t.link(this))}static serialize(t){if(!!t.links)return Array.from(t.links).filter(i=>i.target).map(i=>i.target.id).join(",")||void 0}static restore(t,i){if(t.links)for(let s of t.links)s.delete();!i||setTimeout(()=>{t.links||(t.links=new Set);for(let s of i.split(",")){let n=t.$parent.tiles.get(s);n&&t.links.add(new qs(t,n))}})}},V=class{constructor(t,i,s){this.$parent=t;this.options="";this.colour="";this.posn=C;this.rot=0;this.snapAngles=[0,90];this.canDragToSelect=!0;this.canRotate=!0;this.canMove=!0;this.$el=s||u("g",{class:"tile"},t.$tiles[2]),this.id=i||qi(10),t.tiles.set(this.id,this),ua.set(this.$el._el,this)}makeHandle(t,i,s){let r=u(t==="c"?"circle":"path",{class:"handle"},this.$el);t==="h"&&r.setAttr("d",i$),t==="v"&&r.setAttr("d",s$),t==="c"&&r.setAttr("r",10);let o="",a;return this.$parent.events.listen(r,{start:()=>{this.$parent.selection.add(this,!0),o=this.options,a=this.size},move:({posn:h})=>i(this.relativePosn(h),h),click:()=>s==null?void 0:s(),end:()=>{(this.options!==o||this.size!==a)&&this.$parent.change({changed:[this]})}}),r}is(t){return this.type===t}makeLink(){this.links||(this.links=new Set),this.links.add(new qs(this))}link(t){this.linkSources||(this.linkSources=new Set),this.linkSources.add(t)}unlink(t){var i;(i=this.linkSources)==null||i.delete(t)}setColour(t,i){this.colour=t;for(let s of this.links||[])s.change()}setSize(t){this.size=t}setOrder(t){t!==this.order&&(this.order=t,this.$container.append(this.$el))}lock(t=!0){t!==!!this.locked&&(this.$el.css("pointer-events",t?"none":"all"),this.locked=t,t&&this.$parent.selection.remove(this))}hide(t=!0){t!==!!this.hidden&&(this.$el.toggle(!t),this.hidden=t,t&&this.$parent.selection.remove(this))}flip(t){this.flipped=!this.flipped}click(t){}doubleClick(t){}format(t){}blur(){}get $container(){let t=this.order==="back"?0:this.order==="front"?2:1;return this.$parent.$tiles[t*2+(this.isActive?1:0)]}select(){this.isActive=!0,this.$el.addClass("active"),this.$container.append(this.$el);for(let t of this.links||[])t.redraw()}deselect(){this.isActive=!1,this.$el.removeClass("active"),this.$container.append(this.$el)}watchPolypadOptions(t){this.polypadOptionCallbacks||(this.polypadOptionCallbacks=[]),this.polypadOptionCallbacks.push(t),this.$parent.options.watch(t)}moveStart(){this.startPosn=this.posn}move(t,i){t&&(this.posn=this.startPosn.add(t),this.transform(!0))}showErrorIcon(t){var i;if(this.currentError=t,!t)return(i=this.$errorIcon)==null?void 0:i.detach();this.$errorIcon||(this.$errorIcon=u("g",{style:"cursor: pointer"}),u("circle",{cx:12,cy:12,r:12,fill:"transparent"},this.$errorIcon),u("path",{d:n$,fill:g.yellow},this.$errorIcon),this.transform(),this.$parent.events.listen(this.$errorIcon,{click:()=>{let s=this.$errorIcon.transformMatrix,n=this.posn.shift(s[0][2],s[1][2]);this.$parent.warningBanner.show(n,this.currentError)}})),this.$el.append(this.$errorIcon)}moveEnd(){this.collision&&this.collide(this.collision)}highlight(t=!0){}findNearby(t,i,s=this.posn){for(let n of this.$parent.tiles.values())if(n!==this&&n.is(t)&&d.distance(s,n.posn)<i)return n}setCollision(t){var i;t&&t===this.collision||((i=this.collision)==null||i.highlight(!1),this.collision=t,t==null||t.highlight(!0))}collide(t){}transform(t=!1){var s;let i=this.rot*lt;this.$el.setTransform(this.posn,i),this.customTransform(this.posn,i);for(let n of this.links||[])n.redraw();!t&&this.path&&(this.transformed=this.path.rotate(i).translate(this.posn),this.snapPoints=this.getSnapPoints().map(n=>n.rotate(i).translate(this.posn)),this.snapLines=this.getSnapLines().map(n=>n.rotate(i).translate(this.posn)),(s=this.$errorIcon)==null||s.setTransform(Ki(this.path).p.shift(-28,5)))}customTransform(t,i){}setTransform(t,i=this.rot){this.posn=t,this.rot=At(i,360),this.transform()}animateTo(t,i=this.posn,s=400){return this.setTransform(t),ot(n=>{n=mt("sine",n),this.$el.setTransform(d.interpolate(i,t,n),this.rot*lt)},s).promise}static makeThumbnail(t,i,s,n){}getSnapPoints(){return this.path?It(this.path)?[this.path]:ii(this.path)?this.path.points:ie(this.path)?[this.path.p1,this.path.p2]:$t(this.path)?[this.path.c,this.path.c.shift(0,this.path.r),this.path.c.shift(0,-this.path.r),this.path.c.shift(this.path.r,0),this.path.c.shift(-this.path.r,0)]:Ts(this.path)?[this.path.c,this.path.start,this.path.end]:$n(this.path)?[this.path.start,this.path.end]:[]:[]}getSnapLines(){return[]}delete(){for(let t of this.polypadOptionCallbacks||[])this.$parent.options.unwatch(t);for(let t of this.links||[])t.delete();for(let t of this.linkSources||[])t.delete();this.$parent.selection.remove(this),this.$parent.tiles.delete(this.id),this.$parent.mathContext.removeSource(this),ua.delete(this.$el._el),this.$el.remove()}copy(t={},i=25){let s=new this.constructor(this.options,this.$parent);return this.colour&&s.setColour(this.colour),this.flipped&&s.flip(),s.setTransform(this.posn.shift(i,i),this.rot),this.size&&s.setSize(this.size),s}relativePosn(t){return t.subtract(this.posn).rotate(-this.rot*lt)}get center(){return this.path?Ki(this.path).center:C}get ariaDescription(){return`${this.type}: ${this.options}`}static action(t,i,s){}applyChange(t){var i;if(t.options!==this.options){this.delete(),t=Object.assign(this.serialize(),t),V.unSerialize(t,this.$parent);return}(t.x||t.y||t.rot)&&this.setTransform(new d(t.x||this.posn.x||0,t.y||this.posn.y||0),t.rot||this.rot||0),t.colour&&t.colour!==this.colour&&this.setColour(t.colour),!t.flipped!=!this.flipped&&this.flip(),!t.locked!=!this.locked&&this.lock(!!t.locked),!t.hidden!=!this.hidden&&this.hide(!!t.hidden),this.fixed=!!t.fixed,t.size&&t.size!==this.size&&this.setSize(t.size),t.order!==this.order&&this.setOrder(t.order),t.links!==((i=this.lastSavedData)==null?void 0:i.links)&&qs.restore(this,t.links),this.serialize()}serialize(){return this.lastSavedData={id:this.id,name:this.type,options:this.options,x:this.posn.x,y:this.posn.y,rot:this.rot,size:this.size||void 0,flipped:this.flipped||void 0,locked:this.locked||void 0,fixed:this.fixed||void 0,hidden:this.hidden||void 0,order:this.order,colour:this.colour,links:qs.serialize(this)}}static unSerialize(t,i,s=!1){if(!(t==null?void 0:t.name))return;let n=i.newTile(t.name,t.options||"",s?void 0:t.id);return t.flipped&&n.flip(),n.setTransform(new d(t.x,t.y),t.rot),t.colour&&n.setColour(t.colour),t.size&&n.setSize(t.size),n.setOrder(t.order||void 0),t.hidden&&n.hide(!0),t.fixed&&(n.fixed=!0),t.locked&&n.lock(),t.links&&qs.restore(n,t.links),n.lastSavedData=t,n}};var j0={point:(e,t)=>e!==void 0&&t!==void 0?new d(e,t):void 0,line:(e,t)=>e&&t&&!e.equals(t)?new Ot(e,t):void 0,segment:(e,t)=>e&&t&&!e.equals(t)?new rt(e,t):void 0,circle:(e,t)=>e&&t?new Z(e,t):void 0,polygon:(...e)=>e.every(t=>t)?new O(...e):void 0,triangle:(e,t,i)=>e&&t&&i?new Jl(e,t,i):void 0,rectangle:(e,t,i)=>e?new A(e,t,i):void 0,distance:d.distance,intersections:oe},ze=ji({});ze.assign(j0);var Qi=new Map,gr=new Map,r$=/^_x[0-9]+\.at\([0-9-.e]+\)$/,o$=/^intersections\(|\.midpoint$|\.centroid$/,Ct=class extends V{constructor(t,i,s){super(i,s,u("path",{class:"geo-path"},i.$geoPaths));this.$parent=i;this.type="geo";this.hideSelectionOutline=!0;this.isProjection=!1;this.parentKeys=[];this.deleted=!1;this.onDraw=()=>this.draw();this.$shadow=u("path",{class:"geo-shadow"},i.$geoShadows),this.options=t;let[n,r]=t.split("=");r||(r=n,n=ze.getKey()),this.key=n,Qi.set(n,this),this.snapPoints=this.snapLines=this.snapAngles=[],this.setExpr(r),ze.watch(this.onDraw),this.setColour(i.penColour)}setExpr(t,i=!1){let s=Be(t);ze.setComputed(this.key,s),!i&&(this.options=`${this.key}=${t}`,this.expr=t,this.setParentKeys(t.match(/_x[0-9]+/g)||[]),this.isProjection=r$.test(t),this.computed=o$.test(t),this.$el.setClass("intersection",this.computed))}draw(){let t=ze[this.key];if(t===this.path)return;this.path=t,this.$el.toggle(t&&!this.hidden),this.isActive&&!t&&this.$shadow.hide();let i=t==null?void 0:t.type;i!==this.geoType&&(this.$el.setClass("geo-point",i==="point"),this.$el.setClass("geo-path",i!=="point"),(i==="point"?this.$parent.$geoPoints:this.$parent.$geoPaths).append(this.$el),this.geoType=i),!!t&&(i==="point"&&(t=new Z(t,this.computed?3.5:6)),this.$el.draw(t,{box:this.$parent.canvasBounds.rect}),this.$shadow.setAttr("d",this.$el.attr("d")),this.transform())}setParentKeys(t){var i;for(let s of this.parentKeys)(i=gr.get(s))==null||i.delete(this.key);this.parentKeys=t;for(let s of t)gr.has(s)||gr.set(s,new Set),gr.get(s).add(this.key)}get parents(){return this.parentKeys.map(t=>Qi.get(t)).filter(t=>t)}get children(){let t=gr.get(this.key);return t?Array.from(t).map(i=>Qi.get(i)).filter(i=>i):[]}get ariaDescription(){var t;return`${(t=this.path)==null?void 0:t.type} ${this.key}: ${this.expr}`}setOrder(){}select(){var t;this.isActive=!0,this.path&&this.$shadow.show(),(t=this.$el.parent)==null||t.append(this.$el)}deselect(){this.isActive=!1,this.$shadow.hide()}hover(t=!0){this.isActive||!this.path||(t?this.$shadow.show():this.$shadow.hide())}transform(){this.transformed=this.path,this.pending||(this.snapPoints=this.path&&It(this.path)?[this.path]:[],this.snapLines=!this.path||It(this.path)?[]:[this.path])}setTransform(){this.transform()}setColour(t){var i,s;this.colour=t,(i=this.$el)==null||i.css("color",_(t)),(s=this.$shadow)==null||s.css("color",_(t))}copy(t={}){if(!this.path)return;if(t[this.key])return t[this.key];let i=this.expr;if(It(this.path))i=`point(${this.path.x+25},${this.path.y+25})`;else for(let s of this.parents){let n=t[s.key]||s.copy(t);i=i.replace(s.key,n.key)}return t[this.key]=new Ct(i,this.$parent)}delete(){this.deleted=!0,super.delete(),ze.unwatch(this.onDraw),ze[this.key]=void 0,Qi.delete(this.key),this.$shadow.remove();for(let t of this.parents)t.geoType==="point"&&!t.deleted&&!t.parentKeys.length&&!t.children.length&&t.delete();for(let t of this.children)t.delete()}setPending(t=!0){this.pending=t,t||this.transform();for(let i of this.children)i.setPending(t)}moveStart(){if(!(this.computed||!this.path)){if(this.isProjection){if(this.$parent.selection.size>1)return;this.setParentKeys([])}this.setPending(!0);for(let t of this.parents)t.moveStart();this.moveStartValue=this.transformed}}move(t,i){if(!(!t||!this.path||!this.moveStartValue))if(It(this.path))this.snapTarget=i,this.$el.setClass("intersection",this.computed||!!(i==null?void 0:i.intersection)),ze[this.key]=this.moveStartValue.translate(t);else for(let s of this.parents)s.move(t)}moveEnd(){var t,i,s,n;if(!!this.moveStartValue){for(let r of this.parents)r.moveEnd();if(this.setPending(!1),(t=this.snapTarget)==null?void 0:t.intersection)this.setExpr(this.snapTarget.intersection.expr);else if(((s=(i=this.snapTarget)==null?void 0:i.tile)==null?void 0:s.type)==="geo"){let r=(n=this.snapTarget)==null?void 0:n.tile;if(r.path&&It(r.path)){for(let o of this.children)o.setExpr(o.expr.replace(this.key,r.key));return this.$parent.selection.add(r),this.delete()}else if(r.path){let o=Ns(r.path,ze[this.key]);this.setExpr(`${r.key}.at(${o})`)}}else this.path&&It(this.path)&&(this.expr=`point(${this.path.x},${this.path.y})`,this.options=`${this.key}=${this.expr}`,this.isActive||this.$parent.selection.implicitChanges.add(this))}}applyChange(t){let[i,s]=t.options.split("=");s!==this.expr&&this.setExpr(s),t.colour!==this.colour&&this.setColour(t.colour),!t.locked!=!this.locked&&this.lock(t.locked),this.lastSavedData=t}static get tiles(){return Qi.values()}static computeIntersections(t){t.intersections.clear();let i=Array.from(Qi.values()).filter(n=>n.path&&!It(n.path)),s=i.length;for(let n=0;n<s;++n)for(let r=n+1;r<s;++r){let o=oe(i[n].path,i[r].path);for(let[a,h]of o.entries())t.intersections.add({value:h,expr:`intersections(${i[n].key},${i[r].key})[${a}]`})}}static getInferredShape(t){let i=t.filter(h=>h.type==="geo"&&h.path);if(!i.length)return;if(i.length===1)return{type:i[0].path.type,expr:i[0].key,value:i[0].path};let s=i.filter(h=>It(h.path)),n=i.filter(h=>ie(h.path)||$t(h.path));if(n.length===1&&s.length===i.length-1){let h=n[0].path;if(s.every(l=>h.contains(l.path)))return{type:h.type,expr:n[0].key,value:h}}let r=n.filter(h=>ie(h.path));if(s.length+r.length!==i.length)return;for(let h of r)if(bn(h.path)){let l=h.parentKeys.map(c=>Qi.get(c));for(let c of l)s.includes(c)||s.push(c)}else if(s.filter(l=>h.path.contains(l.path)).length<2)return;let o=s.map(h=>h.key).join(","),a=s.map(h=>h.path);if(s.length===2){let h=new rt(a[0],a[1]);return{type:"segment",expr:`segment(${o})`,value:h}}return s.length===3?{type:"triangle",expr:`triangle(${o})`,value:new Jl(...a)}:{type:"polygon",expr:`polygon(${o})`,value:new O(...a)}}static construct(t,i,s){if(t=t.replace(/\$0/g,i||""),t.includes("$1"))s.tools.geoPending.enable(t);else{let n=new Ct(t,s);s.selection.add(n,!0);let r=It(n.path)?"pop":"draw";n.$el.enter(r,400),n.$shadow.enter(r,400),Ct.computeIntersections(s),s.change({added:[n]})}}static redrawLines(t){for(let i of Qi.values())i.path&&Ql(i.path)&&(i.$el.draw(i.path,{box:t}),i.$shadow.setAttr("d",i.$el.attr("d")))}static clearModel(){ze.clear(),ze.assign(j0)}};var a$=3,h$=.15;function W0(e,t,i,s=!1){let n=t||e,r=i||e,o=Math.atan2(r.y-n.y,r.x-n.x)+(s?Math.PI:0),a=d.distance(n,r)*h$;return e.shift(Math.cos(o)*a,Math.sin(o)*a)}function l$(e){return e.length<=2?si(new Es(...e)):e.map((t,i)=>{if(i===0)return`M${t.x.toFixed(2)} ${t.y.toFixed(2)}`;if(d.distance(e[i-1],t)<4)return`L${t.x.toFixed(2)},${t.y.toFixed(2)}`;let s=W0(e[i-1],e[i-2],t),n=W0(t,e[i-1],e[i+1],!0);return`C${s.x.toFixed(2)},${s.y.toFixed(2)} ${n.x.toFixed(2)},${n.y.toFixed(2)} ${t.x.toFixed(2)},${t.y.toFixed(2)}`}).join("")}var hi=class{constructor(t,i,s,n,r){this.$parent=t;this.brush=n;this.path="";this.$el=u("path",{class:`stroke ${n}`},t.$strokes),this.setColor(s),this.id=r||qi(10),t.strokes.set(this.id,this),i.length===1&&i.push(i[0].shift(.01)),this.draw(i)}setColor(t){this.color=t,this.$el.setAttr("stroke",_(t))}addPoint(t){this.segments.push(new rt(G(this.segments).p2,t)),this.path+=`L${t.x},${t.y}`,this.$el.setAttr("d",this.path)}setLine(t){this.segments=[t],this.path=si(t),this.$el.setAttr("d",this.path)}makeSnapPoints(){this.snapPoints=Vo(...this.segments.map(t=>[t.p1,t.p2])),this.snapLines=this.segments}simplify(){let t=this.segments.map(n=>n.p1);t.push(G(this.segments).p2);let i=[t[0]],s=0;for(let n=2;n<t.length;++n){let r=new rt(G(i),t[n]);t.slice(s+1,n).every(a=>r.contains(a,a$))||(i.push(t[n-1]),s=n-1)}i.push(G(t)),this.draw(i)}draw(t){this.path=l$(t),this.segments=new Es(...t).edges,this.$el.setAttr("d",this.path)}hitTest(t,i){let s=i**2;return this.segments.some(n=>n.distanceSquared(t)<s)}delete(){this.$parent.strokes.delete(this.id),this.$el.remove()}serialize(t=Infinity){return{points:this.path.slice(0,t),colour:this.color,brush:this.brush,id:this.id}}get lastSavedData(){return this.serialize()}static unSerialize(t,i){let s=As(t==null?void 0:t.points);if(!s.length)return;let n=new hi(i,s,t.colour||"#000",t.brush||"",t.id);return s.length===2&&n.makeSnapPoints(),n}};var W=class{constructor(t=0,i=0,s=0){this.x=t;this.y=i;this.z=s}transform(t){if(t instanceof da&&(t=t.matrix),t.length!==4||t[0].length!==4)throw new Error("Must use a 4x4 matrix for 3D transforms!");let[[i],[s],[n],[r]]=St.product(t,[[this.x],[this.y],[this.z],[1]]);return new W(i/r,s/r,n/r)}equals(t){return T(this.x,t.x)&&T(this.y,t.y)&&T(this.z,t.z)}fixFloat(){return new W(T(this.x,0)?0:this.x,T(this.y,0)?0:this.y,T(this.z,0)?0:this.z)}add(t){return this.x+=t.x||0,this.y+=t.y||0,this.z+=t.z||0,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}lerp(t,i){return new W(vt(this.x,t.x||0,i),vt(this.y,t.y||0,i),vt(this.z,t.z||0,i))}scale(t){return new W(this.x*t,this.y*t,this.z*t)}get magnitude(){return Math.hypot(this.x,this.y,this.z)}get normalize(){return this.scale(1/this.magnitude)}get asArray(){return[this.x,this.y,this.z]}get inverse(){return new W(-this.x,-this.y,-this.z)}get xy(){return new d(this.x,this.y)}[Symbol.iterator](){return this.asArray.values()}static get zero(){return new W(0,0,0)}static get oneZ(){return new W(0,0,1)}static get one(){return new W(1,1,1)}static all(t){return new W(t,t,t)}static from2D(t){return new W(t.x,t.y,0)}static average(t){return new W(pn(t.map(i=>i.x)),pn(t.map(i=>i.y)),pn(t.map(i=>i.z)))}static dot(t,i){return t.x*i.x+t.y*i.y+t.z*i.z}static cross(t,i){let s=t.y*i.z-t.z*i.y,n=t.z*i.x-t.x*i.z,r=t.x*i.y-t.y*i.x;return new W(s,n,r)}};var st={translate({x:e,y:t,z:i}){return[[1,0,0,e],[0,1,0,t],[0,0,1,i],[0,0,0,1]]},rotateX(e){let t=Math.cos(e),i=Math.sin(e);return[[1,0,0,0],[0,t,-i,0],[0,i,t,0],[0,0,0,1]]},rotateY(e){let t=Math.cos(e),i=Math.sin(e);return[[t,0,i,0],[0,1,0,0],[-i,0,t,0],[0,0,0,1]]},rotateZ(e){let t=Math.cos(e),i=Math.sin(e);return[[t,-i,0,0],[i,t,0,0],[0,0,1,0],[0,0,0,1]]},rotateAxis({x:e,y:t,z:i},s){let n=Math.hypot(e,t,i);n=1/n,e*=n,t*=n,i*=n;let r=Math.sin(s),o=Math.cos(s),a=1-o;return[[e*e*a+o,e*t*a-i*r,e*i*a+t*r,0],[t*e*a+i*r,t*t*a+o,t*i*a-e*r,0],[i*e*a-t*r,i*t*a+e*r,i*i*a+o,0],[0,0,0,1]]},fromEulerAngles(e,t,i){return St.product(st.rotateX(e),st.rotateY(t),st.rotateZ(i))},scale({x:e,y:t,z:i}){return[[e,0,0,0],[0,t,0,0],[0,0,i,0],[0,0,0,1]]},scaleAll(e){return[[e,0,0,0],[0,e,0,0],[0,0,e,0],[0,0,0,1]]},perspective(e,t,i,s){let n=i*Math.tan(Math.PI/180*e/2),r=-n,o=n*t,a=-o;return[[2*i/(o-a),0,(o+a)/(o-a),0],[0,2*i/(n-r),(n+r)/(n-r),0],[0,0,-((s+i)/(s-i)),-(2*s*i/(s-i))],[0,0,-1,0]]},transformPoint(e,t){return t instanceof W?t.transform(e):new W(t.x,t.y).transform(e)}},da=class{constructor(){this.matrix=St.identity(4)}clear(){return this.matrix=St.identity(4),this}translate(t=0,i=0,s=0){return this.matrix=St.product(this.matrix,st.translate({x:t,y:i,z:s})),this}rotate(t=0,i=0,s=0){return this.matrix=St.product(this.matrix,st.rotateZ(s),st.rotateY(i),st.rotateX(t)),this}scale(t){return this.matrix=St.product(this.matrix,st.scale(t)),this}dragToRotate(t,i,s=100){let n=new W(t.x,t.y,s**3/(s**2+t.length**2)).normalize,r=new W(i.x,i.y,s**3/(s**2+i.length**2)).normalize,o=k(W.dot(n,r),-1,1),a=W.cross(n,r),h=st.rotateAxis(a,2*Math.acos(o));return this.matrix=St.product(h,this.matrix),this}isRotationMatrix(){if(!T(St.determinant(this.matrix),1))return!1;let t=St.transpose(this.matrix);return St.product(this.matrix,t).every((s,n)=>s.every((r,o)=>T(r,n===o?1:0)))}toEulerAngles(){let t=this.matrix,i=Math.sqrt(t[0][0]*t[0][0]+t[1][0]*t[1][0]);if(T(i,0)){let a=Math.atan2(-t[1][2],t[1][1]),h=Math.atan2(-t[2][0],i);return[a,h,0]}let n=Math.atan2(t[2][1],t[2][2]),r=Math.atan2(-t[2][0],i),o=Math.atan2(t[1][0],t[0][0]);return[n,r,o]}};var c$=new q(0,0,0);function u$(e){let t=e.r,i=e.c.x,s=e.c.y,n=.5523*t;return`M${i} ${s-t}C${i+n} ${s-t} ${i+t} ${s-n} ${i+t} ${s}C${i+t} ${s+n} ${i+n} ${s+t} ${i} ${s+t}C${i-n} ${s+t} ${i-t} ${s+n} ${i-t} ${s}C${i-t} ${s-n} ${i-n} ${s-t} ${i} ${s-t}`}var Ec=class{constructor(){this.transform=new da;this.visible=!0}getTransformed(t){let i=this;do t=t.transform(i.transform);while(i=i.parent);return t}get normal(){return this.getTransformed(W.oneZ).add(this.getTransformed(W.zero).inverse).normalize}project(t,i={fov:120}){if(i.fov===!1)return new d(t.x,t.y);let s=Math.exp(t.z/i.fov);return new d(t.x*s,t.y*s)}*getProjectedVertices(t){for(let i of this.getVertices())yield this.project(i,t)}},Le=class extends Ec{constructor(t,i={},s){super();this.children=[];this.sorting=!1;this.$el=u("g",i,s);for(let n of t)this.addChild(n)}addChild(t){return t.parent&&t.parent.removeChild(t),this.children.push(t),this.$el&&t.$el&&this.$el.append(t.$el),t.parent=this,t}removeChild(t){let i=this.children.indexOf(t);i>=0&&this.children.splice(i,1),t.$el&&t.$el.remove(),t.parent=void 0}render(t){if(!!this.visible){if(this.sorting)for(let i of Eo(this.children,s=>s.zIndex))this.$el.append(i.$el);for(let i of this.children)i.render(t)}}*getFaces(){for(let t of this.children)for(let i of t.getFaces())yield i}*getVertices(){for(let t of this.children)for(let i of t.getVertices())yield i}get zIndex(){return pn(this.children.map(t=>t.zIndex))}},ve=class extends Ec{constructor(t,i={},s){super();this.shape=t;if(t==null)this.commands=[];else if(typeof t=="string")this.commands=Xo(t);else{let r=$t(t)?u$(t):si(t);this.commands=Xo(r)}let n=d.average(...this.commands.filter(r=>r.points.length).map(r=>d.average(...r.points)));this.centroid=new W(n.x,n.y,0),s&&(this.color=s),this.$el=u("path",i)}render(t){if(!this.visible)return;if(t==null?void 0:t.hideBackface){let s=this.getTransformed(W.zero).z>0;if(this.$el.toggle(s),!s)return}if(this.color){let s=q.mix(this.color,c$,(Math.abs(this.normal.z)+1)/2);this.$el.setAttr("fill",s),this.$el.setAttr("stroke",s)}let i=this.commands.map(s=>{let n=s.points.map(r=>{let o=this.project(this.getTransformed(new W(r.x,r.y)),t);return`${o.x},${o.y}`});return s.type+n.join(",")}).join("");this.$el.setAttr("d",i)}get zIndex(){return this.getTransformed(this.centroid).z}*getFaces(){yield this}*getVertices(){if(!(typeof this.shape=="string"||!ii(this.shape)))for(let t of this.commands)for(let i of t.points)yield this.getTransformed(new W(i.x,i.y))}};var J=O.regular(3),Vn=O.regular(4),Oe=O.regular(5),pa={shape:J,children:[{shape:J,dihedral:70.53,rot:180},{shape:J,dihedral:70.53,parentEdge:1,rot:300},{shape:J,dihedral:70.53,parentEdge:2,rot:60}]},fa={shape:Vn,children:[{shape:Vn,dihedral:90,myEdge:2,children:[{shape:Vn,dihedral:90,myEdge:2}]},{shape:Vn,dihedral:90,parentEdge:1,rot:270},{shape:Vn,dihedral:90,parentEdge:2},{shape:Vn,dihedral:90,parentEdge:3,rot:90}]},ma={shape:J,children:[{shape:J,dihedral:109.47,rot:180},{shape:J,dihedral:109.47,parentEdge:1,rot:300,children:[{shape:J,dihedral:109.47,parentEdge:1,rot:300}]},{shape:J,dihedral:109.47,parentEdge:2,rot:60,children:[{shape:J,dihedral:109.47,parentEdge:1,rot:300},{shape:J,dihedral:109.47,parentEdge:2,rot:60,children:[{shape:J,dihedral:109.47,parentEdge:1,rot:300}]}]}]},ga={shape:Oe,children:[{shape:Oe,dihedral:116.57,rot:180},{shape:Oe,dihedral:116.57,parentEdge:1,rot:252},{shape:Oe,dihedral:116.57,parentEdge:2,rot:324},{shape:Oe,dihedral:116.57,parentEdge:3,rot:36},{shape:Oe,dihedral:116.57,parentEdge:4,rot:108,children:[{shape:Oe,dihedral:116.57,parentEdge:2,rot:324,children:[{shape:Oe,dihedral:116.57,parentEdge:3,rot:36,children:[{shape:Oe,dihedral:116.57,parentEdge:1,rot:252},{shape:Oe,dihedral:116.57,parentEdge:2,rot:324},{shape:Oe,dihedral:116.57,parentEdge:3,rot:36},{shape:Oe,dihedral:116.57,parentEdge:4,rot:108}]}]}]}]},va={shape:J,children:[{shape:J,dihedral:138.19,rot:180},{shape:J,dihedral:138.19,parentEdge:1,rot:300,children:[{shape:J,dihedral:138.19,parentEdge:1,rot:300,children:[{shape:J,dihedral:138.19,parentEdge:2,rot:60,children:[{shape:J,dihedral:138.19,parentEdge:1,rot:300,children:[{shape:J,dihedral:138.19,parentEdge:1,rot:300}]},{shape:J,dihedral:138.19,parentEdge:2,rot:60}]},{shape:J,dihedral:138.19,parentEdge:1,rot:300}]},{shape:J,dihedral:138.19,parentEdge:2,rot:60}]},{shape:J,dihedral:138.19,parentEdge:2,rot:60,children:[{shape:J,dihedral:138.19,parentEdge:2,rot:60,children:[{shape:J,dihedral:138.19,parentEdge:1,rot:300,children:[{shape:J,dihedral:138.19,parentEdge:2,rot:60,children:[{shape:J,dihedral:138.19,parentEdge:1,rot:300,children:[{shape:J,dihedral:138.19,parentEdge:1,rot:300}]},{shape:J,dihedral:138.19,parentEdge:2,rot:60}]},{shape:J,dihedral:138.19,parentEdge:1,rot:300}]},{shape:J,dihedral:138.19,parentEdge:2,rot:60}]},{shape:J,dihedral:138.19,parentEdge:1,rot:300}]}]};function Z0(e,t,i){let s=O.regular(e).scale(t*Yt(e)),n=new A(C,t,i).polygon,r=[{shape:s,rot:180,parentEdge:2}],o=F(a=>({shape:n,parentEdge:a,rot:360/e*a,children:a?void 0:r}),e);return{shape:s,children:o}}function K0(e,t,i){let s=O.regular(e).scale(t*Yt(e)),n=new O(new d(-t/2,0),new d(t/2,0),new d(0,-i)),r=wt*Math.acos(t/i/2/Math.tan(Math.PI/e)),o=F(a=>({shape:n,dihedral:r,parentEdge:a,rot:180+360/e*a}),e);return{shape:s,children:o}}var d$=St.identity(4);function X0(e,t,i,s){var v;let n=t.shape.edges[e.parentEdge||0],r=e.shape.edges[e.myEdge||0],o=(e.dihedral||90)/wt,a=s(e);i.addChild(a);let h=W.from2D(n.midpoint),l=W.from2D(r.midpoint),c=W.from2D(n.unitVector),p=e.rot?e.rot*lt:0,m=((v=e.children)==null?void 0:v.map(M=>X0(M,e,i,s)))||[];return[a,h,l,c,p,o,m]}function vr(e,t,i=1){var o;let s=t(e),n=new Le([s]);n.sorting=!0;let r=((o=e.children)==null?void 0:o.map(a=>X0(a,e,n,t)))||[];return Ac(r,n,i),{group:new Le([n]),foldTree:r}}function Y0(e,t,i=d$){let[s,n,r,o,a,h,l]=e,c=vt(Math.PI,h,t),p=st.rotateAxis(o,Math.PI-c);a&&(p=St.product(p,st.rotateZ(a)));let m=r.transform(p),v=st.translate(m.inverse.add(n));s.transform.matrix=St.product(i,v,p);for(let M of l||[])Y0(M,t,s.transform.matrix)}function Ac(e,t,i){t.transform.clear();for(let r of e)Y0(r,i);let s=Array.from(t.getFaces()).map(r=>r.getTransformed(r.centroid)),n=W.average(s).inverse;t.transform.translate(n.x,n.y,n.z)}function p$(e,t,i){let s=Math.cos(e),n=Math.cos(t),r=Math.cos(i),o=Math.sin(t),a=Math.acos((r-s*n)/(Math.sin(e)*o)),h=Math.acos((s-n*r)/(o*Math.sin(i)));return[a,h]}function Q0(e,t){return Math.asin(Math.cos(e*t)/Math.cos(e/2))}var f$=[60,90,108],m$=[{internal:[60,90,90,90],dihedral:[144.74,135,135,135]},{internal:[60,60,60,60,90],dihedral:[153.23,153.23,153.23,142.98,142.98]},{internal:[60,90,108,90],dihedral:[159.09,148.28,148.28,159.09]},{internal:[60,60,60,60,108],dihedral:[164.18,164.18,152.93,152.93,152.93]}];function g$(...e){let t=e.length;if(t===3)return p$(e[0],e[1],e[2]);let i=e.map(n=>Math.round(n*wt));if((t===4||t===5)&&i.includes(60)&&i.every(n=>f$.includes(n))){for(let n of m$)if(n.internal.length===t){for(let r=0;r<e.length;++r)if(i.every((o,a)=>o===n.internal[(a+r)%t]))return Al(n.dihedral,r).slice(0,t-1).map(o=>o*lt)}}if(t===4&&i.filter(n=>n===60).length===3){let n=i.findIndex(l=>l!==60),r=(Math.PI-e[n])/4,o=Math.acos(-1/Math.sqrt(3)*Math.tan(r)),a=Math.acos(1-2/3*((3-Math.tan(r)**2)/4+(Math.sin(3*r)/Math.sin(2*r))**2));return Al([o,a,a,o],4-n).slice(0,t-1)}let s=Math.PI/U(e);return F(n=>{let r=Q0(e[n],s),o=Q0(e[n+1],s);return r+o},e.length-1)}var Vc=(e,t)=>At(e+1,t.size),kc=(e,t)=>At(e-1,t.size);function v$(e,t){let i=e.polygon.points[kc(t,e)],s=e.polygon.points[t],n=e.polygon.points[Vc(t,e)];return new Xt(n,s,i).sup.rad}function w$(e){let t=e.find(a=>a.neighbours.filter(h=>h).length===1),i=kc(t.neighbours.findIndex(a=>a),t),s=[],n=t,r=i;do{let a=[];for(;a.push({face:n,vertex:r}),!!n.neighbours[r];){let h=n;n=n.neighbours[r],r=Vc(n.neighbours.indexOf(h),n)}r=Vc(r,n),s.push(a)}while(n!==t||r!==i);let o=new jf(s);for(;;){let a=Math.max(3,...o.array.map(c=>c.val.length)),h=o.array.filter(c=>c.val.length>=a);if(!h.length)break;let l=new Set;for(let c of h){if(l.has(c))continue;let p=c.val.map(v=>v$(v.face,v.vertex)),m=g$(...p);for(let[v,M]of m.entries()){let f=c.val[v],b=c.val[v+1],$=f.vertex,w=kc(b.vertex,b.face);f.face.dihedral[$]=b.face.dihedral[w]=Math.max(M,f.face.dihedral[$]||0,b.face.dihedral[w]||0)}c.prev.val.push(...c.next.val),l.add(c.next),o.delete(c.next),o.delete(c)}}}function J0(e,t){return Math.max(...e.neighbours.map(i=>!i||i===t?0:J0(i,e)))+1}function tg(e,t){return e.visited?!0:(e.visited=!0,e.neighbours.filter(i=>i&&i!==t).some(i=>tg(i,e)))}function eg(e,t,i,s){let n=e.neighbours.map((r,o)=>{if(!(!r||r===i))return eg(r,t,e,e.dihedral[o])}).filter(r=>r);return{shape:ut(e.polygon.points.map(r=>r.subtract(t))),color:e.tile.colour,children:n.length?n:void 0,dihedral:s?+(s*wt).toFixed(2):void 0,parentEdge:i?i.neighbours.indexOf(e):void 0,myEdge:i?e.neighbours.indexOf(i):void 0}}function y$(e){let t=e.map(i=>{let s=i.transformed.oriented,n=s.points.length;return{tile:i,polygon:s,size:n,neighbours:Ce(void 0,n),dihedral:Ce(void 0,n),edges:s.edges,center:s.centroid,radius:s.radius}});if(!t.some(i=>i.size<3)){for(let[i,s]of t.entries())for(let[n,r]of t.entries())if(!(i>=n)&&!(s.radius+r.radius<d.distance(s.center,r.center)-2)){for(let[o,a]of s.edges.entries())for(let[h,l]of r.edges.entries())if(a.equals(l,2)){if(s.neighbours[o]||r.neighbours[h])return;s.joined=r.joined=!0,s.neighbours[o]=r,r.neighbours[h]=s}}if(!t.some(i=>!i.joined)&&!tg(t[0]))return t}}function ig(e){let t=y$(e);if(!t)return;w$(t);let i=ws(t,n=>J0(n)),s=i.polygon.centroid;return[s,eg(i,s)]}function sg(e){var i;let t=((i=e.c||e.children)==null?void 0:i.map(s=>sg(s)))||[];return{shape:kn(e.shape||e.s),color:e.color||e.a,children:t,dihedral:e.dihedral||e.d,parentEdge:e.parentEdge||e.p,myEdge:e.myEdge||e.m,rot:e.rot||e.r}}function ng(e){var i;let t=(i=e.children)==null?void 0:i.map(s=>ng(s));return(t==null?void 0:t.length)||(t=void 0),{s:ut(e.shape.points),a:e.color,children:t,d:e.dihedral,p:e.parentEdge,m:e.myEdge,r:e.rot}}function x$(e){try{let{net:t,angle:i,rotation:s}=JSON.parse(e.replace(/([a-z]):/g,'"$1":')),n;return typeof t=="string"?(n=`"${t}"`,t=yr[t].net||yr.Cube.net):(t=sg(t),n=JSON.stringify(ng(t)).replace(/"([a-z])":/g,"$1:")),{net:t,serialized:n,angle:i,rotation:s}}catch(t){return{net:yr.Cube.net,serialized:'"Cube"',angle:1}}}function Ln(e,t=1){var s;let i=(s=e.children)==null?void 0:s.map(n=>Ln(n,t));return Object.assign({},e,{children:i,shape:e.shape.scale(t)})}var yr={Tetrahedron:{net:Ln(pa,Yt(3)*50),scale:1.1},Cube:{net:Ln(fa,Yt(4)*50),scale:.8},Octahedron:{net:Ln(ma,Yt(3)*50),scale:.95},Dodecahedron:{net:Ln(ga,Yt(5)*50),scale:.42},Icosahedron:{net:Ln(va,Yt(3)*50),scale:.67},Pyramid:{net:K0(6,50,100),scale:.57},Prism:{net:Z0(6,50,100),scale:.45}},Bs={fov:400},rg=[1.066,.243,-.088],Hs=class extends V{constructor(t,i,s){super(i,s);this.type="polyhedron";this.canRotate=!1;this.options=t,t in yr&&(t=`{"net":"${t}","angle":1,"rotation":${JSON.stringify(rg)}}`);let n=x$(t);this.net=n.net,this.serialized=n.serialized;let r=vr(this.net,o=>new ve(o.shape,{class:"polygon-tile"},o.color||wr(o.shape.points.length)));this.solid=r.group,this.foldTree=r.foldTree,this.$el.append(this.solid.$el),this.$outline=u("path",{class:"outline"},this.$el),this.$moveBar=u("path",{d:"M0 0h30",class:"handle"},this.$el),this.$moveHandle=u("path",{d:"M0 0h14v14h-14Z",class:"handle",style:"cursor: grab"},this.$el),this.solid.$el.css("cursor","move"),this.setRotation(n.rotation||[0,0,0]),this.hinge(n.angle||0),this.solid.render(Bs),this.updateOutline(),i.events.listen(this.solid.$el,{start:()=>{i.selection.add(this,!0),this.$el.removeClass("active")},move:({posn:o,lastPosn:a})=>{this.solid.transform.dragToRotate(a.subtract(this.posn),o.subtract(this.posn),100),this.solid.render(Bs)},end:()=>{this.rotation=this.solid.transform.toEulerAngles(),this.updateOutline(),this.updateOptions(),i.change({changed:[this]}),this.$el.addClass("active")},click:o=>i.tools.move.down(o),checkIfActive:()=>this.angle>0})}updateOutline(){let t=this.solid.getProjectedVertices(Bs);this.path=O.convexHull(...t),this.$outline.draw(this.path),this.transform(),this.$moveBar.translate(this.path.points[0].x-30,this.path.points[0].y),this.$moveHandle.translate(this.path.points[0].x-45,this.path.points[0].y-7)}setRotation(t){this.rotation=t,this.solid.transform.clear().rotate(...t)}updateOptions(){let t=JSON.stringify(this.rotation.map(i=>+i.toFixed(4)));this.options=`{"net":${this.serialized},"angle":${this.angle},"rotation":${t}}`}animateHinges(t,i=!1,s=800){let n=i?this.rotation:[0,0,0],r=this.angle;return ot(o=>{this.hinge(vt(r,t,o)),i&&this.setRotation(n.map(a=>a*(1-o))),this.solid.render(Bs)},s)}hinge(t){this.angle=k(t,0,1);let i=this.solid.transform.matrix;this.solid.transform.clear(),Ac(this.foldTree,this.solid.children[0],-this.angle),this.solid.transform.matrix=i}hingeStart(){this.startRotation=this.rotation,this.startAngle=this.angle,this.$el.removeClass("active")}hingeMove(t){if(!T(t,this.angle)){if(this.hinge(t),this.startRotation&&this.startAngle){let i=k(t/this.startAngle,0,1);this.setRotation(this.startRotation.map(s=>i*s))}this.solid.render(Bs)}}hingeEnd(){this.updateOutline(),this.$el.addClass("active"),this.updateOptions()}setColour(t){super.setColour(t);for(let i of this.solid.getFaces())i.color=t;this.solid.render(Bs)}static fold(t){let i=ig(t);if(!i){aa("polyhedron-error");return}let s=JSON.stringify({net:i[1],angle:1}),n=new Hs(s,t[0].$parent);n.hinge(0);let r=n.solid.children[0].transform.matrix;n.setTransform(i[0].shift(-r[0][3],-r[1][3])),n.animateHinges(1).promise.then(()=>n.updateOutline());for(let a of t)a.delete();return n}unfold(){return E(this,null,function*(){this.$parent.selection.remove(this),this.angle>0&&(yield this.animateHinges(0,!0).promise);let t=Array.from(this.solid.getFaces()).map(i=>{let s=Array.from(i.getProjectedVertices()),n=new j(ut(s),this.$parent);return n.setColour(this.colour||i.color||wr(s.length)),n.setTransform(this.posn),n});return this.delete(),t})}static action(t,i){return E(this,null,function*(){if(t==="unfold"){let s=Te(yield Promise.all(i.map(n=>n.unfold())));i[0].$parent.change({added:s,deleted:i})}})}static makeThumbnail(t,i){let s=u("svg",{width:70,height:70},i),n=u("g",{transform:"translate(35, 35)"},s),{net:r,scale:o}=yr[t],a=vr(r,h=>new ve(h.shape,{class:"polygon-tile"},wr(h.shape.points.length)),-1).group;a.transform.clear().rotate(...rg).scale({x:o,y:o,z:o}),n.append(a.$el),a.render(Bs)}};function Yt(e){let t=Math.cos(2*Math.PI/e);return 1/Math.sqrt(2-2*t)}var Lc=e=>At(Math.round(e.angle*wt),180),ut=e=>e.map(t=>`${Ee(t.x,2)} ${Ee(t.y,2)}`).join(",");function wa(e,t){let i=new d(-e/2,-t/2);return ut(new A(i,e,t).points)}var D=50,dt=Math.sqrt(3)/4*D,Oc=new Ot(C,new d(0,1)),og={"equ-triangle":new O(new d(-D/2,dt),new d(D/2,dt),new d(0,-dt)),square:O.regular(4,D*Yt(4)),"reg-pentagon":O.regular(5,D*Yt(5)),"reg-hexagon":O.regular(6,D*Yt(6)),"reg-heptagon":O.regular(7,D*Yt(7)),"reg-octagon":O.regular(8,D*Yt(8)),"reg-decagon":O.regular(10,D*Yt(10)),"reg-dodecagon":O.regular(12,D*Yt(12)),rectangle:new A(new d(-D,-D/2),2*D,D).polygon,trapezium:new O(new d(-D,dt),new d(D,dt),new d(D/2,-dt),new d(-D/2,-dt)),rhombus:new O(new d(-D*3/4,dt),new d(D/4,dt),new d(D*3/4,-dt),new d(-D/4,-dt)),"right-triangle":new O(new d(-D/2,-D/2),new d(D/2,-D/2),new d(-D/2,D/2)),"rhombus-2":new O(new d(D/2-dt,D/4),new d(-dt-D/2,D/4),new d(dt-D/2,-D/4),new d(dt+D/2,-D/4)),chevron:new O(new d(-.75*D,2*dt),new d(.25*D,2*dt),new d(.75*D,0),new d(.25*D,-2*dt),new d(-.75*D,-2*dt),new d(-.25*D,0)),"right-triangle-2":new O(new d(-2*dt,-D/2),new d(-2*dt,D/2),new d(2*dt,-D/2)),kite:new O(new d(0,-D),new d(2*dt,-D/2),new d(0,D),new d(-2*dt,-D/2)),dart:new O(new d(2*dt,.75*D),new d(0,-.75*D),new d(-2*dt,.75*D),new d(0,.25*D))},Ic=["","","",g.yellow,g.blue,g.green,g.red,g.teal,g.purple,"",g.lime,"",g.orange],ag={trapezium:g.red,"right-triangle":g.green,"rhombus-2":g.orange,chevron:g.orange,kite:g.purple,dart:g.teal},hg={"equ-triangle":g.green,square:g.yellow,"reg-pentagon":g.blue,"reg-hexagon":"#ffd615","reg-decagon":g.red,rectangle:g.yellow,trapezium:"#cc1030",rhombus:g.blue,"rhombus-2":"#e6e2c6",chevron:"#cc1030","right-triangle-2":"#ffd615",kite:"#134791",dart:g.purple};function wr(e){return Ic[e%Ic.length]||g.yellow}function kn(e){if(e in og)return og[e];if(e.match(/^[0-9.,\-\s]+$/)){let t=e.split(",").map(i=>new d(...i.split(" ").map(s=>+s)));return new O(...t)}throw new Error("Unknown polygon type.")}var b$=["trapezium","rhombus","rhombus-2","rectangle","right-triangle","right-triangle-2"],$$=["equ-triangle","square","reg-pentagon","reg-hexagon","reg-heptagon","reg-octagon","reg-decagon","reg-dodecagon","rectangle","trapezium","kite","dart"],j=class extends V{constructor(t,i,s){super(i,s);this.type="polygon";this.options=t,this.path=kn(t),this.snapAngles=fe(this.path.edges.map(Lc)),this.symmetric=$$.includes(t);let n=i.options.altColors?hg:ag;this.colour=n[t]||wr(this.path.points.length);let r=A.aroundPoints(this.path.points),o=new d(r.center.x,r.p.y);this.showSelectionOutline=d.distance(o,this.path.project(o))>5;let a={class:"polygon-tile",path:this.path,fill:this.colour};this.$path=u("path",a,this.$el),this.$outline=u("path",{class:"outline",path:this.path},this.$el)}static makeThumbnail(t,i,s,n){let r=b$.includes(t)?30:40,o=kn(t),a=Math.max(...o.points.map(c=>c.length));o=o.scale(36/a).shift(40,r);let h=u("svg",{width:80,height:2*r},i),l=u("path",{class:"polygon-tile",path:o},h);s.options.watch(c=>{let p=c.altColors?hg:ag,m=n||p[t]||Ic[o.points.length];l.setAttr("fill",m)})}setColour(t){super.setColour(t),this.$path.setAttr("fill",_(this.colour))}flip(t){t&&(this.posn=new d(2*t.x-this.posn.x,this.posn.y)),this.rot=-this.rot,this.flipped=!this.flipped,this.symmetric||(this.path=this.path.reflect(Oc),this.$path.draw(this.path),this.$outline.draw(this.path)),this.transform()}static action(t,i,s){if(t==="flip"){for(let n of i)n.flip(s);i[0].$parent.selection.update(),i[0].$parent.change({changed:i})}else if(t==="join"){let n=i.map(h=>h.transformed),r=O.union(...n),o=i[0].colour,a=r.map(h=>new j(ut(h.points),i[0].$parent));for(let h of a)h.transform(),h.setColour(o);for(let h of i)h.delete();i[0].$parent.selection.select(a,!0),i[0].$parent.change({added:a,deleted:i})}else if(t==="fold"){let n=Hs.fold(i);n&&i[0].$parent.change({added:[n],deleted:i})}}};var lg=e=>50*Math.log(e)/Math.log(2),Rc=class extends j{constructor(t,i,s){super(ut(new A(new d(-25,-20),50,lg(+t)).points),i,s);this.type="log-bar";this.fill=g.blue;this.options=t;let n=Ao(bi(+t).map(r=>lg(r)));n.pop();for(let r of n)u("line",{x1:-25,x2:25,y1:r-20,y2:r-20,class:"polygon-tile",opacity:.3},this.$el);this.$el.append(this.$outline),u("text",{text:t,class:"polygon-label",y:6},this.$el)}static makeThumbnail(t,i){i.setAttr("width",21),i.setAttr("fill",g.blue);let s=u("text",{class:"polygon-label",x:+i.attr("x")+10.5,y:+i.attr("y")+16},i.parent);i.onAttr("data-options",n=>{i.setAttr("height",Math.min(21*Math.log(+n)/Math.log(2),100)),s.text=n,s.css("font-size",+n<99?"":"11px")})}};var M$=[[0,0]],cg=[[0,-39],[0,39]],S$=[...cg,[0,0]],ya=[[-18,-39],[18,-39],[-18,39],[18,39]],P$=[...ya,[0,0]],ug=[...ya,[-18,0],[18,0]],C$=[...ug,[0,-19]],_c=[...ya,[-18,-13],[18,-13],[-18,13],[18,13]],T$=[..._c,[0,0]],E$=[..._c,[0,-26],[0,26]],A$={C:"#333",S:"#333",H:g.orange,D:g.orange},V$={A:M$,2:cg,3:S$,4:ya,5:P$,6:ug,7:C$,8:_c,9:T$,10:E$},k$="AH:2H:3H:4H:5H:6H:7H:8H:9H:0H:JH:QH:KH:AC:2C:3C:4C:5C:6C:7C:8C:9C:0C:JC:QC:KC:KD:QD:JD:0D:9D:8D:7D:6D:5D:4D:3D:2D:AD:KS:QS:JS:0S:9S:8S:7S:6S:5S:4S:3S:2S:AS".split(":").map(e=>e+"f").join(":"),L$={A:1,J:11,Q:12,K:13,0:10};function dg(e,t){e.removeChildren();let[i,s,n]=t.split("");if(t==="deck"||n)return u("rect",{x:-39,y:-57,width:78,height:114,rx:2,fill:"url(#card-bg)"},e);i==="0"&&(i="10"),e.setAttr("fill",A$[s]);let r=`#suit-${s.toLowerCase()}`;if(s==="J")u("image",{href:"/polypad/assets/cards/joker.svg",style:"transform: translate(-35px, -53px)",width:70},e),i="Joker";else if(["K","Q","J"].includes(i))u("use",{href:r,style:"transform: translate(-35px, -36px) scale(0.6)",width:24,height:24},e),u("use",{href:r,style:"transform: rotate(180deg) translate(-35px, -36px) scale(0.6)",width:24,height:24},e),u("image",{href:`/polypad/assets/cards/${t.toLowerCase()}.svg`,style:"transform: translate(-35px, -53px)",width:70},e);else{let a=i==="A"?" scale(1.7)":"";for(let h of V$[i]||[]){let l=h[1]>0?" rotate(180deg)":"";u("use",{href:r,style:`transform: translate(${h[0]}px, ${h[1]}px)`+l+a,width:24,height:24},e)}}let o={text:i,x:-40,y:-45,style:"font-size: 16px; letter-spacing: -1px;"};u("text",o,e),u("text",We(We({},o),{style:"transform: rotate(180deg)"}),e)}var On=class extends V{constructor(t,i,s){super(i,s);this.type="card";this.count=0;this.$label=u("g",{class:"outline card-label"},this.$el),this.$labelRect=u("rect",{width:30,height:35,rx:5},this.$label),this.$labelText=u("text",{x:6,y:30},this.$label),this.$stack=u("rect",{class:"polygon-tile",fill:"url(#card-gradient)",rx:10},this.$el),this.$path=u("rect",{class:"polygon-tile",fill:"#eee",rx:10},this.$el),this.$body=u("g",{transform:"scale(1.4)"},this.$el),this.$outline=u("rect",{class:"outline",rx:10},this.$el),this.$path.setRect(new A(new d(-125/2,-175/2),125,175)),this.setOptions(t==="deck"?k$:t)}setOptions(t){if(t===this.options)return;this.options=t;let i=t.split(":");this.count=i.length,this.value=U(i.map(r=>+(L$[r[0]]||r[0])));let s=Math.sqrt(this.count-1)*3;this.path=new A(new d(-125/2,-175/2),125,175+s);for(let r of[this.$stack,this.$outline])r.setRect(this.path);this.transform(),this.$label.setAttr("hidden",this.count<=1?!0:void 0),this.$label.setTransform({x:-125/2,y:175/2-15+s}),this.$labelRect.setAttr("width",46+this.count.toFixed().length*8),this.$labelText.text=`${this.count} cards`;let n=G(i);n!==this.top&&dg(this.$body,n),this.top=n}setColour(t){super.setColour(t||g.blue)}addCards(t){this.setOptions(this.options+":"+t)}highlight(t=!0){this.$el.setClass("active",t)}move(t){super.move(t),!(this.$parent.selection.tiles.size>1)&&this.setCollision(this.findNearby("card",75))}collide(t){t.highlight(!1),t.addCards(this.options),this.delete();let i=this.lastSavedData?[this]:void 0;this.$parent.change({changed:[t],deleted:i})}doubleClick(){let t=this.draw();t&&this.$parent.change({added:[t],changed:[this]})}flip(){this.$parent.playSound("click");let t=this.options.split(":").reverse();this.setOptions(t.map(i=>i.length>2?i.slice(0,2):i+"f").join(":"))}draw(){if(this.count<=1)return;this.$parent.playSound("draw"),this.$parent.selection.clear();let t=this.options.split(":"),i=t.pop();this.setOptions(t.join(":"));let s=new On(i,this.$parent);return s.rot=this.rot,s.animateTo(this.posn.shift(150,0),this.posn),s}shuffle(){this.count<=1||(this.$parent.playSound("shuffle"),this.setOptions(Zt.shuffle(this.options.split(":")).join(":")))}static action(t,i){return E(this,null,function*(){if(t==="stack"){let s=Array.from(i),n=s.map(o=>o.options).join(":"),r=new On(n,s[0].$parent);r.setTransform(d.average(...s.map(o=>o.posn)));for(let o of i)o.delete();return s[0].$parent.selection.add(r),i[0].$parent.change({added:[r],deleted:i})}else if(t==="flip")for(let s of i)s.flip();else if(t==="draw"){let s=i.map(n=>n.draw()).filter(n=>n);return i[0].$parent.change({added:s,changed:i})}else if(t==="shuffle")for(let s of i)s.shuffle();i[0].$parent.change({changed:i})})}static makeThumbnail(t,i){let s=u("svg",{width:60,height:74},i);u("rect",{x:5,y:2,width:50,height:70,fill:"white",rx:4},s);let n=u("g",{style:"transform: translate(30px, 37px) scale(0.55)"},s);i.onAttr("data-options",r=>dg(n,r))}};var O$=[[0,-.2],[1.2,-1],[.6,1],[-.6,1],[-1.2,-.2]],pg=O$.map(e=>new d(e[0]*50,e[1]*50)),Nc=class extends j{constructor(t,i,s){super(t||ut(pg),i,s);this.type="custom-polygon";this.$handles=[];this.showSelectionOutline=!0;for(let[r,o]of this.path.points.entries())this.makeVertex(o,r);this.updatePath();let n;this.$parent.events.listen(this.$outline,{down:({posn:r})=>{r=this.relativePosn(r);let o=this.path.edges.findIndex(a=>r.distanceFromLine(a)<5);n=this.makeVertex(r,(o+1)%this.$handles.length),this.updatePath()},move:({posn:r})=>{n&&this.moveVertex(n,r)},end:()=>{n&&this.$parent.change({changed:[this]})}}),this.$outline.css("cursor","crosshair")}makeVertex(t,i){if(this.$handles.length>=24)return;let s=this.makeHandle("c",(n,r)=>this.moveVertex(s,r),()=>this.deleteVertex(s));return s.setCenter(t),s.setAttr("r",8),s.css("cursor","move"),this.$handles.splice(i,0,s),s}deleteVertex(t){t.remove(),this.$handles.splice(this.$handles.indexOf(t),1),this.updatePath()}moveVertex(t,i){var n;let s=(n=this.$parent.snap([i]))==null?void 0:n.shift;t.setCenter(this.relativePosn(s?i.add(s):i)),this.updatePath()}updatePath(){let t=this.$handles.map(i=>i.center);this.path=new O(...t),this.$path.draw(this.path),this.$outline.draw(this.path),this.transform(),this.snapAngles=fe(this.path.edges.map(Lc)),this.options=ut(t),this.$parent.selection.update()}flip(t){t&&(this.posn=new d(2*t.x-this.posn.x,this.posn.y)),this.rot=-this.rot,this.transform();for(let i of this.$handles)i.setCenter(i.center.reflect(Oc));this.updatePath()}lock(){let t=new j(this.options,this.$parent);return t.setColour(this.colour),t.setTransform(this.posn,this.rot),this.$parent.selection.add(t),this.delete(),t}static makeThumbnail(t,i){let s=new O(...pg).scale(.5).shift(40),n=u("svg",{width:80,height:80},i);u("path",{class:"polygon-tile",path:s,fill:g.green},n);for(let r of s.points)u("circle",{cx:r.x,cy:r.y,r:3,fill:"white"},n)}static action(t,i){if(t==="lock"){let s=[];for(let n of Array.from(i))s.push(n.lock());i[0].$parent.change({added:s,deleted:i})}}};var Dc=25/2,fg=[[[0,2],[0,-4],[-2,-4],[-2,4],[2,4],[2,2],[0,2]],[[0,0],[0,-4],[-2,-4],[-2,2],[0,2],[0,4],[2,4],[2,0],[0,0]],[[-5,-1],[5,-1],[5,1],[-5,1]],[[-3,-2],[-3,2],[1,2],[1,0],[3,0],[3,-2],[-3,-2]],[[3,-2],[3,0],[1,0],[1,-2],[-1,-2],[-1,2],[5,2],[5,-2],[3,-2]],[[-1,-3],[-1,-1],[-3,-1],[-3,3],[-1,3],[-1,1],[1,1],[1,-1],[3,-1],[3,-3],[-1,-3]],[[1,1],[1,-3],[-1,-3],[-1,1],[-3,1],[-3,3],[3,3],[3,1],[1,1]],[[1,-1],[1,-3],[-1,-3],[-1,-1],[-3,-1],[-3,1],[-1,1],[-1,3],[1,3],[1,1],[3,1],[3,-1],[1,-1]],[[-1,-3],[-1,-1],[-3,-1],[-3,1],[-1,1],[-1,3],[1,3],[1,-1],[3,-1],[3,-3],[-1,-3]],[[-4,-2],[-4,0],[-2,0],[-2,2],[0,2],[0,0],[4,0],[4,-2],[-4,-2]],[[-1,-3],[-1,1],[-3,1],[-3,3],[1,3],[1,-1],[3,-1],[3,-3],[-1,-3]],[[-1,-3],[-1,1],[-5,1],[-5,3],[1,3],[1,-3],[-1,-3]],[[-1,2],[1,2],[1,0],[3,0],[3,-2],[-3,-2],[-3,0],[-1,0]],[[-3,2],[-3,0],[-1,0],[-1,-2],[3,-2],[3,0],[1,0],[1,2]],[[-3,2],[-3,-2],[3,-2],[3,0],[-1,0],[-1,2]],[[-2,2],[2,2],[2,-2],[-2,-2]],[[-4,1],[4,1],[4,-1],[-4,-1]]].map(e=>e.map(t=>new d(t[0]*Dc,t[1]*Dc))),I$=[[2,4],[4,4],[5,9],[7,2],[7,6],[11,3],[13,7],[15,3],[17,7],[20,2],[21,5],[23,7],[3,2],[7,2],[5,6],[10,4],[8,7]],mg=[...q.rainbow(12).map(e=>e.hex),g.red,g.blue,g.green,g.yellow,g.purple],Gc=class extends j{constructor(t,i,s){super(ut(fg[+t]),i,s);this.type="pentomino";this.options=t,this.setColour(mg[+t])}static makeThumbnail(t,i){let s=I$[+t],n=new O(...fg[+t]).scale(10/Dc);i.draw(n.shift(10*s[0],10*s[1]).shift(1,1)),i.setAttr("fill",mg[+t])}};var gg=[[[-4,-2],[0,2],[4,-2]],[[-4,-2],[0,2],[4,-2]],[[-2,0],[0,-2],[2,0],[0,2]],[[-3,1],[1,1],[3,-1],[-1,-1]],[[0,-1],[2,1],[-2,1]],[[0,-1],[2,1],[-2,1]],[[-2,-2],[2,-2],[2,2]]],vg=[g.red,g.blue,g.green,g.yellow,g.orange,g.teal,g.purple],R$=[[2,4],[4,2],[6,4],[3,7],[7,2],[4,5],[6,6]],wg=[-90,0,0,0,-90,0,90],_$=25,qc=class extends j{constructor(t,i,s){super(ut(gg[+t].map(n=>new d(...n).scale(_$))),i,s);this.type="tangram";this.snapAngles=[0,45,90,135];this.options=t,this.setColour(vg[+t]),this.rot=wg[+t],this.transform()}static makeThumbnail(t,i,s,n){let r=R$[+t],o=gg[+t].map(h=>new d(...h).rotate(wg[+t]*lt).shift(...r).scale(18).shift(2,2)),a=new O(...o);i.draw(a),i.setAttr("fill",n||vg[+t])}getSnapLines(){return this.path.edges}};var yg=25,xr=(1+Math.sqrt(5))/2*yg,xa=Math.sqrt((5+Math.sqrt(5))/2)*yg,br=xr*(Math.sqrt(5)-1)/2,xg=[`0 ${-xr},${xa} ${-br},0 ${xr},${-xa} ${-br}`,`0 ${2*br-xr},${xa} ${br},0 ${-xr},${-xa} ${br}`],bg=[["M29.4-30.9C25.3-18.2,13.4-9.5,0-9.5c-13.4,0-25.3-8.6-29.4-21.4","M29.4,0C20.8-6.2,10.6-9.5,0-9.5c-10.6,0-20.8,3.3-29.4,9.5"],["M18.2,15.5C20.1,9.6,19,3.3,15.5-1.7C11.9-6.6,6.1-9.5,0-9.5c-6.1,0-11.9,2.9-15.5,7.9c-3.6,4.9-4.6,11.3-2.7,17.1","M18.2-15.5C12.9-11.6,6.5-9.5,0-9.5c-6.5,0-12.9-2.1-18.2-5.9"]],$g=[g.red,g.blue],Bc=class extends j{constructor(t,i,s){super(xg[+t],i,s);this.type="penrose";this.setColour($g[+t]),this.options=t;let n=u("g",{class:"penrose-circles"});this.$path.insertAfter(n);for(let r of bg[+t])u("path",{d:r},n)}static makeThumbnail(t,i,s,n){let r=+t,o=u("svg",{width:80,height:80,viewBox:"-50 -50 100 100"},i),a=n||$g[r];u("polygon",{points:xg[r],class:"polygon-tile",fill:a},o);let h=u("g",{class:"penrose-circles"},o);for(let l of bg[r])u("path",{d:l},h)}};var Mg=["M13.9-13.9,2.8-25H-2.8L-25-2.8V2.8L-2.8,25H2.8L13.9,13.9C21.6,6.6,21.6-6.6,13.9-13.9Zm-2.8,25L0,22.2-22.2,0,0-22.2,11.1-11.1A15.8,15.8,0,0,1,11.1,11.1Z","M25-2.8,13.9-13.9c-7.3-7.7-20.5-7.7-27.8,0L-25-2.8V2.8l11.1,11.1c7.3,7.7,20.5,7.7,27.8,0L25,2.8ZM11.1,11.1a15.8,15.8,0,0,1-22.2,0L-22.2,0l11.1-11.1a15.8,15.8,0,0,1,22.2,0L22.2,0Z","M-25-2.8V2.8l11.1,11.1c7.3,7.6,20.5,7.6,27.8,0s7.6-20.5,0-27.8L2.8-25H-2.8ZM15.7,0a15.9,15.9,0,0,1-4.6,11.1,15.8,15.8,0,0,1-22.2,0L-22.2,0,0-22.2,11.1-11.1A15.9,15.9,0,0,1,15.7,0Z","M-25-2.8V2.8L-2.8,25H2.8L25,2.8V-2.8L2.8-25H-2.8Zm25,25L-22.2,0,0-22.2,22.2,0Z","M0-19.7a19.5,19.5,0,0,0-13.9,5.8c-7.6,7.3-7.6,20.5,0,27.8s20.5,7.6,27.8,0C26.3,1.6,17.5-19.7,0-19.7ZM11.1,11.1c-5.8,6.1-16.3,6.1-22.2,0a15.8,15.8,0,0,1,0-22.2,15.8,15.8,0,0,1,22.2,0A15.8,15.8,0,0,1,11.1,11.1Z","M0-19.7a19.5,19.5,0,0,0-13.9,5.8L-25-2.8V2.8l11.1,11.1c7.3,7.6,20.5,7.6,27.8,0C26.3,1.6,17.5-19.7,0-19.7ZM11.1,11.1a15.8,15.8,0,0,1-22.2,0L-22.2,0l11.1-11.1c5.9-6.1,16.4-6.1,22.2,0A15.8,15.8,0,0,1,11.1,11.1Z"],Hc=class extends j{constructor(t,i,s){super("square",i,s);this.type="kolam";this.setColour(g.orange),this.options=t,u("path",{d:Mg[+t],fill:"white"},this.$el),u("circle",{r:3,fill:"white"},this.$el),this.$el.append(this.$outline),this.$path.css("stroke-width",".5px")}static makeThumbnail(t,i){let s=u("svg",{width:60,height:60},i);u("rect",{class:"polygon-tile",fill:g.orange,x:5,y:5,width:50,height:50},s),u("path",{d:Mg[+t],fill:"white",transform:"translate(30 30)"},s),u("circle",{r:3,cx:30,cy:30,fill:"white"},s)}};var In=["M-32.3,6.5,0,84.3H0L32.3,6.5A80.4,80.4,0,0,0,0,0,86.6,86.6,0,0,0-32.3,6.5Z","M-32.3,6.5,0,84.3H0L32.3,6.5A80.4,80.4,0,0,0,0,0,86.6,86.6,0,0,0-32.3,6.5Z","M-42.1,0A288.5,288.5,0,0,0-20.2,110.2a287.6,287.6,0,0,0,62.3,93.3V0Z","M-42.1,0V203.5a289.5,289.5,0,0,0,62.4-93.3A286.5,286.5,0,0,0,42.1,0Z","M0 0L-101.7 101.7L101.7 101.7Z","M0 0L-101.7 101.7L101.7 101.7Z","M0 0L-59.6 59.6L59.6 59.6Z","M42.1.1H-42.2l-59.5,59.6A143.4,143.4,0,0,0,0,101.8,143,143,0,0,0,101.7,59.7Z","M42.1.1H-42.2l-59.5,59.6A143.4,143.4,0,0,0,0,101.8,143,143,0,0,0,101.7,59.7Z"],Sg=[[66,-17.5,-22.5],[82,-17.5,22.5],[23,-36.5,45],[125,-36.5,-45],[56,47.3,135],[92,47.3,-135],[74,101,180],[41,98,45],[107,98,-45]],N$={0:1,1:1,2:3,3:2,7:8,8:7},Pg=[g.lime,g.teal,g.blue,g.red,g.yellow,g.green,g.grey,g.orange,g.purple],zc=class extends j{constructor(t,i,s){super(ut(As(In[+t])),i,s);this.type="egg";this.snapAngles=[0,45,90,135];this.options=t,this.$path.setAttr("d",In[+t]),this.$outline.setAttr("d",In[+t]),this.setColour(Pg[+t]),this.rot=Sg[+t][2],this.transform(),+t<=1&&this.snapAngles.push(22.5,67.5,112.5,157.5)}flip(t){super.flip(t);let i=this.flipped?N$[this.options]||this.options:this.options;this.$path.setAttr("d",In[+i]),this.$outline.setAttr("d",In[+i])}static makeThumbnail(t,i){i.setAttr("d",In[+t]);let s=Sg[+t];i.css("transform",`translate(${s[0]}px, ${s[1]}px) rotate(${s[2]}deg) scale(0.5)`),i.setAttr("fill",Pg[+t]),i.css("stroke-width","2px")}};var Fc=1/Math.sqrt(3),D$=50/Fc,Cg=[g.blue,g.purple,g.red,g.orange,g.yellow],Rn=O.regular(6,D$).rotate(Math.PI/6).points;Rn.splice(3,1);Rn.splice(2,0,new d(2*Rn[1].x,Rn[0].y));var Uc=class extends j{constructor(t,i,s){super(ut(Rn.map(n=>n.scale(Fc**+t))),i,s);this.type="fractal";this.setColour(Cg[+t]),this.options=t}static makeThumbnail(t,i){let s=new O(...Rn).scale(.6*Fc**+t),n=A.aroundPoints(s.points),r=u("svg",{width:20+n.w,height:20+n.h},i);s=s.shift(10-n.center.x+n.w/2,10-n.center.y+n.h/2),u("path",{class:"polygon-tile",path:s,fill:Cg[+t]},r)}};var ba=["M-25,34.4a81.3,81.3,0,0,1,50,0h0A81.1,81.1,0,0,0,40.4-13.1h.1A81.5,81.5,0,0,1,0-42.5H0A81.5,81.5,0,0,1-40.5-13.2h.1A81.1,81.1,0,0,0-25,34.4Z","M-15.4-21.3A80.5,80.5,0,0,1,0-68.8,80.5,80.5,0,0,1,15.4-21.3a80.6,80.6,0,0,1,50,0A80.3,80.3,0,0,1,25,8.1,80.4,80.4,0,0,1,40.4,55.7,80.2,80.2,0,0,1,0,26.3,80.2,80.2,0,0,1-40.4,55.7,80.4,80.4,0,0,1-25,8.1,80.3,80.3,0,0,1-65.4-21.3,80.6,80.6,0,0,1-15.4-21.3Z","M65.4-21.3A80.5,80.5,0,0,1,0,12.1,80.5,80.5,0,0,1-65.4-21.3a80.6,80.6,0,0,1,50,0A80.5,80.5,0,0,1,0-68.8,80.5,80.5,0,0,1,15.4-21.3,80.6,80.6,0,0,1,65.4-21.3Z","M80.9-47.5h0A81.5,81.5,0,0,1,40.4-76.9,80.4,80.4,0,0,0,0-47.5,80.2,80.2,0,0,0-40.5-76.9h0A80.8,80.8,0,0,1-80.9-47.6h0A80.3,80.3,0,0,1-65.5,0,80.3,80.3,0,0,1-80.9,47.5h0A80.8,80.8,0,0,1-40.5,76.9h0A80.2,80.2,0,0,0,0,47.5,80.4,80.4,0,0,0,40.4,76.9,81.5,81.5,0,0,1,80.9,47.6h0A80.3,80.3,0,0,1,65.5,0,80.3,80.3,0,0,1,80.9-47.5Z","M0-47.5A80.3,80.3,0,0,1,15.5,0,80.3,80.3,0,0,1,0,47.5,80.3,80.3,0,0,1-15.5,0,80.3,80.3,0,0,1,0-47.5Z","M130.9,153.8a80.5,80.5,0,0,1,15.4-47.5,80.2,80.2,0,0,1-40.4-29.4A80.1,80.1,0,0,1,90.5,29.4a80.6,80.6,0,0,1-50,0A80.6,80.6,0,0,1,0,0,80.3,80.3,0,0,1-40.4,29.4a80.9,80.9,0,0,1-50.1,0,80.8,80.8,0,0,1-15.4,47.5,80.9,80.9,0,0,1-40.5,29.4,79.9,79.9,0,0,1,15.5,47.5,81.3,81.3,0,0,1,50,0A80.9,80.9,0,0,1,0,72.9a80.9,80.9,0,0,1,80.9,80.9A81.3,81.3,0,0,1,130.9,153.8Z","M40.4-13.2A80.4,80.4,0,0,0,0-42.5,80.7,80.7,0,0,0-40.4-13.1,80.9,80.9,0,0,0-25,34.4a80.6,80.6,0,0,0,50,0A81.2,81.2,0,0,0,40.4-13.2Z","M40.4-13.1A82,82,0,0,1,0-42.5,81.1,81.1,0,0,1-40.5-13.2,81.3,81.3,0,0,1-25,34.4a81.3,81.3,0,0,1,50,0A81.6,81.6,0,0,1,40.4-13.1Z"],Tg=["M16.2-.3a5.5,5.5,0,0,1-4.4,6.4A5.3,5.3,0,0,1,5.5,1.8,5.4,5.4,0,0,1,9.8-4.6,5.5,5.5,0,0,1,16.2-.3Zm8-8A3.8,3.8,0,0,0,28-4.5a3.7,3.7,0,0,0,3.7-3.8A3.6,3.6,0,0,0,28-12,3.7,3.7,0,0,0,24.2-8.3ZM19,23.4a4.9,4.9,0,0,0,4.8-4.8A4.8,4.8,0,0,0,19,13.9a4.7,4.7,0,0,0-4.7,4.7A4.8,4.8,0,0,0,19,23.4ZM-11.7,6.1A5.3,5.3,0,0,0-5.4,1.8,5.4,5.4,0,0,0-9.7-4.6,5.5,5.5,0,0,0-16.1-.3,5.5,5.5,0,0,0-11.7,6.1ZM-27.9-4.5a3.8,3.8,0,0,0,3.8-3.8A3.7,3.7,0,0,0-27.9-12a3.6,3.6,0,0,0-3.7,3.7A3.7,3.7,0,0,0-27.9-4.5ZM20.9-22A139.9,139.9,0,0,1,3-19.5a1.1,1.1,0,0,1-.1.5L1-15.2V30H-1V-15.2L-2.9-19a1.1,1.1,0,0,1-.1-.5,127,127,0,0,1-17.8-2.6A80.8,80.8,0,0,0,0-41.7,83.3,83.3,0,0,0,20.9-22ZM-3.8-26.7A3.2,3.2,0,0,0-7-30a3.3,3.3,0,0,0-3.3,3.3A3.2,3.2,0,0,0-7-23.5,3.2,3.2,0,0,0-3.8-26.7ZM6.5-30a3.2,3.2,0,0,0-3.2,3.3,3.2,3.2,0,0,0,3.2,3.2,3.2,3.2,0,0,0,3.3-3.2A3.3,3.3,0,0,0,6.5-30ZM-23.7,18.6a4.9,4.9,0,0,0,4.8,4.8,4.8,4.8,0,0,0,4.7-4.8,4.7,4.7,0,0,0-4.7-4.7A4.8,4.8,0,0,0-23.7,18.6Z","M-16.9-4.7l-17.7-6.1a.8.8,0,0,1-.5-.9.8.8,0,0,1,.9-.5L-16.5-6a.7.7,0,0,1,.5.9.7.7,0,0,1-.7.4ZM-24.6-13l9.7,5.4h.3a.9.9,0,0,0,.7-.3.9.9,0,0,0-.3-1l-9.7-5.4a.8.8,0,0,0-1,.2A.8.8,0,0,0-24.6-13ZM-7.8-4.9l5.9,1.2h.5c.2-.1.3-.2.3-.4l.3-1.4a.6.6,0,0,0-.5-.8L-7.2-7.7h-.6l-.3.4-.3,1.4A.8.8,0,0,0-7.8-4.9ZM2.8-2.5a.9.9,0,0,0,.7.6h.2l1.6-.3a1,1,0,0,0,.5-.4.7.7,0,0,0,.1-.5l-1.4-6a.8.8,0,0,0-.9-.6L2-9.4l-.5.3a1.3,1.3,0,0,0-.1.6ZM10.9.4a.7.7,0,0,0-.1-.5L10-1.3a.8.8,0,0,0-1-.2L4,1.9c-.2.1-.3.2-.3.4a.7.7,0,0,0,.1.5L4.6,4a.6.6,0,0,0,.6.3h.4l5-3.4ZM-4.5-1l-1.4-.3a.4.4,0,0,0-.5.1c-.2.1-.3.2-.3.4L-8.2,5.1a.7.7,0,0,0,.5.8l1.4.4h.5a.5.5,0,0,0,.3-.5L-4-.1A.7.7,0,0,0-4.5-1Zm-12.1-.6a.7.7,0,0,0,.7-.6c.1-.4-.2-.7-.6-.8l-11-1.7a.8.8,0,0,0-.8.6c0,.4.2.8.6.8l11,1.7Zm16.1,6H-1c-.2,0-.3.1-.5.3l-.8,1.1a.8.8,0,0,0,.1,1l4.9,3.6.4.2h.1l.4-.3.9-1.1c.2-.4.2-.8-.1-1Zm-9.4,8.8a.7.7,0,0,0-1,.1L-22.2,28.2a.7.7,0,0,0,.1,1l.4.2a.9.9,0,0,0,.6-.3l11.3-15A.6.6,0,0,0-9.9,13.2Zm-11.2,5.6c.2.2.3.3.5.3l.5-.2,8.2-7.6a.7.7,0,0,0,0-1,.8.8,0,0,0-1,0L-21,17.8A.7.7,0,0,0-21.1,18.8Zm14-4.9a.8.8,0,0,0-1,.4L-13,24.2a.6.6,0,0,0,.3.9h.3a.6.6,0,0,0,.6-.4l5-9.9A.8.8,0,0,0-7.1,13.9Zm17.4-.7a.8.8,0,0,0-1-.2.8.8,0,0,0-.2,1L19.9,29.4a.5.5,0,0,0,.5.3h.4a.7.7,0,0,0,.2-1ZM7,14.4A.7.7,0,0,0,6,14a.7.7,0,0,0-.3.9L10.3,25a.8.8,0,0,0,.7.4h.3a.8.8,0,0,0,.3-1Zm4-2.8,7.8,7.8.5.2.5-.2a.7.7,0,0,0,0-1L12,10.6a.7.7,0,0,0-1,1ZM34.4-11.2a.7.7,0,0,0-.8-.5l-18,5.5a.7.7,0,0,0-.4.9.6.6,0,0,0,.6.5c.1,0,.2,0,.2-.1l18-5.4A.7.7,0,0,0,34.4-11.2ZM26.7-4l-11,1.3a.6.6,0,0,0-.6.8.7.7,0,0,0,.7.6h.1l11-1.3c.4,0,.6-.4.6-.8S27.1-4,26.7-4ZM14-7.3h.3l9.8-5.1a.7.7,0,0,0,.3-1,.7.7,0,0,0-.9-.3L13.6-8.6a.8.8,0,0,0-.3,1A.8.8,0,0,0,14-7.3ZM-.5-16.6h0a.7.7,0,0,0,.7-.6L.6-36a.7.7,0,0,0-.7-.7.7.7,0,0,0-.7.7l-.4,18.7A.7.7,0,0,0-.5-16.6Zm3.2,1.2h.2a.7.7,0,0,0,.7-.6L5.7-26.9a.7.7,0,0,0-.5-.8.8.8,0,0,0-.9.6L2.2-16.3A.7.7,0,0,0,2.7-15.4Zm-6.1-.1h.1c.4-.1.7-.5.6-.8l-1.8-11c0-.4-.4-.6-.8-.6a.8.8,0,0,0-.6.8l1.8,11A.9.9,0,0,0-3.4-15.5Z","M60.8-16.2l-3.6-2.5,1.4-3.9-.9-.3-1.3,3.5h0l-9.5,3,2.8-7.8h-1l-3,8.3-9.5,3.1,4.4-11.8H39.5L35-12.5,25.5-9.4l5-14.7H29.4L24.3-9.1l-9.1,3,6-16.3-1.2.3L14-5.7l-1.8.5a50.6,50.6,0,0,0,5.3-16.2l-1.9.6-.4.2L1-9.8v-10L14.4-30.3c0-.4-.1-.8-.1-1.2L1-21.1v-10l11.7-9.1-.3-1.1L1-32.4v-10l8.9-6.9a3,3,0,0,0-.4-1L1-43.7v-10l5.2-4a4.1,4.1,0,0,0-.5-.9l-5.2,4h-1l-5.2-4a4.1,4.1,0,0,0-.5.9l5.2,4v10l-8.5-6.6a3,3,0,0,0-.4,1L-1-42.4v10l-11.4-8.9-.3,1.1L-1-31.1v10L-14.3-31.5c0,.4-.1.8-.1,1.2L-1-19.8v10L-15.2-20.6l-.4-.2-1.9-.6A50.6,50.6,0,0,0-12.2-5.2L-14-5.7l-6-16.4-1.2-.3,6,16.3-9.1-3L-29.4-24h-1.1l5,14.7L-35-12.5l-4.5-12.2h-1.1l4.4,11.8L-45.7-16l-3-8.3h-1l2.8,7.8-9.5-3h0l-1.3-3.5-.9.3,1.4,3.9-3.6,2.5.7.7,3.1-2.2v.2l9.4,3-6.8,4.8.7.7,7.3-5.1,9.6,3.1L-47.3-3.8l.9.6,10.8-7.4,9.5,3.1-13,8.9,1,.5,13.2-9,9.6,3-14.4,10,1.2.4,14.3-9.9h.4l3,1C-9.8-1-8.9.5-7.9,1.9L-18.4,9.4l1.3.3,9.8-7a64.2,64.2,0,0,0,6.6,8H.7a64.2,64.2,0,0,0,6.6-8l9.8,7,1.3-.3L7.9,1.9C8.9.5,9.8-1,10.8-2.6l3-1h.4L28.5,6.3l1.2-.4L15.3-4.1l9.6-3,13.2,9,1-.5-13-8.9,9.5-3.1L46.4-3.2l.9-.6L36.8-11l9.6-3.1L53.7-9l.7-.7-6.8-4.8,9.4-3v-.2l3.1,2.2Zm-76-3.2L-1-8.5V.6l-9.7-7.4A45.9,45.9,0,0,1-15.2-19.4ZM0,8.5A66.6,66.6,0,0,1-9.6-4.7L-1,1.8V6.3a1,1,0,0,0,1,1,1,1,0,0,0,1-1V1.8L9.6-4.7A71,71,0,0,1,0,8.5ZM10.7-6.8,1,.6V-8.5L15.2-19.4A45.9,45.9,0,0,1,10.7-6.8Z","M65-1V1.1A81.6,81.6,0,0,1,40,5c-8.9,0-12.7-.4-20.6-2.9A1,1,0,0,1,18.8.8.9.9,0,0,1,20,.2C27.7,2.7,31.2,3,40,3A79.7,79.7,0,0,0,64.7-.9ZM-64.6,1.1A82.4,82.4,0,0,0-39.4,5c8.8,0,12.6-.4,20.5-2.9A1.2,1.2,0,0,0-18.2.8,1,1,0,0,0-19.5.2C-27.2,2.7-30.7,3-39.4,3A79.9,79.9,0,0,1-64.2-.9H-65V1ZM-45.8,36a6.7,6.7,0,0,1,6.7-6.7A6.7,6.7,0,0,1-32.4,36a6.7,6.7,0,0,1-6.7,6.7A6.7,6.7,0,0,1-45.8,36Zm2,0a4.7,4.7,0,0,0,4.7,4.7A4.7,4.7,0,0,0-34.4,36a4.7,4.7,0,0,0-4.7-4.7A4.7,4.7,0,0,0-43.8,36Zm10.4-71.4a5.7,5.7,0,0,0-5.7-5.7,5.6,5.6,0,0,0-5.7,5.7,5.7,5.7,0,0,0,5.7,5.7A5.8,5.8,0,0,0-33.4-35.4ZM4.9-37.1a2.2,2.2,0,0,0,2.2,2.2,2.2,2.2,0,0,0,2.2-2.2,2.2,2.2,0,0,0-2.2-2.2A2.2,2.2,0,0,0,4.9-37.1ZM38.7,42.7h0A6.8,6.8,0,0,1,32,36a6.7,6.7,0,1,1,6.7,6.7ZM43.4,36a4.7,4.7,0,1,0-4.7,4.7h0A4.7,4.7,0,0,0,43.4,36ZM0,42.9c4.1.7,8.7-9.6,11.4-17.9A78.6,78.6,0,0,0,15.3.3c0-6.7-1.3-13.7-3.2-21.6-.6-1.6-3.4-4.2-5.8-5.1,2.2-2,1.8-2.9,2.3-3.7s.1-3.3,0-3.8c-4.5,1.1-6.3-2.7-4.3-5.5C9-44,19.3-53.3,29-55.2a6.4,6.4,0,0,0,1,1.3,3.1,3.1,0,0,0,1.8.5,2.9,2.9,0,0,0,2.4-1.2h0a3,3,0,0,0-.6-4.2,2.9,2.9,0,0,0-4.2.7,2.6,2.6,0,0,0-.5.9C19-55.4,8.7-46.5,3.6-41.5A33.5,33.5,0,0,1-.2-42.6l-3.7,1.2c-5-4.9-15.3-13.9-25.4-15.8a2.7,2.7,0,0,0-.5-1.1,3,3,0,0,0-4.2-.6,3,3,0,0,0-.6,4.2h0a3,3,0,0,0,2.4,1.2,3.2,3.2,0,0,0,1.8-.6,3.1,3.1,0,0,0,.9-1.1c10.1,2,20.8,11.8,25.2,16.3,1.3,2.5-.4,5.8-4.2,5-.1.6-.5,3,0,4s.6,1.5,2.3,3.5c-2.4.7-6,4-6.3,5.3-1.6,7-3,15.5-3,21.4a78.8,78.8,0,0,0,4,24.7C-8.8,33.3-3.5,43.8,0,42.9Zm-5.2-80a2.2,2.2,0,0,0-2.2-2.2,2.2,2.2,0,0,0-2.2,2.2,2.2,2.2,0,0,0,2.2,2.2A2.2,2.2,0,0,0-5.2-37.1ZM33-35.4a5.8,5.8,0,0,0,5.7,5.7,5.7,5.7,0,0,0,5.7-5.7,5.6,5.6,0,0,0-5.7-5.7A5.7,5.7,0,0,0,33-35.4Z","M.9,33.4v-9l12.7-9.9.3-1.4L.9,23.2v-10l14-10.9V1L.9,12V2L14.5-8.6c0-.3-.1-.7-.1-1.1L.9.8v-10l11.9-9.3a3.6,3.6,0,0,1-.2-1L.9-10.4v-10l9.2-7.1a4.2,4.2,0,0,0-.4-1L.9-21.6v-9.9h0l5.6-4.3L6-36.8.4-32.4H-.4L-6-36.8l-.5.9L-1-31.6a.1.1,0,0,0-.1.1v9.8l-8.6-6.8a4.2,4.2,0,0,0-.4,1l9,7v10l-11.5-9a3.6,3.6,0,0,1-.2,1L-1.1-9.3V.7L-14.4-9.7c0,.4-.1.8-.1,1.1L-1.1,1.9v10L-14.9,1V2.3L-1.1,13.1v10l-12.8-10,.3,1.4,12.5,9.8v9l-9.6-7.5.6,1.8,9,7v4.1a1,1,0,0,0,1,1,.9.9,0,0,0,1-1v-4l9.2-7.1.6-1.7Z","M0,.8A76.2,76.2,0,0,0,7.8,9.9c-1.6,1.9-5.4,7.6-6.6,21.6h-2C-2,17.1-6,11.4-7.6,9.7A72.7,72.7,0,0,0,0,.8ZM124.3,117.2c-6.5,4.7-6.3,16,.5,25.4a30,30,0,0,0,5.8,6,81.7,81.7,0,0,1,8.3-31.1C133.6,114.7,128.1,114.4,124.3,117.2ZM-82.6,86.3A82.8,82.8,0,0,0-104,75l-1.2,1.7A81,81,0,0,1-83.8,87.9a79.9,79.9,0,0,1,17.6,17.7l.3.5,1.3-1.7A81.3,81.3,0,0,0-82.6,86.3Zm47.3-33.1a80,80,0,0,1-3.9-23.7l-1.1.4-.9.2a83.5,83.5,0,0,0,4,23.7A79.9,79.9,0,0,0-25.8,76.6l2-.6-.3-.4A78.4,78.4,0,0,1-35.3,53.2Zm-81,62.7.6-1.9c-11.9-5.1-16.5-10-18.1-12.4a81.4,81.4,0,0,1-11.8,4.9,85.1,85.1,0,0,1,5.8,9.4C-138.6,115.3-132.2,112.1-116.3,115.9ZM-90,30.1a81.7,81.7,0,0,1-.8,11.1c2,.4,8.7,2.3,18.5,13.8l1.7-1.2c-6.9-11.4-7.6-18.1-7.4-20.9A99.4,99.4,0,0,1-90,30.1ZM38,53.8a85.2,85.2,0,0,0,4.1-23.4l-1.8-.5h-.2a81.5,81.5,0,0,1-4,23.4A81.4,81.4,0,0,1,24.6,75.5l-.4.6,2,.7h0A83,83,0,0,0,38,53.8Zm68.4,24.7-.9-1.3-.3-.4a82,82,0,0,1-17.3,17,82,82,0,0,1-22.5,11.3h-.2l1.2,1.7A85.2,85.2,0,0,0,89.1,95.4,81.6,81.6,0,0,0,106.4,78.5ZM70.8,54.6l1.6,1.2c9.9-11.4,16.5-13.4,18.5-13.7a80.8,80.8,0,0,1-.9-12,97.8,97.8,0,0,1-11.9,2.8C78.4,35.1,78.4,42.1,70.8,54.6ZM126.3,152a28,28,0,0,0-3.9-7.7,26.3,26.3,0,0,0-11.9-9.5c-4.6-1.6-8.8-1.3-12,1s-5.5,8.3-4.3,14.4A82.6,82.6,0,0,1,126.3,152Z","M0,4L5,6.6L4,1.1L8.1,-2.9L2.5,-3.7L0,-8.8L-2.5,-3.7L-8.1,-2.9L-4,1.1L-5,6.6Z","M0,4L5,6.6L4,1.1L8.1,-2.9L2.5,-3.7L0,-8.8L-2.5,-3.7L-8.1,-2.9L-4,1.1L-5,6.6Z"],Eg=[g.red,g.blue,g.green,g.yellow,g.green,g.teal,g.orange,g.purple],G$=["-30 -35 60 60","-35 -42 70 70","-35 -60 70 70","-45 -45 90 90","-15 -30 30 60","-75 28 150 100","-30 -35 60 60","-30 -35 60 60"],Ag=[.7,.6,.3,.6,.3,.6,.7,.7],jc=class extends j{constructor(t,i,s){super(ut(As(ba[+t])),i,s);this.type="garden";this.options=t;let n=+t;this.$path.setAttr("d",ba[n]),this.$outline.setAttr("d",ba[n]);let r=u("path",{d:Tg[n],fill:"black",opacity:Ag[n]});this.$path.insertAfter(r),this.symmetric=!0,this.setColour(Eg[n])}static makeThumbnail(t,i){let s=+t,r=u("svg",{width:s===4?40:s===5?120:80,height:80,viewBox:G$[s]},i),o=u("g",{transform:"scale(0.5)"},r);u("path",{d:ba[s],fill:Eg[s],class:"polygon-tile"},o),u("path",{d:Tg[s],fill:"black",opacity:Ag[s]},o)}};var q$=["M34,0a16,16,0,0,1,6.3-12.7l-9-15.7A34.1,34.1,0,0,0,16,0,34.1,34.1,0,0,0,31.3,28.4l9-15.7A16,16,0,0,1,34,0Z","M-25,9.3a33.7,33.7,0,0,0-15.2,3.6l9,15.7A14.4,14.4,0,0,1-25,27.3a16.1,16.1,0,0,1,15.9,14h18A34,34,0,0,0-25,9.3Z","M-25-9.3a33.7,33.7,0,0,1-15.2-3.6l9-15.7A14.4,14.4,0,0,0-25-27.3a16.1,16.1,0,0,0,15.9-14h18A34,34,0,0,1-25-9.3Z","M-8.9,41.3h18A16.1,16.1,0,0,1,25,27.3a14.4,14.4,0,0,1,6.2,1.3l9-15.7A33.9,33.9,0,0,0-8.9,41.3Z","M-31.3-28.4l-9,15.6A65.9,65.9,0,0,1-9.1,41.3h18A83.7,83.7,0,0,0-31.3-28.4Z","M-8.9,41.3h18A65.9,65.9,0,0,1,40.3-12.8l-9-15.6A83.7,83.7,0,0,0-8.9,41.3Z","M-40.3 12.9L-31.3 28.4L40.3 -12.9L31.3 -28.4Z","M-40.2,12.9l9,15.6A65.7,65.7,0,0,1,0,20.6a65.7,65.7,0,0,1,31.2,7.9l9-15.6A82.6,82.6,0,0,0,0,2.6,82.6,82.6,0,0,0-40.2,12.9Z","M31.3,28.4l9-15.6A65.9,65.9,0,0,1,9.1-41.3h-18A83.7,83.7,0,0,0,31.3,28.4Z"],B$=[[6,3,2],[6,4,8],[7,2,5],[7,5,2],[2,6,3],[8,6,4],[5,7,2],[2,7,5],[3,2,6],[4,8,6],[2,5,7],[5,2,7],[0,1,2],[0,2,1]],$r="#242436",H$=[g.red,g.green,g.yellow];function Vg(e,t){let i=B$[e].map((s,n)=>[s,n]).sort((s,n)=>n[0]-s[0]);for(let[s,n]of i)u("path",{d:q$[s],class:"tantrix","stroke-width":2.8,stroke:$r,fill:H$[n]},t)}var Wc=class extends j{constructor(t,i,s){super("reg-hexagon",i,s);this.type="tantrix";this.options=t,this.colour=$r,this.$path.setAttr("fill",$r);for(let n of this.$el.$$(".tantrix"))n.setAttr("stroke",$r);Vg(+t,this.$el)}setColour(){}static makeThumbnail(t,i){let s=u("svg",{width:60,height:60,viewBox:"-54 -54 108 108"},i);u("path",{class:"polygon-tile",path:kn("reg-hexagon"),fill:$r},s),Vg(+t,s)}};var kg=[[[-15.7728,63.1105],[-65.2725,56.0545],[-61.7426,-21.037],[-34.7275,-63.1105],[65.2725,-63.1105]],[[60.6056,14.8729],[-53.4909,57.394],[-80.668,-12.5086],[-20.582,-57.394],[80.668,-57.394]],[[0,-73.612],[50,12.9905],[15,73.612],[-50,12.9905],[-30,-73.612]],[[67.056,-58.248],[67.056,1.752],[-10.5597,58.248],[-67.056,-19.3675],[7.056,-58.248]],[[-74.4415,-47.6314],[35.5585,-47.6314],[74.4415,-8.733],[60.1965,44.3902],[-19.4415,47.6314]],[[47.6215,-81.108],[43.731,-26.2458],[-24.012,81.108],[-47.6215,-43.6179],[-7.3786,-81.108]],[[94.9659,43.7299],[-5.0343,43.7299],[-94.9659,0],[-5.0343,-43.7299],[42.1151,-41.1631]],[[-13.1927,57.1955],[76.8074,57.1955],[76.8257,-32.8045],[-9.8062,-57.1955],[-76.8257,-6.4506]],[[-3.2764,58.8874],[86.2804,29.1016],[26.2804,-43.7514],[-26.2804,-58.8874],[-86.2804,13.9666]],[[51.5265,-55],[58.4735,-14.7198],[9.6458,43.251],[-58.4735,55],[-58.4735,-55]],[[-95.733,-40.991],[53.87,-40.991],[95.733,-15.7718],[1.5099,40.991],[-95.733,-10.4271]],[[-85.642,-51.4515],[12.4961,-51.4515],[85.642,-13.2965],[-38.4855,51.4515],[-85.642,18.5485]],[[-69.99,67.0025],[84.488,2.9975],[84.488,-67.0025],[14.488,-67.0025],[-84.488,32.0117]],[[-15.6401,96.696],[46.9202,6.219],[8.0799,-96.696],[-46.9202,-96.696],[-46.9202,51.458]],[[-46.6683,85],[-46.6683,22.7758],[15.5561,-85],[46.6683,-31.1122],[15.5561,85]],[[0,-46.65],[-43.301,-21.65],[-43.301,46.65],[43.301,46.65],[43.301,-21.65]],[[-25,46.65],[25,46.65],[59.15,-12.5],[0,-46.65],[-59.15,-12.5]],[[0,-64.951],[-50,21.65],[-25,64.951],[25,64.951],[50,21.65]]],Lg=[...q.rainbow(15).map(e=>e.hex),g.red,g.blue,g.yellow],Zc=class extends j{constructor(t,i,s){super((kg[+t-1]||[]).map(n=>n.join(" ")).join(","),i,s);this.type="pentagon";this.options=t,this.setColour(Lg[+t-1])}static makeThumbnail(t,i){let s=u("svg",{width:80,height:80},i),n=new O(...kg[+t-1].map(o=>new d(o[0],o[1])));n=n.scale(41/n.radius).shift(40);let r=Lg[+t-1];u("path",{path:n,fill:r,class:"polygon-tile"},s)}};var Dt=25,Og={100:g.yellow,10:g.blue};function $a(e,t,i,s){let n=s.shift(e*i,0),r=n.shift(0,Math.floor(t/e)*i),o=s.shift(0,Math.ceil(t/e)*i),a=o.shift(t%e*i,0),h=a.shift(0,t%e?-i:0);return new O(s,n,r,h,a,o)}function Ig(e,t,i){return u("rect",{class:"number-tile",width:e,height:e,fill:i},t)}function Rg(e,t,i,s,n,r){e.setAttr("x",n+t%i*s),e.setAttr("y",r+Math.floor(t/i)*s)}var Ma=class extends V{constructor(t,i,s){super(i,s);this.type="number-tile";this.options=t;let[n,r]=t.split(":").map(o=>+o);this.count=r,this.colour=Og[r]||g.red,this.$tiles=F(()=>Ig(Dt,this.$el,this.colour),r),this.$outline=u("path",{class:"outline"},this.$el),r>1&&(this.$handle=this.makeHandle("h",o=>this.setWidth(Math.round(o.x/Dt)))),this.setWidth(n,!0)}setWidth(t,i=!1){var s;if(t=k(t,1,this.count),t!==this.width){this.value=this.count,this.width=t,this.options=`${t}:${this.count}`;for(let n=0;n<this.count;++n)Rg(this.$tiles[n],n,t,Dt,-Dt/2,-Dt/2);this.path=$a(t,this.count,Dt,new d(-Dt/2,-Dt/2)),this.$outline.draw(this.path),(s=this.$handle)==null||s.setTransform(new d((t-.5)*Dt,-Dt/2)),this.transform(),i||this.$parent.selection.update()}}setColour(t){this.colour=t;for(let i of this.$tiles)i.setAttr("fill",_(t))}static makeThumbnail(t,i){let[s,n]=t.split(":").map(l=>+l);s=Math.min(s,n);let r=u("svg",{width:n===1?40:80,height:80},i),o=(n===1?20:40)-s/2*7,a=40-Math.ceil(n/s)/2*7,h=Og[n]||g.red;for(let l=0;l<n;++l)Rg(Ig(7,r,h),l,s,7,o,a)}getSnapPoints(){let t=new d(-Dt/2,-Dt/2),i=[t];for(let n=1;n<=this.width;++n)i.push(t.shift(n*Dt,0));let s=Math.ceil(this.count/this.width);for(let n=1;n<=s;++n)i.push(t.shift(0,n*Dt));for(let n=0;n<this.count;++n)i.push(t.shift((n%this.width+1)*Dt,Math.floor(n/this.width+1)*Dt));return i}split(){if(this.count===1)return[];let t=F(i=>{let s=i%this.width*Dt,n=Math.floor(i/this.width)*Dt,r=this.posn.shift(s,n).rotate(this.rot*lt,this.posn);return _g(1,1,this.$parent,r,this.rot,this.colour)},this.count);return this.$parent.selection.select(t),this.delete(),t}static action(t,i){if(t==="split"){let s=[];for(let n of i)s.push(...n.split());i[0].$parent.change({added:s,deleted:i})}else if(t==="merge"){let s=Array.from(i),n=U(s.map(p=>p.count)),r=G(Eo(s,p=>p.count)),o=r.$parent,a=Math.min(...s.map(p=>p.posn.x)),h=Math.min(...s.map(p=>p.posn.y)),l=Math.max(...s.map(p=>Math.ceil((p.posn.x-a)/Dt)+p.width)),c=_g(n,l,o,new d(a,h),r.rot,r.colour);for(let p of i)p.delete();o.selection.add(c),i[0].$parent.change({added:[c],deleted:i})}}};function _g(e,t,i,s,n,r){let o=new Ma(`${t}:${e}`,i);return o.setColour(r),o.setTransform(s,n),o}var Mr=[g.yellow,"#f15e19","#e1343b",g.red,"#8d2ca1","#4e53d0",g.blue,g.teal,g.green,g.lime],Ng=["#e6e2c6","#cc1030",g.green,g.red,"#ffd615",g.teal,"#181824","#9a2e13",g.blue,g.yellow],Dg=25,Kc=class extends j{constructor(t,i,s){super(wa(+t*Dg,Dg),i,s);this.type="number-bar";this.options=t,this.value=+t,this.$text=u("text",{text:t,class:"polygon-label",y:6},this.$el),this.setColour((i.options.altColors?Ng:Mr)[+t-1])}customTransform(){this.$text.css("transform",`rotate(${-this.rot}deg)`)}static makeThumbnail(t,i,s){let n=+t,r=new A(new d(1,1),n*20,20),o=u("svg",{width:n*20+2,height:22},i),a=u("path",{class:"polygon-tile",path:r},o);u("text",{html:t,class:"polygon-label",x:n*10+1,y:16},o),s.options.watch(h=>a.setAttr("fill",(h.altColors?Ng:Mr)[n-1]))}};var Gg=2*Math.PI;var _n=50,Sa={1:g.grey,2:g.yellow,3:g.green,5:g.blue,7:g.purple},z$="M0-xAx,x,0,0,0-x,0,x,x,0,0,0,0,x,x,x,0,0,0,x,0,x,x,0,0,0,0-xZM0,yAz,z,0,0,1-y,0,z,z,0,0,1,0-y,z,z,0,0,1,y,0,z,z,0,0,1,0,yZ";function qg(e,t,i=1){let s=e.y*t.x-e.x*t.y>0?i:1-i;return[e.x,e.y+"A"+e.length,e.length,0,s,i,t.x,t.y].join(",")}function Bg(e,t,i=_n){if(t===1)return z$.replace(/x/g,""+i).replace(/y/g,""+.4*i).replace(/z/g,""+(.4*i+.1));let s=Gg/t,n=-Math.PI/2-s/2,r=d.fromPolar(n+s*e,i),o=d.fromPolar(n+s*(e+1),i);return`M${qg(r,o)}L${qg(o.scale(.4),r.scale(.4),0)}Z`}function Hg(e){return e===1?[1]:bi(e).reverse()}var Sr=class extends V{constructor(t,i,s){super(i,s);this.type="prime-disk";this.$segments=[];this.factors=[];this.path=new Z(C,_n),u("circle",{class:"prime-background",r:_n},this.$el),this.$segmentWrap=u("g",{},this.$el),this.$label=u("text",{class:"prime-label",y:5},this.$el),this.$outline=u("path",{class:"outline",path:this.path},this.$el),this.setValue(+t)}setValue(t){t=this.value=k(Math.round(t),1,9999999),this.options=this.$label.text=""+t,this.factors=Hg(t);let i=this.factors.length;for(let s=0;s<i;++s){let n=this.getSegment(s);n.setAttr("fill",Sa[this.factors[s]]||g.red),n.setAttr("d",Bg(s,i)),n.show()}for(let s=i;s<this.$segments.length;++s)this.$segments[s].hide()}multiply(t){this.setValue(+this.options*t)}getSegment(t){if(this.$segments[t])return this.$segments[t];let i=u("path",{class:"polygon-tile"},this.$segmentWrap);return this.$parent.events.listen(i,{down:()=>{this.$parent.selection.add(this,!this.$parent.events.shiftKey)},start:()=>{!this.isActive||(this.$parent.selection.add(this,!0),i.addClass("prime-move"),this.$container.append(i))},move:s=>{!this.isActive||(i.setTransform(this.posn.add(s.posn).subtract(s.startPosn)),this.setCollision(this.findNearby("prime-disk",_n,s.posn)))},end:s=>{if(!this.isActive)return;i.removeClass("prime-move"),i.setTransform(),this.$segmentWrap.append(i);let n=s.lastPosn.subtract(s.startPosn);if(n.length>_n){let r=[],o=[this];if(this.collision)this.collision.multiply(this.factors[t]),this.$parent.selection.add(this.collision,!0),o.push(this.collision),this.setCollision();else{let a=new Sr(`${this.factors[t]}`,this.$parent);a.setTransform(this.posn.add(n)),r.push(a),this.$parent.selection.add(a,!0)}this.setValue(+this.options/this.factors[t]),this.$parent.change({changed:o,added:r})}},checkIfActive:()=>this.factors.length>1}),this.$segments[t]=i,i}setColour(t){if(this.colour=t,t)for(let i of this.$segments)i.setAttr("fill",_(this.colour))}highlight(t=!0){this.$el.setClass("active",t)}move(t){super.move(t),!(this.$parent.selection.tiles.size>1)&&this.setCollision(this.findNearby("prime-disk",_n))}collide(t){t.highlight(!1),t.multiply(+this.options),this.delete();let i=this.lastSavedData?[this]:void 0;this.$parent.change({changed:[t],deleted:i})}static makeThumbnail(t,i){let s=u("svg",{width:54,height:54},i),n=u("g",{transform:"translate(27 27)"},s),r=o=>{n.removeChildren();let a=Hg(o);for(let h=0;h<a.length;++h){let l=Sa[a[h]]||g.red,c=Bg(h,a.length,25);u("path",{fill:l,d:c,class:"polygon-tile"},n),u("text",{text:o,y:4,fill:"white",style:"font-size: 11px; text-anchor: middle"},n)}};i.onAttr("data-options",o=>r(Math.round(+o)))}};var Rt=25,Xc=class extends V{constructor(t,i,s){super(i,s);this.type="decimal-grid";this.$handles=[];this.$tiles=u("g",{},this.$el),this.$outline=u("path",{class:"outline"},this.$el),this.$handles[0]=this.makeHandle("h",a=>this.setDimensions(a.x/Rt,this.height,this.size)),this.$handles[1]=this.makeHandle("v",a=>this.setDimensions(this.width,a.y/Rt,this.size)),this.$handles[2]=this.makeHandle("c",a=>this.setDimensions(this.width,this.height,(a.x+a.y)/2/Rt)),this.$handles[1].css("cursor","ns-resize"),this.$handles[2].css("cursor","nwse-resize");let[n,r,o]=t.split(":");this.setDimensions(+n,+r,+o)}setDimensions(t,i,s){t=this.width=k(Math.round(t),1,100),i=this.height=k(Math.round(i),1,100),s=this.size=k(Math.round(s),2,Math.max(t,i));let n=[t,i,s].join(":");if(n===this.options)return;this.options=n,this.$tiles.removeChildren();let r=Math.floor(t/s)*s,o=Math.floor(i/s)*s,a=s*Rt;for(let h=0;h<r;h+=s)for(let l=0;l<o;l+=s)this.drawRect(h*Rt,l*Rt,a,a,g.yellow);for(let h=r;h<t;++h)for(let l=0;l<o;l+=s)this.drawRect(h*Rt,l*Rt,Rt,a,g.blue);for(let h=0;h<r;h+=s)for(let l=o;l<i;++l)this.drawRect(h*Rt,l*Rt,a,Rt,g.blue);for(let h=r;h<t;++h)for(let l=o;l<i;++l)this.drawRect(h*Rt,l*Rt,Rt,Rt,g.red);this.$handles[0].setTransform({x:t*Rt,y:0}),this.$handles[1].setTransform({x:0,y:i*Rt}),this.$handles[2].setTransform({x:a,y:a}),this.path=new A(C,t*Rt,i*Rt),this.$outline.draw(this.path),this.$parent.selection.update(),this.transform()}drawRect(t,i,s,n,r){u("rect",{x:t,y:i,width:s,height:n,fill:this.colour||r,class:"polygon-tile"},this.$tiles)}setColour(t){this.colour=t;for(let i of this.$tiles.children)i.setAttr("fill",_(t))}static makeThumbnail(t,i){let s=u("svg",{width:140,height:80},i),n=(r,o,a,h,l)=>u("rect",{x:5+r,y:5+o,width:a,height:h,fill:l,class:"polygon-tile"},s);for(let r=0;r<2;++r)n(50*r,0,50,50,g.yellow);for(let r=0;r<3;++r)n(100+10*r,0,10,50,g.blue);for(let r=0;r<2;++r)for(let o=0;o<2;++o)n(50*r,50+o*10,50,10,g.blue);for(let r=0;r<3;++r)for(let o=0;o<2;++o)n(100+r*10,50+o*10,10,10,g.red)}};var zg='<h3>Dot Machine</h3><label class="row"><div class="label">Base:</div><input class="input-field" type="number" :bind="base" min="2" max="25"></label><label class="row"><div class="label">Boxes:</div><input class="input-field" type="number" :bind="boxes" min="1" max="10"></label>';var Yc=class extends V{constructor(t,i,s){super(i,s);this.type="dot-machine";this.canRotate=!1;this.canDragToSelect=!1;this.cells=[];this.isAnimating=!1;let[n,r]=t.split(":").map(a=>+a),o={base:n,boxes:r};this.model=i.bindSettingsPanel(this,zg,o),this.$outline=u("rect",{class:"outline",rx:12},this.$el),this.model.watch(()=>this.draw(this.model)),this.setColour(g.purple),this.setOrder("back"),this.onMove=()=>{let a=Array.from(i.selection.tiles).filter(h=>h.type==="dot");for(let h of this.cells)h.hover(a.some(l=>h.contains(l.posn)))},this.onMoveEnd=()=>{for(let a of this.cells)a.hover(!1)},i.on("move-selection",this.onMove),i.on("move-end",this.onMoveEnd),this.onChange=()=>this.rearrangeDots(),setTimeout(()=>{this.rearrangeDots(),i.on("change",this.onChange)})}delete(){this.$parent.off("move-selection",this.onMove),this.$parent.off("move-end",this.onMoveEnd),this.$parent.off("change",this.onChange),super.delete()}select(){super.select();for(let t of this.cells)t.hover()}deselect(){super.deselect();for(let t of this.cells)t.hover(!1)}draw(t){let i=Math.round(t.base),s=Math.round(t.boxes);if(this.options=`${i}:${s}`,this.cells.length>s){for(let r=s;r<this.cells.length;++r)this.cells[r].delete();this.cells=this.cells.slice(0,s)}else if(this.cells.length<s)for(let r=this.cells.length;r<s;++r){let o=new Fg(this,r,this.$parent);this.cells.push(o),o.setColour(this.colour)}for(let r of this.cells)r.setBase(i);let n=150*(s-1)+10;this.path=new A(new d(-n,-10),n+160,170),this.$outline.setRect(this.path),this.transform(),this.$parent.selection.update()}getSnapPoints(){return[]}setColour(t){super.setColour(t.slice(0,7));for(let i of this.cells)i.setColour(this.colour)}moveEnd(){super.moveEnd();for(let t of this.cells)for(let i of[...t.dots,...t.antiDots])i.cell=void 0}rearrangeDots(){if(!this.isAnimating){for(let t of this.cells)t.clear();for(let t of this.$parent.tiles.values())if(!(!t.is("dot")||t.deleted))for(let i of this.cells)(t.cell===i||!t.cell&&i.contains(t.posn))&&i.addDot(t);for(let t of this.cells)t.rearrange()}}static makeThumbnail(t,i){let s=u("svg",{width:160,height:60},i);for(let n of[105,55,5])u("rect",{x:n,y:5,width:50,height:50,class:"dot-cell",stroke:"#eee",style:"stroke-width: 6px"},s),u("circle",{cx:n+25,cy:5,r:2},s),u("circle",{cx:n+25,cy:55,r:2},s)}static action(t,i){return E(this,null,function*(){if(t==="explode")for(let s of i)s.isAnimating||s.cells[0].explode();else if(t==="annihilate")for(let s of i)s.isAnimating||s.cells[0].annihilate()})}},Fg=class{constructor(t,i=0,s){this.machine=t;this.index=i;this.$doc=s;this.dots=[];this.antiDots=[];let n=-150*i;this.$el=u("rect",{class:"dot-cell",width:150,height:150,x:n}),this.$label=u("text",{class:"dot-label",x:75+n,y:154,"font-size":"12px"},t.$el),this.$value=u("text",{class:"dot-label",x:75+n,y:6,text:0,"font-size":"18px"},t.$el),this.bounds=new A(new d(n,0),150,150),t.$el.prepend(this.$el)}setBase(t){this.$label.text=Mt(Math.pow(t,this.index))}delete(){this.$el.remove(),this.$label.remove(),this.$value.remove()}setColour(t){this.$el.setAttr("stroke",t),this.machine.isActive&&this.$el.css("fill",t)}hover(t=!0){this.machine.isActive&&!t||this.$el.css("fill",t?this.machine.colour:"none")}contains(t){return this.bounds.translate(this.machine.posn).contains(t)}clear(){this.dots=[],this.antiDots=[]}addDot(t){(t.options==="1"?this.dots:this.antiDots).push(t),t.cell=this}rearrange(){this.$value.text=Mt(this.dots.length-this.antiDots.length);let t=[...this.dots,...this.antiDots];if(!t.length)return;let i=Math.ceil(Math.sqrt(t.length)),s=Math.ceil(t.length/i),n=t.length<=16?30:t.length<=25?25:20,r=this.bounds.center.add(this.machine.posn).shift(-n*(i-1)/2,-n*(s-1)/2),o=F(a=>r.shift(a%i*n,Math.floor(a/i)*n),t.length);return this.animatePoints(t,o)}animatePoints(t,i){let s=t.map(n=>n.posn);for(let[n,r]of t.entries())r.setTransform(i[n]);return ot(n=>{var r;for(let[o,a]of t.entries()){let h=d.interpolate(s[o],i[o],mt("quad",n));a.$el.setTransform(h),a.transformed=(r=a.path)==null?void 0:r.translate(h)}this.machine.$parent.selection.update()},240).promise}getDotsToExplode(){let t=this.machine.model.base;if(this.dots.length>=t)return this.dots.splice(0,t);if(this.antiDots.length>=t)return this.antiDots.splice(0,t)}explode(){return E(this,null,function*(){let t=this.machine.cells[this.index+1];if(!t){this.machine.isAnimating=!1,this.machine.$parent.change({changed:this.dots});return}this.machine.isAnimating=!0;let i=this.getDotsToExplode();if(!i)return t.explode();this.$doc.playSound("rise"),t.addDot(i[0]);for(let s of i.slice(1))s.popOut();return t.rearrange(),yield Po(400),this.rearrange(),yield Po(400),this.explode()})}annihilate(){return E(this,null,function*(){this.machine.isAnimating=!0;let t=Math.min(this.dots.length,this.antiDots.length);if(t){let s=this.dots.splice(0,t),n=this.antiDots.splice(0,t);for(let r of[...s,...n])r.popOut();this.$doc.playSound("woosh"),this.rearrange(),yield Po(600)}let i=this.machine.cells[this.index+1];if(i)return i.annihilate();this.machine.isAnimating=!1,this.machine.$parent.change({changed:this.dots})})}};var Pa=25/2,Pr=class extends V{constructor(t,i,s){super(i,s);this.type="dot";this.deleted=!1;this.options=t,this.$path=u("circle",{r:Pa,class:"polygon-tile"},this.$el),this.$outline=u("circle",{r:Pa,class:"outline"},this.$el),this.path=new Z(C,Pa),this.setColour(g.blue)}setColour(t){this.colour=t,this.$path.setAttr("fill",this.options==="-1"?g.red:this.colour)}getSnapPoints(){return[]}getCell(){for(let t of this.$parent.tiles.values())if(!(t.type!=="dot-machine"||t.isActive)){for(let i of t.cells)if(i.contains(this.posn))return i}}moveEnd(){let t=this.cell,i=this.cell=this.getCell();if(!t||!i||t===i||t.machine!==i.machine)return;let s=Math.abs(t.index-i.index),n=t.machine.model.base**s;if(t.index<i.index){let r=this.options==="1"?t.dots:t.antiDots;if(r.length<n)return this.cell=t;for(let o of r.filter(a=>!a.isActive).slice(0,n-1))o.popOut()}else for(let r=0;r<n-1;++r){let o=new Pr(this.options,this.$parent);o.posn=this.posn,o.cell=i}}static makeThumbnail(t,i){let s=t==="1"?g.blue:g.red,n=u("svg",{width:40,height:40},i);u("circle",{class:"polygon-tile",cx:20,cy:20,r:Pa,fill:s},n)}negate(){this.options=this.options==="-1"?"1":"-1",this.setColour(g.blue)}popOut(){return E(this,null,function*(){this.deleted=!0,yield this.$path.exit("pop").promise,this.delete()})}};function Ug(e){return e===0?g.grey:e>0?g.blue:g.red}function jg(e){return+e.replace("\u2013","-")}function Wg(e,t,i=40,s=50){t=k(Math.round(t),-9999,9999);let r=(e.text=Mt(t)).length;return e.css("font-size",(r>=6?.625:r>=4?.75:1)*i+"px"),e.setAttr("y",(r>=6?.9:r>=4?.94:1)*s),t}var Qc=class extends V{constructor(t,i,s){super(i,s);this.type="number-card";this.path=new A(C,75),this.$path=u("rect",{class:"polygon-tile",rx:10,width:75,height:75},this.$el),this.$label=u("text",{x:75/2,fill:"white",style:"text-anchor: middle"},this.$el),this.$outline=u("rect",{class:"outline",rx:10,width:75,height:75},this.$el),this.setValue(jg(t))}setValue(t){this.value=Wg(this.$label,t),this.options=""+this.value,this.setColour()}setColour(t){super.setColour(t||Ug(this.value)),this.$path.setAttr("fill",_(this.colour))}highlight(t=!0){this.$el.setClass("active",t)}move(t){if(super.move(t),!this.$parent.options.mergeTiles||this.$parent.selection.tiles.size>1)return;let i=this.findNearby("number-card",40);this.setCollision(i&&at(i.value+this.value,-9999,9999)?i:void 0)}collide(t){t.highlight(!1),t.setValue(t.value+this.value),this.$parent.playSound("click"),this.delete();let i=this.lastSavedData?[this]:void 0;this.$parent.change({changed:[t],deleted:i})}negate(){this.setValue(-this.value)}static makeThumbnail(t,i){let s=u("svg",{width:60,height:60},i),n=u("rect",{x:5,y:5,width:50,height:50,class:"polygon-tile",rx:5},s),r=u("text",{fill:"white",x:30,style:"text-anchor: middle"},s);i.onAttr("data-options",o=>{let a=Wg(r,jg(o),30,39);n.setAttr("fill",Ug(a))})}};var Vt=50,zs=14,F$=`M-${Vt/2} -4.5h${Vt*zs}v-33h9v75h-9v-33h-${Vt*zs}v33h-9v-75h9Z`,Jc=class extends V{constructor(t,i,s){super(i,s);this.type="abacus";this.options=t,this.path=new A(new d(-Vt/2-9,-Vt/2-12.5),zs*Vt+18,Vt+25),u("path",{path:this.path,fill:"transparent"},this.$el),u("path",{d:F$,class:"polygon-tile",fill:"#7e7c86"},this.$el),u("path",{path:this.path,class:"outline"},this.$el),this.positions=t.split(",").map(n=>+n),this.$beads=this.positions.map(n=>u("circle",{cx:n*Vt,r:Vt/2,class:"polygon-tile"},this.$el)),this.$gradients=this.positions.map(n=>u("circle",{cx:n*Vt,r:Vt/2,class:"bead-gradient"},this.$el)),this.count=this.$beads.length;for(let[n,r]of this.$beads.entries())this.setupBead(r,n);this.setColour(g.orange)}setupBead(t,i){let s=0;this.$parent.events.listen(t,{click:()=>{this.locked||this.$parent.selection.add(this,!this.$parent.events.shiftKey)},start:n=>{s=this.positions[i]-this.relativePosn(n.posn).x/Vt},move:n=>{let r=this.positions[i]=k(s+this.relativePosn(n.posn).x/Vt,i,zs-(this.count-i)),o=r;for(let h=i+1;h<this.count;++h)this.positions[h]<o+1&&(this.positions[h]=o+1),o=this.positions[h];let a=r;for(let h=i-1;h>=0;--h)this.positions[h]>a-1&&(this.positions[h]=a-1),a=this.positions[h];for(let[h,l]of this.$beads.entries())l.setAttr("cx",this.positions[h]*Vt),this.$gradients[h].setAttr("cx",this.positions[h]*Vt)},end:()=>{let n=this.options;this.options=this.positions.join(","),n!==this.options&&this.$parent.change({changed:[this]})}})}setColour(t){super.setColour(t.slice(0,7));let i=this.$beads.length/2,s=q.mix("#fff",this.colour,.8);for(let[n,r]of this.$beads.entries())r.setAttr("fill",n<i?this.colour:s)}getSnapPoints(){return[new d(-Vt/2,-25),new d((zs-.5)*Vt,-25),new d(-Vt/2,25),new d((zs-.5)*Vt,25),new d(-Vt/2,50),new d((zs-.5)*Vt,50)]}static makeThumbnail(t,i){let s=u("svg",{width:240,height:40},i);u("line",{x1:5,y1:18,x2:235,y2:20,stroke:"white","stroke-width":"3px"},s),u("line",{x1:4,y1:3,x2:4,y2:37,stroke:"white","stroke-width":"3px"},s),u("line",{x1:236,y1:3,x2:236,y2:37,stroke:"white","stroke-width":"3px"},s);for(let n=0;n<10;++n){let r=n<5?g.orange:q.mix("#fff",g.orange,.7),o={cx:16+20*n,cy:20,r:10,style:"stroke-width: 0.5px"};u("circle",We(We({},o),{class:"polygon-tile",fill:r}),s),u("circle",We(We({},o),{class:"bead-gradient"}),s)}}};var U$={1:g.yellow,x:g.green,x2:g.blue,y:g.teal,y2:"#8d2ca1",xy:"#4e53d0"},Cr=25,j$=Cr*5.4,W$=Cr*4.7,Z$="#ddd";function Ca(e){return e.replace("-","\u2013").replace("2","\xB2")}function tu(e){return e[0]==="-"?g.red:U$[e]}function Zg(e,t=Cr,i=j$,s=W$){return e.endsWith("x2")?[i,i]:e.endsWith("y2")?[s,s]:e.endsWith("xy")?[i,s]:e.endsWith("x")?[t,i]:e.endsWith("y")?[t,s]:[t,t]}var Tr=class extends j{constructor(t,i,s){super(wa(...Zg(t.toLowerCase())),i,s);this.type="algebra-tile";this.options=t.toLowerCase(),this.$text=u("text",{text:Ca(this.options),class:"polygon-label",y:6},this.$el),this.setColour(tu(this.options))}setColour(t=this.colour){super.setColour(t),this.$path.setAttr("fill",_(this.collision?Z$:this.colour)),this.$text.text=this.collision?"0":Ca(this.options)}customTransform(){this.$text.css("transform",`rotate(${-this.rot}deg)`)}setCollision(t){this.collision=t,this.setColour()}move(t){if(super.move(t),this.collision){if(d.distance(this.posn,this.collision.posn)<.95*Cr)return;this.collision.setCollision(),this.setCollision()}let i=this.options[0]==="-"?this.options.slice(1):"-"+this.options;for(let s of this.$parent.tiles.values())if(!(!s.is("algebra-tile")||s.collision||s===this)&&s.options===i&&!(d.distance(this.posn,s.posn)>=.95*Cr)){this.setCollision(s),s.setCollision(this);return}}static makeThumbnail(t,i){let[s,n]=Zg(t,20,78,64),r=t[0]==="-"?t.slice(1):t,o=r==="y2"?112:["x2","xy"].includes(r)?28:2,a=r==="1"?2:["x","x2"].includes(r)?28:112;i.hasAttr("data-rot")&&([o,a,s,n]=[a,o,n,s]),i.setRect(new A(new d(o,a),s,n)),i.setAttr("fill",tu(t)),i.insertAfter(u("text",{text:Ca(t),class:"polygon-label",x:o+s/2,y:a+n/2+5}))}negate(){this.options.startsWith("-")?this.options=this.options.slice(1):this.options="-"+this.options,this.setColour(tu(this.options)),this.$text.text=Ca(this.options)}static action(t,i){if(t==="negate"){for(let s of i)s.negate();i[0].$parent.change({changed:i})}}};var Kg="M-125,0l35,252c0,11,40.3,20,90,20s90-9,90-20L125,0Z",Xg=F(e=>new d(e<5?-45:45,65+40*(e%5)),10),eu=class extends V{constructor(t,i,s){super(i,s);this.type="bucket";this.canRotate=!1;this.canDragToSelect=!1;this.isAnimating=!1;this.tiles=Ce(void 0,20);u("path",{class:"polygon-tile bucket",d:Kg,fill:"#ccc"},this.$el),u("ellipse",{class:"polygon-tile bucket",rx:125,ry:28,fill:"#888"},this.$el),this.$text=u("text",{text:0,class:"bucket-label",y:12},this.$el),this.setColour(g.grey),this.path=new O(new d(-125,0),new d(0,-28),new d(125,0),new d(90,252),new d(0,272),new d(-90,252)),this.setOrder("back"),this.onMoveEnd=()=>this.recompute(),i.on("change",this.onMoveEnd)}delete(){this.$parent.off("change",this.onMoveEnd),super.delete()}getSnapPoints(){return[]}recompute(){return E(this,null,function*(){var i;if(this.isAnimating)return;let t=[];for(let[s,n]of this.tiles.entries())n&&!Bi(this.$parent.tiles.values(),r=>r===n)&&(this.tiles[s]=void 0);for(let s of this.$parent.tiles.values()){if(!s.is("algebra-tile")||!s.options.endsWith("1"))continue;let n=s.options!=="1",r=(i=this.transformed)==null?void 0:i.contains(s.posn),o=this.tiles.indexOf(s);if(o>=0&&!r&&(this.tiles[o]=void 0),!r)continue;if((n?o>=0&&o<10:o>=10)&&(this.tiles[o]=void 0,o=-1),o<0&&(o=this.tiles.findIndex((h,l)=>!h&&(n?l>=10:l<10))),o<0)return;this.tiles[o]=s;let a=Xg[o%10].shift(n?15:-15,0).add(this.posn);a.equals(s.posn)||t.push({tile:s,from:s.posn,to:a})}if(this.$text.text=Mt(U(this.tiles.map((s,n)=>s?n<10?1:-1:0))),t.length){this.isAnimating=!0,yield ot(s=>{var r;let n=mt("quad",s);for(let{tile:o,from:a,to:h}of t){let l=d.interpolate(a,h,n);o.posn=l,o.$el.setTransform(l,o.rot*lt),o.transformed=(r=o.path)==null?void 0:r.translate(l)}this.$parent.selection.update()},240).promise;for(let s of t)s.tile.transform(),s.tile.move();this.isAnimating=!1}})}fill(){if(this.isAnimating)return[];let t=[];for(let[i,s]of this.tiles.entries()){if(s)continue;let n=new Tr(i<10?"1":"-1",this.$parent);n.setTransform(Xg[i%10].shift(i<10?-15:15,0).add(this.posn)),this.tiles[i]=n,t.push(n)}return this.$text.text="0",t}static makeThumbnail(t,i){let s=u("svg",{width:120,height:140,viewBox:"-140 -40 280 320"},i);u("path",{class:"polygon-tile bucket",d:Kg,fill:"#ccc",style:"stroke-width: 2px"},s),u("ellipse",{class:"polygon-tile bucket",rx:125,ry:28,fill:"#888",style:"stroke-width: 2px"},s)}static action(t,i){return E(this,null,function*(){if(t==="fill"){let s=[];for(let n of i)s.push(...n.fill());s.length&&i[0].$parent.change({added:s})}})}};var Ie=50,Yg=Pe((e,t,i,s,n)=>e==="number"?1+s+n*t:e==="addition"?!s&&!n?"+":!s||!n?s||n:s+n:!s&&!n?"\xD7":!s||!n?s||n:s*n),K$=Pe(e=>q.from(e).brightness<140),X$=Pe(e=>q.mix(e,"#000",.7).hex);function Y$(e){return e?new Map(e.split(",").map(t=>t.split("-"))):new Map}function Q$(e){return Array.from(e.entries()).map(t=>t.join("-")).join(",")}var iu=class extends V{constructor(t,i,s){super(i,s);this.type="number-grid";this.cells=[];this.$handles=[];this.rows=3;this.cols=2;this.isFocussed=!1;this.selected=new Set;this.canRotate=!1;this.$cells=u("g",{},this.$el),this.$outline=u("path",{class:"outline"},this.$el),i.events.listen(this.$el,{down:h=>this.selectCell(h.posn),move:h=>this.selectCell(h.posn,!0),checkIfActive:()=>this.isFocussed}),this.$handles[0]=this.makeHandle("h",h=>this.resize(h.x/Ie,this.rows)),this.$handles[1]=this.makeHandle("v",h=>this.resize(this.cols,h.y/Ie)),this.$handles[1].css("cursor","ns-resize");let[n,r,o,a]=t.split(":");this.gridType=n,this.colour="#ccc",this.colorsStr=a||"",this.colors=Y$(this.colorsStr),this.resize(+r,+o)}resize(t,i){this.cols=k(Math.round(t),2,20),this.rows=k(Math.round(i),2,20);let s=`${this.gridType}:${this.cols}:${this.rows}:${this.colorsStr}`;if(s===this.options)return;this.options=s;let n=this.cols*this.rows;for(let r=this.cells.length;r<n;++r)this.cells.push(this.makeCell());for(let r=n;r<this.cells.length;++r)this.cells[r][0].hide();this.updateCells(),this.path=new A(C,this.cols*Ie,this.rows*Ie),this.$outline.draw(this.path),this.$handles[0].setTransform({x:this.path.w,y:0}),this.$handles[1].setTransform({x:0,y:this.path.h}),this.transform(),this.$parent.selection.update()}makeCell(){let t=u("g",{class:"number-grid-cell"},this.$cells),i=u("circle",{r:23,cx:Ie/2,cy:Ie/2},t);return[t,i,u("text",{x:Ie/2,y:Ie/2+8},t)]}updateCells(){for(let t=0;t<this.cols;++t)for(let i=0;i<this.rows;++i){let[s,n,r]=this.cells[t+i*this.cols];s.show(),s.translate(t*Ie,this.flipped?(this.rows-1-i)*Ie:i*Ie),r.text=""+this.getCellValue(t,i)}this.updateColors()}updateColors(){let t=this.gridType==="number",i=_(this.colour),s=X$(i);for(let n=0;n<this.cols;++n)for(let r=0;r<this.rows;++r){let o=n+r*this.cols,a=!t&&(!n||!r),h=this.colors.get(t?`${o}`:`${r}/${n}`)||(a?s:i);this.cells[o][1].setAttr("fill",h),this.cells[o][2].setAttr("fill",K$(h)?"#fff":"#000")}}setColour(t,i){if(this.isFocussed&&i==="picker"){let s=this.gridType==="number",n=_(t);for(let r of this.selected)this.colors.set(s?`${r}`:`${Math.floor(r/this.cols)}/${r%this.cols}`,n);return this.colorsStr=Q$(this.colors),this.options=`${this.gridType}:${this.cols}:${this.rows}:${this.colorsStr}`,this.$parent.change({changed:[this]}),this.updateColors()}i==="picker"&&(this.colors.clear(),this.colorsStr="",this.options=`${this.gridType}:${this.cols}:${this.rows}`),super.setColour(t),this.updateColors()}doubleClick(t){this.$parent.selection.clear(),this.isFocussed=!0,this.$parent.options.focussed=this,this.selectCell(t.posn)}selectCell(t,i=!1){if(t=this.relativePosn(t).scale(1/Ie).floor(),t.x<0||t.x>=this.cols||t.y<0||t.y>=this.rows)return;let s=t.x+(this.flipped?this.rows-1-t.y:t.y)*this.cols;if(i)this.selected.has(s)||this.addToSelection(s);else if(this.$parent.events.shiftKey)this.selected.has(s)?this.removeFromSelection(s):this.addToSelection(s);else{for(let n of this.selected)this.removeFromSelection(n);this.addToSelection(s)}}addToSelection(t){this.cells[t][0].addClass("active"),this.selected.add(t)}removeFromSelection(t){this.cells[t][0].removeClass("active"),this.selected.delete(t)}getCellValue(t,i){return Yg(this.gridType,this.cols,this.rows,t,i)}blur(){for(let t of this.selected)this.removeFromSelection(t);this.isFocussed=!1,this.$parent.options.focussed=void 0}flip(){super.flip(),this.updateCells()}selectMultiples(){let t=Array.from(this.selected).map(s=>+this.getCellValue(s%this.cols,Math.floor(s/this.cols))),i=t.length>1?xs(...t):t[0];for(let s of this.selected)this.removeFromSelection(s);for(let s=0;s<this.cols;++s)for(let n=0;n<this.rows;++n)+this.getCellValue(s,n)%i==0&&this.addToSelection(s+n*this.cols)}static action(t,i){if(t==="reverse"){for(let s of i)s.flip();i[0].$parent.change({changed:i})}}static makeThumbnail(t,i){let s=t.split(":")[0],n=s==="number"?5:4,r=u("svg",{width:10+25*n,height:10+25*n,"text-anchor":"middle","font-size":"14"},i),o=(a,h,l,c)=>{u("circle",{cx:a+17.5,cy:h+17.5,r:12,fill:l},r),u("text",{x:a+17.5,y:h+22,text:c,fill:"white"},r)};for(let a=0;a<n;++a)for(let h=0;h<n;++h){let l=s==="number"||a&&h?"#ffffff44":"#ffffff88";o(25*a,25*h,l,Yg(s,n,n,a,h))}}};var Qg=25;function J$(e){let t=+e,i=Math.ceil(t/2);return ut($a(i,t,Qg,C).points)}function Jg(e,t,i,s=0,n=0){let r=Math.ceil(e/2);for(let o=0;o<e;++o){let a=(o%r+.5)*t+s,h=(.5+(o<r?0:1))*t+n;u("circle",{fill:"white",cx:a,cy:h,r:t*.25},i)}}var su=class extends j{constructor(t,i,s){super(J$(t),i,s);this.type="number-frame";this.options=t,this.value=+t,this.setColour(Mr[this.value-1]),Jg(this.value,Qg,this.$el)}static makeThumbnail(t,i){let s=+t,n=Math.ceil(s/2),r=$a(n,s,20,new d(5,5)),o=u("svg",{width:n*20+10,height:50},i);u("path",{path:r,fill:Mr[s-1],class:"polygon-tile"},o),Jg(s,20,o,5,5)}};var t1=4,e1=6,Fs=6;function i1(e){return e===1?[1]:bi(e)}var t3=Pe((e,t)=>{if(e===2)return 2*t+1.5*Fs;let i=2*t+Fs,s=2*t+Fs;e===3&&(s/=Math.sqrt(3)),e===4&&(s/=Math.sqrt(2)),e>3&&e%2&&(e-=1);let r=Math.ceil((Math.sqrt(e*8/e1+1)-1)/2);return s+(r-1)*i+t+Fs});function nu(e){return e.reduceRight((t,i)=>t3(i,t),t1)}function e3(e,t){if(e===1)return[];if(e===2)return[C.shift(-t-Fs/2,0),C.shift(t+Fs/2,0)];let i=[],s=2*t+Fs,n=s;e===3&&(n/=Math.sqrt(3)),e===4&&(n/=Math.sqrt(2)),e>3&&e%2&&(i.push(C),e-=1);let r=1;for(;e;){let o=Math.min(e1*r,e);i.push(...O.regular(o,n).points),e-=o,n+=s,r+=1}return i}function ru(e,t,i,s=C){if(e.length<1)return[];let n=u("g",{class:"tile","data-n":e.join("-")},i),r=Sa[e[0]]||g.red;u("circle",{r:t,cx:s.x,cy:s.y,fill:r,class:"polygon-tile"},n);let o=e.slice(1),a=nu(o),h=e3(e[0],a);if(o.length){let l=[n];for(let c of h)l.push(...ru(o,a,n,s.add(c)));return l}else{for(let l of h){let c=s.add(l);u("circle",{r:t1,cx:c.x,cy:c.y,fill:"white"},n)}return[n]}}var Er=class extends V{constructor(t,i){super(i);this.type="number-dot";this.factors=[];this.$body=u("g",{},this.$el),this.$outline=u("path",{class:"outline"},this.$el),t.startsWith(">")?(this.options=t,this.factors=t.slice(1).split("-").map(s=>+s),this.value=this.factors.reduce((s,n)=>s*n,1),this.count=this.factors.length,this.buildTile()):this.setValue(+t)}setValue(t){t=this.value=k(Math.round(t),1,999),this.factors=i1(t),this.count=this.factors.length,this.options=">"+this.factors.join("-"),this.buildTile()}add(t){this.setValue(this.value+t)}buildTile(){this.$body.removeChildren(),this.radius=nu(this.factors);let t=ru(this.factors,this.radius,this.$body);if(this.factors.length>1)for(let i of t.slice(1))this.setupListeners(i);this.path=new Z(C,this.radius),this.$outline.draw(this.path),this.transform()}setupListeners(t){let s=t.attr("data-n").split("-").reduce((o,a)=>o*+a,1),n=t.parent,r=t.children[0];this.$parent.events.listen(t,{down:()=>this.$parent.selection.add(this,!this.$parent.events.shiftKey),start:()=>{!this.isActive||(this.$parent.selection.add(this,!0),r.addClass("prime-move"),this.$container.append(t))},move:o=>{!this.isActive||(t.setTransform(this.posn.add(o.posn).subtract(o.startPosn)),this.setCollision(this.findCollision(o.posn)))},end:o=>{if(!!this.isActive)if(o.lastPosn.subtract(this.posn).length<=this.radius)t.setTransform(),r.removeClass("prime-move"),n.append(t);else if(this.collision)t.remove(),this.collision.add(s),this.add(-s),this.$parent.selection.add(this.collision,!0),this.$parent.change({changed:[this,this.collision]}),this.setCollision();else{t.remove();let a=new Er(`${s}`,this.$parent);a.setTransform(this.posn.add(o.lastPosn).subtract(o.startPosn)),this.add(-s),this.$parent.change({added:[a],changed:[this]})}}})}findCollision(t){for(let i of this.$parent.tiles.values())if(i!==this&&i.is("number-dot")&&d.distance(t,i.posn)<i.radius)return i}highlight(t=!0){this.$el.setClass("active",t)}move(t){super.move(t),!(this.$parent.selection.tiles.size>1)&&this.setCollision(this.findCollision(this.posn))}collide(t){t.highlight(!1),t.add(this.value);let i=this.lastSavedData?[this]:void 0;this.$parent.change({changed:[t],deleted:i}),this.delete()}reorder(){this.factors.push(this.factors.shift()),this.options=`>${this.factors.join("-")}`,this.buildTile()}shrink(){this.factors.length<=1||(this.factors.push(this.factors.pop()*this.factors.pop()),this.count=this.factors.length,this.options=`>${this.factors.join("-")}`,this.buildTile())}grow(){let t=this.factors.length-1-this.factors.slice(0).reverse().findIndex(n=>!_l(n));if(t<0||!this.factors[t])return;let i=bi(this.factors[t])[0],s=Math.round(this.factors[t]/i);this.factors.splice(t,1,i,s),this.count=this.factors.length,this.options=`>${this.factors.join("-")}`,this.buildTile()}static action(t,i){return E(this,null,function*(){if(t!=="grow"&&(i=i.filter(s=>s.factors.length>1)),!!i.length){if(t==="reorder")for(let s of i)s.reorder();else if(t==="shrink")for(let s of i)s.shrink();else if(t==="grow")for(let s of i)s.grow();i[0].$parent.change({changed:i})}})}static makeThumbnail(t,i){let s=u("svg",{width:54,height:54},i),n=r=>{s.removeChildren();let o=i1(r);for(let a=0;a<o.length;++a){let h=nu(o);ru(o,h,s)[0].css("transform",`translate(27px, 27px) scale(${25/h})`)}};i.onAttr("data-options",r=>n(Math.round(+r)))}};var Bt=50,Ji=[g.yellow,"#f15e19","#e1343b",g.red,"#8d2ca1","#4e53d0",g.blue,"#0595bf","#0ba27b",g.green,"#7dc410","#ebc000"];function Us(...e){if(!!H.isSafari){for(let t of e)t==null||t.css("transform-box","view-box");setTimeout(()=>{for(let t of e)t==null||t.css("transform-box","fill-box")})}}function i3(e,t){return e==="fraction"?`"1"/"${t}"`:e==="decimal"?`"${Ee(1/t,2)}"`:`"${Ee(1/t*100,1)}%"`}function Ta(e,t,i,s,n,r=1){let o=u("g",{class:"fraction"},n);if(e!=="fraction"&&t>12)return o;let a=t>20?12:t>16?14:18,h=u("g",{style:`font-size: ${a}px`,class:"equation"},o),l=new Ci(h,void 0,0,"",a,!0);l.setValue(i3(e,t));let c=l.root.width*r/2,p=l.root.height*r/2;return h.css("transform",`translate(${i-c}px, ${s-p}px)`+(r!==1?` scale(${r})`:"")),o}function s1(e,t,i,s,n,r,o,a,h,l=1){let c=u("rect",{x:e,y:t,width:i,height:s,fill:o,class:"polygon-tile"},r);return a?[c,Ta(h,n,e+i/2,t+s/2,r,l)]:[c]}var Nn=class extends V{constructor(t,i,s){super(i,s);this.type="fraction-bar";this.count=0;this.$parts=[];this.options=t;let[n,r,o]=t.split(":").map(a=>+a);this.denominator=n,this.tileWidth=10*Bt/n,this.$fraction=u("g",{},this.$el),this.$outline=u("path",{class:"outline"},this.$el),this.$handle=this.makeHandle("h",a=>this.setCount(Math.round((a.x+Bt/2)/this.tileWidth))),this.$dark=this.makeHandle("h",a=>this.setCount(this.count,Math.round((a.x+Bt/2)/this.tileWidth))),this.setCount(r,o!=null?o:r),this.setColour(Ji[(n-1)%Ji.length]),this.watchPolypadOptions(a=>this.draw(!a.noLabels,a.labelType))}setCount(t,i){t=k(t,1,40),i=k(i!=null?i:this.dark===this.count?t:this.dark,0,t),!(t===this.count&&i===this.dark)&&(this.count=t,this.dark=i,this.value=i/this.denominator,this.options=`${this.denominator}:${t}:${i}`,this.draw(!this.$parent.options.noLabels,this.$parent.options.labelType),this.path=new A(new d(-Bt/2,-Bt/2),t*this.tileWidth,Bt),this.$outline.draw(this.path),this.$handle.setTransform(new d(t*this.tileWidth-Bt/2,-Bt/2)),this.$dark.setTransform(new d(this.dark*this.tileWidth-Bt/2,Bt/2)),this.$dark.setAttr("d",`M0 0V20L${this.dark?-20:20} 0Z`),this.transform(),this.$parent.selection.update())}select(){super.select(),Us(...this.$parts.map(t=>t[1]))}deselect(){super.deselect(),Us(...this.$parts.map(t=>t[1]))}setColour(t){super.setColour(t);let i=_(t),s=q.mix("#fff",i,.8).hex;for(let[n,r]of this.$parts.entries())r[0].setAttr("fill",n<this.dark?i:s);this.$fraction.css("color",q.from(i).brightness<220?"#fff":"#000")}draw(t,i){this.$fraction.removeChildren(),this.$parts=[];let s=q.mix("#fff",this.colour,.8).hex;for(let n=0;n<this.count;n+=1){let r=n<this.dark?this.colour:s;this.$parts.push(s1(n*this.tileWidth-Bt/2,-Bt/2,this.tileWidth,Bt,this.denominator,this.$fraction,r,t,i))}this.customTransform(),Us(...this.$parts.map(n=>n[1]))}customTransform(){var t;for(let i of this.$parts)(t=i[1])==null||t.css("transform",`rotate(${-this.rot}deg)`)}static makeThumbnail(t,i,s){let[n,r]=t.split(":").map(l=>+l),o=u("svg",{width:222,height:24},i),a=Ji[n-1],h=220/n;s.options.watch(l=>{o.removeChildren();let c=!l.noLabels,p=l.labelType,m=p!=="fraction"&&n>10?.44:.5;for(let v=0;v<r;++v)s1(1+v*h,1,h,22,n,o,a,c,p,m)})}changeDenominator(t){for(let i=this.denominator+t;t>0?i<=24:i>=1;i+=t){let s=Math.round(this.count/this.denominator*i);if(!T(s,this.count/this.denominator*i))continue;let n=Math.round(this.dark/this.denominator*i);if(!!T(n,this.dark/this.denominator*i)){this.denominator=i,this.tileWidth=10*Bt/i,this.setCount(s,n),this.setColour(Ji[(i-1)%Ji.length]);return}}}getSnapPoints(){let t=[];for(let i=0;i<=this.count;i+=1)t.push(new d(i*this.tileWidth-Bt/2,-Bt/2)),t.push(new d(i*this.tileWidth-Bt/2,Bt/2));return t}split(){if(this.count===1)return[];let t=F(i=>{let s=this.posn.shift(i*this.tileWidth,0).rotate(this.rot*lt,this.posn),n=new Nn(`${this.denominator}:${1}`,this.$parent);return n.setTransform(s,this.rot),n.setColour(this.colour),n},this.count);return this.$parent.selection.select(t),this.delete(),t}static action(t,i){if(t==="split"){let s=[];for(let r of i)s.push(...r.split());let n=i.filter(r=>r.count>1);i[0].$parent.change({added:s,deleted:n})}else if(t==="expand"){for(let s of i)s.changeDenominator(1);i[0].$parent.change({changed:i})}else if(t==="reduce"){for(let s of i)s.changeDenominator(-1);i[0].$parent.change({changed:i})}else if(t==="merge"){let s=Array.from(i),n=Math.min(...s.map(l=>l.posn.x)),r=Math.min(...s.map(l=>l.posn.y)),o=s.map(l=>l.count),a=U(o),h=new Nn(`${s[0].denominator}:${a}`,s[0].$parent);h.setColour(q.mixMany(s.map(l=>q.from(l.colour)),o).hex),h.setTransform(new d(n,r),s[0].rot);for(let l of i)l.delete();s[0].$parent.selection.add(h),i[0].$parent.change({added:[h],deleted:i})}}};var ou=100,au=class extends V{constructor(t,i,s){super(i,s);this.type="fraction-circle";this.rotateAroundOrigin=!0;this.options=t;let n={class:"polygon-tile",path:this.path,fill:this.colour};this.$path=u("path",n,this.$el),this.$outline=u("path",{class:"outline",path:this.path},this.$el);let r=this.denominator=+t;if(this.value=1/r,r>1){let o=new d(0,-ou).rotate(-Math.PI/r),a=this.path=new Ps(C,o,2*Math.PI/r);this.snapAngles=[0,Ms(o)*wt,Ms(a.end)*wt]}else this.path=new Z(C,ou);this.$path.draw(this.path),this.$outline.draw(this.path),this.watchPolypadOptions(o=>this.draw(!o.noLabels,o.labelType)),r===1&&this.setOrder("back"),this.setColour(Ji[r-1]),this.$path.setAttr("fill",this.colour)}draw(t,i){var n;if((n=this.$label)==null||n.remove(),this.denominator===1||!t)return;let s=2-ou/2-(this.denominator-2)*3;this.$label=Ta(i,this.denominator,0,s,this.$el),this.customTransform(),Us(this.$label)}customTransform(){var t;(t=this.$label)==null||t.css("transform",`rotate(${-this.rot}deg)`)}select(){super.select(),Us(this.$label)}deselect(){super.deselect(),Us(this.$label)}setColour(t){super.setColour(t),this.$path.setAttr("fill",_(t)),this.$el.css("color",q.from(_(t)).brightness<220?"#fff":"#000")}static makeThumbnail(t,i,s){let n=+t,r=u("svg",{width:80,height:44},i),o=u("path",{class:"polygon-tile"},r),a=new d(40,2).rotate(-Math.PI/n,new d(40,42)),h=n>1?new Ps(new d(40,42),a,2*Math.PI/n):new Z(new d(40,22),20);if(o.draw(h),o.setAttr("fill",Ji[n-1]),n===1)return;let l;s.options.watch(c=>{l==null||l.remove();let p=!c.noLabels,m=c.labelType,v=26-(m==="fraction"?1.2:1.4)*n;p&&(l=Ta(m,n,40,v,r,.6-n/80))})}};var Ei=25;function hu(e,t,i,s,n){return new O(new d(-n,-n),new d(-n,e),new d(n,e),new d(n,-n),new d(t,-n),new d(t,n),new d(n,n),new d(n,i),new d(-n,i),new d(-n,n),new d(s,n),new d(s,-n))}var lu=class extends V{constructor(t,i,s){super(i,s);this.type="grid";this.showSelectionOutline=!0;this.canDragToSelect=!1;this.options=t,this.dimensions=new d,this.$axes=F(()=>u("line",{class:"grid-axis",stroke:"#777"},this.$el),2),this.$fill=u("path",{fill:"transparent"},this.$el),this.$handles=[0,1].map(r=>this.makeHandle("c",o=>{let a=r?this.dimensions.x:Math.round(o.x/Ei-1),h=r?Math.round(o.y/Ei-1):this.dimensions.y;this.setDimensions(a,h)})),this.$handles[1].css("cursor","ns-resize");let n=t.split(":");this.setDimensions(+n[0],+n[1])}setDimensions(t,i){t=k(t,1,100),i=k(i,1,100),!(t===this.dimensions.x&&i===this.dimensions.y)&&(this.dimensions=new d(t,i),this.options=`${t}:${i}`,this.path=hu(-1.5,t+1,i+1,-1.5,.5).scale(Ei),this.$axes[0].setLine({x:-1.5*Ei,y:0},{x:(t+1)*Ei,y:0}),this.$axes[1].setLine({x:0,y:-1.5*Ei},{x:0,y:(i+1)*Ei}),this.$handles[0].setCenter({x:(t+1)*Ei,y:0}),this.$handles[1].setCenter({x:0,y:(i+1)*Ei}),this.$fill.draw(this.path),this.transform(),this.$parent.selection.update())}setColour(t){this.colour=t;for(let i of this.$axes)i.setAttr("stroke",_(t))}static makeThumbnail(t,i){let s=u("svg",{width:80,height:80},i);u("line",{x1:20,y1:0,x2:20,y2:80,stroke:"white","stroke-width":2},s),u("line",{x1:0,y1:20,x2:80,y2:20,stroke:"white","stroke-width":2},s)}};var ts=new Map,Ar="";function cu(e){var s,n,r;if(e.value!==void 0)return["",e.value,0,e.value,0];if(e.is("algebra-tile")){let o=e.options.startsWith("-")?-1:1,a=o<0?e.options.slice(1):e.options,h=(s=ts.get("x"))!=null?s:5,l=(n=ts.get("y"))!=null?n:4;switch(a){case"1":return["",o,0,o,0];case"x":return["x",o,0,o*h,h];case"x2":return["x",0,o,o*h*h,h];case"y":return["y",o,0,o*l,l];case"y2":return["y",0,o,o*l*l,l];case"xy":return["x",o*l,0,o*l*h,h]}}let t=btoa(e.type+e.options+e.colour).replace(/=/g,""),i=(r=ts.get(t))!=null?r:1;return[t,1,0,i,i]}function s3(e,t){let i={},s=0,n=(p,m=1)=>{let[v,M,f,b,$]=cu(p);s+=m*b,!!v&&(i[v]||(i[v]=[0,0,0]),i[v][0]+=m*M,i[v][1]+=m*f,i[v][2]=$)};for(let p of e)n(p,1);for(let p of t)n(p,-1);if(T(s,0))return;let r=Object.keys(i).filter(p=>i[p][0]||i[p][1]),o=r.filter(p=>!ts.has(p))[0]||G(r);if(!o)return!0;let[a,h,l]=i[o],c=T(h,0)?l-s/a:Math.max(...Rl(h,a,s-a*l-h*l*l));ts.set(o,c),Ar=Array.from(ts.entries()).map(p=>p.join("=")).join(",")}function n3(e){if(e!==Ar){Ar=e,ts.clear();for(let t of e.split(",")){let[i,s]=t.split("=");i&&ts.set(i,+s||0)}}}var Ea="M120,0C120,16,66.3,20,0,20S-120,16-120,0Z",n1="M0,26A18.1,18.1,0,0,0-18,44V72H18V44A18.1,18.1,0,0,0,0,26Z",r1=["text","grid","number-line","spinner","decimal-grid","axes","custom-spinner","ruler","protractor","compass","geo","dot-machine","abacus"],Aa=new A(new d(0,-180),240,180),js=15;function o1(e,t){var s;let i=e.posn.shift(0,t);e.$el.setTransform(i,e.rot*lt),e.transformed=(s=e.path)==null?void 0:s.rotate(e.rot).translate(i)}var uu=class extends V{constructor(t,i,s){super(i,s);this.type="balance";this.canRotate=!1;this.canDragToSelect=!1;this.level=0;this.left=[];this.right=[];this.isAnimating=!1;let[n,r]=t.split(":");this.level=+n||0,this.options=`${this.level}:${Ar}`,t&&n3(r||""),this.$beam=u("path",{class:"balance-beam"},this.$el),this.$left=u("path",{d:Ea,class:"balance"},this.$el),this.$right=u("path",{d:Ea,class:"balance"},this.$el),this.$base=u("path",{d:n1,class:"balance"},this.$el),this.setColour("#bbb"),this.customTransform(),this.draw();let o=u("path",{path:Aa,class:"balance-target"},this.$el),a=u("path",{path:Aa,class:"balance-target"},this.$el);this.onMoveStart=()=>{if(!Xf(i.selection.tiles,h=>r1.includes(h.type))){o.setTransform({x:-280,y:this.level*js}),a.setTransform({x:40,y:-this.level*js});for(let h of[o,a])h.show()}},this.onMoveEnd=()=>{for(let h of[o,a])h.hide()},this.onChange=h=>{h.action==="change"&&(this.checkTileOverlaps(),this.rebalance(400,h))},i.on("move-start",this.onMoveStart),i.on("move-end",this.onMoveEnd),setTimeout(()=>{this.checkTileOverlaps(),i.on("change",this.onChange)})}delete(){this.$parent.off("move-start",this.onMoveStart),this.$parent.off("move-end",this.onMoveEnd),this.$parent.off("change",this.onChange),super.delete()}checkTileOverlaps(){let t=Aa.translate(this.posn).shift(-280,this.level*js),i=Aa.translate(this.posn).shift(40,-this.level*js);this.left=[],this.right=[];for(let s of this.$parent.tiles.values())!s.transformed||s.type==="balance"||r1.includes(s.type)||(dr(t,s.transformed)?this.left.push(s):dr(i,s.transformed)&&this.right.push(s))}draw(t=this.level){let i=new d(-160,t*15),s=new d(160,-t*15);this.$beam.draw(new Es(i.shift(0,10),i.shift(0,44),s.shift(0,44),s.shift(0,10))),this.$left.setTransform(i),this.$right.setTransform(s)}rebalance(t=400,i){return E(this,null,function*(){let s=U(this.left.map(h=>cu(h)[3])),n=U(this.right.map(h=>cu(h)[3])),r=T(s,n)?0:s<n?-1:1;if(r===this.level||this.isAnimating)return;let o=this.level,a=(r-o)*js;this.level=r;for(let h of this.left)h.setTransform(h.posn.shift(0,a));for(let h of this.right)h.setTransform(h.posn.shift(0,-a));if(i==null?void 0:i.data){let h=i.data.changed=i.data.changed||[],l=[...i.data.added||[],...i.data.deleted||[]];for(let c of[this,...this.left,...this.right])!h.includes(c)&&!l.includes(c)&&h.push(c)}this.options=`${r}:${Ar}`,this.isAnimating=!0,yield ot(h=>{this.draw(vt(o,r,h));for(let l of this.left)o1(l,(h-1)*a);for(let l of this.right)o1(l,(1-h)*a);this.$parent.selection.update()},t).promise,this.isAnimating=!1,this.transform(),this.$parent.selection.update()})}customTransform(){let t=this.level*js;this.path=new O(new d(-280,t),new d(-40,t),new d(-40,25),new d(40,25),new d(40,-t),new d(280,-t),new d(280,-t+48),new d(40,-t+48),new d(40,72),new d(-40,72),new d(-40,t+48),new d(-280,t+48))}getSnapPoints(){return[]}getSnapLines(){let t=this.level*js;return[new rt(new d(-280,t),new d(-40,t)),new rt(new d(40,-t),new d(280,-t))]}setColour(t){this.colour=t,this.$beam.css("stroke",t);for(let i of[this.$base,this.$left,this.$right])i.css("fill",_(t))}static makeThumbnail(t,i){let s=u("svg",{width:250,height:50,viewBox:"-290 -10 580 82",class:"scale"},i);u("path",{d:"M-160 10v34h320v-34",fill:"transparent",stroke:"#bbb","stroke-width":10},s),u("path",{d:Ea,transform:"translate(-160 0)",fill:"#bbb"},s),u("path",{d:Ea,transform:"translate(160 0)",fill:"#bbb"},s),u("path",{d:n1,fill:"#bbb"},s)}static action(t,i){return E(this,null,function*(){let s=i[0];if(t!=="balance"||i.length!==1||!s.level)return;if(s3(s.left,s.right))return aa("balance-error");let r=new Set;for(let o of s.$parent.tiles.values())if(!!o.is("balance")){o.rebalance();for(let a of[o,...o.left,...o.right])r.add(a)}i[0].$parent.change({changed:Array.from(r)})})}};var du={circle:"M -25 0a25,25 0 1 0 50 0a25 25 0 1 0 -50 0",square:"M0 -25L25 0L0 25L-25 0Z",cross:"M25 -9L9 -9L9 -25L-9 -25L-9 -9L-25 -9L-25 9L-9 9L-9 25L9 25L9 9L25 9L25 -9Z",weight:"M24.3,22.1,17.7-6.1A4,4,0,0,0,14-9H8a10.3,10.3,0,0,0,2-6A10,10,0,0,0,0-25,10,10,0,0,0-10-15,10.3,10.3,0,0,0-8-9h-6a4,4,0,0,0-3.7,2.9l-6.6,28.2A2.2,2.2,0,0,0-22,25H22A2.2,2.2,0,0,0,24.3,22.1ZM0-11a4,4,0,0,1-4-4,4,4,0,0,1,4-4,4,4,0,0,1,4,4A4,4,0,0,1,0-11Z",star:"M0 15.7L15.5 23.8L12.5 6.6L25 -5.6L7.7 -8.1L0 -23.8L-7.7 -8.1L-25 -5.6L-12.5 6.6L-15.5 23.8L0 15.7Z",heart:"M3.4,20.8a4.9,4.9,0,0,1-6.7-.1l-.3-.2C-16.7,8.6-25.3.8-25-8.9a13.7,13.7,0,0,1,5.9-10.7A14.4,14.4,0,0,1,0-16.8a14.4,14.4,0,0,1,19.1-2.8A13.7,13.7,0,0,1,25-8.9C25.3.8,16.7,8.6,3.6,20.5Z"},r3={weight:"M24.3,22.1,17.7-6.1A4,4,0,0,0,14-9H8a10.3,10.3,0,0,0,2-6A10,10,0,0,0,0-25,10,10,0,0,0-10-15,10.3,10.3,0,0,0-8-9h-6a4,4,0,0,0-3.7,2.9l-6.6,28.2A2.2,2.2,0,0,0-22,25H22A2.2,2.2,0,0,0,24.3,22.1Z"},a1={circle:g.orange,square:g.purple,cross:g.green,weight:g.blue,star:g.yellow,heart:g.red},pu=class extends j{constructor(t,i,s){super("square",i,s);this.type="token";this.options=t,this.$path.setAttr("d",du[t]),this.$outline.setAttr("d",r3[t]||du[t]),this.setColour(a1[t])}static makeThumbnail(t,i){let s=u("svg",{width:36,height:36},i),n=u("path",{d:du[t],class:"polygon-tile"},s);n.setTransform({x:18,y:18},0,.6),n.setAttr("fill",a1[t])}};var we=19,Vr=[[],[[0,0]],[[-.9,-.9],[.9,.9]],[[-1,-1],[0,0],[1,1]],[[-.9,-.9],[.9,-.9],[.9,.9],[-.9,.9]],[[-1,-1],[1,-1],[1,1],[-1,1],[0,0]],[[-.9,-1.1],[-.9,0],[-.9,1.1],[.9,-1.1],[.9,0],[.9,1.1]],[[0,-1.2],[0,0],[0,1.2],[1,-.6],[1,.6],[-1,-.6],[-1,.6]],[[0,-1.1],[0,1.1],[-1.1,-1.1],[-1.1,0],[-1.1,1.1],[1.1,-1.1],[1.1,0],[1.1,1.1]],[[0,-1.1],[0,0],[0,1.1],[-1.1,-1.1],[-1.1,0],[-1.1,1.1],[1.1,-1.1],[1.1,0],[1.1,1.1]]],o3=new A(new d(-we,-we),2*we,2*we),Va=[[0,0],[0,Math.PI/2],[Math.PI/2,0],[-Math.PI/2,0],[0,-Math.PI/2],[Math.PI,0]],fu=["#656073",g.teal,g.blue,g.purple,g.red,g.orange,g.yellow,g.lime,g.green,g.teal],Fe=class extends V{constructor(t,i,s){super(i,s);this.type="dice";this.isAnimating=!1;this.options=t;let[n,r]=t.split(":");this.faces=r||"1,2,3,4,5,6";let o=this.faces.split(",").map(a=>{let h=new ve(o3,{class:"dice-face",fill:fu[+a],stroke:fu[+a]}),l=Vr[+a].map(c=>new ve(new Z(new d(c[0]*we/2,c[1]*we/2),4),{class:"dice-dot"}));for(let c of l)c.transform.translate(0,0,2);return new Le([h,...l])});o[0].transform.translate(0,0,we),o[1].transform.translate(-we,0,0).rotate(0,-Math.PI/2),o[2].transform.translate(0,we,0).rotate(-Math.PI/2,0),o[3].transform.translate(0,-we,0).rotate(Math.PI/2,0),o[4].transform.translate(we,0,0).rotate(0,Math.PI/2),o[5].transform.translate(0,0,-we).rotate(0,Math.PI),this.die=new Le(o,{},this.$el),this.die.sorting=!0,this.setValue(+n||Zt.integer(1,6)),this.path=new A(new d(-25,-25),50,50),this.$outline=u("path",{class:"outline",path:this.path},this.$el)}setColour(t){this.colour=t==="#000"||t==="#000000"?"":t.slice(0,7);for(let i of this.die.children)i.children[0].color=_(this.colour);this.die.render()}setValue(t){this.value!==t&&(this.value=t,this.options=`${t}:${this.faces}`,this.die.transform.clear().rotate(...Va[t-1]),this.die.render())}roll(t=2e3){return E(this,null,function*(){if(this.isAnimating)return;this.isAnimating=!0,this.$parent.playSound("roll");let i=Zt.integer(1,6),s=Va[this.value-1],n=4*Math.PI+Va[i-1][0]-s[0],r=4*Math.PI+Va[i-1][1]-s[1];yield ot(o=>{let a=mt("sine",o);this.die.transform.clear().translate(0,0,4*a*(1-a)*we/2).rotate(s[0]+a*n,s[1]+a*r),this.die.render()},t).promise,this.setValue(i),this.isAnimating=!1})}static makeThumbnail(t,i){if(i.data.thumb==="net"){let s=u("svg",{width:58,height:76},i),n=t.split(":")[1].split(",").map(a=>+a),r=i.data.colour,o=[new d(20,2),new d(20,20),new d(20,38),new d(20,56),new d(2,20),new d(38,20)];for(let[a,h]of o.entries()){let l=r||fu[+n[a]];u("path",{path:new A(h,18,18),class:"polygon-tile",fill:l},s);for(let c of Vr[n[a]])u("circle",{cx:h.x+9+c[0]*4.5,cy:h.y+9+c[1]*4.5,r:1.8,class:"dice-dot"},s)}}else{let s=u("svg",{width:60,height:60},i);u("rect",{x:6,y:6,width:48,height:48,rx:3,class:"polygon-tile",fill:g.orange},s);for(let n of Vr[5])u("circle",{cx:30+n[0]*12,cy:30+n[1]*12,r:5,class:"dice-dot"},s)}}doubleClick(){Fe.action("roll",[this])}static action(t,i){return E(this,null,function*(){t==="roll"&&(i[0].$parent.selection.clear(),yield Promise.all(i.map(s=>s.roll())),i[0].$parent.selection.tiles.size||i[0].$parent.selection.select(i),i[0].$parent.change({changed:i}))})}};var a3={1:"M-1.92 3.18V2.24H-0.5V-1.94H-1.67V-2.66C-1.15-2.74-0.65-2.92-0.2-3.18H0.66V2.24H1.91V3.18Z",2:"M-2.13 3.24V2.57C-1.04 1.37 0.53 0.37 0.75-1.23 0.78-2.65-0.89-2.56-1.53-1.62L-2.18-2.26C-1.23-3.5 1.07-3.69 1.72-2.09 2.36-0.32 0.62 1.1-0.44 2.33 0.43 2.26 1.3 2.24 2.18 2.26V3.24Z",3:"M-0.04 3.3C-0.86 3.34-1.65 3.01-2.2 2.4L-1.65 1.66C0.56 3.88 2.73 0.26-0.84 0.32V-0.52C2.13-0.44 0.64-3.74-1.4-1.79L-1.99-2.5C-1-3.49 1.1-3.71 1.83-2.34 2.03-1.92 2.04-1.45 1.85-1.03 1.67-0.61 1.31-0.29 0.87-0.16V-0.12C3.22 0.57 2.17 3.46-0.04 3.3Z",4:"M0.46 3.18V1.54H-2.34V0.76L0.18-3.18H1.55V0.65H2.35V1.54H1.55V3.18ZM-1.21 0.65H0.46C0.47-0.13 0.45-1.34 0.51-2.11H0.47C0.31-1.77 0.14-1.46-0.05-1.12Z",5:"M-0.03 3.24C-0.84 3.26-1.63 2.94-2.2 2.36L-1.67 1.62C-0.91 2.53 1.08 2.63 1.05 1.08 1.11-0.14-0.33-0.42-1.14 0.25L-1.69-0.1-1.5-3.24H1.9V-2.27H-0.5L-0.63-0.73C2.69-2.07 3.34 3.22-0.03 3.24Z",6:"M-0.78 3.3C-3.49 3.25-3.6-0.85-2.32-2.48-1.9-2.98-1.28-3.28-0.63-3.3 0.03-3.32 0.66-3.06 1.11-2.58L0.49-1.88C-0.96-3.24-2.1-1.59-2.02-0.01-1.71-0.43-1.23-0.7-0.72-0.75-0.2-0.8 0.32-0.63 0.71-0.28 1.85 0.94 1.02 3.38-0.78 3.3ZM-0.8 2.42C0.17 2.46 0.41 0.95-0.11 0.36-0.41 0.13-0.79 0.04-1.16 0.13-1.52 0.22-1.83 0.47-1.99 0.81-1.88 1.7-1.63 2.37-0.8 2.42ZM2.38 3.3C1.97 3.27 1.64 2.93 1.64 2.52 1.64 2.1 1.97 1.76 2.38 1.74 3.35 1.7 3.35 3.33 2.38 3.3Z",7:"M-0.89 3.18C-0.9 1.24-0.28-0.65 0.87-2.21H-2.13V-3.18H2.13V-2.48C0.84-0.89 0.17 1.13 0.28 3.18Z",8:"M0.01 3.3C-2.15 3.38-3.04 0.92-1.01-0.08V-0.12C-1.71-0.52-2.04-1.36-1.79-2.14-1.54-2.91-0.77-3.4 0.03-3.3 0.83-3.37 1.57-2.88 1.82-2.12 2.06-1.36 1.75-0.53 1.05-0.12V-0.08C3.03 0.9 2.12 3.43 0.01 3.3ZM0.03 2.48C0.38 2.52 0.72 2.36 0.91 2.06 1.11 1.77 1.13 1.39 0.96 1.08 0.57 0.68 0.08 0.38-0.46 0.24-1.49 0.87-1.34 2.51 0.02 2.48ZM0.43-0.41C1.17-1 1.18-2.49 0.02-2.48-0.3-2.49-0.59-2.33-0.75-2.06-0.9-1.79-0.91-1.46-0.75-1.19-0.46-0.81-0.04-0.54 0.42-0.41Z",9:"M-1.33 3.3C-1.97 3.31-2.59 3.05-3.03 2.58L-2.41 1.88C-0.96 3.23 0.2 1.59 0.11 0.01-0.27 0.53-0.9 0.81-1.55 0.74-2.19 0.66-2.74 0.25-2.99-0.35-3.27-0.99-3.21-1.72-2.84-2.31-2.46-2.9-1.83-3.27-1.13-3.3 2.17-3.26 1.88 3.36-1.33 3.3ZM-1.06-0.08C-0.58-0.12-0.15-0.39 0.08-0.82 0.07-1.94-0.89-2.96-1.79-2.11-2.32-1.48-2.12 0.01-1.06-0.08ZM2.41 3.3C2 3.28 1.67 2.94 1.67 2.52 1.67 2.11 2 1.76 2.41 1.74 3.38 1.71 3.38 3.33 2.41 3.3Z",10:"M-4.48 3.18V2.24H-3.06V-1.94H-4.23V-2.66C-3.71-2.74-3.21-2.92-2.76-3.18H-1.9V2.24H-0.65V3.18ZM2.27 3.3C-0.66 3.38-0.69-3.4 2.27-3.3 5.23-3.39 5.2 3.38 2.27 3.3ZM2.27 2.4C3.71 2.54 3.74-2.56 2.27-2.4 0.8-2.56 0.83 2.53 2.27 2.4Z",11:"M-4.38 3.18V2.24H-2.96V-1.94H-4.13V-2.66C-3.61-2.74-3.11-2.92-2.66-3.18H-1.8V2.24H-0.55V3.18ZM0.55 3.18V2.24H1.97V-1.94H0.8V-2.66C1.32-2.74 1.82-2.92 2.27-3.18H3.13V2.24H4.38V3.18Z",12:"M-4.43 3.24V2.3H-3.01V-1.88H-4.18V-2.6C-3.67-2.68-3.17-2.86-2.71-3.12H-1.85V2.3H-0.6V3.24ZM0.13 3.24V2.57C1.22 1.37 2.79 0.37 3.01-1.23 3.04-2.65 1.37-2.56 0.73-1.62L0.09-2.26C1.03-3.5 3.33-3.69 3.98-2.09 4.62-0.32 2.88 1.1 1.82 2.33 2.69 2.26 3.56 2.24 4.43 2.26V3.24Z",13:"M-4.41 3.18V2.24H-2.99V-1.94H-4.16V-2.66C-3.65-2.74-3.15-2.92-2.69-3.18H-1.83V2.24H-0.58V3.18ZM2.18 3.3C1.36 3.34 0.57 3.01 0.02 2.4L0.57 1.66C2.78 3.88 4.94 0.26 1.38 0.32V-0.52C4.34-0.44 2.86-3.74 0.82-1.79L0.23-2.5C1.21-3.49 3.31-3.71 4.04-2.34 4.24-1.92 4.25-1.45 4.07-1.03 3.88-0.61 3.53-0.29 3.09-0.16V-0.12C5.43 0.57 4.38 3.46 2.18 3.3Z",14:"M-4.53 3.18V2.24H-3.11V-1.94H-4.28V-2.66C-3.76-2.74-3.26-2.92-2.81-3.18H-1.95V2.24H-0.7V3.18ZM2.65 3.18V1.54H-0.16V0.76L2.36-3.18H3.73V0.65H4.53V1.54H3.73V3.18ZM0.98 0.65H2.65C2.65-0.13 2.64-1.34 2.7-2.11H2.66C2.5-1.77 2.32-1.46 2.14-1.12Z",15:"M-4.41 3.12V2.18H-2.99V-2H-4.16V-2.72C-3.65-2.8-3.15-2.98-2.69-3.24H-1.83V2.18H-0.58V3.12ZM2.19 3.24C1.37 3.26 0.59 2.94 0.02 2.36L0.55 1.62C1.3 2.53 3.29 2.63 3.27 1.08 3.33-0.14 1.88-0.42 1.07 0.25L0.52-0.1 0.71-3.24H4.11V-2.27H1.72L1.59-0.73C4.9-2.06 5.56 3.22 2.18 3.24Z",16:"M-4.47 3.18V2.24H-3.05V-1.94H-4.22V-2.66C-3.71-2.74-3.21-2.92-2.75-3.18H-1.89V2.24H-0.64V3.18ZM2.46 3.3C-0.24 3.25-0.35-0.85 0.92-2.48 1.34-2.98 1.96-3.28 2.61-3.3 3.27-3.32 3.9-3.06 4.35-2.58L3.73-1.88C2.29-3.24 1.14-1.59 1.22-0.01 1.54-0.43 2.01-0.7 2.53-0.75 3.05-0.8 3.56-0.63 3.95-0.28 5.09 0.94 4.26 3.39 2.46 3.3ZM2.44 2.42C3.41 2.46 3.65 0.95 3.13 0.36 2.84 0.13 2.45 0.04 2.09 0.13 1.72 0.22 1.41 0.47 1.25 0.81 1.36 1.7 1.61 2.37 2.45 2.42Z",17:"M-4.45 3.18V2.24H-3.03V-1.94H-4.2V-2.66C-3.68-2.74-3.18-2.92-2.73-3.18H-1.87V2.24H-0.62V3.18ZM1.42 3.18C1.42 1.24 2.04-0.65 3.19-2.21H0.18V-3.18H4.45V-2.48C3.15-0.89 2.49 1.13 2.59 3.18Z",18:"M-4.45 3.18V2.24H-3.03V-1.94H-4.2V-2.66C-3.68-2.74-3.18-2.92-2.73-3.18H-1.87V2.24H-0.62V3.18ZM2.31 3.3C0.16 3.38-0.74 0.92 1.3-0.08V-0.12C0.59-0.52 0.26-1.36 0.51-2.14 0.77-2.91 1.53-3.4 2.34-3.3 3.14-3.37 3.88-2.88 4.12-2.12 4.37-1.36 4.05-0.53 3.36-0.12V-0.08C5.33 0.9 4.42 3.43 2.31 3.3ZM2.33 2.48C2.68 2.52 3.02 2.36 3.22 2.06 3.41 1.77 3.43 1.39 3.26 1.08 2.88 0.68 2.39 0.38 1.85 0.24 0.82 0.87 0.96 2.51 2.33 2.48ZM2.73-0.41C3.47-1 3.48-2.49 2.32-2.48 2.01-2.49 1.72-2.33 1.56-2.06 1.4-1.79 1.39-1.46 1.55-1.19 1.85-0.81 2.26-0.54 2.73-0.41Z",19:"M-4.45 3.18V2.24H-3.03V-1.94H-4.2V-2.66C-3.68-2.74-3.18-2.92-2.73-3.18H-1.87V2.24H-0.62V3.18ZM1.91 3.3C1.27 3.31 0.65 3.05 0.21 2.58L0.83 1.88C2.28 3.23 3.44 1.59 3.35 0.01 2.97 0.53 2.33 0.81 1.69 0.74 1.05 0.66 0.5 0.25 0.24-0.35-0.03-0.99 0.03-1.73 0.4-2.31 0.77-2.9 1.41-3.27 2.11-3.3 5.4-3.26 5.12 3.36 1.91 3.3ZM2.18-0.08C2.66-0.12 3.09-0.39 3.32-0.82 3.3-1.94 2.35-2.96 1.45-2.11 0.91-1.48 1.12 0.01 2.18-0.08Z",20:"M-4.63 3.18V2.51C-3.54 1.31-1.98 0.31-1.75-1.29-1.73-2.71-3.4-2.62-4.04-1.68L-4.68-2.32C-3.74-3.56-1.44-3.75-0.79-2.15-0.15-0.38-1.88 1.04-2.95 2.27-2.08 2.2-1.21 2.18-0.33 2.2V3.18ZM2.48 3.3C-0.45 3.38-0.48-3.4 2.48-3.3 5.43-3.39 5.4 3.38 2.48 3.3ZM2.48 2.4C3.92 2.54 3.95-2.56 2.48-2.4 1.01-2.56 1.03 2.53 2.48 2.4Z"},mu=40,gu={4:{net:pa,meshScale:.9,numberScale:.08,colour:g.red,thumbnailY:8,renderOptions:{fov:180,hideBackface:!0}},6:{net:fa,meshScale:.744,numberScale:.1,colour:g.yellow,renderOptions:{fov:120,hideBackface:!0}},8:{net:ma,meshScale:.85,numberScale:.07,colour:g.green,thumbnailY:3,renderOptions:{fov:180,hideBackface:!0}},12:{net:ga,meshScale:.6,numberScale:.1,colour:g.blue,renderOptions:{fov:!1,hideBackface:!0}},20:{net:va,meshScale:.6,numberScale:.06,colour:g.purple,renderOptions:{fov:!1,hideBackface:!0}}};function h1(e,t){let i=gu[e],s=[],n=vr(i.net,o=>{let a=new ve(o.shape,{class:"polygon-tile",style:"stroke-width: 0.5"});a.color=_(i.colour),s.push(a);let h=new ve(a3[s.length],{class:"dice-dot"});return h.transform.scale(W.all(i.numberScale)),new Le([a,h])}).group,r=n.children[0].children.map(o=>{let a=o.getTransformed(W.zero).fixFloat(),h=0;(a.x!==0||a.z!==0)&&(h=Math.atan2(a.z,a.x)-Math.PI/2);let l=a.transform(st.rotateY(h)),c=0;(l.y!==0||l.z!==0)&&(c=Math.atan2(l.y,l.z));let p=St.product(st.rotateX(c),st.rotateY(h)),m=o.getTransformed(new W(1,0,0)).transform(p).fixFloat().xy,v=Math.atan2(-m.y,m.x);return new W(c,h,v)});return t.append(n.$el),{die:n,faces:s,rotationOptions:r}}var vu=class extends V{constructor(t,i,s){super(i,s);this.type="polyhedral-dice";this.isAnimating=!1;this.options=t;let[n,r]=t.split(":").map(h=>+h);n=n||0,n>=r&&(n=0),this.faceCount=r,this.definition=gu[r];let o=h1(r,this.$el);this.faces=o.faces,this.die=o.die,this.rotationOptions=o.rotationOptions,this.setValue(+n||Zt.integer(1,r));let a=this.die.getProjectedVertices(this.definition.renderOptions);this.path=O.convexHull(...a),this.$outline=u("path",{class:"outline",path:this.path},this.$el)}setColour(t){super.setColour(t);for(let i of this.faces)i.color=_(this.colour);this.die.render(this.definition.renderOptions)}setValue(t){if(this.value===t)return;this.value=t,this.options=`${t}:${this.faceCount}`;let i=this.rotationOptions[this.value-1];this.die.transform.matrix=St.product(st.rotateZ(i.z),st.rotateX(i.x),st.rotateY(i.y),st.scaleAll(this.definition.meshScale*mu)),this.die.render(this.definition.renderOptions)}roll(t=2e3){return E(this,null,function*(){if(this.isAnimating)return;this.isAnimating=!0,this.$parent.playSound("roll");let i=Math.floor(Math.random()*this.faceCount),s=this.rotationOptions[this.value-1],n=this.rotationOptions[i];yield ot(r=>{r=mt("sine",r),this.die.transform.matrix=St.product(st.translate(new W(0,0,4*r*(1-r)*mu/2)),st.rotateZ(s.z+(n.z-s.z)*r),st.rotateX(s.x+(n.x-s.x+4*Math.PI)*r),st.rotateY(s.y+(n.y-s.y+4*Math.PI)*r),st.scaleAll(this.definition.meshScale*mu)),this.die.render(this.definition.renderOptions)},t).promise,this.setValue(i+1),this.isAnimating=!1})}doubleClick(){Fe.action("roll",[this])}static makeThumbnail(t,i){let s=+t.split(":")[1],n=gu[s],r=u("svg",{width:70,height:70},i),o=u("g",{transform:`translate(35, ${35+(n.thumbnailY||0)})`},r),a=h1(s,o),h=a.rotationOptions[a.rotationOptions.length-1];a.die.transform.matrix=St.product(st.rotateZ(h.z),st.rotateX(h.x),st.rotateY(h.y),st.scaleAll(n.meshScale*32)),a.die.render()}};var h3="M0 7.4L8.6 12L7 2.4L13.9 -4.4L4.3 -5.8L0 -14.5L-4.3 -5.8L-13.9 -4.4L-7 2.4L-8.6 12L0 7.4",l1="M12.9,9.7C13.9,3,4,5.3,4,1.2H4C9.4-3.7,7.6-14,.1-14.3S-9.3-3.9-4,1.3c-.1,3.8-9.8,1.9-8.9,8.4h0C-5.5,13.2,5.2,13.2,12.9,9.7Z",c1=23,l3=[g.red,g.blue],c3=[h3,l1],wu=class extends V{constructor(t,i,s){super(i,s);this.type="coin";this.isAnimating=!1;let n=new Z(C,c1),r=l3.map((o,a)=>{let h=new ve(n,{class:"dice-face",fill:o,stroke:o}),l=new ve(c3[a],{class:"dice-dot"});return l.transform.translate(0,0,1),new Le([h,l])});r[0].transform.translate(0,0,.5),r[1].transform.rotate(Math.PI,0,0).translate(0,0,-.5),this.coin=new Le(r,{},this.$el),this.coin.sorting=!0,this.setValue(t?+t:Zt.integer(0,1)),this.path=new Z(C,25),this.$outline=u("path",{class:"outline",path:this.path},this.$el)}setValue(t){this.value!==t&&(this.value=t,this.options=""+t,this.coin.transform.clear().rotate(t?Math.PI:0,0,0),this.coin.render())}setColour(t){this.colour=t.slice(0,7)}roll(t=2e3){return E(this,null,function*(){if(this.isAnimating)return;this.isAnimating=!0,this.$parent.playSound("coinToss");let i=Zt.integer(0,1),s=this.value?Math.PI:0,n=6*Math.PI+(i?Math.PI:0)-s;yield ot(r=>{let o=mt("sine",r);this.coin.transform.clear().translate(0,0,4*o*(1-o)*c1).rotate(s+o*n,.4*Math.sin(o*8*Math.PI),0),this.coin.render()},t).promise,this.setValue(i),this.isAnimating=!1})}doubleClick(){Fe.action("roll",[this])}static makeThumbnail(t,i){let s=u("svg",{width:60,height:60},i);u("circle",{cx:30,cy:30,r:28,class:"polygon-tile",fill:g.blue},s),u("path",{d:l1,class:"dice-dot"},s).setTransform({x:30,y:30},0,1.2)}};var yu=75,kr=2*Math.PI,Lr=Math.PI/2,ka="M9.8-39.1,0-63-9.8-39.1-3-43V60a2.9,2.9,0,0,0,3,3,2.9,2.9,0,0,0,3-3V-43Z";function Or(e,t,i,s=yu,n=C){let r=i?q.shades(i,t.length):q.rainbow(t.length);e.removeChildren();for(let[o,a]of t.entries()){let h=t[o+1]?t[o+1]-a:kr-a+t[0],l=new Ps(n,d.fromPolar(a-Lr,s).add(n),h),c=r[o];u("path",{path:l,class:"polygon-tile",fill:c},e)}}var Ir=class extends V{constructor(t,i,s){super(i,s);this.type="spinner";this.angle=0;this.isAnimating=!1;this.path=new Z(C,yu),this.$sectors=u("g",{},this.$el),this.$arrow=u("path",{d:ka,class:"spinner"},this.$el),this.$outline=u("path",{class:"outline",path:this.path},this.$el),this.setupHandles(),u("circle",{r:4,class:"spinner"},this.$el),i.events.listen(this.$arrow,{move:({posn:o})=>{let a=this.relativePosn(o).angle()+Lr;this.$arrow.setTransform(void 0,a)},end:({lastPosn:o})=>{let a=this.relativePosn(o).angle()+Lr;this.setValue(a*wt)},click:()=>this.roll()}),this.$arrow.css("cursor","pointer");let[n,r]=t.split(":");this.drawSectors(+r),this.setValue(+n||0)}setupHandles(){this.$handle=this.makeHandle("c",t=>{let i=(t.angle()+Lr)%kr;this.drawSectors(kr/i)}),this.$handle.css("cursor","move")}drawSectors(t){let i=k(Math.round(t),2,16);if(i===this.sectors)return;this.sectors=i,this.options=`${this.angle}:${i}`;let s=kr/i;Or(this.$sectors,F(n=>s*n,i),this.colour),this.$handle.setCenter(d.fromPolar(s-Lr,yu))}setColour(t){this.colour=t;let i=this.$sectors.children,s=q.shades(t,i.length);for(let[n,r]of i.entries())r.setAttr("fill",s[n])}setValue(t){t=At(Math.round(t),360),this.angle!==t&&(this.angle=t,this.options=`${t}:${this.sectors}`,this.$arrow.setTransform(void 0,this.angle*lt))}roll(t=2e3){return E(this,null,function*(){if(this.isAnimating)return;this.isAnimating=!0,this.$parent.playSound("spin");let i=this.angle,s=(4+Math.random())*360;yield ot(n=>{let r=vt(i,s,mt("sine",n));this.$arrow.setTransform(void 0,r*lt)},t).promise,this.setValue(s),this.isAnimating=!1})}doubleClick(){Fe.action("roll",[this])}static makeThumbnail(t,i){let s=u("svg",{width:80,height:80},i),n=new d(40,40);Or(s,F(o=>kr/5*o,5),"",36,n),u("path",{d:ka,class:"spinner"},s).setTransform(n,-.8,.5)}};var u3=2*Math.PI,xu=Math.PI/2,bu=75,$u=class extends Ir{constructor(t,i,s){super(`${t.split(":")[0]}:1`,i,s);this.type="custom-spinner";this.$handles=[];for(let n of t.split(":")[1].split(","))this.makeVertex(d.fromPolar(+n*lt-xu,bu))}setupHandles(){let t;this.$parent.events.listen(this.$outline,{down:({posn:i})=>t=this.makeVertex(this.relativePosn(i)),move:({posn:i})=>this.moveVertex(this.relativePosn(i),t),end:()=>this.$parent.change({changed:[this]})}),this.$outline.css("cursor","crosshair")}drawSectors(){if(!this.$handles||this.$handles.length<2)return;let t=this.$handles.map(s=>(s.center.angle()+xu)%u3).sort();this.sectors=t.map(s=>Math.round(s*wt)).join(",");let i=`${this.angle}:${this.sectors}`;i!==this.options&&(this.options=i,Or(this.$sectors,t,this.colour))}makeVertex(t){if(this.$handles.length>=24)return;let i=this.makeHandle("c",s=>{!i||(s.length>2*bu?(this.deleteVertex(i),i=void 0):this.moveVertex(s,i))},()=>{i&&this.deleteVertex(i)});return i.setAttr("r",8),i.css("cursor","move"),this.$handles.push(i),this.moveVertex(t,i),i}deleteVertex(t){this.$handles.length<=2||(t.remove(),this.$handles.splice(this.$handles.indexOf(t),1),this.drawSectors())}moveVertex(t,i){if(!i)return;let s=ht(t.angle()*wt,10)*lt;i.setCenter(d.fromPolar(s,bu)),this.drawSectors()}static makeThumbnail(t,i){let s=u("svg",{width:80,height:80},i),n=new d(40,40),r=t.split(":")[1].split(",").map(a=>+a*lt);Or(s,r,"",36,n),u("path",{d:ka,class:"spinner"},s).setTransform(n,.4,.5);for(let a of r){let h=d.fromPolar(a-xu,36).add(n);u("circle",{cx:h.x,cy:h.y,r:3,fill:"white"},s)}}};var Ue=50;function La(e,t,i,s=0,n=0){for(let r of Vr[t]){let o=r[0]*.23*i+i/2+s,a=r[1]*.23*i+i/2+n;u("circle",{cx:o,cy:a,r:i/10,class:"dice-dot"},e)}}var Mu=class extends V{constructor(t,i,s){super(i,s);this.type="domino";this.options=t,this.path=new A(C,Ue,Ue*2),this.$mainShape=u("rect",{class:"polygon-tile",rx:5},this.$el),u("line",{x1:0,y1:Ue,x2:Ue,y2:Ue,class:"polygon-tile"},this.$el);let[n,r]=t.split(":").map(o=>+o);La(this.$el,n,Ue,0,0),La(this.$el,r,Ue,0,Ue),this.value=n+r,this.$outline=u("rect",{class:"outline",rx:5},this.$el),this.$mainShape.setRect(this.path),this.$outline.setRect(this.path),this.transform(),this.setColour(g.teal)}getSnapPoints(){return[...super.getSnapPoints(),new d(0,Ue),new d(Ue,Ue)]}setColour(t){super.setColour(t),this.$mainShape.setAttr("fill",_(t))}static makeThumbnail(t,i){let s=30,n=u("svg",{width:s+4,height:s*2+4},i);u("rect",{x:2,y:2,width:s,height:s*2,rx:2,class:"polygon-tile",fill:g.teal},n),u("line",{x1:2,y1:s+2,x2:s+2,y2:s+2,class:"polygon-tile"},n);let[r,o]=t.split(":").map(a=>+a);La(n,r,s,2,2),La(n,o,s,2,2+s)}};var u1=[g.red,g.blue,g.green,g.yellow,g.purple,g.orange,g.lime],Ws=class extends V{constructor(t,i,s){super(i,s);this.focussedSeries=-1;this.default=!0;this.chartOptions=ji({}),t&&Object.assign(this.chartOptions,JSON.parse(t)),this.chartColors=this.chartOptions.colours||[],this.chartOptions.watchAll(()=>this.options=JSON.stringify(this.chartOptions)),this.$series=u("g",{},this.$el),this.$outline=u("path",{class:"outline"},this.$el),i.events.listen(this.$el,{click:n=>this.focusOnSeries(n),checkIfActive:()=>this.focussedSeries>=0})}setColour(t,i){let s=this.focussedSeries;if(s>=0&&i==="picker"){if(this.chartColors[s]===t)return;this.chartColors[s]=t,this.colorSeries(_(t),s),this.chartOptions.colours=this.chartColors.slice(0),this.$parent.change({changed:[this]})}else i==="theme"||super.setColour(t)}getSeriesColor(t){if(this.default)return g.grey;let i=this.chartColors[t]||u1[t%u1.length];return _(i)}doubleClick(t){this.focussedSeries>=0||(this.focusOnSeries(t),!(this.focussedSeries<0)&&(this.$parent.options.focussed=this,this.$el.addClass("chart-focussed"),this.$parent.selection.clear()))}focusOnSeries(t){let i=t.event.target.getAttribute("series-idx")||this.findClosestElement(t);!i||(this.focussedSeries=+i,this.focusSeries(+i))}findClosestElement(t){return""}blur(){this.focussedSeries<0||(this.focussedSeries=-1,this.$el.removeClass("chart-focussed"),this.$parent.options.focussed=void 0)}};function Rr(e){e=e.filter((i,s)=>!s||i.some(n=>n));let t=e[0].map((i,s)=>e.some((n,r)=>r>0&&n[s]));return e.map(i=>i.filter((s,n)=>t[n]))}function d1(e){if(e=Rr(e),!e.length||!e[0].length)return[[],[]];e[0].length===1&&(e=e.map((n,r)=>[`${r}`,n[0]]));let t=e.slice(1),i=t.map(n=>n[0]),s=e[0].slice(1).map((n,r)=>({label:n,data:t.map(o=>+o[r+1]||0)}));return[i,s]}function p1(e,t,i=!0){let s=e[0].data.length,n=[];for(let r=0;r<s;++r){let o=[];if(t==="grouped")for(let a of e)o.push([0,a.data[r]]);else if(i){let a=0,h=0,l=e.map(p=>p.data[r]),c=t==="percentage"?99.99/U(l):1;for(let p of l)p<0?(o.push([a,a+p*c]),a+=p*c):(o.push([h,h+p*c]),h+=p*c)}else{let a=0,h=e.map(c=>c.data[r]),l=t==="percentage"?99.99/U(h):1;for(let c of h)o.push([a,a+c*l]),a+=c*l}n.push(o)}return n}var li=class{constructor(t){this.makeNew=t;this.stack=[]}get(t){return this.stack[t]||(this.stack[t]=this.makeNew()),this.stack[t]}};var d3=["A","B","C"],p3=[[10,20,30],[30,10,40],[20,25,10]].map(e=>({label:"",data:e})),Su=class extends Ws{constructor(t,i,s){super(t,i,s);this.type="chart";this.colour=g.darkGrey;this.tables=[];this.categories=[];this.series=[];this.$rects=new li(()=>u("rect",{class:"polygon-tile"}));this.$areas=new li(()=>u("polygon",{opacity:.5}));this.$lines=new li(()=>u("polyline",{class:"chart-line"}));this.$points=new li(()=>u("circle",{r:5}));this.$background=u("path",{fill:"transparent"},this.$el),this.$el.prepend(this.$background),this.$axes=u("path",{class:"grid-axis",stroke:g.darkGrey},this.$el),this.$labels=u("g",{class:"axis-labels"},this.$el),this.$foreground=u("g",{},this.$el),this.$handle=this.makeHandle("c",n=>{this.chartOptions.height=Math.max(ht(-n.y,25),100),this.chartOptions.width=Math.max(ht(n.x,25),100)}),this.$handle.css("cursor","nesw-resize"),this.chartOptions.watch(({type:n,layout:r,width:o,height:a})=>{this.updateOutline(o,a),this.drawChart(n,r)})}reconcileSeries(){var t,i;this.categories=((t=this.tables[0])==null?void 0:t.categories.slice(0))||[],this.series=((i=this.tables[0])==null?void 0:i.series.map(s=>({label:s.label,data:s.data.slice(0)})))||[];for(let s of this.tables.slice(1)){let n=this.categories.length,r=this.series.length;for(let o of s.series)this.series.push({label:o.label,data:Ce(0,n)});for(let[o,a]of s.categories.entries()){let h=this.categories.indexOf(a);if(h<0){this.categories.push(a);for(let l of this.series)l.data.push(0);h=this.categories.length-1}for(let[l,c]of s.series.entries())this.series[r+l].data[h]=c.data[o]}}}link(t){if(super.link(t),!t.source.is("table"))return;let[i,s]=d1(t.source.visibleData),n=this.tables.find(r=>r.table===t.source);n?Object.assign(n,{categories:i,series:s}):this.tables.push({table:t.source,categories:i,series:s}),this.reconcileSeries(),this.drawChart(this.chartOptions.type,this.chartOptions.layout)}unlink(t){super.unlink(t),this.tables=this.tables.filter(i=>i.table!==t.source),this.reconcileSeries(),this.drawChart(this.chartOptions.type,this.chartOptions.layout)}updateOutline(t=400,i=250){this.path=new A(C.shift(0,-i),t,i),this.$background.draw(this.path),this.$outline.draw(this.path),this.$handle.setCenter({x:t,y:-i}),this.transform(),this.$parent.selection.update()}getX(t){return(t-this.bounds.xMin)/this.bounds.dx*this.path.w}getY(t){return(t-this.bounds.yMin)/this.bounds.dy*this.path.h}drawChart(t="column",i="grouped"){this.$series.removeChildren(),this.$foreground.removeChildren();let s=["line","area"].includes(t);this.default=!this.series.length;let n=this.default?p3:this.series,r=this.default?d3:this.categories,o=p1(n,i,!s),a=Math.min(0,...o.map(M=>Math.min(...M.map(f=>f[1])))),h=Math.max(0,...o.map(M=>Math.max(...M.map(f=>f[1])))),l=t==="row"?this.path.w:this.path.h,c=Xi("",l,[a,h],0),p=[0,r.length-1,1],m=s&&!r.some(M=>isNaN(+M)),v=m?r.map(M=>+M):void 0;if(m){let M=Math.min(...v),f=Math.max(...v);p=Xi("",this.path.w,[M,f],0)}t==="row"&&([c,p]=[p,c]),this.bounds=new Ve(p[0],p[1],c[0],c[1]),t==="column"?this.drawColumnChart(o,i):t==="row"?this.drawRowChart(o,i):(t==="area"&&this.drawAreas(o,v),this.drawLines(o,v),t==="line"&&this.drawPoints(o,v)),this.drawAxes(t,this.path.w,this.path.h,p[2],c[2],m?void 0:r)}drawAxes(t,i,s,n,r,o){var h;this.$labels.removeChildren();let a=`M0 0v${-s}M0 0h${i}`;if(at(0,this.bounds.yMin,this.bounds.yMax)&&(a+=`M0 ${-this.getY(0)}h${i}`),at(0,this.bounds.xMin,this.bounds.xMax)&&(a+=`M${this.getX(0)} 0 v${-s}`),t==="column"&&o){let l=o.length?i/o.length:0;for(let c=0;c<=o.length;++c){let p=c*l;a+=`M${p} 0L${p} 5`,u("text",{text:o[c],x:p+l/2,y:21,"text-anchor":"middle"},this.$labels)}}else for(let l=this.bounds.xMin;l<=this.bounds.xMax;l+=n){let c=this.getX(l);a+=`M${c},0v5`;let p=t==="row"?Mt(l,4):(h=o==null?void 0:o[l])!=null?h:Mt(l,4);u("text",{text:p,x:c,y:21,"text-anchor":"middle"},this.$labels)}if(t==="row"&&o){let l=o.length?s/o.length:0;for(let c=0;c<=o.length;++c){let p=-c*l;a+=`M0 ${p}h-5`,u("text",{text:o[c],x:-12,y:p-l/2+5,"text-anchor":"end"},this.$labels)}}else for(let l=this.bounds.yMin;l<=this.bounds.yMax;l+=r){let c=this.getY(l);a+=`M0 ${-c}h-5`;let p=Mt(l,4);u("text",{text:p,x:-10,y:-c+5,"text-anchor":"end"},this.$labels)}this.$axes.setAttr("d",a)}drawColumnChart(t,i){let s=t.length,n=t[0].length,r=this.path.w/s,o=r/4,a=r-o,h=i==="grouped";h&&(a/=n);for(let l=0;l<n;++l)for(let c=0;c<s;++c){let p=t[c][l],m=c*r+o/2+(h?l*a:0),v=[-this.getY(p[0]),-this.getY(p[1])],M=Math.abs(v[1]-v[0]);this.drawRect(l*s+c,l,m,Math.min(...v),a,M)}}drawRowChart(t,i){let s=t.length,n=t[0].length,r=this.path.h/s,o=r/4,a=r-o,h=i==="grouped";h&&(a/=n);for(let l=0;l<n;++l)for(let c=0;c<s;++c){let p=t[c][l],m=c*r+o/2+(h?l*a:0),v=[this.getX(p[0]),this.getX(p[1])],M=Math.abs(v[1]-v[0]);this.drawRect(l*s+c,l,Math.min(...v),-(m+a),M,a)}}drawRect(t,i,s,n,r,o){let a=this.$rects.get(t);this.$series.append(a),a.setAttr("fill",this.getSeriesColor(i)),a.setAttr("x",s),a.setAttr("y",n),a.setAttr("width",r),a.setAttr("height",o),a.setAttr("series-idx",i)}drawLines(t,i){let s=t[0].length;for(let n=0;n<s;++n){let r=t.map((a,h)=>{var l;return`${this.getX((l=i==null?void 0:i[h])!=null?l:h)} ${-this.getY(a[n][1])}`}).join(" "),o=this.$lines.get(n);o.setAttr("stroke",this.getSeriesColor(n)),o.setAttr("points",r),o.setAttr("series-idx",n),this.$series.append(o)}}drawPoints(t,i){var r;let s=t[0].length,n=t.length;for(let o=0;o<s;++o)for(let a=0;a<n;++a){let h=this.$points.get(o*n+a);h.setCenter({x:this.getX((r=i==null?void 0:i[a])!=null?r:a),y:-this.getY(t[a][o][1])}),h.setAttr("fill",this.getSeriesColor(o)),h.setAttr("series-idx",o),this.$foreground.append(h)}}drawAreas(t,i){let s=t[0].length;for(let n=0;n<s;++n){let r=t.map((h,l)=>{var c;return`${this.getX((c=i==null?void 0:i[l])!=null?c:l)} ${-this.getY(h[n][1])}`}).join(" "),o=t.map((h,l)=>{var c;return`${this.getX((c=i==null?void 0:i[l])!=null?c:l)} ${-this.getY(h[n][0])}`}).reverse().join(" "),a=this.$areas.get(n);a.setAttr("fill",this.getSeriesColor(n)),a.setAttr("points",r+" "+o),a.setAttr("series-idx",n),this.$series.append(a)}}setColour(t,i){super.setColour(t,i),this.focussedSeries<0&&(this.$labels.setAttr("fill",_(t)),this.$axes.setAttr("stroke",_(t)))}colorSeries(t,i){var s,n,r,o;if(!!this.series.length){(s=this.$lines.stack[i])==null||s.setAttr("stroke",t),(n=this.$areas.stack[i])==null||n.setAttr("stroke",t),(r=this.$areas.stack[i])==null||r.setAttr("fill",t),i===this.focussedSeries&&((o=this.$focussedLine)==null||o.setAttr("stroke",t));for(let a of this.$series.$$(`rect[series-idx="${i}"]`))a.setAttr("fill",t);for(let a of this.$foreground.$$(`circle[series-idx="${i}"]`))a.setAttr("fill",t)}}focusSeries(t){if(this.chartOptions.type==="line"){this.$focussedLine||(this.$focussedLine=u("polyline",{class:"chart-shadow"}),this.$background.insertAfter(this.$focussedLine)),this.$focussedLine.setAttr("points",this.$lines.get(t).attr("points")),this.$focussedLine.setAttr("stroke",this.getSeriesColor(t)),this.$focussedLine.show();return}if(this.$focussedOutline||(this.$focussedOutline=u("path",{class:"chart-outline"},this.$el)),this.chartOptions.type==="area"){let i=dn(this.$areas.get(t).attr("points").split(" "),2),s="M"+i.map(n=>n.join(" ")).join("L")+"Z";this.$focussedOutline.setAttr("d",s)}else{let i=this.$rects.stack.filter(n=>+n.attr("series-idx")===t&&n.css("display")),s="";for(let n of i){let r=+n.attr("height");if(T(0,r))continue;let o=n.attr("width");s+=`M${n.attr("x")} ${n.attr("y")}h${o}v${r}h${-o}Z`}this.$focussedOutline.setAttr("d",s)}this.$focussedOutline.show()}blur(){var t,i;super.blur(),(t=this.$focussedOutline)==null||t.hide(),(i=this.$focussedLine)==null||i.hide()}findClosestElement(t){var n;if(this.chartOptions.type!=="line"&&this.chartOptions.type!=="area")return"";let i=this.relativePosn(t.posn),s=this.$lines.stack.slice(0,this.series.length);return((n=ws(s,r=>{let o=dn(r.attr("points").split(" "),2).map(([h,l])=>new d(+h,+l)),a=new Es(...o);return d.distance(i,a.project(i))}))==null?void 0:n.attr("series-idx"))||""}static action(t,i){return E(this,null,function*(){if(["line","area","column","row"].includes(t)){let s=i.filter(n=>n.chartOptions.type!==t);for(let n of s)n.chartOptions.type=t;s.length&&s[0].$parent.change({changed:s})}else if(["grouped","stacked","percentage"].includes(t)){let s=i.filter(n=>n.chartOptions.layout!==t);for(let n of s)n.chartOptions.layout=t;s.length&&s[0].$parent.change({changed:s})}})}};var f3=[2,4,5],Pu=class extends Ws{constructor(t,i,s){super(t,i,s);this.type="pie-chart";this.series=[];this.$sectors=new li(()=>u("path",{class:"polygon-tile"}));this.$focussedOutline=u("path",{class:"chart-outline"},this.$el),this.$handle=this.makeHandle("c",n=>{this.chartOptions.width=k(ht(n.length,25),50,300)}),this.$handle.css("cursor","ew-resize"),this.chartOptions.watch(({type:n,width:r})=>{this.updateOutline(r),this.drawChart(n||"pie",r)})}link(t){var n;if(super.link(t),!t.source.is("table"))return;this.currentLink!==t&&((n=this.currentLink)==null||n.delete());let i=Rr(t.source.visibleData).slice(1),s=i[0].length>1?1:0;this.series=i.map(r=>Math.abs(+r[s]||0)),this.drawChart(this.chartOptions.type,this.chartOptions.width)}unlink(t){super.unlink(t),this.series=[],this.drawChart(this.chartOptions.type,this.chartOptions.width)}updateOutline(t=100){this.path=new Z(C,t),this.$outline.draw(this.path),this.$handle.setTransform({x:t,y:0}),this.transform(),this.$parent.selection.update()}drawChart(t,i=100){var a,h;this.default=!this.series.length;let s=this.default?f3:this.series,n=U(s),r=s.map(l=>l/n*2*Math.PI);this.$series.removeChildren();let o=-Math.PI/2;for(let[l,c]of r.entries()){let p=this.$sectors.get(l);this.$series.append(p),p.setAttr("fill",this.getSeriesColor(l)),p.setAttr("series-idx",l),p.draw(new Ps(C,d.fromPolar(o,i),c)),o+=c}t==="donut"&&!this.$donutHole&&(this.$donutHole=u("circle",{fill:"white",class:"donut-hole"},this.$el)),(a=this.$donutHole)==null||a.setAttr("r",i/2),(h=this.$donutHole)==null||h.toggle(t==="donut")}colorSeries(t,i){!this.series.length||this.$sectors.get(i).setAttr("fill",t)}focusSeries(t){this.$focussedOutline.setAttr("d",this.$sectors.get(t).attr("d")),this.$focussedOutline.show()}blur(){super.blur(),this.$focussedOutline.hide()}static action(t,i){return E(this,null,function*(){if(["pie","donut"].includes(t)){let s=i.filter(n=>n.chartOptions.type!==t);for(let n of s)n.chartOptions.type=t;s.length&&s[0].$parent.change({changed:s})}})}};var m3=[[1,2,3,4,5]].map(e=>({label:"",data:e}));function g3(e,t=!1){let i=fn(e,.25),s=fn(e,.75),n=1.5*(s-i),r=t?e.filter(l=>at(l,i-n,s+n)):e,o=Math.min(...r);i=fn(r,.25);let a=fn(r,.5);s=fn(r,.75);let h=Math.max(...r);return[o,i,a,s,h]}var Cu=class extends Ws{constructor(t,i,s){super(t,i,s);this.type="box-whisker";this.colour=g.darkGrey;this.$boxPlots=new li(()=>u("path",{class:"chart-line"}));this.range=[0,5];this.series=[];this.tables=[];this.$background=u("path",{fill:"transparent"}),this.$el.prepend(this.$background),this.$axis=u("path",{class:"grid-axis",stroke:g.darkGrey},this.$el),this.$labels=u("g",{class:"axis-labels"},this.$el),this.$focussedOutline=u("path",{class:"chart-shadow"},this.$el),this.$handle=this.makeHandle("h",n=>{this.chartOptions.width=Math.max(ht(n.x,25),100)}),this.chartOptions.watch(({width:n})=>{this.updateOutline(n),this.drawChart()})}drawChart(){this.default=!this.series.length;let t=this.default?m3:this.series;this.$series.removeChildren(),this.range[0]=Math.min(...t.map(i=>Math.min(...i.data))),this.range[1]=Math.max(...t.map(i=>Math.max(...i.data))),t.forEach((i,s)=>this.drawBoxWhiskerPlot(i.data,s,-25-50*(t.length-1-s))),this.drawAxes(t)}drawBoxWhiskerPlot(t,i,s){let n=this.$boxPlots.get(i),r=this.chartOptions.layout==="outliers",[o,a,h,l,c]=g3(t,r).map(M=>this.getX(M)),p=16,m=10,v=`M${o} ${s+m}V${s-m}M${o} ${s}H${a}V${s+p}H${l}V${s-p}H${a}V${s}M${h} ${s+p}V${s-p}M${l} ${s}H${c}M${c} ${s+m}V${s-m}`;if(r){let M=t.map(f=>this.getX(f)).filter(f=>f<o||f>c);for(let f of M)v+=si(new Z(new d(f,s),4))}n.setAttr("d",v),n.setAttr("series-idx",i),n.setAttr("stroke",this.getSeriesColor(i)),this.$series.append(n)}drawAxes(t){this.$labels.removeChildren();let i=Xi("",this.path.w,this.range,0),s=`M 0 0 h ${this.path.w}`;for(let n=this.range[0];n<=this.range[1]+.001;n+=i[2]){let r=this.getX(n);s+=`M${r},0v5`,u("text",{text:Mt(n,4),x:r,y:21,"text-anchor":"middle"},this.$labels)}this.$axis.setAttr("d",s),t.forEach((n,r)=>{let o=-25-50*(t.length-1-r),a=n.label;u("text",{text:a,x:-14,y:o,"text-anchor":"end"},this.$labels)})}updateOutline(t=this.chartOptions.width||300){let i=(this.series.length||1)*50;this.path=new A(C.shift(0,-i),t,i),this.$outline.draw(this.path),this.$background.draw(this.path),this.$handle.translate(t,-i),this.transform(),this.$parent.selection.update()}colorSeries(t,i){this.$boxPlots.get(i).setAttr("stroke",t),this.$focussedOutline.setAttr("stroke",t)}getX(t){return(t-this.range[0])/(this.range[1]-this.range[0])*this.path.w}setColour(t,i){super.setColour(t,i),this.focussedSeries<0&&(this.$labels.setAttr("fill",_(t)),this.$axis.setAttr("stroke",_(t)))}link(t){super.link(t),!!t.source.is("table")&&(this.tables.includes(t.source)||this.tables.push(t.source),this.buildSeries(),this.drawChart(),this.updateOutline())}unlink(t){super.unlink(t),!!t.source.is("table")&&(this.tables=this.tables.filter(i=>i!==t.source),this.buildSeries(),this.drawChart(),this.updateOutline())}buildSeries(){this.series=[];for(let t of this.tables){let i=Rr(t.visibleData).slice(1);if(!!i.length)for(let s=0;s<i[0].length;s++){let n=i.map(r=>parseInt(r[s])).filter(r=>!Number.isNaN(r));this.series.push({label:t.visibleData[0][s],data:n})}}}focusSeries(t){this.$focussedOutline.setAttr("d",this.$boxPlots.get(t).attr("d")),this.$focussedOutline.setAttr("stroke",this.getSeriesColor(t)),this.$focussedOutline.show()}blur(){super.blur(),this.$focussedOutline.hide()}findClosestElement(t){let i=Math.round((this.relativePosn(t.posn).y+25)/50);return""+k(-i,0,this.series.length-1)}static action(t,i){return E(this,null,function*(){if(t==="outliers")for(let s of i)s.chartOptions.layout=s.chartOptions.layout===t?void 0:t})}static makeThumbnail(t,i){let[s,n]=[180,45],[r,o,a,h,l]=[0,1,2,3,4].map(b=>5+b/4*170),[c,p,m]=[n/2,14,8],v=u("svg",{width:s,height:n},i),M=u("path",{class:"chart-line",stroke:"white",style:"stroke-width: 2px"},v),f=`M${r} ${c-m} V ${c+m}M${r} ${c} H ${o}V${c-p}H${h} V ${c+p}H${o} V ${c}M${a} ${c-p} V ${c+p}M${h} ${c}H${l}M${l} ${c-m}V${c+m}`;M.setAttr("d",f)}};var f1=`<h3>Coordinate System</h3><div class="row"><div class="label">X Axis:</div><button class="increment" @click="step('xStep', -1)">\u2013</button><input class="input-field" type="number" :bind="xStep" min="0" style="width: 45px"><button class="increment" @click="step('xStep', 1)">+</button></div><div class="row"><div class="label">Y Axis:</div><button class="increment" @click="step('yStep', -1)">\u2013</button><input class="input-field" type="number" :bind="yStep" min="0" style="width: 45px"><button class="increment" @click="step('yStep', 1)">+</button></div>`;var v3=["x","y","\u03B8","r"];function Dn(e){if(e instanceof ee&&e.fn==="="){let[t,i]=e.args;if(t instanceof vn&&!v3.includes(t.i))return[t.i,i]}return[void 0,e]}var Tu=class{constructor(){this.assignments=new Map;this.callbackDeps=new Map;this.updatedNames=new Set}findFirstAssigner(t){var i;return(i=this.assignments.get(t))==null?void 0:i.keys().next().value}findDependants(t,i=[]){let s=[];for(let[r,o]of this.assignments.entries())o.size===1&&r!==t&&!i.includes(r)&&ko(o.values()).unknowns.filter(h=>!i.includes(h)).includes(t)&&s.push(r);let n=[...Lo(s,r=>this.findDependants(r,s))];return s.concat(n)}validate(t){let i=new Set,s=(n,r=[])=>{if(!this.assignments.has(n)){i.add(n);return}if(r.includes(n))return{message:`The variable <em>${n}</em> is defined recursively.`,locations:r.splice(r.indexOf(n)).map(a=>this.findFirstAssigner(a))};let o=this.assignments.get(n);if(o.size===1){let a=ko(o.values());for(let h of a.unknowns){let l=s(h,[...r,n]);if(l)return l}}else return{message:`You have defined <em>${n}</em> in multiple places.`,locations:Array.from(o.keys())}};for(let n of t.unknowns){let r=s(n);if(r)return{error:r,dependsOn:[],unknowns:[]}}return{dependsOn:[],unknowns:Array.from(i)}}evaluate(t){let{error:i,unknowns:s}=this.validate(t);if(i||s.length)return{error:i,value:NaN};try{return{value:t.evaluate(this.evalContext)}}catch(n){return{value:NaN}}}get evalContext(){let t={};for(let[i,s]of this.assignments.entries())s.size===1&&(t[i]=ko(s.values()));return t}get serializedEvalContext(){let t={};for(let[i,s]of Object.entries(this.evalContext))t[i]=s.toString();return t}substituteAssignments(t){let[i,s]=Dn(t);return i?new ee("=",[new vn(i),s.recursiveSubstitute(this.evalContext)]):t.recursiveSubstitute(this.evalContext)}markUpdated(t){this.updatedNames.add(t);for(let i of this.findDependants(t))this.updatedNames.add(i)}flushChanges(){for(let[i,s]of this.callbackDeps.entries())s.some(n=>this.updatedNames.has(n))&&i();let t=Array.from(this.updatedNames);return this.updatedNames.clear(),t}updateSource(t,i,s,n=!0){this.removeSource(t,!1),this.assignments.has(i)||this.assignments.set(i,new Map),this.assignments.get(i).set(t,s),this.markUpdated(i),n&&this.flushChanges()}attemptUpdateSource(t,i,s=!0){if(typeof i=="string")try{i=ei.parse(i).collapse()}catch(o){return}let[n,r]=Dn(i);return n?this.updateSource(t,n,r,s):this.removeSource(t),r}removeSource(t,i=!0){for(let[s,n]of this.assignments.entries())n.has(t)&&this.markUpdated(s),n.delete(t),n.size===0&&this.assignments.delete(s);i&&this.flushChanges()}watch(t,i,s=!1){this.callbackDeps.set(i,t),s&&i()}unwatch(t){t&&this.callbackDeps.delete(t)}};var _t=50,m1=class{constructor(t){this.promises=new Map;this.latestPromises=new Map;this.worker=new Worker(t),this.worker.onmessage=i=>{if(!i.data)return;let s=i.data[0],n=this.promises.get(i.data[0]);this.promises.delete(s),!(!n||this.latestPromises.get(n[0])!==s)&&n[1](i.data[1])}}draw(t,i,s,{xMin:n,xMax:r,yMin:o,yMax:a,xStep:h,yStep:l}){let c=qi();return this.latestPromises.set(t,c),this.worker.postMessage(["plot",i,s,c,n,r,h,o,a,l,_t]),new Promise(p=>this.promises.set(c,[t,p]))}},Eu,Au=class extends V{constructor(t,i,s){super(i,s);this.type="axes";this.showSelectionOutline=!0;this.canDragToSelect=!1;this.functions=new Map;this.watchers=new Map;this.$fill=u("path",{fill:"transparent"},this.$el),this.$grid=u("path",{class:"axis-gridlines"},this.$el),this.$content=u("g",{},this.$el),this.$axes=u("path",{class:"grid-axis"},this.$el),this.$labels=u("g",{class:"axis-labels"},this.$el),this.$outline=u("rect",{class:"outline active",hidden:!0},this.$el),this.setColour(g.darkGrey),this.watchPolypadOptions(v=>this.$grid.toggle(v.grid==="none"));let[n,r,o,a,h,l]=t.split(":").map(v=>+v),p={xMin:n,xMax:o,xStep:r,yMin:a,yMax:l,yStep:h,step:(v,M)=>this.step(v,M)},m=this.model=i.bindSettingsPanel(this,f1,p);this.$handles=[this.makeHandle("c",v=>m.xMin=k(Math.round(v.x/_t),-20,0)),this.makeHandle("c",v=>m.xMax=k(Math.round(v.x/_t),0,20)),this.makeHandle("c",v=>m.yMin=k(Math.round(-v.y/_t),-20,0)),this.makeHandle("c",v=>m.yMax=k(Math.round(-v.y/_t),0,20))];for(let v of[2,3])this.$handles[v].css("cursor","ns-resize");m.watch((v,M)=>this.setSizes(m,M))}highlight(t=!0){var i;(i=this.$outline)==null||i.toggle(t)}setSizes({xMin:t,xMax:i,yMin:s,yMax:n,xStep:r,yStep:o},a=!1){var m;let h=`${t}:${r}:${i}:${s}:${o}:${n}`;if(h===this.options)return;this.options=h;let l=_t;this.$handles[0].setCenter({x:t*l,y:0}),this.$handles[1].setCenter({x:i*l,y:0}),this.$handles[2].setCenter({x:0,y:-s*l}),this.$handles[3].setCenter({x:0,y:-n*l}),this.$labels.removeChildren();let c="",p=`M${t*l} 0L${i*l} 0M0 ${-s*l}L0 ${-n*l}`;p+=`M0 ${-n*l-3}l5 8h-10ZM${i*l+3} 0l-8 5v-10Z`;for(let v=t+1;v<i;++v)!v||(p+=`M${v*l} 0L${v*l} 5`,c+=`M${v*l} ${-s*l}L${v*l} ${-n*l}`,u("text",{text:Mt(v*r,4),x:v*l,y:21,"text-anchor":"middle"},this.$labels));for(let v=s+1;v<n;++v)!v||(p+=`M0 ${-v*l}L-5 ${-v*l}`,c+=`M${t*l} ${-v*l}L${i*l} ${-v*l}`,u("text",{text:Mt(v*o,4),x:-10,y:-v*l+5,"text-anchor":"end"},this.$labels));this.$axes.setAttr("d",p),this.$grid.setAttr("d",c),this.$fill.draw(hu(-n*_t,i*_t,-s*_t,t*_t,15)),this.path=new A(new d(t*_t,-n*_t),(i-t)*_t,(n-s)*_t),(m=this.$outline)==null||m.setRect(this.path);for(let[v,M]of this.functions.entries())this.draw(v,M);this.transform(),this.$parent.selection.update(),a||this.$parent.change({changed:[this]})}step(t,i){let s=this.model[t],n=Math.pow(10,Math.floor(Math.log10(s))),r=[.5*n,n,2*n,5*n,10*n],o=r.find((a,h)=>i>0?a>s:r[h+1]>=s);this.model[t]=k(o,1e-6,1e12)}link(t){if(super.link(t),!t.source.is("equation"))return;this.functions.has(t.source)||this.functions.set(t.source,u("path",{class:"geo-path"},this.$content));let i=this.functions.get(t.source);i.css("color",_(t.source.colour)),this.draw(t.source,i)}unlink(t){var i;super.unlink(t),(i=this.functions.get(t.source))==null||i.remove(),this.functions.delete(t.source),this.$parent.mathContext.unwatch(this.watchers.get(t.source))}draw(t,i){let s=ei.parse(t.options).collapse(),n=this.$parent.mathContext;n.unwatch(this.watchers.get(t));let r=()=>E(this,null,function*(){let[o,a]=Dn(s),{error:h,unknowns:l}=n.validate(a);if(this.showErrorIcon(h),h)i.setAttr("d","");else if(l.length>2)this.showErrorIcon({message:"An equation has too many degrees of freedom.",locations:[t]}),i.setAttr("d","");else{Eu||(Eu=new m1(this.$parent.attr("worker")));let c=yield Eu.draw(t,s.toString(),n.serializedEvalContext,this.model);i.setAttr("d",c.startsWith("[Error]")?"":c)}});this.watchers.set(t,r),n.watch(s.unknowns,r,!0)}getSnapPoints(){let{xMin:t,xMax:i,yMin:s,yMax:n}=this.model,r=[];for(let o=t;o<=i;++o)for(let a=s;a<=n;++a)r.push(new d(o*_t,-a*_t));return r}getSnapLines(){let{xMin:t,xMax:i,yMin:s,yMax:n}=this.model;return[new rt(new d(t*_t,0),new d(i*_t,0)),new rt(new d(0,-s*_t),new d(0,-n*_t))]}setColour(t){super.setColour(t.slice(0,7));for(let i of[this.$axes,this.$labels])i.setAttr("fill",_(this.colour));for(let i of[this.$axes,this.$grid])i.setAttr("stroke",_(this.colour))}static makeThumbnail(t,i){let s=u("svg",{width:180,height:180},i);u("path",{d:"M30 10v160M60 10v160M120 10v160M150 10v160M10 30h160M10 60h160M10 120h160M10 150h160",class:"axis-gridlines",stroke:"white"},s),u("path",{d:"M10 90h160M90 10v160M90 8l4 6h-8ZM172 90l-6 4v-8Z",class:"grid-axis",fill:"white"},s)}};var w3=Math.PI/2,Ht=Math.PI*2,g1=["hours","minutes","seconds"],y3={hours:"M-3,0-4-29l4-5,4,5L3,0Z",minutes:"M-2,0-3-47l3-5,3,5L2,0",seconds:"M-1,-52L1,-52L1,0L-1,0Z"};function v1(e,t=75){let i=t-5,s="";for(let a=0;a<60;++a){let h=d.fromPolar(a/30*Math.PI),l=i-(a%5?3:8);s+=`M${h.x*l} ${h.y*l}L${h.x*i} ${h.y*i}`}let n=u("circle",{r:t,class:"polygon-tile"},e);u("circle",{r:i,class:"clock-face"},e);let r=u("path",{d:s,class:"clock-ticks"},e);for(let a=1;a<=12;++a){let h=d.fromPolar((a-3)/6*Math.PI).scale(53).shift(0,5);u("text",{text:a,x:h.x,y:h.y,class:"clock-label"},e)}let o=g1.map(a=>u("path",{class:"clock-handle",d:y3[a],opacity:a==="hours"?.8:void 0},e));return u("circle",{r:4,class:"spinner"},e),[n,r,...o]}var Vu=class extends V{constructor(t,i,s){super(i,s);this.type="clock";this.showSeconds=!0;this.prevAngle=0;this.currentAngle=0;this.seconds=0;this.time=[0,0,0];this.options=t;let n=75;this.path=new Z(C,n),[this.$border,this.$ticks,...this.$hands]=v1(this.$el,n),this.$outline=u("circle",{class:"outline",r:n},this.$el);let r=this.options;for(let[l,c]of this.$hands.entries())i.events.listen(c,{start:({posn:p})=>{r=this.options,this.prevAngle=this.getPointerAngle(p)%Ht},move:({posn:p})=>this.handleMoveHand(g1[l],p),end:()=>{this.updateOptions(),this.options!==r&&i.change({changed:[this]})}});let[o,a,...h]=this.options.split(":");if(+a||this.$hands[2].hide(),o==="l"){this.clockType="live";let l=new Date().getTimezoneOffset()*60,c=-1;this.animation=ot(()=>{let p=Math.round(Date.now()/1e3-l);p!==c&&(c=p,this.setTime(p))});for(let p of this.$hands)p.css("pointer-events","none")}else o==="g"?(this.clockType="geared",this.setTime(+h[0]||0)):(this.clockType="free",this.setHands(+h[0]||0,+h[1]||0,+h[2]||0))}setTime(t){this.seconds=t;let i=t%60,s=t/60%60,n=t/3600%12;this.setHands(n,s,i)}setHands(t,i,s){this.time=[t%12,i%60,s%60],this.$hands[2].setTransform(void 0,Math.round(s)/60*Ht),this.$hands[1].setTransform(void 0,i/60*Ht),this.$hands[0].setTransform(void 0,t/12*Ht),this.value=At(t,12)+At(i,60)/60+At(s,60)/3600}updateOptions(){let t=this.showSeconds?"1":"0";this.clockType==="live"?this.options=`l:${t}`:this.clockType==="geared"?this.options=`g:${t}:${this.seconds}`:this.options=`f:${t}:${this.time[0]}:${this.time[1]}:${this.time[2]}`}delete(){var t;(t=this.animation)==null||t.cancel,super.delete()}getPointerAngle(t){return this.relativePosn(t).angle()+w3}handleMoveHand(t,i){this.currentAngle=this.getPointerAngle(i)%Ht,this.prevAngle/Ht>.75?this.currentAngle/Ht<.25&&(this.currentAngle+=Ht):this.prevAngle/Ht<.25&&this.currentAngle/Ht>.75&&(this.currentAngle-=Ht);let s=(this.currentAngle-this.prevAngle)/Ht;if(this.clockType==="geared"){let n=s*(t==="hours"?43200:t==="minutes"?3600:60);this.setTime(this.seconds+n)}else if(this.clockType==="free"){let[n,r,o]=this.time;t==="hours"?n+=s*12:t==="minutes"?r+=s*60:o+=s*60,this.setHands(n,r,o)}this.currentAngle>=Ht?this.currentAngle-=Ht:this.currentAngle<0&&(this.currentAngle+=Ht),this.prevAngle=this.currentAngle}setColour(t){super.setColour(t),this.$border.setAttr("fill",_(t)),this.$ticks.setAttr("stroke",_(t)),this.$hands[2].css("fill",_(t))}toggleSecondsVisible(){this.$hands[2].toggle(!this.showSeconds),this.showSeconds=!this.showSeconds,this.updateOptions()}static action(t,i){if(t==="toggleSeconds"){for(let s of i)s.toggleSecondsVisible();i[0].$parent.change({changed:i})}}static makeThumbnail(t,i){let s=u("svg",{width:80,height:80,viewBox:"-80 -80 160 160"},i),n=i.data.colour,[r,o,...a]=v1(s,75);r.removeClass("polygon-tile"),r.setAttr("fill",n),o.setAttr("stroke",n),a[2].css("fill",n),a[2].setTransform(void 0,57/60*Ht),a[1].setTransform(void 0,37/60*Ht),a[0].setTransform(void 0,2.62/12*Ht)}};var w1='<h3>Number Line</h3><label class="row"><div class="label">Start:</div><input class="input-field" type="number" :bind="start"></label><label class="row"><div class="label">Step Size:</div><input class="input-field" type="number" :bind="step" min="0"></label><label class="row"><div class="label">Width:</div><input class="input-field" type="number" :bind="size" min="1" max="25"></label><label class="row"><div class="label">Divisions:</div><input class="input-field" type="number" :bind="minor" min="1" max="25"></label>';var _r=25,ku=class extends V{constructor(t,i,s){super(i,s);this.type="number-line";this.$el.addClass("number-line"),this.$fill=u("path",{fill:"transparent"},this.$el),this.$lines=u("path",{class:"number-line-ticks"},this.$el),this.$labels=u("g",{},this.$el),this.setColour(g.darkGrey);let[n,r,o,a,h]=t.split(":").map(p=>+p),l={start:n,step:r,width:o,size:a,minor:h},c=i.bindSettingsPanel(this,w1,l);this.$start=this.makeHandle("h",p=>{let m=k(Math.round(p.x/_r/c.size),c.width-100,c.width-1);!m||(this.setTransform(this.posn.rotate(-Ul(this.rot)).shift(m*_r*c.size,0).rotate(Ul(this.rot))),c.width-=m,c.start=Ee(c.start+m*c.step,5))}),this.$start.setTransform({x:-_r,y:-2.5},Math.PI),H.isSafari&&this.$start.hide(),this.$end=this.makeHandle("h",p=>{let m=p.x/_r/c.size;c.width=k(Math.round(m),1,100)}),c.watch((p,m)=>{c.start=Ee(c.start,4),c.step=Ee(c.step,4),c.size=Math.round(c.size),c.minor=Math.round(c.minor),this.setDimensions(c,m)})}setDimensions({start:t,step:i,width:s,size:n,minor:r},o=!1){let a=`${t}:${i}:${s}:${n}:${r}`;if(a===this.options)return;this.options=a,this.$labels.removeChildren(),n*=_r;let h=`M0 10L${s*n} 10`;for(let l=0;l<=s*r;l+=1){let c=l*n/r,p=!(l%r),m=Mt(t+l*i/r,4);h+=`M${c} ${p?0:5}L${c} ${p?20:15}`,p&&u("text",{text:m,x:c,y:40},this.$labels)}this.$lines.setAttr("d",h),this.$end.setTransform({x:s*n,y:-2.5}),this.linePoints=F(l=>new d(l*n/r,10),s*r+1),this.line=new rt(new d(0,10),new d(s*n,10)),this.path=new A(new d(0,-2.5),s*n,25),this.$fill.draw(this.path),this.transform(),this.$parent.selection.update(),o||this.$parent.change({changed:[this]})}getSnapPoints(){return this.linePoints}getSnapLines(){return[this.line]}customTransform(){if(!H.isSafari)for(let t of this.$labels.children)t.css("transform",`rotate(${-this.rot}deg)`)}setColour(t){super.setColour(t.slice(0,7)),this.$lines.setAttr("stroke",_(this.colour)),this.$labels.setAttr("fill",_(this.colour))}static makeThumbnail(t,i){let s=u("svg",{width:240,height:40,class:"number-line"},i),n="M20 10L220 10";for(let r=0;r<=10;r+=1){let o=20+r*20;n+=`M${o} 5L${o} 15`,u("text",{text:r,x:o,y:30},s)}u("path",{d:n,class:"number-line-ticks"},s)}};var y1='<g class="leg-pin" style="transform-origin:bottom right"><polygon points="0,-21 -7,-21 0,0" fill="#3a3645"></polygon><path d="M-23.9-375H0v354h-7l-17-19v-335H-23.9z" fill="#d6d4db"></path></g><g class="pencil"><rect class="leg-pencil" x="0" y="-375" width="24" height="307" style="transform-box:fill-box;transform-origin:bottom center" fill="#d6d4db"></rect><g><path d="M72-48c-0.5,0-3,5-3,5H39c0,0-2.5-5-3-5v-106h36C72-154,72-48,72-48z"></path><rect x="47" y="-154" width="14" height="111" fill="#000" opacity="0.3"></rect><path d="M37.4-47.3l2.2,2.6c0.4,0.5,1,0.8,1.6,0.8c0.5,0,1-0.2,1.4-0.6l2.8-3.9c0.9-0.8,2.3-0.9,3.3-0.2l3.6,3.2c1,0.8,2.4,0.8,3.4,0l3.6-3.2c1-0.7,2.4-0.6,3.3,0.2l2.8,3.9c0.4,0.4,0.9,0.6,1.4,0.6c0.6,0,1.2-0.3,1.6-0.8l2.2-2.6c0.3-0.4,0.8-0.7,1.4-0.7L61.4-19.6c-4.8-1.9-10-1.9-14.8,0L36-48C36.6-48,37.1-47.7,37.4-47.3z" fill="#f7eecb"></path><path d="M46.6-19.6c4.8-1.9,10-1.9,14.8,0L54,0L46.6-19.6z"></path></g><path d="M81-56H15c-1.7,0-3-1.3-3-3v-18c0-1.7,1.3-3,3-3h66c1.7,0,3,1.3,3,3v18C84-57.3,82.7-56,81-56z" fill="#d6d4db"></path><circle cx="12" cy="-68" r="16" fill="#d6d4db"></circle><circle cx="12" cy="-68" r="9" fill="#3a3645"></circle></g><g class="top"><path d="M19-422H9v-25c0-2.8-2.2-5-5-5h-8c-2.8,0-5,2.2-5,5v25h-10c-2.8,0-5,2.2-5,5l0.1,42l9.2,19.2c0.4,1,1.4,4,4,4h21.7c2.7,0,3.7-3,4.1-4L24-375v-42C24-419.8,21.8-422,19-422z" fill="#3a3645"></path><circle cy="-386" r="9" fill="#d6d4db"></circle></g>';var Tt=50,x1=75,Nr=class extends V{constructor(t,i,s){super(i,s);this.canRotate=!1;this.canDragToSelect=!1;this.$el.addClass("utensil"),this.width=+t,this.absoluteEnd=new d(this.width,0),this.setup(),this.$handles=[0,1].map(n=>this.makeHandle("c",(r,o)=>{var l;let a=n?this.posn:this.absoluteEnd,h=(l=this.$parent.snap([o]))==null?void 0:l.shift;o=h?o.add(h):o.snap(a,10),d.distance(o,a)<x1&&(o=new Z(a,x1).project(o)),n?this.absoluteEnd=o:this.posn=o,this.rot=this.absoluteEnd.angle(this.posn)*wt,this.width=this.absoluteEnd.subtract(this.posn).length,this.update(),this.transform()})),this.update(),this.setOrder("front")}flip(){super.flip(),this.update(),this.transform()}moveEnd(){this.absoluteEnd=new d(this.width,0).rotate(this.rot/wt).add(this.posn)}update(){this.options=""+this.width,this.$handles[1].setCenter({x:this.width,y:0})}},x3=["ruler","protractor","set-triangle","compass"];function b1(e){return x3.includes(e.type)}var Lu=class extends Nr{constructor(){super(...arguments);this.type="ruler"}setup(){this.$glass=u("rect",{x:-20,height:60,class:"glass",rx:5},this.$el),this.$ticks=u("path",{class:"ticks"},this.$el),this.$labels=F(t=>u("text",{text:t,y:31},this.$el),31)}update(){this.path=new rt(C,new d(this.width,0)),this.flipped&&(this.path=new rt(this.path.p2,C));let t=this.path.length+.1;this.$glass.setAttr("width",t+40);let i="";for(let s=0;s<=t;s+=Tt/10){let n=s%Tt?s%(Tt/2)?0:1:2;i+=`M${this.flipped?this.width-s:s} 0V${[10,15,20][n]}`}this.$ticks.setAttr("d",i);for(let[s,n]of this.$labels.entries())n.toggle(s<=t/Tt),n.setAttr("x",this.flipped?this.width-Tt*s:Tt*s);super.update()}getSnapPoints(){let t=this.path.length;return F(i=>this.path.at(i*Tt/t),t/Tt)}getSnapLines(){return[this.path]}static action(t,i){if(t==="flip")for(let s of i)s.flip();i[0].$parent.change({changed:i})}};function b3(e){return`M0-${e}A${e},${e},0,0,0-${e},0V3a5,5,0,0,0,5,5H${e-5}a5,5,0,0,0,5-5V0A${e},${e},0,0,0,0-${e}Z`}var Ou=class extends Nr{constructor(){super(...arguments);this.type="protractor"}setup(){this.$glass=u("path",{d:"",class:"glass"},this.$el),this.$ticks=u("path",{class:"ticks"},this.$el),this.$labels=F(t=>u("text",{text:t*10},this.$el),19)}update(){let t=this.width;this.path=new Ss(C,new d(-this.width,0),Math.PI),this.$glass.setAttr("d",b3(t));let i="",s=this.width<100?5:1;for(let n=0;n<=180;n+=s){let r=!(n%10),o=d.fromPolar(-n*lt),a=t-(r?30:20);i+=`M${o.x*t} ${o.y*t}L${o.x*a} ${o.y*a}`,r&&(i+=`M${o.x*8} ${o.y*8}L${o.x*(t-50)} ${o.y*(t-50)}`)}this.$ticks.setAttr("d",i);for(let[n,r]of this.$labels.entries()){let o=t>160||!(n%3);r.toggle(o),!!o&&(r.setAttr("y",44-t),r.setAttr("transform",`rotate(${(this.flipped?-1:1)*(90-10*n)})`))}super.update()}getSnapPoints(){return[C,this.path.start,this.path.at(.5),this.path.end]}getSnapLines(){return[]}},Iu=234,Oa=150;function $3(e){let t=e<Oa?e/(Oa/(Iu/6)):e<Iu?Iu/6:e/6,i=t+t*Math.SQRT2;return`M0,0 H${e} L0,${-e} V0 M${t},${-t} H${e-i} L${t},${-e+i} V${t},${-t}`}var Ru=class extends Nr{constructor(){super(...arguments);this.type="set-triangle"}setup(){this.$glass=u("path",{d:"","fill-rule":"evenodd",class:"glass"},this.$el),this.$ticks=u("path",{class:"ticks"},this.$el),this.$hLabels=F(t=>u("text",{text:t,y:-23},this.$el),31),this.$hLabels[0].hide(),this.$vLabels=F(t=>u("text",{text:t,x:25,"dominant-baseline":"central"},this.$el),31),this.$vLabels[0].hide()}update(){this.path=new O(C,new d(this.width,0),new d(0,-this.width)),this.$glass.setAttr("d",$3(this.width));let t=this.width-50,i="",s=2,n=1;for(let r=0;r<=t;r+=Tt/10){let o=r%Tt?r%(Tt/2)?0:n:s,a=r<10?-10*(r/10):[-10,-15,-20][o];i+=`M${r} 0V${a}`}for(let r=0;r<=t;r+=Tt/10){let o=r%Tt?r%(Tt/2)?0:n:s,a=r<10?10*(r/10):[10,15,20][o];i+=`M0,${-r} H${a}`}this.$ticks.setAttr("d",i);for(let[r,o]of this.$hLabels.entries())r>0&&o.toggle(this.width>=Oa&&r<t/Tt),o.setAttr("x",Tt*r);for(let[r,o]of this.$vLabels.entries())r>0&&o.toggle(this.width>=Oa&&r<t/Tt),o.setAttr("y",Tt*-r);super.update()}getSnapPoints(){let t=this.width,i=new rt(C,new d(this.width,0)),s=new rt(C,new d(0,-this.width)),n=F(o=>i.at(o*Tt/t),t/Tt),r=F(o=>s.at(o*Tt/t),t/Tt);return n.concat(r)}getSnapLines(){return[this.path]}},Ia=375,Ra=new d(54,68),_u=class extends Nr{constructor(){super(...arguments);this.type="compass"}setup(){this.$el.html=y1,this.$pencil=this.$el.$(".pencil"),this.$top=this.$el.$(".top"),this.$legPin=this.$el.$(".leg-pin"),this.$legPencil=this.$el.$(".leg-pencil"),this.setColour(g.red);let t,i=0;this.$parent.events.listen(this.$pencil.$("g"),{start:s=>{let n=new d(this.width,0).rotate(this.rot/wt).add(this.posn);t=new hi(this.$parent,[n],this.colour,"pen"),i=s.posn.angle(this.posn)*wt-this.rot;for(let r of this.$handles)r.setAttr("hidden",!0)},move:s=>{this.rot=s.posn.angle(this.posn)*wt-i,this.transform();let n=d.fromPolar(this.rot/wt,this.width).add(this.posn);t.addPoint(n)},end:()=>{this.$parent.change({added:[t],changed:[this]}),t=void 0;for(let s of this.$handles)s.removeAttr("hidden")}})}setColour(t){super.setColour(t),this.$pencil.css("fill",this.colour)}update(){this.width>730&&(this.width=730);let t=this.width-Ra.x,i=Ia-Ra.y,s=new Z(C,Ia),n=new Z(new d(t,-Ra.y),i),r=oe(s,n)[0],o=Math.acos(r.x/Ia),a=Math.acos((t-r.x)/i);this.$legPin.setTransform(void 0,-o+Math.PI/2),this.$legPencil.setTransform(void 0,a-Math.PI/2),this.$pencil.setTransform({x:this.width-Ra.x,y:0}),this.$top.setTransform({x:r.x,y:Ia+r.y}),this.path=new Z(C,this.width),super.update()}getSnapPoints(){return[C,new d(this.width,0)]}};var Ai=50,Nu=class extends V{constructor(t,i,s){super(i,s);this.type="table";this.size=0;this.$handles=[];this.$cells=[];this.focussed=!1;this.timeout=0;this.rows=3;this.cols=2;this.data=[["x","y"],["",""],[""],[""]];this.columnWidths=[];this.selection={startRow:0,startCol:0,endRow:0,endCol:0};this.visibleData=[[]];this.linkTypes=["chart","pie-chart","box-whisker"];this.options=t,t&&this.initializeData(),this.$foreignObject=u("foreignObject",{x:this.posn.x,y:this.posn.y,width:1,height:1,overflow:"visible"},this.$el),this.$table=u("div",{xmlns:"http://www.w3.org/1999/xhtml",class:"table-tile"},this.$foreignObject),this.$outline=u("path",{class:"outline"},this.$el),this.$selectionOutline=u("rect",{class:"table-selection",hidden:!0,rx:2},this.$el),i.events.listen(this.$el,{down:n=>{this.findSelection(this.relativePosn(n.posn)),this.$hidden.focus()},move:n=>{let r=this.relativePosn(n.startPosn),o=this.relativePosn(n.posn);this.findSelection(r,o)},click:n=>this.focusCell(this.findCellAt(this.relativePosn(n.posn))),blurInput:!1,checkIfActive:()=>this.focussed}),this.$hidden=u("textarea",{class:"table-hidden"},this.$parent),this.$hidden.on("blur",n=>{var r;((r=Pt(n.relatedTarget))==null?void 0:r.hasClass("table-cell"))||this.blur()}),this.$hidden.on("paste",n=>{var r;n.preventDefault(),this.paste(((r=n.clipboardData)==null?void 0:r.getData("text").trim())||"")}),this.$hidden.on("cut copy",n=>{var o;let r=this.getSelectionContents();r&&((o=window.navigator.clipboard)==null||o.writeText(r)),n.type==="cut"&&this.removeSelectionContents()}),this.$hidden.onKeyDown("escape",n=>{n.stopPropagation(),this.$hidden.blur(),this.$parent.selection.add(this)}),this.$hidden.onKeyDown("enter",n=>{n.preventDefault(),this.moveDown(!0)}),this.$hidden.onKeyDown("tab",n=>{n.preventDefault(),this.moveRight()}),this.$hidden.onKeyDown("backspace",n=>{n.stopPropagation(),this.removeSelectionContents()}),this.$handles[0]=this.makeHandle("h",n=>this.updateCols(n.x)),this.$handles[1]=this.makeHandle("v",n=>this.updateRows(n.y)),this.$handles[1].css("cursor","ns-resize"),this.setColour("#bbb"),this.buildTable()}select(){var t;super.select(),!((t=this.links)==null?void 0:t.size)&&Bi(this.$parent.tiles.values(),i=>this.linkTypes.some(s=>i.is(s)))&&this.makeLink()}setColour(t){this.colour=t,this.$table.css("border-color",t);for(let s of this.$cells)s.css("border-color",t);let i=q.mix(t,"#fff",.6);this.$table.css("background",i.rgb),this.$table.setClass("contrast",i.brightness<128)}updateOutline(){let t=G(this.columnWidths),i=this.rows*Ai;this.$foreignObject.setAttr("width",t||1),this.$foreignObject.setAttr("height",i||1);let s=new A(C,t,i);this.$outline.draw(s),this.path=s.shift(.5),this.$handles[0].setTransform({x:t,y:0}),this.$handles[1].setTransform({x:0,y:i})}initializeData(){this.data=JSON.parse(this.options),this.rows=this.data.length,this.cols=this.data[0].length}updateCols(t){let i=G(this.columnWidths),s=this.columnWidths[this.columnWidths.length-2]||0;t>i+Ai?(this.cols+=1,this.buildTable()):this.cols>1&&t<s+Ai&&(this.cols-=1,this.buildTable())}updateRows(t){let i=k(Math.round(t/Ai),1,100);i!==this.rows&&(this.rows=i,this.buildTable())}resizeColumns(){this.columnWidths=Ao(F(t=>this.$cells[t].width,this.cols)),this.drawSelection()}makeCell(){let t=this.$cells.length,i=u("div",{class:"table-cell",contenteditable:!0,"cell-index":t},this.$table);i.css("border-color",this.colour),this.$cells.push(i);let s=!1;i.on("focus",()=>s=!0),i.on("pointerdown",r=>{s&&r.stopPropagation()}),i.on("blur",r=>{s=!1,this.data[this.cellPosn(i)[0]][this.cellPosn(i)[1]]=i.text,this.updateData();let o=Pt(r.relatedTarget);!(o==null?void 0:o.hasClass("table-cell"))&&!(o==null?void 0:o.hasClass("table-hidden"))&&this.blur()});let n=i.width;i.on("change keyup input",()=>{let r=n;n=i.width,r!==n&&this.resizeColumns()}),i.on("paste",r=>{var a;let o=((a=r.clipboardData)==null?void 0:a.getData("text").trim())||"";(o.includes(`
`)||o.includes("	"))&&(r.preventDefault(),this.paste(o))}),i.onKeyDown("escape",r=>{r.stopPropagation(),i.blur(),this.$parent.selection.add(this)}),i.onKeyDown("enter",r=>{r.preventDefault(),this.$parent.events.shiftKey?this.moveUp():this.moveDown(!0)}),i.onKeyDown("tab",r=>{r.preventDefault(),this.$parent.events.shiftKey?this.moveLeft():this.moveRight()})}cellPosn(t){let i=parseInt(t.attr("cell-index"));return[Math.floor(i/this.cols),i%this.cols]}buildTable(){this.$table.css("grid-template-columns",`repeat(${this.cols}, max-content)`);let t=this.cols*this.rows;for(let i=this.$cells.length;i<t;++i)this.makeCell();for(let i=t;i<this.$cells.length;++i)this.$cells[i].hide();for(let i=0;i<this.rows;++i)for(let s=0;s<this.cols;++s){this.data[i]||(this.data[i]=[]),this.data[i][s]||(this.data[i][s]="");let n=this.$cells[i*this.cols+s];n.show(),n.html=this.data[i][s],n.setClass("header",!i)}this.resizeColumns(),this.updateOutline(),this.updateData(),this.transform(),this.$parent.selection.update()}paste(t){let[i,s]=[this.selection.startRow,this.selection.startCol],n=t.trim().split(`
`).map(r=>r.split("	"));this.rows=Math.max(this.rows,i+n.length),this.cols=Math.max(this.cols,s+Math.max(...n.map(r=>r.length)));for(let r=0;r<n.length;++r)for(let o=0;o<n[r].length;++o)this.data[i+r]||(this.data[i+r]=[]),this.data[i+r][s+o]=n[r][o];this.updateSelection(s,i,s+n[0].length-1,i+n.length-1),this.buildTable()}moveLeft(){let[t,i]=[this.selection.startRow,this.selection.startCol];this.focusCell(this.$cells[t*this.cols+i-1]||this.$cells[this.$cells.length-1])}moveRight(){let[t,i]=[this.selection.startRow,this.selection.startCol];this.focusCell(this.$cells[t*this.cols+i+1]||this.$cells[0])}moveUp(){let[t,i]=[this.selection.startRow,this.selection.startCol],s=t===0?this.rows:t;this.focusCell(this.$cells[(s-1)*this.cols+i])}moveDown(t=!0){let[i,s]=[this.selection.startRow,this.selection.startCol];t&&this.rows<=i+1&&(this.data[i][s]=this.$cells[i*this.cols+s].text,this.rows+=1,this.buildTable()),this.focusCell(this.$cells[(i+1)*this.cols+s])}click(t){let i=Date.now();i-this.timeout<500&&(this.focus(),this.focusCell(this.findCellAt(this.relativePosn(t.posn)))),this.timeout=i}focus(){this.focussed||(this.focussed=!0,this.initialOptions=this.options,this.$parent.options.focussed=this,this.$table.addClass("active"),this.$parent.selection.clear(),this.$selectionOutline.show())}findCellAt(t){let i=this.columnWidths.findIndex(n=>n>t.x),s=Math.floor(t.y/Ai);return this.$cells[this.cols*s+i]}focusCell(t){var r,o;let[i,s]=this.cellPosn(t);this.updateSelection(s,i),t.focus();let n=document.createRange();n.selectNodeContents(t._el),(r=document.getSelection())==null||r.removeAllRanges(),(o=document.getSelection())==null||o.addRange(n)}blur(){!this.focussed||(this.focussed=!1,this.$parent.options.focussed=void 0,this.$table.removeClass("active"),this.$selectionOutline.hide(),this.updateData(),this.updateOutline(),this.transform(),this.$parent.selection.add(this),this.initialOptions!==this.options&&this.$parent.change({changed:[this]}))}updateData(){let t=this.data.slice(0,this.rows).map(i=>i.slice(0,this.cols));if(this.options=JSON.stringify(t),this.visibleData=t,this.initialOptions!==this.options)for(let i of this.links||[])i.change()}findSelection(t,i=t){let s=Math.floor(Math.min(t.y,i.y)/Ai),n=Math.ceil(Math.max(t.y,i.y)/Ai)-1,r=this.columnWidths.findIndex(a=>a>Math.min(t.x,i.x)),o=this.columnWidths.findIndex(a=>a>Math.max(t.x,i.x));o<0&&(o=this.cols),this.updateSelection(r,s,o,n)}updateSelection(t,i,s=t,n=i){var r,o,a,h;t=k(t,0,this.cols-1),s=k(s,t,this.cols-1),i=k(i,0,this.rows-1),n=k(n,i,this.rows-1),!(((r=this.selection)==null?void 0:r.startRow)===i&&((o=this.selection)==null?void 0:o.endRow)===n&&((a=this.selection)==null?void 0:a.startCol)===t&&((h=this.selection)==null?void 0:h.endCol)===s)&&(this.selection={startCol:t,startRow:i,endCol:s,endRow:n},this.drawSelection())}drawSelection(){if(!this.selection)return;let t=this.columnWidths[this.selection.startCol-1]||0,i=new d(t,this.selection.startRow*Ai),s=this.columnWidths[this.selection.endCol]-t||0,n=(this.selection.endRow+1-this.selection.startRow)*Ai;this.$selectionOutline.setRect(new A(i,s+1,n+1))}getSelectionContents(){let t="",i=this.selection;if(!i)return t;for(let s=i.startRow;s<=i.endRow;++s){for(let n=i.startCol;n<=i.endCol;++n)n>i.startCol&&(t+="	"),t+=this.data[s][n];t+=`
`}return t}removeSelectionContents(){let t=this.selection;if(!!t)for(let i=t.startRow;i<=t.endRow;++i)for(let s=t.startCol;s<=t.endCol;++s)this.data[i][s]="",this.$cells[i*this.cols+s].text=""}static action(t,i){return E(this,null,function*(){if(t==="transpose"){for(let s of i){for(let n=0;n<s.data.length;n++)for(let r=0;r<n;r++)[s.data[n][r],s.data[r][n]]=[s.data[r][n],s.data[n][r]];[s.rows,s.cols]=[s.cols,s.rows],s.updateData(),s.buildTable()}i[0].$parent.change({changed:i})}})}static makeThumbnail(t,i){let s=u("svg",{width:110,height:85},i),n=(r,o,a,h,l,c="")=>{u("rect",{x:5+r,y:5+o,width:a,height:h,fill:l,class:"polygon-tile"},s),c&&u("text",{x:25+5/2+r,y:25-5/2+o,text:c,fill:"white"},s)};for(let r=0;r<2;++r)for(let o=0;o<3;++o)n(50*r,25*o,50,25,o?"#ffffff33":"#ffffff66",o?"":r?"y":"x")}};var M3="M7,4,2.3-.3,6.6-5a1.2,1.2,0,0,0,0-1.5l-.4-.3a1,1,0,0,0-1.4,0L0-2.5-4.8-6.8a1,1,0,0,0-1.4,0l-.4.3A1.2,1.2,0,0,0-6.6-5L-2.3-.3-7,4a1.1,1.1,0,0,0-.1,1.4l1.5,1.4a.9.9,0,0,0,1.3,0L0,2.1,4.3,6.8a.9.9,0,0,0,1.3,0L7.1,5.4A1.1,1.1,0,0,0,7,4Z",$1="M7.7-5.7l-.2-.4-.3-.2c-.1-.1-.3,0-.4,0A36.6,36.6,0,0,0-3,2.1,36.1,36.1,0,0,0-7.8-.8h-.5l-1,.9a.4.4,0,0,0-.1.3c0,.2,0,.3.1.4a72.1,72.1,0,0,1,6.6,7h.4l.4-.2C1.9,1,3.8-1.8,7.5-5.2,7.7-5.3,7.7-5.5,7.7-5.7Z",M1={fill:"none",style:"touch-action: none",stroke:g.green},S1=class{constructor(t){this.$el=u("g",{});this.$ring=u("circle",We({opacity:.6},M1),this.$el);this.$burst=u("path",M1,this.$el);this.$mark=u("g",{class:"problem-marker"},this.$el);this.$circle=u("circle",{r:13},this.$mark);this.$cross=u("path",{d:M3,fill:"white"},this.$mark);this.$check=u("path",{d:$1,fill:"white"},this.$mark);this.isAnimating=!1;t.append(this.$el)}show(t=!1,i=!0){this.$cross.toggle(!t),this.$check.toggle(t),this.$circle.setAttr("fill",t?g.green:g.red),this.$mark.addClass("show"),i&&t&&this.burst()}hide(){this.$mark.removeClass("show")}burst(t=1e3,i=60,s=20){return E(this,null,function*(){this.isAnimating||(this.isAnimating=!0,yield ot(n=>{let r=mt("sine-out",n);this.$ring.setAttr("r",.6*r*i),this.$ring.setAttr("stroke-width",.25*(1-r)*i);let o=mt("exp-out",n),a=(.4+.6*o)*i,h=(.1+.9*o)*i,l="";for(let c=0;c<s;++c){let p=Math.cos(Math.PI*2*c/s),m=Math.sin(Math.PI*2*c/s);l+=`M${p*h} ${m*h}L${p*a} ${m*a}`}this.$burst.setAttr("d",l)},t).promise,this.isAnimating=!1)})}},Dr=class extends V{constructor(t,i,s){super(i,s);this.type="question-blank";this.size=100;this.canRotate=!1;this.solution="";this.submitted="";this.attempts=0;this.correct=!1;this.focussed=!1;this.options=t||"Pw::0";let[n,r,o]=this.options.split(":");this.solution=atob(n),this.submitted=r,this.attempts=+o||0,this.$box=u("rect",{class:"problem-box",rx:6},this.$el),this.$text=u("text",{class:"problem-text",text:this.text,y:36},this.$el),this.mark=new S1(this.$el),this.$input=u("input",{class:"problem-text"},i.$html),this.$input.onKeyDown("enter",()=>this.$input.blur()),this.$input.on("blur",()=>this.blur()),this.$parent.options.canEditQuestions?(this.$handle=this.makeHandle("c",a=>this.setSize(a.x)),this.$handle.css("cursor","ew-resize")):(this.$input.setInputPattern(this.solution),this.checkAnswer(!1),this.canMove=!1),this.setSize(100),this.setOrder("front")}setSize(t){var i;super.setSize(ht(k(t,50,400),25)),this.path=new A(C,this.size,50),this.$input.css({width:this.size+"px",height:"50px"}),this.$box.setRect(this.path),this.$text.setAttr("x",this.size/2),this.mark.$el.setTransform({x:this.size,y:0}),(i=this.$handle)==null||i.setCenter({x:this.size,y:50}),this.transform()}delete(){super.delete(),this.$input.remove()}get text(){return(this.$parent.options.canEditQuestions?this.solution:this.submitted)||"?"}click(){this.focussed||this.$parent.events.shiftKey||this.correct&&!this.$parent.options.canEditQuestions||(this.focussed=!0,this.$parent.selection.add(this,!0),setTimeout(()=>{this.$el.removeClass("correct incorrect"),this.mark.hide()}),this.$input.css({top:this.posn.y+"px",left:this.posn.x+"px"}),this.$input.value=this.text,this.$text.hide(),this.$input.show(),this.$input.focus(),document.execCommand("selectAll",!1))}blur(){if(!this.focussed)return;this.focussed=!1,this.$input.hide(),this.$text.show();let t=this.text,i=this.$input.value.trim();this.$parent.options.canEditQuestions?(this.solution=i,this.options=`${btoa(i)}::0`):(i&&i!==this.submitted&&(this.attempts+=1),this.submitted=i==="?"?"":i,this.options=`${btoa(this.solution)}:${i}:${this.attempts}`,setTimeout(()=>{this.checkAnswer(),Dr.gradeWorksheet(this.$parent)})),this.$text.text=this.text,this.text!==t&&this.$parent.change({changed:[this]})}isCorrect(){if(!this.submitted||!this.solution)return!1;if(this.submitted.toLowerCase()===this.solution.toLowerCase())return!0;let t=Ll(this.solution),i=Ll(this.submitted);return T(i,t)||Il(t)===this.submitted||this.solution===Il(i)}checkAnswer(t=!0){this.correct=this.isCorrect(),this.submitted&&this.mark.show(this.correct,t),this.$el.setClass("correct",this.correct),this.$el.setClass("incorrect",!!this.submitted&&!this.correct)}static gradeWorksheet(t){let i=[0,0,0,0];for(let s of t.tiles.values())!s.is("question-blank")||(i[0]+=1,!!s.submitted&&(i[s.correct?s.attempts<=1?1:2:3]+=1));i[0]===i[1]+i[2]&&s0()}static makeThumbnail(t,i){let s=u("svg",{width:130,height:70},i);u("rect",{x:15,y:15,width:100,height:50,class:"problem-box",rx:6},s),u("text",{x:65,y:50,text:"?",class:"problem-text"},s),u("circle",{cx:115,cy:15,r:13,fill:g.blue},s),u("path",{d:$1,fill:"white",transform:"translate(115 15)"},s)}};var P1=Pe(Uo),Du=class extends V{constructor(t,i,s){super(i,s);this.type="image";this.path=new A(C,0,0);this.aspectRatio=1;this.options=t,this.$image=u("image",{href:t,crossorigin:"anonymous"},this.$el),this.$outline=u("path",{class:"outline"},this.$el),P1(t).then(n=>{this.aspectRatio=n.height/n.width,this.setSize(this.size||n.width)}),this.$handle=this.makeHandle("c",n=>this.setSize(n.x)),this.$handle.css("cursor","nwse-resize")}setHref(t){this.options=t,this.$image.setAttr("href",t),P1(t)}setSize(t){let i=Math.max(50,50*this.aspectRatio),s=Math.min(1e3,1e3/this.aspectRatio);this.size=k(t,i,s),this.$image.setAttr("width",this.size),this.$image.setAttr("height",this.aspectRatio*this.size),this.path=new A(C,this.size,this.aspectRatio*this.size),this.$outline.draw(this.path),this.$handle.setCenter({x:this.size,y:this.aspectRatio*this.size}),this.transform(),this.$parent.selection.update()}};var S3={bold:"font-weight",italic:"font-style",underline:"text-decoration",colour:"color"};function C1(e,t){return e.style.getPropertyValue(t)||""}function T1(e,t,i){e.style.setProperty(t,i)}function P3(e,t){t==="font-weight"||t==="font-style"?e.style.setProperty(t,"normal"):t==="text-decoration"?e.style.setProperty(t,"none"):e.style.removeProperty(t)}var Gu=class extends V{constructor(t,i,s){super(i,s);this.type="text";this.size=0;this.focussed=!1;this.creating=!1;this.$box=u("rect",{fill:"transparent"},this.$el),this.$foreignObject=u("foreignObject",{x:this.posn.x,y:this.posn.y,width:1,height:1,overflow:"visible"},this.$el),this.$text=u("div",{class:"text-edit",style:"pointer-events: none",xmlns:"http://www.w3.org/1999/xhtml"},this.$foreignObject),this.$outline=u("path",{class:"outline"},this.$el),this.options=this.$text.html=t||"Text",this.setColour(i.penColour),this.setOrder("front"),this.updateOutline(),this.$text.on("pointerdown",n=>n.handled=!0),this.$text.onKeyDown("escape",n=>this.blur()),this.$text.on("blur",()=>this.blur())}setSize(t){super.setSize(k(t,-5,10)),this.$text.css("font-size",20*1.2**this.size+"px"),this.updateOutline()}setColour(t){if(this.focussed)return this.formatFont("color",t);this.colour=t,this.$text.css("color",_(this.colour))}getSnapPoints(){return[]}updateOutline(){let t=this.$text.width,i=this.$text.height;this.$foreignObject.setAttr("width",t||1),this.$foreignObject.setAttr("height",i||1),this.path=new A(C,t,i),this.$box.setRect(this.path),this.$outline.draw(this.path),this.transform()}selectAll(){let t=this.selection,i=document.createRange();i.selectNodeContents(this.$text._el),t==null||t.removeAllRanges(),t==null||t.addRange(i)}static action(t,i){return E(this,null,function*(){for(let s of Array.from(i))t==="smaller"||t==="larger"?s.setSize(t==="larger"?s.size+1:s.size-1):s.format(t);i[0].$parent.change({changed:Array.from(i)})})}format(t){this.formatFont(S3[t]||"",t),this.cleanupElements(this.$text._el.children),this.updateOutline(),this.options=this.$text.html}get selection(){var i,s;return(((s=(i=this.$el._el).getRootNode)==null?void 0:s.call(i))||document).getSelection()}formatFont(t,i){if(!this.focussed){let r=new Range,o=this.$text._el.childNodes;return r.setStartBefore(o[0]),r.setEndAfter(o[o.length-1]),this.formatRange(r,t,i)}let s=this.selection;if(!s)return;let n=[];for(let r=0;r<s.rangeCount;++r){let o=s.getRangeAt(r);this.formatRange(o,t,i),n.push(s.getRangeAt(r))}s.removeAllRanges();for(let r=0;r<n.length;++r)s.addRange(n[r])}formatRange(t,i,s){let n=t==null?void 0:t.extractContents().childNodes;if(!n)return;let r=t.commonAncestorContainer;(r==null?void 0:r.nodeName)==="#text"&&r.parentNode&&(r=r.parentNode),this.removeEmptyTextNodes(n),this.wrapChildrenInSpans(r,n,i),this.updateRangeChildren(n,i,s);for(let o=n.length-1;o>=0;--o)t.insertNode(n[o])}removeEmptyTextNodes(t){for(let i=0;i<t.length;i++){let s=t[i];s.nodeName==="#text"&&!s.nodeValue&&s.remove()}}wrapChildrenInSpans(t,i,s){for(let n=0;n<i.length;++n){let r=i[n];if(r.nodeName==="#text"){let o=document.createElement("span");t.nodeName==="SPAN"&&T1(o,s,C1(t,s)),o.appendChild(document.createTextNode(r.nodeValue||"")),r.replaceWith(o)}}}updateRangeChildren(t,i,s){if(s==="smaller"||s==="larger"){let n=t[0],r=parseFloat(n.style.fontSize)||100,o=(s==="smaller"?1/1.2:1.2)*r;this.setChildrenStyles(t,"font-size",o+"%")}else this.allChildrenHaveStyle(t,i,s)?this.unsetChildrenStyles(t,i):this.setChildrenStyles(t,i,s)}allChildrenHaveStyle(t,i,s){for(let n=0;n<t.length;++n){let r=t[n];if(C1(r,i)!==s||!this.allChildrenHaveStyle(r.children,i,s))return!1}return!0}unsetChildrenStyles(t,i){for(let s=0;s<t.length;++s){let n=t[s];P3(n,i),this.unsetChildrenStyles(n.children,i)}}setChildrenStyles(t,i,s){for(let n=0;n<t.length;++n){let r=t[n];T1(r,i,s),this.clearChildrenStyles(r.children,i)}}clearChildrenStyles(t,i){for(let s=0;s<t.length;++s){let n=t[s];n.style.removeProperty(i),this.clearChildrenStyles(n.children,i)}}cleanupElements(t){for(let i=0;i<t.length;++i)this.cleanupElements(t[i].children);for(let i=0;i<t.length;++i)t[i].textContent||t[i].remove();for(let i=0;i<t.length;++i)t[i].getAttribute("style")||t[i].replaceWith(...Array.from(t[i].childNodes))}doubleClick(){this.focus()}focus(t=!1){this.focussed||(this.creating=t,this.focussed=!0,this.$parent.options.focussed=this,this.$parent.selection.clear(),this.$text.css("pointer-events","all"),this.$text.setAttr("contenteditable",!0),this.$text.focus(),this.selectAll())}blur(){var s;if(!this.focussed)return;this.focussed=!1,this.$parent.options.focussed=void 0,this.$text.css("pointer-events","none"),this.$text.removeAttr("contenteditable");let t=this.$text.html,i=this.options!==t;if(t){this.$text.show(),this.options=t,this.updateOutline();let n=this.creating?"added":"changed";(this.creating||i)&&this.$parent.change({[n]:[this]})}else this.delete(),this.creating||this.$parent.change({deleted:[this]});(s=this.selection)==null||s.removeAllRanges()}};function Qt(e){return!!e.setValue}function E1(e,t){let i=e;for(let s of e.parents()){if(s.type in t&&s.children.indexOf(i)===t[s.type])return s;i=s}}function C3(e,t){for(let i of e.parents(!0))for(let s of t.parents(!0))if(i===s)return s}function A1(e,t,i=!1){let s=i?e.children.slice(0).reverse():e.children,n=t.parent;return s.findIndex((r,o)=>n.hasParent(a=>a===r)||Qt(n)&&n===r||e===n&&(i?s.length-o:o)===t.offset)}var qu=class{constructor(t){this.equation=t;this.offset=0;this.$el=u("line",{class:"cursor",hidden:!0},t.$row),this.$range=u("rect",{class:"range",hidden:!0}),t.$row.prepend(this.$range),this.parent=t.root}redraw(){let t=this.getRangeRect();if(this.$el.toggle(!t),this.$range.toggle(!!t),t)this.$range.setRect(t);else{this.selected=void 0;let i=this.getCursorLine();i&&this.$el.setLine(...i),this.$el.restartAnimation()}}hide(){this.$el.hide(),this.$range.hide(),this.clearRange()}startRange(){this.start={parent:this.parent,offset:this.offset}}clearRange(){this.selected=void 0,this.start=void 0}moveToPoint(t){let i=this.equation.root.hitTest(t)||this.equation.root,s=i.worldTransform,n=(t.x-s.x)/(i.width*s.scale);Qt(i)?this.moveInto(i,Math.round(n*i.value.length)):n<.5?this.moveBefore(i):this.moveAfter(i)}getRangeRect(){if(!this.start||this.start.parent===this.parent&&this.start.offset===this.offset)return;let t=C3(this.parent,this.start.parent),i=[t];if(t.children.length){let s=A1(t,this.start),n=A1(t,this);n<s&&([s,n]=[n,s]),(s>0||n<t.children.length-1)&&(i=t.children.slice(s,n+1)),i.length||(i=[t]),(s<0||n<0)&&t.type==="mrow"&&t.parent&&(i=[t.parent]),i.length===1&&i[0].type==="mrow"&&(i=i[0].children.slice(0))}return this.selected=i,A.aroundPoints(Lo(i,s=>{let n=s.worldTransform;return[n,{x:n.x+s.width*n.scale,y:n.y+s.height*n.scale}]}))}getCursorLine(){let t=Qt(this.parent)?this.parent:this.prev||this.next;if(!t)return;let i=t.worldTransform,s=t.height*i.scale,n=-1;return Qt(this.parent)?n=t.width*i.scale*this.offset/t.value.length:this.prev&&(n=this.prev.width*i.scale+1),[{x:i.x+n,y:i.y+2},{x:i.x+n,y:i.y+s-2}]}moveAfter(t){if(t.type==="mrow")return this.moveAfter(G(t.children));if(!t.parent)throw new Error("Move cursor to unattached node");this.parent=t.parent,this.offset=this.parent.children.indexOf(t)+1}moveBefore(t){if(t.type==="mrow")return this.moveBefore(t.children[0]);if(!t.parent)throw new Error("Move cursor to unattached node");this.parent=t.parent,this.offset=this.parent.children.indexOf(t)}moveInto(t,i){if(Qt(t)){if(i<=0)return this.moveBefore(t);if(i>=t.value.length)return this.moveAfter(t)}this.parent=t,this.offset=i}get prev(){return this.parent.children[this.offset-1]}get next(){return this.parent.children[this.offset]}handleShift(t,i=!1){if(t&&!this.selected)this.startRange();else if(!t&&this.selected)return i?this.moveBefore(this.selected[0]):this.moveAfter(G(this.selected)),this.clearRange(),!0;this.selected&&this.parent!==this.selected[0].parent&&this.moveAfter(G(this.selected))}left(t){if(this.handleShift(t,!0))return;if(this.selected)return this.offset-=1;if(Qt(this.parent))return this.moveInto(this.parent,this.offset-1);let i=this.prev;if(i)return Qt(i)?this.moveInto(i,i.value.length-1):i.children.length?this.moveAfter(G(i.children)):this.moveBefore(i);let s=this.parent,n=(s==null?void 0:s.type)==="mrow";if(n&&(s==null?void 0:s.prev))return this.moveAfter(s.prev);let r=n?s.parent:s;r&&this.moveBefore(r)}right(t){if(this.handleShift(t))return;if(this.selected)return this.offset+=1;if(Qt(this.parent))return this.moveInto(this.parent,this.offset+1);let i=this.next;if(i)return Qt(i)?this.moveInto(i,1):i.children.length?this.moveBefore(i.children[0]):this.moveAfter(i);let s=this.parent,n=(s==null?void 0:s.type)==="mrow";if(n&&(s==null?void 0:s.next))return this.moveBefore(s.next);let r=n?s.parent:s;r&&this.moveAfter(r)}up(t){this.selected&&this.clearRange();let i=E1(this.parent,{mfrac:1,msub:1,msup:0});(i==null?void 0:i.type)==="mfrac"&&this.moveAfter(G(i.children[0].children)),(i==null?void 0:i.type)==="msub"&&this.moveAfter(G(i.children[0].children)),(i==null?void 0:i.type)==="msup"&&this.moveBefore(i.children[1].children[0])}down(t){this.selected&&this.clearRange();let i=E1(this.parent,{mfrac:0,msub:0,msup:1});(i==null?void 0:i.type)==="mfrac"&&this.moveBefore(i.children[1].children[0]),(i==null?void 0:i.type)==="msub"&&this.moveBefore(i.children[1].children[0]),(i==null?void 0:i.type)==="msup"&&this.moveAfter(G(i.children[0].children))}backspace(){var r;if(this.selected){this.moveBefore(this.selected[0]);for(let o of this.selected)o.deleteFromDom();this.clearRange(),this.parent.children.length||this.parent.addChildren([this.placeholder]);return}if(Qt(this.parent)){let o=this.parent.value;return this.setText(o.slice(0,this.offset-1)+o.slice(this.offset)),this.moveInto(this.parent,this.offset-1)}let t=this.prev;if(t)return Qt(t)&&t.value.length>1?t.setValue(t.value.slice(0,t.value.length-1)):t.type==="placeholder"||t.children.length?this.left():(t.deleteFromDom(),this.parent.children.length||this.parent.addChildren([this.placeholder]),this.moveInto(this.parent,this.offset-1));let i=this.parent,s=i.children,n=0;i.type==="mrow"&&parent.parent&&(n=((r=i.prev)==null?void 0:r.children.filter(o=>o.type!=="placeholder").length)||0,i=i.parent,s=Te((i==null?void 0:i.children.map(o=>o.children))||[])),!!(i==null?void 0:i.parent)&&(this.moveInto(i.parent,i.index+n),i.insertAfter(s.filter(o=>o.type!=="placeholder")),i.deleteFromDom(),this.parent.children.length||this.parent.addChildren([this.placeholder]))}get placeholder(){return new sa(this.equation)}setText(t,i){if(!i&&Qt(this.parent)&&(i=this.parent),!!i){if(t in Pn&&(t=Pn[t]),t==="sqrt"){let s=this.createNode("msqrt");return i.insertAfter([s]),i.deleteFromDom(),this.moveBefore(s.children[0].children[0])}i.setValue(t)}}createNode(t,i){let s=oi(this.equation,i||[this.placeholder]);if(t==="mfenced")return new cr([s],this.equation);if(t==="msqrt")return new Tn(t,[s],this.equation);let n=oi(this.equation,[this.placeholder]);if(t==="mfrac")return new na([s,n],this.equation);if(t==="mroot")return new Tn(t,[s,n],this.equation);if(t==="msub"||t==="msup")return new Cn(t,[s,n],this.equation)}splitTextNode(){let t=this.parent,i=t.value.slice(this.offset);t.setValue(t.value.slice(0,this.offset)),t.insertAfter([new Os(t.type,i,this.equation)]),this.moveAfter(t)}insert(t,i){var n,r,o,a,h;let s=((n=this.prev)==null?void 0:n.type)==="placeholder";if(Qt(this.parent)&&!this.start&&!this.selected){let l=this.parent.value;((r=this.parent)==null?void 0:r.type)===t?(this.setText(l.slice(0,this.offset)+i+l.slice(this.offset)),this.moveInto(this.parent,this.offset+1)):(this.splitTextNode(),this.insert(t,i))}else if(t==="mi"||t==="mn"||t==="mtext")this.selected&&this.backspace(),((o=this.prev)==null?void 0:o.type)===t?this.setText(this.prev.value+i,this.prev):((a=this.next)==null?void 0:a.type)===t?(this.setText(i+this.next.value,this.next),this.moveInto(this.next,1)):(this.parent.addChildren([new Os(t,i,this.equation)],this.offset),s||(this.offset+=1));else if(t==="mo"||t==="mspace"){this.selected&&this.backspace();let l=t==="mo"?new Os("mo",i,this.equation):new ia(this.equation);this.parent.addChildren([l],this.offset),s||(this.offset+=1)}else{let l=t==="msub"||t==="msup"||t==="mfrac"&&((h=this.prev)==null?void 0:h.type)!=="mo",c=this.selected||(l&&this.prev?[this.prev]:void 0);c&&this.moveBefore(c[0]),this.selected&&this.clearRange();let p=this.createNode(t,c);this.parent.addChildren([p],this.offset),this.moveBefore(p.children[c&&p.children.length>1?1:0].children[0])}}toSubSup(t){let i=this.placeholder,s=t.type==="msub"?2:1;t.addChildren([oi(this.equation,[i])],s),t.type="msubsup",this.moveBefore(i)}type(t){var i,s,n,r,o,a;if(t=t.replace("*","\xD7").replace("-","\u2212"),t.match(/^[A-Za-zπ]$/))this.insert("mi",t);else if("0123456789.".includes(t))this.insert("mn",t);else if("+\u2212\xB1\xD7\xF7<>\u2264\u2265=%!".includes(t))this.insert("mo",t);else if(t===" "){let h=(i=this.prev)==null?void 0:i.type,l=(s=this.next)==null?void 0:s.type;if(h==="placeholder"||h==="mspace"||l==="placeholder"||l==="mspace"||!Qt(this.parent)&&h!=="mi"&&l!=="mi")return;this.insert("mspace")}else if(t==="frac"||t==="/")this.insert("mfrac",t);else if(t==="sqrt")this.insert("msqrt",t);else if(t==="^"||t==="sup"){if(((n=this.prev)==null?void 0:n.type)==="msub")return this.toSubSup(this.prev);this.insert("msup",t)}else if(t==="_"||t==="sub"){if(((r=this.prev)==null?void 0:r.type)==="msup")return this.toSubSup(this.prev);this.insert("msub",t)}else if(t==="brackets"||"([{|".includes(t))this.insert("mfenced",t);else if(")]}".includes(t))if(((a=(o=this.parent)==null?void 0:o.parent)==null?void 0:a.type)==="mfenced")this.moveAfter(this.parent.parent);else{let h=this.prev;this.parent.addChildren([this.createNode("mfenced",h?[h]:void 0)],this.offset),h||(this.offset+=1)}}copy(){return this.selected?this.selected.map(t=>t.expr).join(""):""}paste(t){try{let i=this.equation.parse(t);if(this.selected&&this.backspace(),i.length===1&&Qt(i[0]))return this.insert(i[0].type,i[0].value),i[0].deleteFromDom();Qt(this.parent)&&this.splitTextNode(),this.parent.addChildren(i,this.offset),this.moveAfter(G(i))}catch(i){}}};var V1=class{constructor(t,i,s=!0){this.$el=u("g",{class:"equation","font-size":"20px"},t),this.equation=new Ci(this.$el,void 0,0,"",20,s);try{this.equation.setValue(i)}catch(n){console.warn("Parsing error",i,n.message)}}get expr(){return ei.parse(this.equation.root.expr).collapse()}get width(){return this.equation.root.width}get height(){return this.equation.root.height}},k1=class extends V1{constructor(t,i,s,n=!0){super(i,s,n);this.tile=t;this.cursor=new qu(this.equation),this.$textarea=u("textarea",{class:"hidden-input",tabindex:-1},t.$parent),this.$textarea.on("key",r=>this.handleKey(r)),this.$textarea.on("blur",()=>t.blur()),this.$textarea.on("cut copy",r=>{var o;(o=window.navigator.clipboard)==null||o.writeText(this.cursor.copy()),r.type==="cut"&&(this.cursor.backspace(),this.redraw())}),this.$textarea.on("paste",()=>E(this,null,function*(){var o;let r=yield(o=window.navigator.clipboard)==null?void 0:o.readText();!r||(this.cursor.paste(r),this.redraw())}))}redraw(){this.equation.resize(),this.tile.transform(),this.cursor.redraw()}bindSlideEvents(t,i){this.tile.$parent.events.listen(this.tile.$el,{down:s=>{s.event.preventDefault(),this.cursor.clearRange(),this.moveCursor(t(s))},start:()=>this.cursor.startRange(),move:s=>this.moveCursor(t(s)),blurInput:!1,checkIfActive:i})}handleKey(t){var i;if(!((i=this.excludedChars)==null?void 0:i.includes(t.char))){if(t.code===He.enter||t.code===He.escape)return this.$textarea.blur(),this.tile.$parent.selection.add(this.tile,!0);if(t.code===He.left)this.cursor.left(t.shift);else if(t.code===He.right)this.cursor.right(t.shift);else if(t.code===He.up)this.cursor.up(t.shift);else if(t.code===He.down)this.cursor.down(t.shift);else return t.code===He.backspace||t.code===He.delete?(this.cursor.backspace(),this.redraw()):(this.cursor.type(t.char),this.redraw());this.cursor.redraw()}}moveCursor(t){this.cursor.moveToPoint(t||C),this.cursor.redraw()}focus(){this.$textarea.show(),this.$textarea.focus()}blur(){return this.cursor.hide(),this.$textarea.hide(),this.equation.updateDescription(),this.equation.root.expr}delete(){this.$el.remove(),this.$textarea.remove()}},Bu=class extends V{constructor(t,i,s){super(i,s);this.type="equation";this.focussed=!1;this.size=0;this.linkTypes=["axes"];this.creating=!1;this.options=t||"placeholder",this.$box=u("rect",{fill:"transparent"},this.$el),this.$outline=u("rect",{class:"outline"},this.$el),this.$resultText=u("text",{opacity:.5,style:"font-size: 13px"},this.$el),this.watchPolypadOptions(n=>{var r;this.$resultText.toggle(n.evalEquations),(r=this.watcher)==null||r.call(this)}),this.equationArea=new k1(this,this.$el,this.options),this.equationArea.bindSlideEvents(n=>this.getCursorOffset(n),()=>this.focussed),this.setOrder("front"),this.transform(),this.setColour(i.penColour),this.updateMath()}setSize(t){super.setSize(k(t,-5,10)),this.equationArea.$el.css("transform",this.size?`scale(${this.scale})`:""),this.$resultText.css("font-size",13*this.scale+"px"),this.transform()}get scale(){return 1.2**this.size}select(){var t;super.select(),!((t=this.links)==null?void 0:t.size)&&Bi(this.$parent.tiles.values(),i=>i.type==="axes")&&this.makeLink()}doubleClick(t){this.focus(!1,t)}customTransform(){let t=this.equationArea.width*this.scale+16,i=this.equationArea.height*this.scale+12;this.path=new A(C.shift(-8,-6),t,i);for(let s of[this.$box,this.$outline])s.setRect(this.path);this.$resultText.setTransform({x:0,y:i+10*this.scale-6})}setColour(t){super.setColour(t),this.equationArea.$el.css("color",_(this.colour)),this.$resultText.setAttr("fill",_(this.colour))}delete(){super.delete(),this.equationArea.delete()}getSnapPoints(){return[]}focus(t=!1,i){this.focussed||(this.focussed=!0,this.$parent.options.focussed=this,this.creating=t,this.showErrorIcon(void 0),this.$el.css("cursor","text"),this.$parent.selection.clear(),this.equationArea.focus(),this.equationArea.moveCursor(this.getCursorOffset(i)))}blur(){if(!this.focussed)return;this.focussed=!1,this.$parent.options.focussed=void 0,this.$el.css("cursor","grab");let t=this.options;if(this.options=this.equationArea.blur(),this.updateMath(),this.creating||t!==this.options){let i=this.creating?"added":"changed";this.$parent.change({[i]:[this]});for(let s of this.links||[])s.change()}}updateMath(){let t=this.$parent.mathContext;this.watcher&&t.unwatch(this.watcher);let i=t.attemptUpdateSource(this,this.options);if(!i){this.watcher=void 0,this.value=0;return}let s=Dn(i)[1]instanceof zi,n=()=>{let{error:r,value:o}=t.evaluate(i);if(this.showErrorIcon(this.$parent.options.evalEquations?r:void 0),this.value=o||0,s||isNaN(o))return this.$resultText.textStr="";this.$resultText.textStr=`= ${Mt(o,8)}`};this.watcher=n,t.watch(i.unknowns,n,!0)}getCursorOffset(t){return t?this.relativePosn(t.posn).scale(1/this.scale):C}format(t){this.equationArea.handleKey({char:t})}};var L1='<h3>Variable Slider</h3><label class="row"><div class="label">Variable:</div><input class="input-field wide" type="text" :bind="name" style="font-style:italic"></label><label class="row"><div class="label">Range:</div><input class="input-field input-pair" type="number" :bind="min"><input class="input-field input-pair" type="number" :bind="max"></label><label class="row"><div class="label">Increment:</div><input class="input-field wide" type="number" :bind="step"></label><label class="row"><div class="label">Duration:</div><input class="input-field wide" type="number" :bind="duration" min="0.1" max="10"></label><label class="row"><div class="label">Motion:</div><select class="input-field wide" :bind="type"><option value="bounce">Bounce</option><option value="loop">Loop</option><option value="once">Once</option></select></label>';var _a=200,Na=75,ci=20,T3='<tspan style="font-style:italic"></tspan> &nbsp;=&nbsp; <tspan></tspan>',O1="M8,6.8V17.2a.9.9,0,0,0,1.5.8l8.2-5.2a1,1,0,0,0,0-1.7L9.5,6A1,1,0,0,0,8,6.8Z",E3="M8 19a2 2 0 0 0 2-2v-10a2 2 0 0 0 -2-2 2 2 0 0 0 -2 2v10a2 2 0 0 0 2 2zm6-12v10a2 2 0 0 0 2 2 2 2 0 0 0 2-2v-10a2 2 0 0 0 -2-2 2 2 0 0 0 -2 2z";function A3(e,t,i){let s=(Date.now()-e)/1e3;if(i==="once")return s/t;if(i==="loop")return s/t%1;let n=s/(t*2)%1;return n<.5?n*2:1-(n-.5)*2}var Hu=class extends V{constructor(t,i,s){super(i,s);this.type="slider";this.path=new A(C,_a,Na);this.options=t,this.$body=u("rect",{class:"polygon-tile",rx:10},this.$el),this.$outline=u("rect",{class:"outline",rx:10},this.$el),this.$body.setRect(this.path),this.$outline.setRect(this.path),this.$expr=u("text",{x:ci,y:30,html:T3},this.$el),[this.$exprName,this.$exprValue]=this.$expr.$$("tspan"),this.$bar=u("line",{x1:ci,x2:_a-ci,y1:Na-ci,y2:Na-ci,opacity:.5,style:"stroke-width: 4; stroke-linecap: round;"},this.$el);let n=u("g",{transform:"translate(162 12)",style:"cursor: pointer"},this.$el);u("rect",{x:-4,y:-4,width:32,height:32,fill:"transparent"},n),this.$playIcon=u("path",{d:O1},n),i.events.listen(n,{click:()=>this.play()}),this.$handle=this.makeHandle("c",m=>{let v=vt(this.model.min,this.model.max,(m.x-ci)/(_a-2*ci));this.setValue(v),this.updateOptions()}),this.$handle.addClass("persistent");let[r,o,a,h,l,c,p]=this.options.split(":");this.variable=r,this.model=i.bindSettingsPanel(this,L1,{name:r,min:a===void 0?-5:+a,max:h===void 0?5:+h,step:+l||.1,type:c||"bounce",duration:+p||2}),this.model.watchAll((m,v)=>{this.animation&&this.stopAnimating(),this.setValue(v?+o||0:this.value)})}play(){if(this.animation)return this.stopAnimating();this.$playIcon.setAttr("d",E3);let{min:t,max:i,type:s,duration:n}=this.model,r=Date.now(),o=r+n*1e3;this.animation=ot(()=>{let a=A3(r,n,s);this.setValue(vt(t,i,a)),s==="once"&&Date.now()>=o&&this.stopAnimating()})}stopAnimating(){var t;(t=this.animation)==null||t.cancel(),this.animation=void 0,this.$playIcon.setAttr("d",O1),this.updateOptions(),this.$parent.change({changed:[this]})}delete(){this.animation&&this.stopAnimating(),super.delete()}setValue(t){if(t=k(ht(t,this.model.step),this.model.min,this.model.max),this.model.name!==this.variable)this.model.name=this.model.name.replace(/[^A-Za-z]/g,""),this.$parent.mathContext.removeSource(this),this.variable=this.model.name;else if(this.value!==void 0&&T(t,this.value))return;this.value=t;let i=vt(ci,_a-ci,(t-this.model.min)/(this.model.max-this.model.min));this.$handle.setTransform(new d(i,Na-ci)),this.$exprName.text=this.variable,this.$exprValue.text=Mt(t,5),this.$parent.mathContext.updateSource(this,this.variable,new zi(t))}setColour(t){super.setColour(t);let i=_(t),s=q.from(i).brightness<180?"#fff":"#000";this.$body.setAttr("fill",i);for(let n of[this.$expr,this.$playIcon])n.setAttr("fill",s);this.$handle.css("fill",s),this.$bar.setAttr("stroke",s)}updateOptions(){this.options=[this.variable,this.value,this.model.min,this.model.max,this.model.step,this.model.type,this.model.duration].join(":")}static makeThumbnail(t,i){let n=t.split(":")[0],r=u("svg",{width:104,height:54},i);u("rect",{x:2,y:2,width:100,height:50,fill:i.data.colour,rx:5},r),u("rect",{x:10,y:40,width:84,height:3,fill:"white",rx:2,opacity:.5},r),u("circle",{cx:32,cy:41.5,r:6,fill:"white"},r),u("text",{x:52,y:28,fill:"white",style:"font-size:24;font-style:italic;text-anchor:middle",text:n},r)}};var I1={"number-bar":Kc,"number-tile":Ma,polygon:j,pentomino:Gc,tangram:qc,"fraction-bar":Nn,"fraction-circle":au,text:Gu,"algebra-tile":Tr,"log-bar":Rc,grid:lu,"custom-polygon":Nc,image:Du,dice:Fe,"polyhedral-dice":vu,coin:wu,"number-line":ku,penrose:Bc,kolam:Hc,"prime-disk":Sr,balance:uu,"decimal-grid":Xc,spinner:Ir,"custom-spinner":$u,token:pu,egg:zc,geo:Ct,fractal:Uc,ruler:Lu,protractor:Ou,compass:_u,"set-triangle":Ru,"dot-machine":Yc,dot:Pr,garden:jc,tantrix:Wc,axes:Au,"question-blank":Dr,equation:Bu,"number-card":Qc,card:On,abacus:Jc,bucket:eu,table:Nu,pentagon:Zc,domino:Mu,slider:Hu,"number-grid":iu,"number-frame":su,"number-dot":Er,polyhedron:Hs,chart:Su,"pie-chart":Pu,clock:Vu,"box-whisker":Cu};function Gr(e){if(!(e in I1))throw new Error(`Unknown tile type: ${e}`);return I1[e]}var qr=Math.PI/180,R1,_1,Da=new Set,zu=new Set;function V3(e,t,i){let s=At(e-t,i);return s>i/2?s-i:s}function k3(e,t){for(let i of e)if(t(i))return!0;return!1}var Fu=class{constructor(t){this.$parent=t;this.angle=0;this.startAngle=0;this.hasChanged=!1;this.showTools=!1;this.isMoving=!1;this.tiles=new Set;this.implicitChanges=new Set;this.$tools=t.$(".transform-tools"),this.$shadow=t.$(".group-shadow"),this.$rect=this.$tools.$(".group-outline"),this.$rotateBar=this.$tools.$(".rotate-bar"),this.$rotateCircle=this.$tools.$(".rotate-circle"),t.events.listen(this.$rotateCircle,{start:()=>{this.startAngle=this.angle,this.rotateStart()},move:({startPosn:i,posn:s})=>{this.rotate(this.startAngle-new Xt(s,this.center,i).deg)},end:()=>this.rotateEnd()}),H.onKey("up down left right r R",(i,s)=>{if(!this.tiles.size)return;if(s==="r"||s==="R"){if(Array.from(this.tiles).some(l=>l.fixed||!l.canRotate))return;this.rotateStart(),this.rotate(this.angle+(s==="R"?-15:15)),this.rotateEnd();return}let n=C,r=this.$parent.events.shiftKey?5:25,o=s==="left"?-r:s==="right"?r:0,a=s==="up"?-r:s==="down"?r:0,h=n.shift(o,a);this.moveStart(),this.move({posn:h,startPosn:n}),this.moveEnd()}),H.onKey("escape",()=>this.clear())}get size(){return this.tiles.size}add(t,i=!1,s=!1){i&&this.clear(),!t.isActive&&this.$parent.tiles.has(t.id)&&this.select([t],s)}select(t,i=!1){for(let s of t)s.isActive||!this.$parent.tiles.has(s.id)||(this.tiles.add(s),s.select(),this.hasChanged=!0);i||this.update(!0)}remove(t,i=!1){!t.isActive||(t.deselect(),this.hasChanged=!0,this.tiles.delete(t),i||this.update(!0))}clear(){if(!this.isMoving){for(let t of this.tiles)t.deselect();this.tiles.size&&(this.hasChanged=!0),this.tiles.clear(),this.update(!0)}}getTileProperty(t){if(!this.size)return;let i=Array.from(this.tiles),s=t(i[0]);return i.slice(1).some(r=>t(r)!==s)?void 0:s}update(t=!1){if(t&&!this.hasChanged)return;if(this.hasChanged=!1,this.implicitChanges.clear(),!this.size){for(let h of[this.$shadow,this.$tools])h.hide();this.$parent.trigger("change-selection",{tiles:[],color:void 0});return}let i=Array.from(this.tiles);this.angle=this.getTileProperty(h=>h.rot)||0;let s=Ki(...i.map(h=>h.transformed.rotate(-this.angle*qr))),n=s.p.shift(s.w/2,s.h/2).rotate(this.angle*qr).shift(-s.w/2,-s.h/2);this.rect=new A(n,s.w,s.h),this.center=this.rect.center;let r=!!this.$parent.options.canRotate&&i.every(h=>h.canRotate&&!h.fixed);if(i.length===1&&$t(i[0].transformed)&&(r=!1),r&&this.getTileProperty(h=>h.rotateAroundOrigin)){let h=i[0].posn;i.slice(1).every(l=>l.posn.equals(h))&&(this.center=h,this.angle&&i.length===1&&(this.rect=Ki(i[0].transformed.rotate(-this.angle*qr,h))))}this.$rotateBar.toggle(r),this.$rotateCircle.toggle(r);let o=this.size>1||i[0].showSelectionOutline;this.$rect.toggle(o),this.showTools=!this.getTileProperty(h=>h.hideSelectionOutline),this.$tools.toggle(this.showTools),this.$shadow.toggle(o&&this.showTools),(this.size===1?i[0].$container:this.$parent.$svg).append(this.$tools),this.positionTools();let a=this.getTileProperty(h=>h.colour);this.$parent.trigger("change-selection",{tiles:i,color:a})}positionTools(){if(!this.showTools)return;let t=this.rect.rotate(this.angle*qr,this.center);for(let n of[this.$shadow,this.$rect])n.draw(t);let i=new d(this.center.x,this.rect.p.y),s=new rt(i,i.shift(0,-28)).rotate(this.angle*qr,this.center);this.$rotateBar.setLine(s.p1,s.p2),this.$rotateCircle.setCenter(s.p2)}moveStart(){for(let t of this.tiles)if(t.fixed||!t.canMove)return;this.isMoving=!0;for(let t of this.tiles)t.moveStart();this.startSnapPoints=[];for(let t of this.tiles)for(let i of t.snapPoints)this.startSnapPoints.some(s=>i.equals(s))||this.startSnapPoints.push(i);_1=this.rect,R1=this.center,this.$parent.newTileShift=0,this.$parent.trigger("move-start")}move({posn:t,startPosn:i}){if(!this.isMoving)return;let s=t.subtract(i),n=this.startSnapPoints.map(a=>a.add(s)),r=this.$parent.snap(n);r&&(s=s.add(r.shift));let o=this.tiles.size===1?r==null?void 0:r.target:void 0;for(let a of this.tiles)a.move(s,o);this.rect=_1.translate(s),this.center=R1.add(s),this.positionTools(),this.$parent.trigger("move-selection")}moveEnd(t=!1){if(!this.isMoving)return;for(let s of this.tiles)s.transform(),s.moveEnd();if(Ct.computeIntersections(this.$parent),this.$parent.trigger("move-end"),this.isMoving=!1,!this.tiles.size)return;let i=[...Array.from(this.tiles),...Array.from(this.implicitChanges)];this.$parent.change({[t?"added":"changed"]:i}),this.implicitChanges.clear()}rotateStart(){zu.clear();for(let t of this.tiles)for(let i of t.snapAngles)zu.add(At(i+t.rot,180));Da.clear(),Da.add(0);for(let t of this.$parent.tiles.values())if(!t.isActive&&!!k3(this.tiles,i=>d.distance(i.posn,t.posn)<140))for(let i of t.snapAngles)Da.add(At(i+t.rot,180));this.$parent.newTileShift=0}rotate(t){if(t=ht(t,3),t===this.angle)return;let i=Infinity;for(let n of zu)for(let r of Da){let o=V3(r,n+t-this.startAngle,180);Math.abs(o)<Math.abs(i)&&(i=o)}if(Math.abs(i)<8&&(t+=i),t===this.angle)return;let s=t-this.angle;this.angle=t;for(let n of this.tiles)n.posn=n.posn.rotate(s*Math.PI/180,this.center),n.rot=At(n.rot+s,360),n.transform(!0);this.positionTools(),this.$parent.trigger("rotate-selection")}rotateEnd(){for(let t of this.tiles)t.transform();this.$parent.change({changed:Array.from(this.tiles)})}copy(t=!1,i=25){if(this.isMoving||!this.$parent.options.canCopy||!this.tiles.size)return;let s={},n=Array.from(this.tiles).map(r=>r.copy(s,i));this.clear();for(let r of n)this.add(r);t||this.$parent.change({added:n})}delete(){if(this.isMoving||!this.$parent.options.canDelete)return;let t=Array.from(this.tiles).filter(s=>!s.fixed);if(!t.length)return;let i=new Set;for(let s of t){for(let n of s.linkSources||[])i.add(n.source);s.delete()}Ct.computeIntersections(this.$parent),this.$parent.change({deleted:t,changed:Array.from(i).filter(s=>!t.includes(s))}),this.$parent.newTileShift=0}action(t,i){if(i==="copy")return this.copy();if(i==="delete")return this.delete();Gr(t.split(" ")[0]).action(i,Array.from(this.tiles),this.center),this.update()}setOrder(t){for(let i of this.tiles)i.setOrder(t);this.$parent.change({changed:Array.from(this.tiles)})}lock(){let t=Array.from(this.tiles);for(let i of this.tiles)i.lock();this.$parent.change({changed:t})}setFixed(t=!0){let i=Array.from(this.tiles).filter(s=>!s.fixed!=!t);for(let s of i)s.fixed=t;i.length&&this.$parent.change({changed:i})}hide(){let t=Array.from(this.tiles);for(let i of t)i.hide();this.$parent.change({changed:t})}};var L3=5,Zs=class{constructor(t){this.$parent=t}getTileAt(t,i=!0){var o;let s=this.$parent.snap([t.posn],i,!0,!0,"geo"),n=(o=s==null?void 0:s.target)==null?void 0:o.tile;if(!(n==null?void 0:n.locked)&&!(n==null?void 0:n.hidden)&&(n==null?void 0:n.type)==="geo")return n;let r=t.event.target;for(;r;){let a=ua.get(r);if(a&&!a.locked&&!a.hidden&&a.type!=="geo")return a;if(r=r.parentNode||void 0,r===this.$parent._el)return}}hoverGeoTile(t){var i;this.hoveringTile!==t&&((i=this.hoveringTile)==null||i.hover(!1)),t==null||t.hover(),this.hoveringTile=t}down(t){}start(t){}move(t){}end(t){}click(t){}hover(t){}cancel(){}},Uu=class extends Zs{constructor(){super(...arguments);this.clickTimeout=0;this.name="move"}down(t){var s;let i=this.activeTile=this.getTileAt(t,!1);this.previousSelection=void 0,(s=this.$parent.options.focussed)==null||s.blur(),this.$parent.warningBanner.hide(),i?(i.isActive&&this.$parent.events.shiftKey?this.$parent.selection.remove(i):(this.$parent.events.shiftKey||!i.isActive)&&this.$parent.selection.add(i,!this.$parent.events.shiftKey),Wi.addClass("grabbing")):this.$parent.events.shiftKey?this.previousSelection=new Set(this.$parent.selection.tiles):this.$parent.selection.clear()}start(){this.activeTile?(this.$parent.events.altKey&&this.$parent.selection.copy(!0,0),this.$parent.selection.moveStart()):this.$parent.$selection.show()}move(t){var s;if(this.activeTile){this.$parent.selection.move(t);return}let i=A.aroundPoints([t.startPosn,t.posn]);this.$parent.$selection.setRect(i);for(let n of this.$parent.tiles.values()){if(n.locked||n.hidden||!n.canDragToSelect||!n.transformed)continue;let r=dr(i,n.transformed,n.type);(this.$parent.events.shiftKey&&((s=this.previousSelection)==null?void 0:s.has(n))?!r:r)?this.$parent.selection.add(n,!1,!0):this.$parent.selection.remove(n,!0)}this.$parent.selection.update(!0)}end(){this.activeTile?this.$parent.selection.moveEnd():this.$parent.$selection.hide(),Wi.removeClass("grabbing")}click(t){if(this.activeTile){this.activeTile.click(t);let i=Date.now();i-this.clickTimeout<500&&this.activeTile.doubleClick(t),this.clickTimeout=i}}hover(t){let i=this.getTileAt(t,!1);this.hoverGeoTile((i==null?void 0:i.type)==="geo"?i:void 0),this.$parent.$svg.css("cursor",i?"grab":"")}},ju=class extends Zs{constructor(){super(...arguments);this.erased=[];this.name="eraser"}down({posn:t}){this.erase(t)}move({posn:t,lastPosn:i}){let s=d.distance(t,i)/4;for(let n=0;n<s;++n)this.erase(d.interpolate(t,i,n/s))}shouldErase(t,i,s){return It(i)?d.distance(i,t)<10:ie(i)?i.distanceSquared(t)<100:zo(i)?i.edges.some(n=>n.distanceSquared(t)<100):$t(i)&&s==="geo"?Math.abs(d.distance(t,i.c)-i.r)<10:i.contains(t)}erase(t){for(let i of this.$parent.tiles.values())if(!(!i.transformed||!i.canDragToSelect||i.locked||i.hidden)&&this.shouldErase(t,i.transformed,i.type)){i.delete(),this.erased.push(i);return}for(let i of this.$parent.strokes.values())if(i.hitTest(t,10)){i.delete(),this.erased.push(i);return}}end(){this.erased.length&&this.$parent.change({deleted:this.erased}),this.erased=[]}click(){this.end()}},Wu=class extends Zs{constructor(){super(...arguments);this.name="text";this.options="text"}down({posn:t}){let i=this.$parent.newTile(this.options,"");i.setTransform(t.shift(-10,-15)),this.$parent.trigger("add-tile",{tile:i}),i.focus(!0)}},Zu=class extends Zs{constructor(){super(...arguments);this.name="pan"}enable(){this.previousTool=this.$parent.activeTool.name,this.$parent.setActiveTool("pan")}down(t){this.initialOrigin=this.$parent.origin,this.startPosn=Ui(t.event)}move(t){let i=Ui(t.event).subtract(this.startPosn),s=this.initialOrigin.subtract(i.scale(1/this.$parent.zoom));this.$parent.setViewport(s,this.$parent.zoom)}end(){this.$parent.setActiveTool(this.previousTool)}click(){this.end()}},Ga=class extends Zs{constructor(){super(...arguments);this.name="pen";this.options="pen"}getUtensil(t){for(let i of this.$parent.tiles.values()){if(!i.transformed||!b1(i))continue;let s=i.transformed.project(t);if(d.distance(t,s)<30)return i.transformed}}getPoint(t){if(this.options==="ruler"){let i=this.$parent.snap([t]);return i?t.add(i.shift):this.startPoint?t.snap(this.startPoint,L3):t}else return this.utensil?this.utensil.project(t):t}down({posn:t}){this.utensil=this.getUtensil(t),this.startPoint=this.getPoint(t),this.stroke=new hi(this.$parent,[this.startPoint],this.$parent.penColour,this.options)}move({posn:t}){var s,n;let i=this.getPoint(t);this.options==="ruler"?(s=this.stroke)==null||s.setLine(new rt(this.startPoint,i)):(n=this.stroke)==null||n.addPoint(this.getPoint(i))}click(){this.$parent.change({added:[this.stroke]}),this.stroke=this.startPoint=this.utensil=void 0}end(t){var i,s;this.options==="ruler"?(i=this.stroke)==null||i.makeSnapPoints():this.utensil||(s=this.stroke)==null||s.simplify(),this.utensil=void 0,this.click()}},qa=class extends Zs{constructor(){super(...arguments);this.name="geo";this.options="line"}expr(t,i){switch(this.options){case"line":return`segment(${t},${i})`;case"circle":return`circle(${t},distance(${t},${i}))`;case"rect":return`rectangle(${t},${i}.x-${t}.x,${i}.y-${t}.y)`}}snapPoint(t){var r,o,a,h;let i=this.$parent.snap([t]);i&&(t=t.add(i.shift));let s="",n=((o=(r=i==null?void 0:i.target)==null?void 0:r.tile)==null?void 0:o.type)==="geo"?(a=i==null?void 0:i.target)==null?void 0:a.tile:void 0;return(n==null?void 0:n.path)&&It(n.path)&&(s=n.key),((h=i==null?void 0:i.target)==null?void 0:h.intersection)&&(s=i.target.intersection.expr),{point:t,tile:n,expr:s||`point(${t.x},${t.y})`}}getOrMakePointTile(t){var s,n;if(((s=t==null?void 0:t.tile)==null?void 0:s.path)&&It(t.tile.path))return t.tile;if((n=t==null?void 0:t.tile)==null?void 0:n.path){let r=Ns(t.tile.path,t.point),o=new Ct(`${t.tile.key}.at(${r})`,this.$parent);return this.$parent.trigger("add-tile",{tile:o}),o}let i=new Ct(t.expr,this.$parent);return this.$parent.trigger("add-tile",{tile:i}),i}drawPendingPoint(t){var n,r;let i=((r=(n=t.tile)==null?void 0:n.path)==null?void 0:r.type)==="point",s=t.expr.startsWith("intersection");this.$parent.$pendingPoint.toggle(!i),i||(this.$parent.$pendingPoint.setCenter(t.point),this.$parent.$pendingPoint.setClass("intersection",s),this.$parent.$pendingPoint.setAttr("r",s?3.5:6))}down({posn:t}){let i=this.snapPoint(t);this.startPoint=this.getOrMakePointTile(i),this.createdNewStart=!i.tile}start(){var t;this.path=new Ct("",this.$parent),this.startPoint.pending=this.path.pending=!0,(t=this.$parent.$pendingPoint)==null||t.show(),this.hoverGeoTile(void 0)}move({posn:t}){var i;this.endSnap=this.snapPoint(t),this.path.setExpr(this.expr(this.startPoint.key,this.endSnap.expr),!0),this.drawPendingPoint(this.endSnap),this.hoverGeoTile((i=this.endSnap)==null?void 0:i.tile)}end(){var s;let t=d.distance(this.startPoint.path,this.endSnap.point)<8,i;if(t?this.path.delete():(i=this.getOrMakePointTile(this.endSnap),this.path.setExpr(this.expr(this.startPoint.key,i.key)),this.path.setPending(!1),this.$parent.trigger("add-tile",{tile:this.path})),this.startPoint.setPending(!1),(s=this.$parent.$pendingPoint)==null||s.hide(),this.hoverGeoTile(void 0),Ct.computeIntersections(this.$parent),this.createdNewStart||!t){let n=[];this.createdNewStart&&n.push(this.startPoint),this.path&&n.push(this.path),i&&n.push(i),this.$parent.change({added:n})}this.startPoint=this.path=this.endSnap=void 0}click(){this.createdNewStart&&this.$parent.change({added:[this.startPoint]})}hover(t){var s;let i=this.snapPoint(t.posn);this.drawPendingPoint(i),this.hoverGeoTile(((s=i==null?void 0:i.tile)==null?void 0:s.type)==="geo"?i.tile:void 0)}cancel(){this.$parent.$pendingPoint.hide(),this.path&&this.path.delete(),this.startPoint=this.path=this.endSnap=void 0}},Ku=class extends qa{constructor(){super(...arguments);this.name="geoPending";this.startId="";this.expression=""}enable(t){var i;this.expression=t,this.$parent.selection.clear(),this.$parent.setActiveTool("geoPending"),((i=window.event)==null?void 0:i.clientX)&&this.hover({posn:ri(window.event,this.$parent.$svg)})}makePath(){return this.path=new Ct("",this.$parent),this.path.$el.css("opacity",.5),this.path.pending=!0,this.path}down(t){if(!this.expression)return;super.down(t);let i=this.path||this.makePath();i.$el.css("opacity",1),i.setExpr(this.expression.replace(/\$1/g,this.startPoint.key)),i.pending=!1,this.path=void 0,this.$parent.selection.add(i,!0);let s=this.createdNewStart?[this.startPoint]:[];this.$parent.change({added:[...s,i]}),Ct.computeIntersections(this.$parent),this.$parent.trigger("add-tile",{tile:i}),this.$parent.setActiveTool("move")}hover({posn:t}){var s;if(!this.expression)return;let i=this.snapPoint(t);this.drawPendingPoint(i),this.hoverGeoTile(((s=i==null?void 0:i.tile)==null?void 0:s.type)==="geo"?i.tile:void 0),this.path||this.makePath(),this.path.setExpr(this.expression.replace(/\$1/g,i.expr))}cancel(){super.cancel(),this.expression=""}},Xu=class extends Ga{constructor(){super(...arguments);this.name="cutPolygon";this.options="ruler"}enable(){if(this.tiles=Array.from(this.$parent.selection.tiles).filter(t=>!t.fixed),!this.tiles.length)return this.cancel();this.$parent.selection.clear(),this.$parent.setActiveTool("cutPolygon");for(let t of this.tiles)t.$el.addClass("active")}down(){}start({posn:t}){!this.tiles||(this.utensil=this.getUtensil(t),this.startPoint=this.getPoint(t),this.$stroke=u("line",{class:"stroke cut"},this.$parent.$strokes))}move({posn:t}){var i;this.lastPoint=this.getPoint(t),(i=this.$stroke)==null||i.setLine(this.startPoint,this.lastPoint)}end(t){var o;if(t.cancelled)return this.cancel();let i=new Ot(this.startPoint,this.lastPoint),s=!1,n=[],r=[];for(let a of this.tiles||[]){let l=a.transformed.cut(i);if(l.length>1){for(let c of l){let p=new j(ut(c.points),this.$parent);p.setColour(a.colour),p.transform(),n.push(p)}a.delete(),r.push(a),s=!0}else a.$el.removeClass("active")}s&&this.$parent.change({added:n,deleted:r}),(o=this.$stroke)==null||o.remove(),this.$stroke=this.tiles=this.startPoint=this.lastPoint=void 0,this.$parent.setActiveTool("move")}click(){this.cancel()}cancel(){var t;for(let i of this.tiles||[])i.$el.removeClass("active");(t=this.$stroke)==null||t.remove(),this.$stroke=this.tiles=this.startPoint=this.lastPoint=void 0,setTimeout(()=>this.$parent.setActiveTool("move"))}};var N1='<svg class="canvas" tabindex="0"><defs><pattern class="grid-pattern" id="square2-grid" x="0" y="0" width="50" height="50" patternUnits="userSpaceOnUse"><rect x="0" y="0" width="50" height="50" opacity="0.2"></rect></pattern><pattern class="grid-pattern" id="square-dots" x="-4" y="-4" width="25" height="25" patternUnits="userSpaceOnUse"><circle cx="4" cy="4" r="2" opacity="0.3"></circle></pattern><pattern class="grid-pattern" id="square-grid" x="0" y="0" width="125" height="125" patternUnits="userSpaceOnUse"><g opacity="0.2"><line x1="25" y1="0" x2="25" y2="125"></line><line x1="0" y1="25" x2="125" y2="25"></line><line x1="50" y1="0" x2="50" y2="125"></line><line x1="0" y1="50" x2="125" y2="50"></line><line x1="75" y1="0" x2="75" y2="125"></line><line x1="0" y1="75" x2="125" y2="75"></line><line x1="100" y1="0" x2="100" y2="125"></line><line x1="0" y1="100" x2="125" y2="100"></line></g><rect x="0" y="0" width="125" height="125" opacity="0.5"></rect></pattern><pattern class="grid-pattern" id="tri-dots" x="0" y="-4" width="25" height="43.30127018922193" patternUnits="userSpaceOnUse"><circle cx="0" cy="4" r="2" opacity="0.3"></circle><circle cx="25" cy="4" r="2" opacity="0.3"></circle><circle cx="12.5" cy="25.650635094610966" r="2" opacity="0.3"></circle></pattern><pattern class="grid-pattern" id="tri-grid" x="0" y="0" width="25" height="43.30127018922193" patternUnits="userSpaceOnUse"><g opacity="0.2"><line x1="0" y1="0" x2="25" y2="0"></line><line x1="0" y1="21.650635094610966" x2="25" y2="21.650635094610966"></line><line x1="0" y1="43.30127018922193" x2="25" y2="43.30127018922193"></line><line x1="0" y1="0" x2="25" y2="43.30127018922193"></line><line x1="25" y1="0" x2="0" y2="43.30127018922193"></line></g></pattern><pattern class="grid-pattern" id="tri2-dots" x="-4" y="0" width="43.30127018922193" height="25" patternUnits="userSpaceOnUse"><circle cx="4" cy="0" r="2" opacity="0.3"></circle><circle cx="4" cy="25" r="2" opacity="0.3"></circle><circle cx="25.650635094610966" cy="12.5" r="2" opacity="0.3"></circle></pattern><pattern class="grid-pattern" id="tri2-grid" x="0" y="0" width="43.30127018922193" height="25" patternUnits="userSpaceOnUse"><g opacity="0.2"><line x1="0" y1="0" x2="0" y2="25"></line><line x1="21.650635094610966" y1="0" x2="21.650635094610966" y2="25"></line><line x1="43.30127018922193" y1="0" x2="43.30127018922193" y2="25"></line><line x1="0" y1="0" x2="43.30127018922193" y2="25"></line><line x1="0" y1="25" x2="43.30127018922193" y2="0"></line></g></pattern><pattern class="grid-pattern" id="square-checked" x="0" y="0" width="50" height="50" patternUnits="userSpaceOnUse"><rect class="filled" x="0" y="0" width="25" height="25" opacity="0.2"></rect><rect class="filled" x="25" y="25" width="25" height="25" opacity="0.2"></rect></pattern><pattern class="grid-pattern" id="rainbow-grid" x="0" y="0" width="100" height="100" patternUnits="userSpaceOnUse"><g opacity="0.2"><line x1="10" y1="-10" x2="-110" y2="110" style="stroke:#cd0e66" stroke-width="17.677669529663685"></line><line x1="35" y1="-10" x2="-85" y2="110" style="stroke:#fd8c00" stroke-width="17.677669529663685"></line><line x1="60" y1="-10" x2="-60" y2="110" style="stroke:#22ab24" stroke-width="17.677669529663685"></line><line x1="85" y1="-10" x2="-35" y2="110" style="stroke:#0f82f2" stroke-width="17.677669529663685"></line><line x1="110" y1="-10" x2="-10" y2="110" style="stroke:#cd0e66" stroke-width="17.677669529663685"></line><line x1="135" y1="-10" x2="15" y2="110" style="stroke:#fd8c00" stroke-width="17.677669529663685"></line><line x1="160" y1="-10" x2="40" y2="110" style="stroke:#22ab24" stroke-width="17.677669529663685"></line><line x1="185" y1="-10" x2="65" y2="110" style="stroke:#0f82f2" stroke-width="17.677669529663685"></line><line x1="210" y1="-10" x2="90" y2="110" style="stroke:#cd0e66" stroke-width="17.677669529663685"></line></g></pattern><marker id="axis-arrow" refX="3" refY="3" markerWidth="6" markerHeight="6" orient="auto"><path d="M 0 0 L 6 3 L 0 6 z"></path></marker><radialGradient id="sphere-gradient" cx="65%" cy="35%" r="65%"><stop offset="0" stop-color="white" stop-opacity="0.3"></stop><stop offset="0.32" stop-color="white" stop-opacity="0"></stop><stop offset="0.33" stop-opacity="0"></stop><stop offset="1" stop-opacity="0.2"></stop></radialGradient><linearGradient id="card-gradient"><stop offset="0" stop-color="#999"></stop><stop offset="0.08" stop-color="#bbb"></stop><stop offset="0.92" stop-color="#bbb"></stop><stop offset="1" stop-color="#999"></stop></linearGradient><filter id="handdrawn" x="-20%" y="-20%" width="140%" height="140%"><feTurbulence type="fractalNoise" basefrequency="0.004 0.004" numoctaves="26" stitchtiles="stitch" result="turbulence"></feTurbulence><feDisplacementMap in="SourceGraphic" in2="turbulence" scale="20" xchannelselector="R" ychannelselector="G" result="displacementMap"></feDisplacementMap></filter><filter id="pencil" x="-10%" y="-10%" width="110%" height="110%" filterUnits="objectBoundingBox"><feTurbulence type="fractalNoise" baseFrequency="1.2" numOctaves="3" result="noise"></feTurbulence><feDisplacementMap xChannelSelector="R" yChannelSelector="G" scale="2" in="SourceGraphic" result="newSource"></feDisplacementMap></filter><symbol id="suit-c" viewBox="-12 -12 24 24" width="24" height="24" x="-12" y="-12"><path d="m0-10c2.3.1 4.2 1.9 4.3 4.2 0 1.6-.9 3-2.3 3.8.8-.3 1.6-.5 2.5-.5 2.4-.1 4.4 1.7 4.5 4.1v.2c0 2.3-1.9 4.2-4.2 4.2-.1 0-.2 0-.3 0-1.2-.1-2.4-.4-3.5-1 0 0-.3 2 2 5h-6c2.3-3 2-5 2-5-1.1.6-2.3.9-3.5 1-2.3.2-4.3-1.6-4.5-3.9 0-.1 0-.2 0-.3 0-2.4 1.9-4.3 4.3-4.3h.2c.9 0 1.7.2 2.5.5-1.4-.8-2.3-2.2-2.3-3.8.1-2.3 2-4.1 4.3-4.2z"></path></symbol><symbol id="suit-s" viewBox="-12 -12 24 24" width="24" height="24" x="-12" y="-12"><path d="m0-10c-3 5-8 7-8 12 .1 2.1 1.9 3.9 4 4 1.1.1 2.2-.2 3-1 0 0 .3 2-2 5h6c-2-3-2-5-2-5 .8.8 1.9 1.1 3 1 2.1-.1 3.9-1.9 4-4 0-5-5-7-8-12z"></path></symbol><symbol id="suit-h" viewBox="-12 -12 24 24" width="24" height="24" x="-12" y="-12"><path d="m0 8.5-1.3-1.3c-4.6-4.1-7.7-6.9-7.7-10.3-.1-2.7 2.1-4.9 4.8-5h.2c1.5 0 3.1.7 4 1.9 1-1.2 2.5-1.9 4-1.9 2.8-.1 4.9 2.1 5 4.8v.2c0 3.4-3.1 6.2-7.7 10.3z"></path></symbol><symbol id="suit-d" viewBox="-12 -12 24 24" width="24" height="24" x="-12" y="-12"><path d="m7 0-7 10-7-10 7-10"></path></symbol><pattern id="card-bg" width="6" height="8" patternUnits="userSpaceOnUse"><rect width="6" height="8" fill="#0f82f2"></rect><line x2="6" y2="8" stroke="#eee" stroke-width="1"></line><line x1="6" y2="8" stroke="#eee" stroke-width="1"></line></pattern></defs><rect class="grid"></rect><path class="group-shadow"></path><g class="tiles"></g><g class="tiles"></g><g class="tiles"></g><g class="tiles"></g><g class="strokes"></g><g class="geo-shadows"></g><g class="geo-paths"></g><g class="geo-points"></g><g class="tiles"></g><g class="tiles"></g><rect class="selection"></rect><g class="transform-tools" hidden><path class="group-outline"></path><line class="rotate-bar"></line><circle class="rotate-circle" r="10"></circle></g></svg><div class="html-overlay"></div><div class="panels"></div><slot></slot>';var Vi="https://static.mathigon.org/polypad/audio",D1={roll:new ni(`${Vi}/roll.mp3`,.6),spin:new ni(`${Vi}/spin.mp3`,.5),coinToss:new ni(`${Vi}/coin-toss.mp3`,.3),shuffle:new ni(`${Vi}/shuffle.mp3`,.3),draw:new ni(`${Vi}/card-draw.mp3`,.2),click:new ni(`${Vi}/click.mp3`,.3),woosh:new ni(`${Vi}/woosh.mp3`,.2),rise:new ni(`${Vi}/rise.mp3`,.3),fall:new ni(`${Vi}/fall.mp3`,.3)};var Yu=3,O3=new Ve(-2e3,4e3,-2e3,4e3),ki=25,Qu=ki*Math.sqrt(3)/2,Ba=e=>`${e.xMin} ${e.yMin} ${e.dx} ${e.dy}`,G1=e=>!!e.name,Ju=class extends h0{constructor(){super(...arguments);this.tiles=new Map;this.strokes=new Map;this.mathContext=new Tu;this.penColour="#242436";this.initial={};this.intersections=new Set;this.margins=[20,20,20,20];this.tools={move:new Uu(this),pen:new Ga(this),geo:new qa(this),geoPending:new Ku(this),eraser:new ju(this),text:new Wu(this),pan:new Zu(this),cutPolygon:new Xu(this)};this.activeTool=this.tools.move;this.origin=C;this.zoom=1;this.newTileShift=0;this.options=ji({grid:"none",changeCount:0,labelType:"fraction"});this.canPinchPan=!1;this.setup=!1;this.undoStack=[];this.redoStack=[]}ready(){this.$svg=this.$("svg.canvas"),this.$tiles=this.$svg.$$(".tiles"),this.$selection=this.$svg.$(".selection"),this.$strokes=this.$svg.$(".strokes"),this.$grid=this.$svg.$(".grid"),this.$html=this.$(".html-overlay"),this.$panels=this.$(".panels"),this.$geoShadows=this.$svg.$(".geo-shadows"),this.$geoPaths=this.$svg.$(".geo-paths"),this.$geoPoints=this.$svg.$(".geo-points"),this.$pendingPoint=u("circle",{class:"geo-point pending",hidden:!0},this.$geoPoints),this.setAttr("data-tool","move"),this.events=new fr(this.$svg,{down:s=>this.activeTool.down(s),start:s=>this.activeTool.start(s),move:s=>this.activeTool.move(s),end:s=>this.activeTool.end(s),click:s=>this.activeTool.click(s),hover:s=>this.activeTool.hover(s),cursor:!1});let t=this.options;this.$svg.copy=function(s=!0,n=!0,r){let o=Yo.prototype.copy.call(this,s,n,r);if(t.canEditQuestions)for(let a of o.$$(".problem-text"))a.text="?";return o},this.selection=new Fu(this),this.warningBanner=new pc(this),this.isTeacher=this.attr("user-type")==="teacher",this.options.canEditQuestions=this.isTeacher,this.options.canRotate=pr(this,"rotate",!0),this.options.canDelete=pr(this,"delete",!0),this.options.canCopy=pr(this,"copy",!0),this.options.grid=this.attr("grid")||"none",this.setViewport(C,1),this.options.watch(s=>{this.$grid.setAttr("fill",s.grid!=="none"?`url(#${s.grid})`:"none"),this.$grid.setRect(this.canvasBounds.rect)}),pr(this,"pan",!1)&&this.enablePinchPan(),this.$svg.on("contextmenu",s=>{this.options.focussed||s.preventDefault()});let i=!1;this.$svg.on("focusin",()=>{if(!i)return;let s=Array.from(this.tiles.values());this.focusTile(this.events.shiftKey?G(s):s[0])}),this.$svg.on("focusout",()=>this.focussed=void 0),Nt.on("keydown",s=>{if(i=!0,s.keyCode!==9||!this.focussed)return;let n=Array.from(this.tiles.values());this.focusTile(n[n.indexOf(this.focussed)+(s.shiftKey?-1:1)]),this.focussed&&s.preventDefault()}),Nt.on("pointerdown",()=>i=!1),H.onThemeChange(()=>{for(let s of this.tiles.values())s.colour&&s.setColour(s.colour,"theme");for(let s of this.strokes.values())s.setColor(s.color)})}playSound(t){this.options.playAudio&&D1[t].play()}focusTile(t){this.options.focussed||(this.focussed=t,this.$svg.setAttr("aria-description",t?t.ariaDescription:"Empty Canvas"),t&&this.selection.add(t,!0))}*snapPoints(t,i,s){if(!s){for(let n of Ct.tiles)if(!(t&&n.isActive||i&&n.locked||n.pending))for(let r of n.snapPoints)yield[r,{tile:n}]}for(let n of this.tiles.values())if(!(t&&n.isActive||i&&n.locked||n.pending||s&&n.type!==s))for(let r of n.snapPoints)yield[r,{tile:n}];for(let n of this.strokes.values())if(!!n.snapPoints)for(let r of n.snapPoints)yield[r,{stroke:n}];for(let n of this.intersections)yield[n.value,{intersection:n}]}*gridPoints(t){if(this.options.grid==="none")return;let i=this.options.grid.split("-")[0],s=A.aroundPoints(t),n=new Ve(s.p.x-ki,s.p.x+s.w+2*ki,s.p.y-ki,s.p.y+s.h+2*ki);if(i.startsWith("square")){let r=(i==="square2"?2:1)*ki,o=ht(n.xMin,r);for(let a=ht(n.yMin,r);a<n.yMax;a+=r)for(let h=o;h<n.xMax;h+=r)yield[new d(h,a),{}]}else if(i.startsWith("tri")){let r=i==="tri2";r&&(n=n.flip);let o=ht(n.xMin,ki);for(let a=Math.floor(n.yMin/Qu);a*Qu<n.yMax;++a)for(let h=o+(a%2?ki/2:0);h<n.xMax;h+=ki){let l=new d(h,a*Qu);yield[r?l.flip:l,{}]}}}*snapLines(t,i,s){for(let n of this.tiles.values())if(!(t&&n.isActive||i&&n.locked||n.pending||s&&n.type!==s))for(let r of n.snapLines)yield[r,{tile:n}];for(let n of this.strokes.values())if(!!n.snapLines)for(let r of n.snapLines)yield[r,{stroke:n}]}snap(t,i=!0,s=!1,n=!1,r){return ra(8,t,this.snapPoints(i,n,r))||!s&&ra(18,t,this.gridPoints(t))||ra(6,t,this.snapLines(i,n,r),(o,a)=>o.project(a))}getTileAt(t,i){for(let s of this.tiles.values())if(i.includes(s.type)&&s.transformed&&(ii(s.transformed)||$t(s.transformed))&&s.transformed.contains(t))return s}enablePinchPan(){this.canPinchPan=!0,this.on("wheel",s=>{if(s.preventDefault(),s.ctrlKey){let n=this.zoom*(1-s.deltaY/100);this.setViewport(this.origin,n,ri(s,this.$svg))}else{let n=this.origin.shift(s.deltaX/this.zoom,s.deltaY/this.zoom);this.setViewport(n,this.zoom)}});let t=0,i=this.origin;this.on("gesturestart",s=>{s.preventDefault(),i=new d(s.pageX,s.pageY).subtract(this.origin),t=this.zoom,this.events.cancel()}),this.on("gesturechange",s=>{s.preventDefault();let n=t*s.scale,r=new d(s.pageX,s.pageY).subtract(i);this.setViewport(r,n,ri(s,this.$svg))}),this.on("gestureend",s=>s.preventDefault())}enableImageDrop(t,i){let s=u("div",{class:"image-drop"},this);this.imageUploadCallback=t,this.on("dragenter dragover dragleave drop",r=>r.preventDefault()),this.on("dragenter dragover",()=>s.show()),this.on("dragleave drop",()=>s.hide());let n=(r,o)=>E(this,null,function*(){let h=Array.from((r==null?void 0:r.files)||[]).slice(0,10).map((c,p)=>this.newImage(c,o.shift(p*25),t)),l=yield Promise.all(h);this.change({added:l}),this.trigger("paste")});this.on("drop",r=>n(r.dataTransfer,ri(r,this.$svg))),i==null||i.on("change",()=>E(this,null,function*(){yield n(i._el,this.canvasBounds.center),i.value=""}))}bindSettingsPanel(t,i,s){let n=u("div",{class:"polypad-settings",html:i},this.$panels);this.on("change-selection",({tiles:o})=>{n.toggle(o.length===1&&o[0]===t)});let r=ji(s);return n.bindModel(r),r}enableHotkeys(){H.onKey("backspace",()=>this.selection.delete()),H.onKey("z",t=>{(t.ctrlKey||t.metaKey)&&(t.preventDefault(),t.shiftKey?this.redo():this.undo())}),H.onKey("y",t=>{(t.ctrlKey||t.metaKey)&&(t.preventDefault(),this.redo())}),H.onKey("c",t=>{var i;t.ctrlKey||t.metaKey||((i=H.getActiveInput())==null?void 0:i.is("input, textarea, [contenteditable]"))||this.selection.copy()}),Nt.on("cut copy",t=>{var s,n;if(!this.selection.tiles.size||((s=H.getActiveInput())==null?void 0:s.is("input, textarea, [contenteditable]")))return;let i=Array.from(this.selection.tiles).map(r=>r.serialize());for(let r of i)r.links=void 0;(n=window.navigator.clipboard)==null||n.writeText(JSON.stringify(i)),t.type==="cut"&&this.selection.delete()}),Nt.on("paste",t=>E(this,null,function*(){var n,r;if((n=H.getActiveInput())==null?void 0:n.is("input, textarea, [contenteditable]"))return;let i=A0(t.clipboardData);if(i&&this.imageUploadCallback){let o=yield this.newImage(i,this.center.shift(-50),this.imageUploadCallback);return this.trigger("paste"),this.change({added:[o]})}let s=yield(r=window.navigator.clipboard)==null?void 0:r.readText();if(!!s){try{let o=JSON.parse(s);if(!o.length)return;let a=o.map(c=>V.unSerialize(c,this,!0)).filter(c=>c);this.selection.clear();let h=Ki(...a.map(c=>c.transformed)).center,l=this.center.subtract(h).shift(this.newTileShift*25);for(let c of a)c.setTransform(c.posn.add(l)),this.selection.add(c);this.change({added:a}),this.newTileShift+=1}catch(a){let o=this.newTile("text",s);o.setTransform(this.canvasBounds.center.subtract(o.center)),this.selection.add(o,!0),this.change({added:[o]})}this.trigger("paste")}}))}newImage(t,i,s){return E(this,null,function*(){let n=new FileReader;n.readAsDataURL(t),yield new Promise(o=>n.onloadend=o);let r=this.newTile("image",(n.result||"").toString());return r.setTransform(i),this.selection.add(r,!0),yield s==null?void 0:s(t,r),r})}newTile(t,i,s){return new(Gr(t))(i,this,s)}setViewport(t,i=1,s){if(i=k(i,1/Yu,Yu),s){let a=this.zoom/i;t=s.subtract(s.subtract(this.origin).scale(a))}let n=this.width/i,r=this.height/i;this.zoom=i,this.origin=t.clamp(O3.resize(-n,-r)),this.canvasBounds=new Ve(this.origin.x,this.origin.x+n,this.origin.y,this.origin.y+r),this.$svg.setAttr("viewBox",this.attr("viewBox")||Ba(this.canvasBounds)),this.$html.setTransform(this.origin.inverse.scale(this.zoom),0,this.zoom);let o=this.canvasBounds.rect;this.options.grid!=="none"&&this.$grid.setRect(o),Ct.redrawLines(o),this.newTileShift=0}resetViewport(){if(!this.tiles.size&&!this.strokes.size)return this.setViewport(C,1);let t=oa(this.tiles,this.strokes,0),[i,s,n,r]=this.margins,o=(this.width-r-s)/t.dx,a=(this.height-i-n)/t.dy,h=k(Math.min(o,a),1/Yu,1),l=new d(this.width+r-s,this.height+i-n),c=t.center.subtract(l.scale(1/2/h));this.setViewport(c,h)}bindSource(t,i,s,n,r){Gr(i).makeThumbnail(s,t,this,r);let o,a=n==null?void 0:n.$(".tiles"),h=+t.attr("data-rot")||0;this.events.listen(t,{down:()=>this.trigger("add-tile-start"),start:({posn:l})=>{o=this.newTile(i,t.data.options||s),r&&o.setColour(r),o.setTransform(l,h),this.selection.add(o,!0),this.selection.moveStart(),n&&n.setAttr("viewBox",Ba(this.canvasBounds)),(a||o.$container).append(o.$el),this.trigger("add-tile",{tile:o})},move:l=>this.selection.move(l),end:()=>{o.$container.append(o.$el),this.selection.moveEnd(!0)},click:()=>{let l=this.newTile(i,t.data.options||s);l.setTransform(this.center.subtract(l.center).shift(this.newTileShift*25)),r&&l.setColour(r),this.selection.add(l,!0),l.moveEnd(),this.trigger("add-tile",{tile:l}),this.change({added:[l]}),this.newTileShift+=1}})}get center(){let[t,i,s,n]=this.margins;return this.canvasBounds.center.shift((n-i)/this.zoom/2,(t-s)/this.zoom/2)}setActiveTool(t,i){this.activeTool.cancel(),this.activeTool=this.tools[t],i&&(this.activeTool.options=i),this.setAttr("data-tool",t),this.warningBanner.hide(),this.selection.clear()}clear(t=!0){this.selection.clear();let i=[...Array.from(this.tiles.values()),...Array.from(this.strokes.values())];for(let s of i)s.delete();t&&this.setViewport(C,1),this.change({deleted:i})}thumbnail(t,i){let s=oa(this.tiles,this.strokes,50);return this.$svg.pngImage(t,i,Ba(s))}downloadImage(t){var n;this.selection.clear();let i=t||((n=this.options.title)==null?void 0:n.replace(/\s/g,"-").replace(/[^\w-]/g,"").toLowerCase())||"polypad",s=oa(this.tiles,this.strokes,50);this.$svg.downloadImage(`${i}.png`,"png",s.dx,s.dy,Ba(s))}unlockAll(){let t=[];for(let i of this.tiles.values())!i.locked&&!i.hidden||(i.lock(!1),i.hide(!1),t.push(i));this.change({changed:t})}check(t){let i=!1;return new Promise(s=>{this.on("change",()=>{!i&&t(Array.from(this.tiles.values()))&&(i=!0,s())})})}change(t){var i,s,n;this.setup||(this.trigger("change",{action:"change",data:t}),this.undoStack.push({added:(i=t.added)==null?void 0:i.map(r=>r.serialize()),changed:(s=t.changed)==null?void 0:s.map(r=>[r.lastSavedData,r.serialize()]),deleted:(n=t.deleted)==null?void 0:n.map(r=>r.lastSavedData)}),this.undoStack.length>50&&this.undoStack.shift(),this.redoStack=[],this.options.canUndo=!0,this.options.canRedo=!1,this.options.changeCount+=1)}undo(){!this.undoStack.length||(this.applyChange(G(this.undoStack),!0),this.redoStack.push(this.undoStack.pop()),this.options.canUndo=!!this.undoStack.length,this.options.canRedo=!0,this.options.changeCount-=1,this.selection.update(),this.trigger("change",{action:"undo"}))}redo(){!this.redoStack.length||(this.applyChange(G(this.redoStack)),this.undoStack.push(this.redoStack.pop()),this.options.canUndo=!0,this.options.canRedo=!!this.redoStack.length,this.options.changeCount+=1,this.selection.update(),this.trigger("change",{action:"redo"}))}applyChange(t,i=!1){var s,n;for(let r of(i?t.deleted:t.added)||[])(G1(r)?V:hi).unSerialize(r,this);for(let r of(i?t.added:t.deleted)||[])(s=(G1(r)?this.tiles:this.strokes).get(r.id))==null||s.delete();for(let[r,o]of t.changed||[])(n=this.tiles.get(r.id))==null||n.applyChange(i?r:o)}serialize(t=2e3,i=1e3,s=16e3){var n;return{title:(n=this.options.title)==null?void 0:n.slice(0,30),grid:this.options.grid||"none",noLabels:this.options.noLabels,altColors:this.options.altColors,mergeTiles:this.options.mergeTiles,evalEquations:this.options.evalEquations,labelType:this.options.labelType,tiles:Array.from(this.tiles.values()).slice(0,t).map(r=>r.serialize()),strokes:Array.from(this.strokes.values()).slice(0,i).map(r=>r.serialize(s))}}unSerialize(t){if(!!t){this.setup=!0,this.clear(!1),Ct.clearModel();for(let i of t.tiles||[])V.unSerialize(i,this);for(let i of t.strokes||[])hi.unSerialize(i,this);Ct.computeIntersections(this);for(let i of this.tiles.values())i.move();this.setup=!1}}load(t){var i,s,n,r,o;this.initial=t,this.options.canEditQuestions=this.isTeacher&&((i=t.canEdit)!=null?i:!0),this.unSerialize(t),this.undoStack=this.redoStack=[],this.options.assign({title:t.title,grid:t.grid||"none",canUndo:!1,changeCount:0,noLabels:(s=t.noLabels)!=null?s:this.options.noLabels,altColors:(n=t.altColors)!=null?n:this.options.altColors,mergeTiles:(r=t.mergeTiles)!=null?r:this.options.mergeTiles,evalEquations:(o=t.evalEquations)!=null?o:this.options.evalEquations,labelType:t.labelType||this.options.labelType}),this.resetViewport()}};Ju=R([l0("x-polypad",{template:N1})],Ju);var q1=`<div class="factris-panel-left"><div class="keys-play"><button @click="app.reset()" title="Restart Game"><x-icon name="restart" size="36"></x-icon></button><button @click="app.toggle()" :title="playing ? 'Pause' : 'Play'"><span :show="playing"><x-icon name="pause" size="36"></x-icon></span><span :show="!playing"><x-icon name="play" size="36"></x-icon></span></button><button class="highscore-btn" @click="app.showHighscore()" title="Highscore"><x-icon name="trophy" size="36"></x-icon></button></div><div class="panel-item"><div class="text-large" :class="points &gt; 999999 ? 'narrow' : ''">\${numberFormat(points)}</div><div class="text-small">Points</div></div><div class="panel-item"><div class="text-large margin"><span :show="min(time)" data-display="inline">\${min(time)}m</span> \${time % 60}s</div><div class="text-small">Time</div></div><hr :show="highscore.length"><div class="highscore-panel" :show="highscore.length"><div class="highscore-title">Highscore</div><table><tr><td>\${highscore[0].name.slice(0, 4)}</td><td>\${numberFormat(highscore[0].score)}</td></tr><tr><td>\${highscore[1].name.slice(0, 4)}</td><td>\${numberFormat(highscore[1].score)}</td></tr><tr><td>\${highscore[2].name.slice(0, 4)}</td><td>\${numberFormat(highscore[2].score)}</td></tr><tr><td>\${highscore[3].name.slice(0, 4)}</td><td>\${numberFormat(highscore[3].score)}</td></tr><tr><td colspan="2"><a @click="app.showHighscore()">View more\u2026</a></td></tr></table></div><div class="corner"><svg width="13" height="17"><path class="dark" d="M0,0V5A12,12,0,0,1,12,17h1V0Z"></path><path d="M0,0V1A12,12,0,0,1,12,13v4h1V0Z"></path></svg></div></div><div class="factris-panel-right"><div class="panel-item"><div class="text-small">Next blocks:</div><div class="text-large">\${next[0]}</div><div class="text-large">\${next[1]}</div><div class="text-large">\${next[2]}</div><div class="text-large">\${next[3]}</div><div class="text-large">\${next[4]}</div></div><hr><div class="text-small discharge-label">Discharge:</div><button class="discharge" :show="!discardCounter" data-display="inline-block" @click="app.discharge()" title="Discard Tile"><x-icon name="delete" size="36"></x-icon></button><svg class="discharge-count" :show="discardCounter" data-display="inline-block" width="74" height="74" viewBox="0 0 74 74"><circle cx="37" cy="37" r="32" style="strokeDashoffset:\${201*discardCounter/5}px"></circle><text class="large" x="37" y="38">\${discardCounter}</text><text class="small" x="37" y="51">needed</text></svg><div class="corner"><svg width="13" height="17"><path class="dark" d="M0,0V17H1A12,12,0,0,1,13,5V0Z"></path><path d="M0,0V17H1V13A12,12,0,0,1,13,1V0Z"></path></svg></div></div><div class="factris-body"><svg class="factris-board" :show="(playing || lost) &amp;&amp; !showHighscore &amp;&amp; !initial" data-display="visibility"><defs><linearGradient id="shadow" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color: white; stop-opacity: 0.2"></stop><stop offset="100%" style="stop-color: white; stop-opacity: 0.05"></stop></linearGradient></defs><rect class="shadow" fill="url(#shadow)"></rect><g class="tiles"></g><g class="grid"><g class="faint-grid"></g></g><g class="scores"></g></svg><div class="logo" :class="initial &amp;&amp; !showHighscore ? 'show' : ''"><svg viewBox="0 0 200 60" xmlns="http://www.w3.org/2000/svg"><g fill="#ffffff"><path d="m1.5039 59.1143v-57.9034h24.7227v7.8077h-16.4278v17.5659h14.313v7.8071h-14.313v24.7227z"/><path d="m23.7871 59.1143 12.9307-57.9034h6.9122l12.931 57.9034h-8.2954l-2.4394-12.4429h-11.3042l-2.44 12.4429zm20.4937-20.25-4.066-20.9815h-.1626l-4.0664 20.9815z"/><path d="m86.9766 42.6055v3.5781a12.9 12.9 0 0 1 -1.0166 5.083 14.0881 14.0881 0 0 1 -2.8057 4.27 13.5323 13.5323 0 0 1 -4.1885 2.9683 12.2636 12.2636 0 0 1 -5.164 1.0977 18.5964 18.5964 0 0 1 -4.7984-.65 11.3307 11.3307 0 0 1 -4.3911-2.2774 12.5723 12.5723 0 0 1 -3.2123-4.1889 14.814 14.814 0 0 1 -1.2608-6.5463v-31.8795a14.0993 14.0993 0 0 1 .976-5.2861 12.4357 12.4357 0 0 1 2.7648-4.229 12.863 12.863 0 0 1 4.27-2.8054 14.35 14.35 0 0 1 5.4892-1.0169 12.5807 12.5807 0 0 1 9.5151 3.8223 13.6266 13.6266 0 0 1 2.8057 4.4321 14.9842 14.9842 0 0 1 1.0166 5.5708v3.253h-8.2954v-2.7652a6.7153 6.7153 0 0 0 -1.3824-4.2285 4.4819 4.4819 0 0 0 -3.7412-1.789q-3.0915 0-4.1064 1.9111a10.23 10.23 0 0 0 -1.0166 4.8384v29.6025a7.6635 7.6635 0 0 0 1.0976 4.2285q1.098 1.7081 3.9444 1.708a6.0109 6.0109 0 0 0 1.7485-.2846 5.2115 5.2115 0 0 0 1.7485-.9351 4.953 4.953 0 0 0 1.22-1.79 7.2474 7.2474 0 0 0 .4878-2.8462v-2.8457z"/><path d="m99.1748 59.1143v-50.0957h-9.5967v-7.8077h27.4878v7.8077h-9.5959v50.0957z"/><path d="m120.7246 59.1143v-57.9034h13.3369q14.6385 0 14.6385 16.9971a21.4218 21.4218 0 0 1 -1.5859 8.7017 12.2983 12.2983 0 0 1 -5.5708 5.7739l8.9458 26.4307h-8.7832l-7.7256-24.7227h-4.9603v24.7227zm8.2954-50.0957v18.0537h4.7168a8.348 8.348 0 0 0 3.4971-.61 4.7555 4.7555 0 0 0 2.0332-1.7485 7.9534 7.9534 0 0 0 .8945-2.8057 26.9748 26.9748 0 0 0 .2437-3.8628 26.99 26.99 0 0 0 -.2437-3.8628 7.7387 7.7387 0 0 0 -.976-2.8872q-1.5467-2.2753-5.8556-2.2767z"/><path d="m155.6123 59.1143v-57.9034h8.2954v57.9034z"/><path d="m198.7954 17.8828h-8.2949v-1.8706a8.8535 8.8535 0 0 0 -1.3423-4.92 4.962 4.962 0 0 0 -4.5132-2.0737 5.2227 5.2227 0 0 0 -2.7651.65 5.4612 5.4612 0 0 0 -1.708 1.6265 6.8624 6.8624 0 0 0 -.8946 2.3989 15.6706 15.6706 0 0 0 -.2436 2.8057 27.5758 27.5758 0 0 0 .1216 2.8467 5.3954 5.3954 0 0 0 .61 2.0332 4.5014 4.5014 0 0 0 1.4229 1.5449 12.9606 12.9606 0 0 0 2.562 1.3013l6.3433 2.521a15.7628 15.7628 0 0 1 4.4726 2.48 10.7272 10.7272 0 0 1 2.6839 3.2943 15.4228 15.4228 0 0 1 1.22 4.4321 44.0689 44.0689 0 0 1 .3252 5.6524 29.8066 29.8066 0 0 1 -.7319 6.7905 14.3039 14.3039 0 0 1 -2.3584 5.3267 11.699 11.699 0 0 1 -4.4727 3.5781 15.7942 15.7942 0 0 1 -6.75 1.3013 14.7745 14.7745 0 0 1 -5.6113-1.0572 13.31 13.31 0 0 1 -4.4732-2.9277 14.2235 14.2235 0 0 1 -2.9682-4.3506 13.2116 13.2116 0 0 1 -1.0982-5.4082v-3.09h8.2955v2.6025a6.7761 6.7761 0 0 0 1.3418 4.1069q1.3418 1.83 4.5136 1.83a7.2794 7.2794 0 0 0 3.2935-.61 4.3859 4.3859 0 0 0 1.83-1.7486 6.4244 6.4244 0 0 0 .7729-2.7246q.1216-1.5856.1221-3.5376a35.0565 35.0565 0 0 0 -.1631-3.7407 6.4528 6.4528 0 0 0 -.65-2.3584 4.59 4.59 0 0 0 -1.5044-1.4639 19.57 19.57 0 0 0 -2.4805-1.22l-5.9365-2.44q-5.3679-2.1958-7.1972-5.8145a19.9948 19.9948 0 0 1 -1.83-9.0679 21.0112 21.0112 0 0 1 .8945-6.1806 14.0506 14.0506 0 0 1 2.6841-5.042 12.3042 12.3042 0 0 1 4.3506-3.375 14.5257 14.5257 0 0 1 6.3018-1.2609 13.7661 13.7661 0 0 1 5.6519 1.1387 14.5927 14.5927 0 0 1 4.4326 3.0088 12.5712 12.5712 0 0 1 3.7407 8.9458z"/></g></svg></div><x-icon class="play" :class="initial &amp;&amp; !showHighscore ? 'show' : ''" @click="app.play()" name="play" size="80"></x-icon><div class="overlay lost" :class="lost &amp;&amp; !showHighscore ? 'show' : ''">Game over!</div><div class="overlay paused" :class="playing || lost || initial || showHighscore ? '' : 'show'">Paused</div><div class="highscore" :show="showHighscore"><div class="text-large"><x-icon name="trophy" size="36"></x-icon> Highscore</div><table><tr><td>\${highscore[0].name}</td><td>\${numberFormat(highscore[0].score)}</td></tr><tr><td>\${highscore[1].name}</td><td>\${numberFormat(highscore[1].score)}</td></tr><tr><td>\${highscore[2].name}</td><td>\${numberFormat(highscore[2].score)}</td></tr><tr><td>\${highscore[3].name}</td><td>\${numberFormat(highscore[3].score)}</td></tr><tr><td>\${highscore[4].name}</td><td>\${numberFormat(highscore[4].score)}</td></tr><tr><td>\${highscore[5].name}</td><td>\${numberFormat(highscore[5].score)}</td></tr><tr><td>\${highscore[6].name}</td><td>\${numberFormat(highscore[6].score)}</td></tr><tr><td>\${highscore[7].name}</td><td>\${numberFormat(highscore[7].score)}</td></tr><tr><td>\${highscore[8].name}</td><td>\${numberFormat(highscore[8].score)}</td></tr><tr><td>\${highscore[9].name}</td><td>\${numberFormat(highscore[9].score)}</td></tr><tr><td>\${highscore[10].name}</td><td>\${numberFormat(highscore[10].score)}</td></tr></table></div></div><div class="factris-keys"><button class="key-left" :class="key === 'left' ? 'active' : ''" title="Left" @pointerdown="app.keyPress('left')"><x-icon name="left" size="36"></x-icon></button><div class="keys-center"><button class="key-up" :class="key === 'up' ? 'active' : ''" title="Resize" @pointerdown="app.keyPress('up')"><svg class="icon" width="54" height="36" viewBox="0 0 54 36" xmlns="http://www.w3.org/2000/svg"><path d="m41.1973 11 1.5975-1.635a.75.75 0 0 1 1.2751.5325v.495a6 6 0 0 1 5.2501 5.8575.75.75 0 0 1 -1.5 0 4.5 4.5 0 0 0 -3.75-4.3426v1.1475a.75.75 0 0 1 -1.2751.5326l-1.5975-1.56a.7676.7676 0 0 1 -.0001-1.0275z"/><path d="m12.8027 11-1.5975-1.635a.75.75 0 0 0 -1.2752.5324v.495a6 6 0 0 0 -5.25 5.8576.75.75 0 0 0 1.5 0 4.5 4.5 0 0 1 3.75-4.3426v1.1475a.75.75 0 0 0 1.2751.5326l1.5975-1.56a.7676.7676 0 0 0 .0001-1.0275z"/><rect height="11" rx="2" width="11" x="15" y="6"/><rect height="11" rx="2" width="11" x="28" y="6"/><rect height="11" rx="2" width="11" x="15" y="19"/><rect height="11" rx="2" width="11" x="28" y="19"/><path d="m50 21v7h-7v-7zm0-2h-7a2 2 0 0 0 -2 2v7a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2v-7a2 2 0 0 0 -2-2z"/><path d="m11 21v7h-7v-7zm0-2h-7a2 2 0 0 0 -2 2v7a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2v-7a2 2 0 0 0 -2-2z"/></svg>
</button><button class="key-down" :class="key === 'down' ? 'active' : ''" title="Down" @pointerdown="app.keyPress('down')"><x-icon name="down" size="36"></x-icon></button></div><button class="key-right" :class="key === 'right' ? 'active' : ''" title="Right" @pointerdown="app.keyPress('right')"><x-icon name="right" size="36"></x-icon></button></div><div class="factris-panel-top" :class="showHighscore ? 'hide' : ''"><div class="text-small">Block size:</div><div class="text-large">\${active[0] || '?' } = \${active[2]|| '?'} \xD7 \${active[1]|| '?'}</div><div class="corner left"><svg width="13" height="13"><path d="M12,0A12,12,0,0,1,0,12v1H13V0Z"></path></svg></div><div class="corner right"><svg width="13" height="13"><path d="M1,0A12,12,0,0,0,13,12v1H0V0Z"></path></svg></div></div>`;var I3=1e3,nt=xt(+Jd(location.search).size||16,8,24),R3=5,Gn=Math.ceil(nt/2),Ha=nt+Gn,za=[];for(let e=2;e<=nt*1.5;e+=1){let t=nh(e);t&&e>.75*nt||e>nt&&Sd(e)[0]>nt/2||(t&&e>nt/2||e>1.25*nt?za.push(e):za.push(e,e))}var Br=()=>za[Jt.integer(za.length)],_3=Ks(1,nt),N3=nt*10,B1=Ze(e=>N3*2**e,nt),H1=class{constructor(t,i,s){this.$el=S("rect",{width:20,height:20},s),this.setPosition(t,i)}setPosition(t,i){this.x=t,this.y=i,this.$el.setTransform({x:10+20*this.x,y:10+20*this.y})}go(t,i,s){this.setPosition(this.x+s-i,this.y+t)}canSet(t,i,s){return!s.find(n=>n.x===t&&n.y===i)}canGo(t,i,s,n){let r=this.x+s-i,o=this.y+t;return o>=Ha||r<0||r>=nt?!1:this.canSet(r,o,n)}canGoDown(t){return this.canGo(1,0,0,t)}goDown(t=1){if(t!==0)return this.go(t,0,0)}},td=class extends I{constructor(){super(...arguments);this.interval=void 0;this.tiles=[];this.activeTiles=[];this.activeSize=[0,0,0];this.activeFactors=[];this.isDown=!1;this.keyLock=!1;this.requestQueue=Promise.resolve("");this.highscore=!0}ready(){this.$svg=this.$(".factris-board"),this.$tiles=this.$svg.$(".tiles"),this.$shadow=this.$svg.$(".shadow"),this.attr("highscore")==="no"&&(this.highscore=!1);let t=this.$svg.$(".scores");this.$scores=B1.map((i,s)=>{let n=S("g",{},t);return S("text",{text:"+"+i,class:`s${s+1}`},n),n}),this.bindModel(as({time:0,points:0,playing:!1,lost:!1,initial:!0,key:void 0,discardCounter:0,next:[],active:[],highscore:[],showHighscore:!1,min:i=>Math.floor(i/60),numberFormat:ss,app:this}));for(let i of this.$$("button, .play"))i.on("contextmenu",s=>s.preventDefault());P.onKey("left up right down",(i,s)=>{!this.model.playing||(i.preventDefault(),this.isDown=!0,this.model.key=s,this.keyPress(s))}),P.onKey("left up right down",()=>{!this.model.playing||(this.isDown=this.keyLock=!1,this.model.key=void 0)},!0),this.setupSVG(),this.updateHighscore()}setupSVG(){this.$svg.setAttr("viewBox",`0 0 ${(nt+1)*20} ${(Ha+1)*20}`);let t=this.$svg.$(".grid"),i=t.$(".faint-grid");for(let s=0;s<=nt;s+=1){let n=10+s*20,r=10+(Gn+s)*20,o=!(s%4)||s===nt?t:i,a=!(s%2)||s===nt?"thick":"";S("line",{x1:10,y1:r,x2:10+nt*20,y2:r,class:a},o),S("line",{x1:n,y1:10+Gn*20,x2:n,y2:Ha*20+10,class:a},o)}}drawShadow(){!this.activeTiles.length||(this.$shadow.setAttr("x",10+20*this.activeSize[0]),this.$shadow.setAttr("y",10+20*this.activeSize[1]),this.$shadow.setAttr("width",20*this.activeSize[2]),this.$shadow.setAttr("height",20*(Ha-this.activeSize[1])))}newRect(){let t=this.getNewTileSize();this.activeFactors=_3.filter(n=>t%n==0);let i=this.activeFactors.pop(),s=Math.floor((nt-i)/2);this.activeTiles=Ze(n=>new H1(s+n%i,Math.floor(n/i),this.$tiles),t),this.model.active=[t,i,t/i],this.activeSize=[s,t/i,i],this.drawShadow(),this.isDown&&(this.keyLock=!0)}reset(){this.pause(),this.model.time=0,this.model.points=0,this.model.discardCounter=0,this.model.showHighscore=!1,this.model.lost=!1,this.model.next=[Br(),Br(),Br(),Br()];for(let t of this.tiles)t.$el.remove();for(let t of this.activeTiles)t.$el.remove();this.tiles=[],this.newRect(),this.play(),this.requestQueue=Promise.resolve("")}toggle(){this.model.lost?this.reset():this.model.playing?this.pause():this.play()}pause(){this.model.playing=!1,clearInterval(this.interval)}play(){if(this.model.showHighscore=!1,window==null||window.ga("send","event","Factris","play"),this.model.initial||this.model.lost)return this.model.initial=!1,this.reset();this.model.playing=!0,this.interval=window.setInterval(()=>this.tick(),I3)}getNewTileSize(){let t=nt*nt-this.tiles.length;if(this.model.next[0]>t)return t>nt?t-nt:nt;this.model.discardCounter>0&&(this.model.discardCounter-=1);let i=this.model.next[0];return this.model.next=[...this.model.next.slice(1),Br()],i}tick(){if(this.model.time+=1,this.activeTiles.every(r=>r.canGoDown(this.tiles))){for(let r of this.activeTiles)r.goDown();this.activeSize[1]+=1,this.drawShadow();return}this.tiles.push(...this.activeTiles);for(let r of this.activeTiles)r.$el.addClass("fixed");if(this.tiles.some(r=>r.y<Gn))return this.gameOver();this.activeTiles=[];let i=this.getFullRows();if(!i.length)return this.newRect();this.model.points+=kt(B1.slice(0,i.length)),i.length>=6&&Wn(10,150*i.length/nt),this.removeRows(i);let s=this.model.points,n=(s+nt)%13+(s-nt)%87;this.requestQueue=this.requestQueue.then(r=>fi("/factris-verify",{token:r,size:nt,score:s,check:n})),this.trigger("score",{points:s})}getFullRows(){return Ze(t=>this.tiles.filter(i=>i.y===t+Gn),nt).filter(t=>t.length===nt)}removeRows(t){let i=Ii(t);this.tiles=this.tiles.filter(r=>!i.includes(r)),this.$tiles.addClass("animated"),P.redraw();for(let r of i)r.$el.addClass("removing");let s=t.map(r=>r[0].y);for(let r of this.tiles)r.goDown(s.filter(o=>o>r.y).length);let n=400/t.length;for(let[r,o]of s.reverse().entries())this.$scores[r].setTransform({x:10+Gn*20,y:27+o*20}),ui(()=>this.$scores[r].addClass("visible"),r*n);return setTimeout(()=>{for(let r of this.$scores)r.removeClass("visible")},600),setTimeout(()=>{for(let r of i)r.$el.remove();this.$tiles.removeClass("animated"),this.newRect()},1e3),!1}gameOver(){this.model.lost=!0;for(let t of this.activeTiles)t.$el.addClass("error");this.pause(),this.requestQueue.then(t=>{t&&this.trigger("game-over",{token:t,points:this.model.points})})}discharge(){if(!!this.model.playing){for(let t of this.activeTiles)t.$el.remove();this.newRect(),this.model.discardCounter=R3}}keyPress(t,i=!0){if(!!this.model.playing&&!this.keyLock){if(t==="up"){if(!this.activeFactors.length)return;let s=this.activeFactors.pop(),n=this.activeSize[0]+Math.floor((this.activeSize[2]-s)/2),r=this.activeSize[1];if(this.activeTiles.some((h,l)=>!h.canSet(n+l%s,r-1-Math.floor(l/s),this.tiles)))return;for(let[h,l]of this.activeTiles.entries())l.setPosition(n+h%s,r-1-Math.floor(h/s));let a=this.model.active[0];this.model.active=[a,s,a/s],this.activeSize=[n,r,s]}else{let s=t==="down"?1:0,n=t==="left"?1:0,r=t==="right"?1:0;if(this.activeTiles.every(o=>o.canGo(s,n,r,this.tiles))){for(let o of this.activeTiles)o.go(s,n,r);this.activeSize[0]+=r-n,this.activeSize[1]+=s}i&&t==="down"&&setTimeout(()=>this.keyPress("down",!1),100)}this.drawShadow()}}showHighscore(){!this.highscore||(this.pause(),this.model.showHighscore=!0)}updateHighscore(){return E(this,null,function*(){if(!this.highscore)return;let t=yield fetch(`/factris-highscore?size=${nt}`);this.model.highscore=yield t.json()})}};td=R([L("x-factris",{template:q1})],td);var ed=class extends I{ready(){let t=Array.from(this._el.children);this.removeChildren();let i=S("svg",{class:"equation"},this),s=S("g",{transform:"translate(2 0)"},i),n=S("div",{class:"overlay"},this),r=parseFloat(this.css("font-size")),o=this.parents(".text-center").length||this.hasClass("display"),a=new Ci(s,n,0,"",r,!!o);a.setValue(this.attr("expr")||t),this.css({width:a.root.width+4+"px",height:a.root.height+"px","vertical-align":`-${a.root.height-a.root.baseline}px`})}};ed=R([L("x-math")],ed);window.$=N;window.$$=Je;window.Browser=P;var Fa=N("x-modal#privacy");Fa&&Fa.$("form").on("submit",e=>{e.preventDefault();let t=Fa.$('input[name="newsletter"]');fi("/settings/privacy",{policies:"on",newsletter:t.checked?"on":"off"}),Fa.close()});var z1="";function id(){return fetch("/joke").then(e=>e.text()).then(e=>z1=e),z1}var sd=N(".error-box");sd&&sd.on("click",()=>sd.html=id());id();window.tellMeAJoke=function(){return id().replace(/<p>/g,"").replace(/<\/p>/g,`
`).trim()};console.log(`%cWelcome to Mathigon!
%cYou can see our source code at https://github.com/mathigon
%cIf you want to contribute, visit https://mathigon.io
%cJust here for fun? Run tellMeAJoke()`,"color: #cd0e66; font-weight: bold; font-size: 18px;","color: #0f82f2; font-weight: bold;","color: #22ab24; font-weight: bold;","color: #fd8c00; font-weight: bold;");var F1=[38,38,40,40,37,39,37,39,66,65],Hr=0;document.addEventListener("keydown",e=>{e.keyCode===F1[Hr]?(Hr+=1,Hr===F1.length&&(Wn(),Hr=0)):Hr=0});})();